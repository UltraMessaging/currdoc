<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Manager Guide: UMM API Overview</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen_manual.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Manager Guide
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('ummapioverview.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">UMM API Overview </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The UMM API allows you to programmatically create and store application configurations in the UMM database. The UMM GUI uses the same API to create users, passwords, applications configurations and configuration templates. See <a href="../UMM_Java_API/index.html">UMM Java API</a> for UMM objects, constructors and methods.</p>
<p>Programs that create application XML configurations store them in the UMM Configuration Database as shown in the diagram, Architecture for Programming Application Configurations. The UMM Daemon serves the XML configuration to UM applications.</p>
<div class="image">
<img src="programming_architecture.png" alt="programming_architecture.png"/>
</div>
 <p>The following sample code provides a framework for creating an application configuration, test_application with two templates. '<code>template_1</code>' sets the file descriptor type option for a UM context. <code>'template_2</code>' sets the resolver multicast address and port. Use of the application configuration is also authenticated with a username and password.</p>
<p>See <a class="elRef" doxygen="/29W/Amun/home/sford/sfordmac_DEV_HF_6_12/29West/lbm/doc/UMM/config.tag:../Config/" href="../Config/xmlconfigurationfiles.html#umelementtemplates">&lt;templates&gt;</a> and <a class="elRef" doxygen="/29W/Amun/home/sford/sfordmac_DEV_HF_6_12/29West/lbm/doc/UMM/config.tag:../Config/" href="../Config/xmlconfigurationfiles.html#umelementapplications">&lt;applications&gt;</a> for more information about XML configuration elements. See also <a class="el" href="usingtheummgui.html#creatingconfigurationtemplates">Creating Configuration Templates</a> and <a class="el" href="usingtheummgui.html#creatingapplicationconfigurations">Creating Application Configurations</a> for information on creating templates and application configurations using the UMM GUI.</p>
<pre class="fragment">package umm.api;

import java.io.CharArrayReader;
import java.util.ArrayList;
import java.util.logging.Level;
import java.util.logging.Logger;
import org.w3c.dom.Document;
import org.w3c.dom.Node;
import org.xml.sax.InputSource;
import umm.api.NameValue;
import umm.api.UMMAPI;
import umm.api.util.DOMUtil;
import umm.api.util.Util;

public class Example {

    String test_application = "&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n"
            + "&lt;application name=\"test_application\" template=\"\"&gt;\n"
            + " &lt;contexts order=\"deny,allow\"&gt;\n"
            + "&lt;context rule=\"allow\" template=\"\"&gt;\n"
            + "&lt;sources order=\"deny,allow\"/&gt;\n"
            + " &lt;receivers order=\"deny,allow\"/&gt;\n"
            + "&lt;wildcard-receivers order=\"deny,allow\"/&gt;\n"
            + " &lt;/context&gt;\n"
            + " &lt;/contexts&gt;\n"
            + "&lt;event-queues order=\"deny,allow\"&gt;\n"
            + " &lt;event-queue rule=\"allow\"/&gt;\n"
            + "&lt;/event-queues&gt;\n"
            + "&lt;/application&gt;";
    String template_1 = "&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n"
            + "&lt;template name=\"template_1\"&gt;\n"
            + "&lt;options type=\"context\"&gt;\n"
            + "&lt;option default-value=\"epoll\" name=\"fd_management_type\"/&gt;\n"
            + "&lt;/options&gt;\n"
            + "&lt;/template&gt;";
    String template_2 = "&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n"
            + "&lt;template name=\"template_2\"&gt;\n"
            + "&lt;options type=\"context\"&gt;\n"
            + "&lt;option default-value=\"224.9.10.11\" name=\"resolver_multicast_address\"/&gt;\n"
            + "&lt;option default-value=\"12965\" name=\"resolver_multicast_port\"/&gt;\n"
            + "&lt;/options&gt;\n"
            + "&lt;/template&gt;";
    UMMAPI api;

    private void init(String machine, int port) throws Exception {

        //Create the UMMPI object. The constructor takes a machine name and port 
        //which are used to connect to the UMM Daemon.
        api = new UMMAPI(machine, port);
        System.out.println("Init Success");
    }

    private void login(String userName, String password) throws Exception {

        //Login to the UMM system. The login method must be called with a valid username 
        //and password. The login user must be a UMM administrative user.
    if (api.login(userName, password)) {
            System.out.println("login Success");
            return;
        }
        System.out.println("login Failure");
        System.exit(-1);
    }

    public Example(String args[]) {
        try {

            String machine = args[0];
            int port = Integer.parseInt(args[1]);
            String userName = args[2];
            String password = args[3];

            init(machine, port); //Connect to the UMM daemon
            login(userName, password); //Login to the daemon.

            ArrayList&lt;NameValue&gt; templateList = new ArrayList();
            // Need a list of templates to assign to the Application.

            NameValue nv = api.saveTemplate("template_1", template_1);
            if (nv == null) {
                System.out.println("saveTemplate Failure");
                System.exit(-1);
            }
            templateList.add(nv);

            nv = api.saveTemplate("template_2", template_2);
            if (nv == null) {
                System.out.println("saveTemplate Failure");
                System.exit(-1);
            }
            templateList.add(nv);

            String xml = setTemplateXML(templateList, test_application);
            if (xml == null) {
                System.out.println("setTemplateXML Failure");
                System.exit(-1);
            }

            //The template names must be set in the xml.
            if (api.saveApplication("test_application", xml) == null) {
                System.out.println("saveApplication Failure");
                System.exit(-1);
            }

            //The template names must be set in the Database.
            if (api.setTemplates("test_application", templateList) == false) {
                System.out.println("setTemplates Failure");
                System.exit(-1);
            }

            System.out.println("##############################################");
            System.out.println(api.getConfig("test_application"));
        } catch (Exception ex) {
            Logger.getLogger(Example.class.getName()).log(Level.SEVERE, null, ex);
        }
        
        api.logOff();
    }

    private String setTemplateXML(ArrayList&lt;NameValue&gt; list, String xml) {
        try {

            StringBuilder sb = new StringBuilder();

            //Build the template name string.
            for (NameValue nv : list) {
                sb.append(nv.getName() + ",");
            }
            // Remove the last ","
            if (sb.length() &gt; 0) {
                sb.delete(sb.length() - 1, sb.length());
            }
            
            //Create a DOM document.
            CharArrayReader characterStream = new CharArrayReader(xml.toCharArray());
            InputSource is = new InputSource(characterStream);
            Document document = DOMUtil.createDocument(is);
            Node node = (Node) document.getDocumentElement();
            
            //Find the correct node to add the templates to.
            node = DOMUtil.findNode("contexts", node);
            if (node == null) {
                System.out.println("No contexts node");
                return null;
            }
            node = DOMUtil.findNode("context", node);
            if (node == null) {
                System.out.println("No context node");
                return null;
            }
            if (node.getAttributes().getNamedItem("template") != null) {
                node.getAttributes().getNamedItem("template").setNodeValue(sb.toString());
                return DOMUtil.getXML(document);
            }
        } catch (Exception ex) {
            ex.printStackTrace();
        }
        return null;
    }

    public static void main(String args[]) {
        new Example(args);
        System.exit(0);
    }
}
</pre> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
</body>
</html>
