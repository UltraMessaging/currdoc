<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Manager Guide: UMM API Overview</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen_manual.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Manager Guide
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('ummapioverview.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">UMM API Overview </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The UMM API allows you to programmatically create and store application configurations in the UMM database. The UMM GUI uses the same API to create users, passwords, applications configurations and configuration templates. See <a href="../UMM_Java_API/index.html">UMM Java API</a> for UMM objects, constructors and methods.</p>
<p>Programs that create application XML configurations store them in the UMM Configuration Database as shown in the diagram, Architecture for Programming Application Configurations. The UMM Daemon serves the XML configuration to UM applications.</p>
<div class="image">
<img src="programming_architecture.png" alt="programming_architecture.png"/>
</div>
 <p>The following sample code provides a framework for creating an application configuration, test_application with two templates. '<code>template_1</code>' sets the file descriptor type option for a UM context. <code>'template_2</code>' sets the resolver multicast address and port. Use of the application configuration is also authenticated with a username and password.</p>
<p>See <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UMM/config.tag:../Config/" href="../Config/xmlconfigurationfiles.html#umelementtemplates">&lt;templates&gt;</a> and <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UMM/config.tag:../Config/" href="../Config/xmlconfigurationfiles.html#umelementapplications">&lt;applications&gt;</a> for more information about XML configuration elements. See also <a class="el" href="usingtheummgui.html#creatingconfigurationtemplates">Creating Configuration Templates</a> and <a class="el" href="usingtheummgui.html#creatingapplicationconfigurations">Creating Application Configurations</a> for information on creating templates and application configurations using the UMM GUI.</p>
<div class="fragment"><div class="line"><span class="keyword">package </span>umm.api;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.io.CharArrayReader;</div><div class="line"><span class="keyword">import</span> java.util.ArrayList;</div><div class="line"><span class="keyword">import</span> java.util.logging.Level;</div><div class="line"><span class="keyword">import</span> java.util.logging.Logger;</div><div class="line"><span class="keyword">import</span> org.w3c.dom.Document;</div><div class="line"><span class="keyword">import</span> org.w3c.dom.Node;</div><div class="line"><span class="keyword">import</span> org.xml.sax.InputSource;</div><div class="line"><span class="keyword">import</span> umm.api.NameValue;</div><div class="line"><span class="keyword">import</span> umm.api.UMMAPI;</div><div class="line"><span class="keyword">import</span> umm.api.util.DOMUtil;</div><div class="line"><span class="keyword">import</span> umm.api.util.Util;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">class </span>Example {</div><div class="line"></div><div class="line">    String test_application = <span class="stringliteral">&quot;&lt;?xml version=\&quot;1.0\&quot; encoding=\&quot;UTF-8\&quot;?&gt;\n&quot;</span></div><div class="line">            + <span class="stringliteral">&quot;&lt;application name=\&quot;test_application\&quot; template=\&quot;\&quot;&gt;\n&quot;</span></div><div class="line">            + <span class="stringliteral">&quot; &lt;contexts order=\&quot;deny,allow\&quot;&gt;\n&quot;</span></div><div class="line">            + <span class="stringliteral">&quot;&lt;context rule=\&quot;allow\&quot; template=\&quot;\&quot;&gt;\n&quot;</span></div><div class="line">            + <span class="stringliteral">&quot;&lt;sources order=\&quot;deny,allow\&quot;/&gt;\n&quot;</span></div><div class="line">            + <span class="stringliteral">&quot; &lt;receivers order=\&quot;deny,allow\&quot;/&gt;\n&quot;</span></div><div class="line">            + <span class="stringliteral">&quot;&lt;wildcard-receivers order=\&quot;deny,allow\&quot;/&gt;\n&quot;</span></div><div class="line">            + <span class="stringliteral">&quot; &lt;/context&gt;\n&quot;</span></div><div class="line">            + <span class="stringliteral">&quot; &lt;/contexts&gt;\n&quot;</span></div><div class="line">            + <span class="stringliteral">&quot;&lt;event-queues order=\&quot;deny,allow\&quot;&gt;\n&quot;</span></div><div class="line">            + <span class="stringliteral">&quot; &lt;event-queue rule=\&quot;allow\&quot;/&gt;\n&quot;</span></div><div class="line">            + <span class="stringliteral">&quot;&lt;/event-queues&gt;\n&quot;</span></div><div class="line">            + <span class="stringliteral">&quot;&lt;/application&gt;&quot;</span>;</div><div class="line">    String template_1 = <span class="stringliteral">&quot;&lt;?xml version=\&quot;1.0\&quot; encoding=\&quot;UTF-8\&quot;?&gt;\n&quot;</span></div><div class="line">            + <span class="stringliteral">&quot;&lt;template name=\&quot;template_1\&quot;&gt;\n&quot;</span></div><div class="line">            + <span class="stringliteral">&quot;&lt;options type=\&quot;context\&quot;&gt;\n&quot;</span></div><div class="line">            + <span class="stringliteral">&quot;&lt;option default-value=\&quot;epoll\&quot; name=\&quot;fd_management_type\&quot;/&gt;\n&quot;</span></div><div class="line">            + <span class="stringliteral">&quot;&lt;/options&gt;\n&quot;</span></div><div class="line">            + <span class="stringliteral">&quot;&lt;/template&gt;&quot;</span>;</div><div class="line">    String template_2 = <span class="stringliteral">&quot;&lt;?xml version=\&quot;1.0\&quot; encoding=\&quot;UTF-8\&quot;?&gt;\n&quot;</span></div><div class="line">            + <span class="stringliteral">&quot;&lt;template name=\&quot;template_2\&quot;&gt;\n&quot;</span></div><div class="line">            + <span class="stringliteral">&quot;&lt;options type=\&quot;context\&quot;&gt;\n&quot;</span></div><div class="line">            + <span class="stringliteral">&quot;&lt;option default-value=\&quot;224.9.10.11\&quot; name=\&quot;resolver_multicast_address\&quot;/&gt;\n&quot;</span></div><div class="line">            + <span class="stringliteral">&quot;&lt;option default-value=\&quot;12965\&quot; name=\&quot;resolver_multicast_port\&quot;/&gt;\n&quot;</span></div><div class="line">            + <span class="stringliteral">&quot;&lt;/options&gt;\n&quot;</span></div><div class="line">            + <span class="stringliteral">&quot;&lt;/template&gt;&quot;</span>;</div><div class="line">    UMMAPI api;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keywordtype">void</span> init(String machine, <span class="keywordtype">int</span> port) <span class="keywordflow">throws</span> Exception {</div><div class="line"></div><div class="line">        <span class="comment">//Create the UMMPI object. The constructor takes a machine name and port </span></div><div class="line">        <span class="comment">//which are used to connect to the UMM Daemon.</span></div><div class="line">        api = <span class="keyword">new</span> UMMAPI(machine, port);</div><div class="line">        System.out.println(<span class="stringliteral">&quot;Init Success&quot;</span>);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keywordtype">void</span> login(String userName, String password) <span class="keywordflow">throws</span> Exception {</div><div class="line"></div><div class="line">        <span class="comment">//Login to the UMM system. The login method must be called with a valid username </span></div><div class="line">        <span class="comment">//and password. The login user must be a UMM administrative user.</span></div><div class="line">    <span class="keywordflow">if</span> (api.login(userName, password)) {</div><div class="line">            System.out.println(<span class="stringliteral">&quot;login Success&quot;</span>);</div><div class="line">            <span class="keywordflow">return</span>;</div><div class="line">        }</div><div class="line">        System.out.println(<span class="stringliteral">&quot;login Failure&quot;</span>);</div><div class="line">        System.exit(-1);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">public</span> Example(String args[]) {</div><div class="line">        <span class="keywordflow">try</span> {</div><div class="line"></div><div class="line">            String machine = args[0];</div><div class="line">            <span class="keywordtype">int</span> port = Integer.parseInt(args[1]);</div><div class="line">            String userName = args[2];</div><div class="line">            String password = args[3];</div><div class="line"></div><div class="line">            init(machine, port); <span class="comment">//Connect to the UMM daemon</span></div><div class="line">            login(userName, password); <span class="comment">//Login to the daemon.</span></div><div class="line"></div><div class="line">            ArrayList&lt;NameValue&gt; templateList = <span class="keyword">new</span> ArrayList();</div><div class="line">            <span class="comment">// Need a list of templates to assign to the Application.</span></div><div class="line"></div><div class="line">            NameValue nv = api.saveTemplate(<span class="stringliteral">&quot;template_1&quot;</span>, template_1);</div><div class="line">            <span class="keywordflow">if</span> (nv == null) {</div><div class="line">                System.out.println(<span class="stringliteral">&quot;saveTemplate Failure&quot;</span>);</div><div class="line">                System.exit(-1);</div><div class="line">            }</div><div class="line">            templateList.add(nv);</div><div class="line"></div><div class="line">            nv = api.saveTemplate(<span class="stringliteral">&quot;template_2&quot;</span>, template_2);</div><div class="line">            <span class="keywordflow">if</span> (nv == null) {</div><div class="line">                System.out.println(<span class="stringliteral">&quot;saveTemplate Failure&quot;</span>);</div><div class="line">                System.exit(-1);</div><div class="line">            }</div><div class="line">            templateList.add(nv);</div><div class="line"></div><div class="line">            String xml = setTemplateXML(templateList, test_application);</div><div class="line">            <span class="keywordflow">if</span> (xml == null) {</div><div class="line">                System.out.println(<span class="stringliteral">&quot;setTemplateXML Failure&quot;</span>);</div><div class="line">                System.exit(-1);</div><div class="line">            }</div><div class="line"></div><div class="line">            <span class="comment">//The template names must be set in the xml.</span></div><div class="line">            <span class="keywordflow">if</span> (api.saveApplication(<span class="stringliteral">&quot;test_application&quot;</span>, xml) == null) {</div><div class="line">                System.out.println(<span class="stringliteral">&quot;saveApplication Failure&quot;</span>);</div><div class="line">                System.exit(-1);</div><div class="line">            }</div><div class="line"></div><div class="line">            <span class="comment">//The template names must be set in the Database.</span></div><div class="line">            <span class="keywordflow">if</span> (api.setTemplates(<span class="stringliteral">&quot;test_application&quot;</span>, templateList) == <span class="keyword">false</span>) {</div><div class="line">                System.out.println(<span class="stringliteral">&quot;setTemplates Failure&quot;</span>);</div><div class="line">                System.exit(-1);</div><div class="line">            }</div><div class="line"></div><div class="line">            System.out.println(<span class="stringliteral">&quot;##############################################&quot;</span>);</div><div class="line">            System.out.println(api.getConfig(<span class="stringliteral">&quot;test_application&quot;</span>));</div><div class="line">        } <span class="keywordflow">catch</span> (Exception ex) {</div><div class="line">            Logger.getLogger(Example.class.getName()).log(Level.SEVERE, null, ex);</div><div class="line">        }</div><div class="line">        </div><div class="line">        api.logOff();</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">private</span> String setTemplateXML(ArrayList&lt;NameValue&gt; list, String xml) {</div><div class="line">        <span class="keywordflow">try</span> {</div><div class="line"></div><div class="line">            StringBuilder sb = <span class="keyword">new</span> StringBuilder();</div><div class="line"></div><div class="line">            <span class="comment">//Build the template name string.</span></div><div class="line">            <span class="keywordflow">for</span> (NameValue nv : list) {</div><div class="line">                sb.append(nv.getName() + <span class="stringliteral">&quot;,&quot;</span>);</div><div class="line">            }</div><div class="line">            <span class="comment">// Remove the last &quot;,&quot;</span></div><div class="line">            <span class="keywordflow">if</span> (sb.length() &gt; 0) {</div><div class="line">                sb.delete(sb.length() - 1, sb.length());</div><div class="line">            }</div><div class="line">            </div><div class="line">            <span class="comment">//Create a DOM document.</span></div><div class="line">            CharArrayReader characterStream = <span class="keyword">new</span> CharArrayReader(xml.toCharArray());</div><div class="line">            InputSource is = <span class="keyword">new</span> InputSource(characterStream);</div><div class="line">            Document document = DOMUtil.createDocument(is);</div><div class="line">            Node node = (Node) document.getDocumentElement();</div><div class="line">            </div><div class="line">            <span class="comment">//Find the correct node to add the templates to.</span></div><div class="line">            node = DOMUtil.findNode(<span class="stringliteral">&quot;contexts&quot;</span>, node);</div><div class="line">            <span class="keywordflow">if</span> (node == null) {</div><div class="line">                System.out.println(<span class="stringliteral">&quot;No contexts node&quot;</span>);</div><div class="line">                <span class="keywordflow">return</span> null;</div><div class="line">            }</div><div class="line">            node = DOMUtil.findNode(<span class="stringliteral">&quot;context&quot;</span>, node);</div><div class="line">            <span class="keywordflow">if</span> (node == null) {</div><div class="line">                System.out.println(<span class="stringliteral">&quot;No context node&quot;</span>);</div><div class="line">                <span class="keywordflow">return</span> null;</div><div class="line">            }</div><div class="line">            <span class="keywordflow">if</span> (node.getAttributes().getNamedItem(<span class="stringliteral">&quot;template&quot;</span>) != null) {</div><div class="line">                node.getAttributes().getNamedItem(<span class="stringliteral">&quot;template&quot;</span>).setNodeValue(sb.toString());</div><div class="line">                <span class="keywordflow">return</span> DOMUtil.getXML(document);</div><div class="line">            }</div><div class="line">        } <span class="keywordflow">catch</span> (Exception ex) {</div><div class="line">            ex.printStackTrace();</div><div class="line">        }</div><div class="line">        <span class="keywordflow">return</span> null;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keywordtype">void</span> main(String args[]) {</div><div class="line">        <span class="keyword">new</span> Example(args);</div><div class="line">        System.exit(0);</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><p><br />
<br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
</p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
</body>
</html>
