<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Operations Guide: Startup/Shutdown Procedures</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen_manual.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Operations Guide
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('startupshutdownprocedures.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Startup/Shutdown Procedures </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>In a multicast environment, only the applications and monitoring tools need to be started. If using Persistence, the store daemon (umestored) also needs to be started. Likewise, use of the UM Router requires starting the UM Router daemon (tnwgd).</p>
<p>In a unicast-only environment, one or more resolver daemons (lbmrd) are typically required. It is recommended that you start the lbmrd before starting the applications.</p>
<p>Informatica recommends that you shutdown applications using UM sources and receivers cleanly, even though UM is able to cope with the ungraceful shutdown and restart of applications and UM daemons.</p>
<p>A failed assertion could lead to immediate application shutdown. If opting to restart a UM client or lbmrd, no other components need be restarted. Failed assertions should be logged with Informatica support.</p>
<p><br />
 </p>
<h1><a class="anchor" id="topicresolution"></a>
Topic Resolution</h1>
<p>Your UM development or administration team should anticipate the time and bandwidth required to resolve all topics when all applications initially start. This team should also establish any restarting restrictions.</p>
<p>Operations staff should not have any direct topic resolution tasks aside from monitoring the increased CPU and bandwidth usage.</p>
<p>Topic resolution is the discovery of a topic's transport session information by a receiver to enable the receipt of topic messages. Although in a multicast environment, topic resolution does not need to be started or shutdown, it does use network resources and can cause deaf receivers and other problems if not operating properly. See <em>Topic Resolution</em> in the <em>UM Concepts Guide</em> for more detailed information.</p>
<p>Applications cannot deliver messages until topic resolution completes. UM monitoring statistics are active before all topics resolve. In a large topic space approximately 10,000 topics) topic resolution messages may be 'staggered' or rate controlled, taking potentially several seconds to complete.</p>
<p>For example, 10,000 topics at the default value of 1,000 for <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.11.1_RC1/doc/Operations/config.tag:../Config/" href="../Config/grpresolveroperation.html#resolverinitialadvertisementspersecondcontext">resolver_initial_advertisements_per_second (context)</a> will take 10 seconds to send out an advertisement for every topic. If all receiving applications have been started first, fully resolving all topics may not take much more than 10 seconds. The rate of topic resolution can also be controlled with the <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.11.1_RC1/doc/Operations/config.tag:../Config/" href="../Config/grpresolveroperation.html#resolverinitialadvertisementbpscontext">resolver_initial_advertisement_bps (context)</a> configuration option. Topic advertisements contain the topic string and approximately 110 bytes overhead. Topic queries from receivers contain no overhead, only the topic string.</p>
<p><br />
 </p>
<h1><a class="anchor" id="umapplications"></a>
UM Applications</h1>
<p>Your UM development team should provide you with the application names, resident machines and startup parameters, along with a sequence of application/daemon startups and shutdowns.</p>
<p>The following lists typical application startup errors.</p>
<ul>
<li>
Lack of resources </li>
<li>
License not configured - LOG Level 3: CRITICAL: LBM license invalid [LBM_LICENSE_FILENAME nor LBM_LICENSE_INFO are set] </li>
<li>
<p class="startli">Cannot bind port - lbm_context_create: could not find open TCP server port in range.</p>
<p>Too many applications may be running using the UM context's configured port range on this machine. This possibility should be escalated to your UM development team.</p>
<p class="endli">Application is possibly already running. It is possible to start more than one instance of the same UM application. </p>
</li>
<li>
Invalid network interface name / mask - lbm_config: line 1: no interfaces matching criteria </li>
<li>
Multiple interfaces detected - LOG Level 5: WARNING: Host has multiple multicast-capable interfaces; going to use [en1][10.10.10.102] </li>
</ul>
<p>This message appears for multi-homed machines. UM is not explicitly configured to use a single interface. This may not cause an issue but requires configuration review by your UM development team.</p>
<p><br />
 </p>
<h1><a class="anchor" id="indicationsofpossibleapplicationshutdown"></a>
Indications of Possible Application Shutdown</h1>
<p>A UM application shutdown may not be obvious immediately, especially if you are monitoring scores of applications. The following lists events that may indicate an application has shutdown.</p>
<ul>
<li>
The Process ID disappears. Consider a method to monitor all process IDs (PIDs). </li>
<li>
You notice the existence of a core dump file on the machine. </li>
<li>
UM statistics appear to reduce in volume or stop flowing. </li>
<li>
In an Application Log, one or more End Of Session (EOS) events signaling the cessation of a transport session. This may indicate a source application may have shut down. Your UM development team must explicitly log LBM_MSG_EOS events. Some EOS events may be delayed for some transports. </li>
<li>
In an Application Log, disconnect events (LBM_SRC_EVENT_DISCONNECT) for unicast transports (if implemented) indicate UM receiver applications have shutdown. </li>
</ul>
<p><br />
 </p>
<h1><a class="anchor" id="unicasttopicresolverlbmrd"></a>
Unicast Topic Resolver (lbmrd)</h1>
<p>If not using multicast topic resolution, one or more instances of lbmrd must be started prior to stating applications. Unicast resolver daemons require an XML configuration file and multiple resolver daemons can be specified by your UM development team for resiliency. See UM Concepts Guide, Unicast Topic Resolution for more details.</p>
<p>Execute the following command on the appropriate machine to start a unicast topic resolver (lbmrd).</p>
<pre class="fragment">lbmrd --interface=ADDR -L daemon_logfile.out -p PORT lbmrd.cfg
</pre><p>To stop the resolver, use the kill command. If a unicast resolver daemon terminates, you need to restart it.</p>
<p>Observe the lbmrd logfile for errors and warnings</p>
<p>If running multiple lbmrds and an lbmrd in the list becomes inactive, the following log message appears:</p>
<pre class="fragment">unicast resolver "&lt;ip&gt;:&lt;port&gt;" went inactive
</pre><p>If all unicast resolver daemons become inactive, the following log message appears:</p>
<pre class="fragment">No active resolver instances, sending via inactive instance
</pre><p>After all topics are resolved, daemons do not strictly need to be running unless you restart applications. Resolver daemons do not cache or persist state and do not require other shutdown maintenance.</p>
<p><br />
 </p>
<h1><a class="anchor" id="persistentstoreumestored"></a>
Persistent Store (umestored)</h1>
<p>Stores can operate in disk-backed or memory-only mode specified in the store's XML configuration file. Disk backed stores are subject to the limitations of the disk hardware. Stores should not be run on virtual machines and each store should have a dedicated disk. UM holds messages in memory until written to disk.</p>
<p><br />
 </p>
<h2><a class="anchor" id="startingastore"></a>
Starting a Store</h2>
<p>Execute the following command on the appropriate machine to start a (umestored):</p>
<pre class="fragment">umestored config-file.xml
</pre><ul>
<li>
Record umestored PID to monitor process presence for failure detection. </li>
<li>
On Microsoft Windows®, monitor the umestored service. </li>
<li>
Observe the umestored logfile for errors and warnings </li>
</ul>
<p>In disk mode, stores create two types of files.</p>
<ul>
<li>
Cache file - contains the actual persisted messages, and can grow to be very large over time. It is important to ensure that there is enough disk space to record the appropriate amount of persisted data. </li>
<li>
State file - contains information about the current state of each client connection and is much smaller. </li>
</ul>
<p>Stores do not create any files in memory-only mode.</p>
<p><br />
 </p>
<h2><a class="anchor" id="restartingastore"></a>
Restarting a Store</h2>
<p>Perform the following procedure to restart a store.</p>
<ol>
<li>
If the store is still running, kill the PID (Linux) or use the Windows Service Manager® to stop the Windows service. </li>
<li>
If you want a clean "start-of-day" start, delete the cache and state files. The location of these files is specified in the store's XML configuration file. </li>
<li>
Wait 20-30 seconds to let timeouts expire. Due to its use of connectionless protocols, Persistence depends upon timeouts. Therefore, do not rapidly restart the store. </li>
<li>
Run the command: "umestored config-file.xml". umestored automatically uses the existing cache and state files after a graceful shutdown and resumes as part of the current messaging stream at its last known position. </li>
</ol>
<p><br />
 </p>
<h2><a class="anchor" id="commonstartupandshutdownissues"></a>
Common Startup and Shutdown Issues</h2>
<ul>
<li>
Cache and state directories don't exist. </li>
<li>
Disk space - Cache files contain the actual persisted messages, and can grow to be very large over time. It is important to ensure that there is enough disk space to record the appropriate amount of persisted data. </li>
<li>
Configuration error - UM parses a store's XML configuration file at startup, reporting errors to standard error. </li>
<li>
Configuration error - UM reports other configuration errors the store's log file. </li>
<li>
Missing license details. </li>
</ul>
<p><br />
 </p>
<h1><a class="anchor" id="umroutertnwgd"></a>
UM Router (tnwgd)</h1>
<p>When a UM Router starts it discovers all sources and receivers in the topic resolution domains to which it connects. This results in a measurable increase and overall volume of topic resolution traffic and can take some time to complete depending upon the number of sources, receivers, and topics. The rate limits set on topic resolution also affect the time to resolve all topics.</p>
<p>See also <a class="el" href="startupshutdownprocedures.html#topicresolution">Topic Resolution</a>.</p>
<p><br />
 </p>
<h2><a class="anchor" id="startingaumrouter"></a>
Starting a UM Router</h2>
<p>Execute the following command on the appropriate machine to start a UM Router (tnwgd).</p>
<pre class="fragment">tnwgd config-file.xml
</pre><ul>
<li>
Record tnwgd PID to monitor process presence for failure detection. </li>
<li>
Observe the tnwgd logfile for errors and warnings. </li>
</ul>
<p><br />
 </p>
<h2><a class="anchor" id="restartingaumrouter"></a>
Restarting a UM Router</h2>
<p>Perform the following procedure to restart a UM Router.</p>
<ol>
<li>
If the UM Router is still running, kill the PID. </li>
<li>
Wait 20-30 seconds to let timeouts expire. After a restart new proxy sources and receivers must be created on the UM Router. Applications will not use the new proxies until the transport timeout setting expires for the old connections. Until this happens, applications may appear to be "deaf" since they are still considering themselves as connected to the "old" UM Router proxies. Therefore, do not rapidly restart the UM Router. </li>
<li>
Run the command: tnwgd config-file.xml </li>
</ol>
<p><br />
 </p>
<h1><a class="anchor" id="umanalysistools"></a>
UM Analysis Tools</h1>
<p>Tools available to analyze UM activity and performance.</p>
<p><br />
 </p>
<h2><a class="anchor" id="packetcapturetools"></a>
Packet Capture Tools</h2>
<ul>
<li>
Wireshark® is an open-source network packet analysis tool, for which Informatica provides 'dissectors' describing our packet formats. It is used to open and sift through packet capture files, which can be gathered by a variety of both software and hardware tools. For more information about Wireshark or to download the UM Wireshark plugins, please visit <a href="http://www.29west.com/wireshark">http://www.29west.com/wireshark</a>. </li>
<li>
Tshark is a command-line version of Wireshark. </li>
<li>
Tcpdump is the primary software method for gathering packet capture data from a specific host. It is available on most Unix-based systems, though generally gathering packet captures with the tool requires super-user permissions. </li>
</ul>
<p><br />
 </p>
<h2><a class="anchor" id="resourcemonitors"></a>
Resource Monitors</h2>
<ul>
<li>
Top is a system resource monitor available on Linux/Unix that presents a variety of useful data, such as CPU use (both average and per-CPU), including time spent in user mode, system mode, time processing interrupts, time spent waiting on I/O, etc. </li>
<li>
Microsoft ®Windows® System Resource Manager manages Windows Server® 2008 processor and memory usage with built-in or custom resource policies. </li>
<li>
<b>prstat</b> is a resource manager for Solaris® that provides similar CPU and memory usage information. </li>
</ul>
<p><br />
 </p>
<h2><a class="anchor" id="processanalysistools"></a>
Process Analysis Tools</h2>
<ul>
<li>
<p class="startli"><b>pstack</b> dumps a stack trace for a process (pid). If the process named is part of a thread group, then</p>
<p class="endli"><b>pstack</b> traces all the threads in the group. </p>
</li>
<li>
<b>gcore</b> generates a core dump for a Solaris, Linux, and HP-UX process. The process continues after core has been dumped. Thus, gcore is especially useful for taking a snapshot of a running process. </li>
</ul>
<p><br />
 </p>
<h2><a class="anchor" id="networktools"></a>
Network Tools</h2>
<ul>
<li>
<b>netstat</b> provides network statistics for a computer's configured network interfaces. This extensive command-line tool is available on Linux/Unix based systems and Windows operating systems. </li>
<li>
<b>wget</b> is a Linux tool that captures content from a web interface, such as a UM daemon web monitor. Its features include recursive download, conversion of links for off-line viewing of local HTML, support for proxies, and more. </li>
<li>
<b>netsh</b> is a Windows utility that allows local or remote configuration of network devices such as the interface. </li>
</ul>
<p><br />
 </p>
<h2><a class="anchor" id="umtools"></a>
UM Tools</h2>
<ul>
<li>
lbmmoncache is a utility that monitors both source notification and source/receiver statistics. Contact UM Support for more information about this utility. </li>
<li>
lbtrreq restarts the topic resolution process. Contact UM Support for more information about this utility. </li>
</ul>
<p><br />
 </p>
<h2><a class="anchor" id="umdebugflags"></a>
UM Debug Flags</h2>
<p>The use of UM debug flags requires the assistance of UM Support. Also refer to the following Knowledge Base articles for more information about using debug flags. </p><ul>
<li>
<a href="https://kb.informatica.com/howto/4/Pages/80100.aspx">Using debug flags</a> </li>
<li>
<a href="https://kb.informatica.com/howto/4/Pages/80101.aspx">Using debug flags in application code</a> </li>
<li>
<a href="https://kb.informatica.com/howto/4/Pages/80242.aspx">Using debug flags with daemons</a> </li>
<li>
<a href="https://kb.informatica.com/howto/4/Pages/80241.aspx">Using debug flags with daemons running as windows services</a> </li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
</body>
</html>
