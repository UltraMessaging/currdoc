<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Operations Guide: Monitoring</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen_manual.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Operations Guide
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('monitoring.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Monitoring </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>For an Ultra Messaging deployment, "monitoring" is the process of overseeing the operation of UM and the resources it uses to determine its health and performance.</p>
<p><b>Informatica strongly recommends that users of Ultra Messaging actively monitor its operation.</b></p>
<p><a class="anchor" id="whymonitor"></a><br />
 </p>
<h1><a class="anchor" id="monitoringintroduction"></a>
Monitoring Introduction&nbsp;&nbsp;<small><a href="#monitoringintroduction">&lt;-</a></small></h1>
<p>Many Ultra Messaging deployments operate without any problem. Why monitor a system that is working fine? Monitoring lets you: </p><ul>
<li>
Evaluate the health of the messaging system. </li>
<li>
Identify inefficiencies that can cause latency and limit capacity. </li>
<li>
Track utilization trends and prevent future overload. </li>
<li>
Provide forensic data to help diagnose system trouble. (If you wait to turn on monitoring until after you have a problem, it's too late.) </li>
</ul>
<p>UM deployments are often large-scale, loosely-coupled systems, used by many diverse end-user groups who may have little knowledge of each others usage patterns or future plans. Especially when there are resources shared by these groups, it is important to monitor UM's operation and performance characteristics. This can help you avoid problems, and when problems do arise, having monitoring data can be critical to diagnosing the root causes.</p>
<p>At a high level, Informatica strongly recommends: </p><ul>
<li>
Network and Host Equipment Monitoring. </li>
<li>
UM Monitoring. </li>
</ul>
<p><br />
 </p>
<h2><a class="anchor" id="networkandhostmonitoring"></a>
Network and Host Equipment Monitoring&nbsp;&nbsp;<small><a href="#networkandhostmonitoring">&lt;-</a></small></h2>
<p>An effective monitoring strategy should include monitoring of the host and network resources that UM depends on. Informatica requests that you monitor and record data from the following sources: </p><ul>
<li>
Network equipment (switches, routers, firewalls). Includes packet drops at ports and trunks. Often also includes always-running packet capture (for example, <a href="https://www.pico.net/corvil-analytics">Corvil</a>). </li>
<li>
Hosts. Includes CPU load, memory usage, hardware errors, and packet drops (kernel and user sockets). Where possible, monitor resource usage per-process. </li>
</ul>
<p>There are many vendors of monitoring technology that do a good job of recording and visualizing network and host statistics and logged events. Your operations staff should have fast and easy access to this monitoring data. Ideally, your monitoring tools will raise alerts when problems are detected.</p>
<p>Detailed discussion of host and network monitoring is beyond the scope of the Ultra Messaging documentation.</p>
<p><br />
 </p>
<h2><a class="anchor" id="monitoringum"></a>
Monitoring UM&nbsp;&nbsp;<small><a href="#monitoringum">&lt;-</a></small></h2>
<p>Broadly speaking, there are three kinds of UM operational data that should be monitored and recorded: </p><ul>
<li>
UM events. This can be from either user applications or UM daemons (Store, DRO, etc). Events are typically logged and saved to local log files. </li>
<li>
UM library statistical data. This can be from user applications or from UM daemons, and mostly contains information about UM contexts and transports. </li>
<li>
UM Daemon Statistical data. This is daemon-specific operational data (Store, DRO, etc). </li>
</ul>
<p><br />
 </p>
<h1><a class="anchor" id="monitoringumapplications"></a>
Monitoring UM Applications&nbsp;&nbsp;<small><a href="#monitoringumapplications">&lt;-</a></small></h1>
<p>These are application programs that you, the UM user, have developed. As you write your code, Informatica requests that all applications do the following: </p><ol>
<li>
Record all failed API calls with informational string, typically to a log file. </li>
<li>
Record all non-message events delivered to the application, typically to a log file, </li>
<li>
Record all asynchronous UM log messages (strings), typically to a log file. </li>
<li>
Record UM library statistics, typically using UM automatic monitoring. </li>
</ol>
<p>Items 1-3 typically involve writing to log file on the local host. See <a class="el" href="monitoring.html#applicationlogfile">Application Log File</a>.</p>
<p>Item 4 typically involves configuring the UM library to publish its statistics to a <a class="el" href="monitoring.html#centralizedcollector">Centralized Collector</a>. The statistics are sampled and published using UM's <a class="el" href="monitoring.html#automaticmonitoring">Automatic Monitoring</a> feature. (There are alternatives; see <a class="el" href="legacymonitoring.html">Legacy Monitoring</a>.)</p>
<p>Note that Informatica recommends the use of the <a class="el" href="monitoring.html#monitoringcollectorservicemcs">Monitoring Collector Service (MCS)</a>, which is a relatively recent addition to UM. Be aware that the MCS is able to collect stats from all UM versions 5.x and 6.x. It is not necessary to upgrade applications to take advantage of the latest UM monitoring capabilities.</p>
<p><br />
 </p>
<h2><a class="anchor" id="applicationlogfile"></a>
Application Log File&nbsp;&nbsp;<small><a href="#applicationlogfile">&lt;-</a></small></h2>
<p>During the design and development of user applications, Informatica requests that users implement the following logging items:</p>
<ol>
<li>
<p class="startli">The UM library delivers events to the application. Informatica requests that applications log all informational and exceptional events. Logs are classified as to their severity, which is useful for automatic log file scanners to detect potential problems and raise alerts.</p>
<ul>
<li>
<b>Informatica requests that logs be written with a time stamp with at least second resolution (preferably millisecond), the log severity level, and the descriptive text of the event being logged.</b> </li>
</ul>
<p>Be aware that different threads might need to write logs asynchronously to each other. Your logger code must be thread-safe.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">Some of UM events represent the delivery of user data messages. These events do not need to be logged. Other events are informational and are delivered during normal operation, like Beginning of Session (BOS). These should be logged because they can be essential to diagnose problems.</p>
<ul>
<li>
<b>Informatica requests that all informational (non-message) events be logged.</b> </li>
</ul>
<p class="endli"></p>
</li>
<li>
<p class="startli">Many UM event callbacks can deliver a variety of different event types. For example, a receiver callback can be delivered user data messages, Beginning of Session (BOS) events, etc. The application code typically recognizes those events that it is written to recognize, and ignores the others.</p>
<ul>
<li>
<b>Informatica requests that unrecognized events be logged with their event types.</b> </li>
</ul>
<p class="endli"></p>
</li>
<li>
<p class="startli">The UM library can sometimes detect internal conditions that are not associated with deliverable events or API calls. These are delivered to the application with the "logger callback" (<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Operations/api.tag:../API/" href="../API/lbm_8h.html#aae14099b91f2919f424e81f20ca10951">lbm_log()</a> for C, <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Operations/javaapi.tag:../JavaAPI/" href="../JavaAPI/classcom_1_1latencybusters_1_1lbm_1_1LBM.html#ac0bd24d34cdd5039586c8f576c015dec">LBM.setLogger()</a> for Java and .NET).</p>
<ul>
<li>
<b>Informatica requests that all logger callbacks be logged.</b> </li>
</ul>
<p class="endli"></p>
</li>
<li>
<p class="startli">The application calls UM API functions. Each function can return a failed status. In C, the failure is almost always indicated by a return value of -1. In Java and .NET, the failure is almost always indicated by throwing an exception. In either case, UM provides a text string that describes the failure. See <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Operations/api.tag:../API/" href="../API/lbm_8h.html#a22a4650d3a5b649c84a0c05adedcc055">lbm_errmsg()</a> for C, the exception's <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/Throwable.html#toString()">toString()</a> method for Java, or the exception's <a href="https://docs.microsoft.com/en-us/dotnet/api/system.exception.message?view=net-5.0">Message property</a> for .NET).</p>
<ul>
<li>
<b>Informatica requests that all failed API calls be logged with their descriptive text.</b> </li>
</ul>
<p class="endli"></p>
</li>
<li>
<p class="startli">Log files are typically "rolled" (saved off and re-created) on a periodic basis (usually daily), and are kept for some period of time before being purged.</p>
<ul>
<li>
<b>Informatica requests that full logs be retained for at least 1 week.</b> </li>
</ul>
<p class="endli"></p>
</li>
<li>
<p class="startli">Recording and saving all this information is necessary to diagnose many user-visible problems. However, errors can be written to the log which are not associated with a user-visible problem. Users should have tools and procedures that alert operators of abnormal logs. This can prevent small problems from becoming big problems.</p>
<ul>
<li>
<b>Informatica requests the use of a log file analysis tool that scans the live log files and reports unusual or exceptional logs and raises alerts that will be noticed by the operations staff.</b> </li>
</ul>
<p>Ideally, log file monitoring would support the following: </p><ul>
<li>
Archive all log messages for all applications for at least a week, preferably a month. </li>
<li>
Provide rapid access to operations staff to view the latest log messages from an application. </li>
<li>
Periodic scans of the log file to detect errors and raise alerts to operations staff. </li>
</ul>
<p class="endli">There are many third party real-time log file analysis tools available. A discussion of possible tools is beyond the scope of UM documentation. </p>
</li>
</ol>
<p><br />
 </p>
<h1><a class="anchor" id="monitoringumdaemons"></a>
Monitoring UM Daemons&nbsp;&nbsp;<small><a href="#monitoringumdaemons">&lt;-</a></small></h1>
<p>Monitoring the UM daemons (Stores, DROs, etc) is similar to monitoring user applications.</p>
<p>For an overview of Informatica monitoring recommendations, see <a class="el" href="monitoring.html">Monitoring</a>.</p>
<p>For most UM daemons, there are three types of monitoring data that should be collected and monitored: </p><ul>
<li>
Log files. </li>
<li>
UM Library Statistics. These are stats for contexts, transports, etc. </li>
<li>
Daemon Statistics. These are stats specific to each daemon (Store, DRO, etc). </li>
</ul>
<p>Informatica requests that all UM daemons being used in a deployment be monitored for all three types of data.</p>
<p>The different UM daemons have different methods of enabling monitoring. See: </p><ul>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Operations/ume.tag:../UME/" href="../UME/operationalview.html#storemonitoring">Store Monitoring</a>. </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Operations/gateway.tag:../Gateway/" href="../Gateway/umroutermonitoring.html">DRO Monitoring</a>. </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Operations/design.tag:../Design/" href="../Design/topicresolutiondescription.html#srsmonitoring">SRS Monitoring</a>. </li>
</ul>
<p><br />
 </p>
<h1><a class="anchor" id="automaticmonitoring"></a>
Automatic Monitoring&nbsp;&nbsp;<small><a href="#automaticmonitoring">&lt;-</a></small></h1>
<p>UM applications and some UM daemons (Store, DRO) make use of the UM library, which maintains a rich set of statistics. The library statistics consists of data about the health and operation of UM contexts, transport sessions, and event queues.</p>
<p>The recommended method for monitoring UM library statistics is the automatic monitoring feature. This should be enabled via configuration options on user applications and also Store daemons. See <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Operations/config.tag:../Config/" href="../Config/grpautomaticmonitoring.html">Automatic Monitoring Options</a>. When enabled, a background context will sample and send the monitoring data. Note that a single monitoring context will be created and configured with the monitoring options. For example, if your application has multiple contexts, it is not possible to have different automatic monitoring settings for each context. For more information on monitoring applications with multiple contexts, see <a href="https://knowledge.informatica.com/s/article/151305">https://knowledge.informatica.com/s/article/151305</a>.</p>
<p>Enabling the automatic monitoring feature will create a monitoring context that is configured for reduced system resource usage (sockets and memory). This monitoring context periodically wakes up and samples the library statistics in the current process and publishes them. The context is created with the name <code>"29west_statistics_context"</code> to simplify configuring the context with an <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Operations/config.tag:../Config/" href="../Config/xmlconfigurationfiles.html">XML configuration file</a>.</p>
<p>Informatica recommends setting up a separate <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Operations/design.tag:../Design/" href="../Design/fundamentalconcepts.html#topicresolutiondomain">Topic Resolution Domain</a> for monitoring data. If possible, that TRD should be hosted on a separate network from the main production network (perhaps an administrative "command and control" network). This minimizes the impact of monitoring on application throughput and latency.</p>
<p>To ease the deployment of monitoring data on an alternate network, Informatica recommends not using multicast. Topic resolution should use <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Operations/design.tag:../Design/" href="../Design/topicresolutiondescription.html#unicastudptr">Unicast UDP TR</a> or <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Operations/design.tag:../Design/" href="../Design/topicresolutiondescription.html#tcptr">TCP TR</a> (or both), and the monitoring data should be sent via the <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Operations/design.tag:../Design/" href="../Design/transporttypes.html#transporttcp">tcp transport</a>.</p>
<p><a class="anchor" id="automaticmonitoringrecommendations"></a><br />
 </p>
<h2><a class="anchor" id="automaticmonitoringsample"></a>
Automatic Monitoring Sample&nbsp;&nbsp;<small><a href="#automaticmonitoringsample">&lt;-</a></small></h2>
<p>Here is an excerpt from a sample application configuration file that shows how the above recommendations implemented: </p><div class="fragment"><div class="line">&lt;?xml version=<span class="stringliteral">&quot;1.0&quot;</span> encoding=<span class="stringliteral">&quot;UTF-8&quot;</span> ?&gt;</div><div class="line">&lt;um-configuration version=<span class="stringliteral">&quot;1.0&quot;</span>&gt;</div><div class="line">  &lt;templates&gt;</div><div class="line">    ...</div><div class="line">    &lt;<span class="keyword">template</span> name=<span class="stringliteral">&quot;automonitor&quot;</span>&gt;</div><div class="line">      &lt;options type=<span class="stringliteral">&quot;context&quot;</span>&gt;</div><div class="line">        &lt;option name=<span class="stringliteral">&quot;monitor_format&quot;</span> <span class="keywordflow">default</span>-value=<span class="stringliteral">&quot;pb&quot;</span>/&gt;</div><div class="line">        &lt;option name=<span class="stringliteral">&quot;monitor_interval&quot;</span> <span class="keywordflow">default</span>-value=<span class="stringliteral">&quot;600&quot;</span>/&gt;</div><div class="line">        &lt;option name=<span class="stringliteral">&quot;monitor_transport&quot;</span> <span class="keywordflow">default</span>-value=<span class="stringliteral">&quot;lbm&quot;</span>/&gt;</div><div class="line">      &lt;/options&gt;</div><div class="line">    &lt;/<span class="keyword">template</span>&gt;</div><div class="line">    ...</div><div class="line">    &lt;<span class="keyword">template</span> name=<span class="stringliteral">&quot;mon_ctx&quot;</span>&gt;</div><div class="line">      &lt;options type=<span class="stringliteral">&quot;context&quot;</span>&gt;</div><div class="line">        &lt;option name=<span class="stringliteral">&quot;resolver_unicast_daemon&quot;</span> <span class="keywordflow">default</span>-value=<span class="stringliteral">&quot;10.29.3.101:12801&quot;</span>/&gt;</div><div class="line">        &lt;option name=<span class="stringliteral">&quot;default_interface&quot;</span> <span class="keywordflow">default</span>-value=<span class="stringliteral">&quot;10.29.3.0/24&quot;</span>/&gt;</div><div class="line">        &lt;option name=<span class="stringliteral">&quot;mim_incoming_address&quot;</span> <span class="keywordflow">default</span>-value=<span class="stringliteral">&quot;0.0.0.0&quot;</span>/&gt;</div><div class="line">        ...</div><div class="line">      &lt;/options&gt;</div><div class="line">      &lt;options type=<span class="stringliteral">&quot;source&quot;</span>&gt;</div><div class="line">        &lt;option name=<span class="stringliteral">&quot;transport&quot;</span> <span class="keywordflow">default</span>-value=<span class="stringliteral">&quot;tcp&quot;</span>/&gt;</div><div class="line">      &lt;/options&gt;</div><div class="line">      ...</div><div class="line">    &lt;/<span class="keyword">template</span>&gt;</div><div class="line">    ...</div><div class="line">  &lt;/templates&gt;</div><div class="line"></div><div class="line">  &lt;applications&gt;</div><div class="line">    ...</div><div class="line">    &lt;application name=<span class="stringliteral">&quot;myapplication&quot;</span>&gt;</div><div class="line">      &lt;contexts&gt;</div><div class="line">        &lt;context name=<span class="stringliteral">&quot;mycontext&quot;</span> <span class="keyword">template</span>=<span class="stringliteral">&quot;mytemplate,automonitor&quot;</span>&gt;</div><div class="line">          &lt;sources/&gt;</div><div class="line">        &lt;/context&gt;</div><div class="line">        &lt;context name=<span class="stringliteral">&quot;29west_statistics_context&quot;</span> <span class="keyword">template</span>=<span class="stringliteral">&quot;mon_ctx&quot;</span>&gt;</div><div class="line">          &lt;sources/&gt;</div><div class="line">        &lt;/context&gt;</div><div class="line">      &lt;/contexts&gt;</div><div class="line">    &lt;/application&gt;</div><div class="line">    ...</div></div><!-- fragment --><p>Here is a pair of "flat" configuration files to do the same thing:</p>
<p>myapplication.cfg: </p><pre class="fragment">context monitor_format pb
context monitor_interval 600
context monitor_transport lbm
context monitor_transport_opts config=mon.cfg
...
</pre><p>mon.cfg: </p><pre class="fragment">context resolver_unicast_daemon 10.29.3.101:12801
context default_interface 10.29.3.0/24
context mim_incoming_address 0.0.0.0
source transport tcp
</pre><p><b>Notes:</b></p>
<ol>
<li>
<p class="startli">The <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Operations/config.tag:../Config/" href="../Config/grpautomaticmonitoring.html#monitorformatcontext">monitor_format (context)</a> value "pb" selects the protobuf format and is available for the Store in UM version 6.14 and beyond. For applications running on earlier versions, omit <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Operations/config.tag:../Config/" href="../Config/grpautomaticmonitoring.html#monitorformatcontext">monitor_format (context)</a> (the format will be "csv"). UM supports a mixture of different versions, with the centralized collector accepting both "csv" and "pb".</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">For applications that use event queues, the corresponding <code>"event_queue monitor_..."</code> options should be added.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">For a list of possible protobuf messages for UM library monitoring, see the "ums_mon.proto" file at <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Operations/example.tag:../example/" href="../example/index.html#exampleums_mon_proto">Example ums_mon.proto</a>.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">The application context named <code>"mycontext"</code> is configured with the <code>"automonitor"</code> template, which sets the automatic monitoring options. The <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Operations/config.tag:../Config/" href="../Config/grpautomaticmonitoring.html#monitorintervalcontext">monitor_interval (context)</a> option enables automatic monitoring and defines the statistics sampling period. In the above example, 600 seconds (10 minutes) is chosen somewhat arbitrarily. Shorter times produce more data, but not much additional benefit. However, UM networks with many thousands of applications may need a longer interval (perhaps 30 or 60 minutes) to maintain a reasonable load on the network and monitoring data storage.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">When automatic monitoring is enabled, it creates a context named "29west_statistics_context". It is configured with the "mon_ctx" template, which sets options for the monitoring data TRD. (Alternatively, you can configure the monitoring context using <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Operations/config.tag:../Config/" href="../Config/grpautomaticmonitoring.html#monitortransportoptscontext">monitor_transport_opts (context)</a>.) When possible, Informatica recommends directing monitoring data to an administrative network, separate from the application data network. This prevents monitoring data from interfering with application data latency or throughput. In this example, the monitoring context is configured to use an interface matching <code>10.29.3.0/24</code>.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">The monitoring data is sent out via UM using the TCP transport.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">These settings were chosen to conform to the recommendations above.</p>
<p class="endli"></p>
</li>
</ol>
<p>For a full demonstration of monitoring, see: <a href="https://github.com/UltraMessaging/mcs_demo">https://github.com/UltraMessaging/mcs_demo</a></p>
<p><br />
 </p>
<h1><a class="anchor" id="centralizedcollector"></a>
Centralized Collector&nbsp;&nbsp;<small><a href="#centralizedcollector">&lt;-</a></small></h1>
<p>Once you have applications and daemons publishing statistics, you need an independent program (the monitoring collector) that subscribes to the statistics and records them for subsequent analysis and display.</p>
<p>UM supports two approaches to centralized monitoring: </p><ul>
<li>
<a class="el" href="monitoring.html#monitoringcollectorservicemcs">Monitoring Collector Service (MCS)</a>. Informatica's monitoring program that collects library and daemon statistics for storage in a database of your choosing. </li>
<li>
<a class="el" href="monitoring.html#userdevelopedcollector">User-Developed Collector</a>. Your own centralized monitoring program that collects library and daemon statistics for storage and analysis. </li>
</ul>
<p><br />
 </p>
<h2><a class="anchor" id="monitoringcollectorservicemcs"></a>
Monitoring Collector Service (MCS)&nbsp;&nbsp;<small><a href="#monitoringcollectorservicemcs">&lt;-</a></small></h2>
<p>The MCS is an independent monitoring data collector program. It subscribes to UM library and daemon statistics and writes the data to a database.</p>
<p>MCS requires Java 9 or greater.</p>
<p>The MCS needs to be configured. It has an XML configuration file; see <a class="el" href="mcsconfigurationfile.html">MCS Configuration File</a>. In this configuration file, the <a class="el" href="mcsconfigurationfile.html#mcselementconfigfile">MCS Element "&lt;config-file&gt;"</a> references an LBM configuration file. This is used to configure the UM library so that it can subscribe to published monitoring data.</p>
<p>The MCS also needs its database to be created prior to starting it.</p>
<p>See <a class="el" href="manpagesformcs.html">Man Pages for MCS</a> for information on running the MCS.</p>
<p>As of UM 6.14, the MCS supports writing to <a href="https://www.sqlite.org/">SQLite</a> (the default) or <a href="https://hadoop.apache.org/">HDFS (Apache Hadoop)</a>, selectable by configuration. Note that UM does not ship with a copy of either database software package. The user must install a copy of the desired database on the host where MCS will run.</p>
<p><a class="anchor" id="mcssqlite"></a><b>SQLite</b></p>
<p>To use SQLite, you must install it yourself on the host where MCS is intended to run. You should have some familiarity with administering the system. SQLite training is beyond the scope of UM documentation.</p>
<p>MCS is written to convert incoming proto buff messages into JSON, and write the JSON to SQLite using SQLite's jdbc driver. This allows flexible querying of the data.</p>
<p>You will find the MCS executable the UM package's "MCS/bin" directory. Also in that directory, you will find the file "ummon_db.sql" which can be used to create the database. For example, enter the following command from the Linux shell: </p><div class="fragment"><div class="line">sqlite3 /mcs/mcs.db &lt;$HOME/UMP_6.15/MCS/bin/ummon_db.sql</div></div><!-- fragment --><p>Here is the contents of "ummon_db.sql": </p><pre class="fragment">PRAGMA foreign_keys=OFF;
BEGIN TRANSACTION;
CREATE TABLE umsmonmsg(message json);
CREATE TABLE umpmonmsg(message json);
CREATE TABLE dromonmsg(message json);
CREATE TABLE srsmonmsg(message json);
COMMIT;</pre><p>To use SQLite, set MCS's XML configuration file's element <a class="el" href="mcsconfigurationfile.html#mcselementconnector">&lt;connector&gt;</a> to "sqlite". Also set <a class="el" href="mcsconfigurationfile.html#mcselementpropertiesfile">MCS Element "&lt;properties-file&gt;"</a> to a file which contains properties that the MCS's "sqlite" connector expects: </p><ul>
<li>
sqlite_database_path - file path to the SQLite database file. If on Windows, you may use forward slashes or escaped (double) back slashes to separate directories. </li>
</ul>
<p>Example sqlite properties file: </p><pre class="fragment">sqlite_database_path=/mcs/ummon.db
</pre><p>For a full demonstration of monitoring with the MCS and sqlite, see: <a href="https://github.com/UltraMessaging/mcs_demo">https://github.com/UltraMessaging/mcs_demo</a></p>
<p>Listing best practices for SQLite deployments is beyond the scope of UM documentation. However, this paragraph from <a href="https://www.sqlite.org/lockingv3.html">https://www.sqlite.org/lockingv3.html</a> did catch our eye: </p><blockquote class="doxtable">
<p>SQLite uses POSIX advisory locks to implement locking on Unix. On Windows it uses the LockFile(), LockFileEx(), and UnlockFile() system calls. SQLite assumes that these system calls all work as advertised. If that is not the case, then database corruption can result. One should note that POSIX advisory locking is known to be buggy or even unimplemented on many NFS implementations (including recent versions of Mac OS X) and that there are reports of locking problems for network filesystems under Windows. <b>Your best defense is to not use SQLite for files on a network filesystem.</b> </p>
</blockquote>
<p>(emphasis ours)</p>
<p>See <a href="https://www.sqlite.org/">https://www.sqlite.org/</a> for full information on SQLite.</p>
<p><a class="anchor" id="mcshdfs"></a><b>HDFS</b></p>
<p>To use HDFS, you must install it yourself on the host where MCS is intended to run. You should have some familiarity with administering the system. Training you on HDFS's use is beyond the scope of UM documentation.</p>
<p>MCS is written to write the protocol buffers directly to HDFS. This allows flexible querying of the data.</p>
<p>You will find the MCS executable the UM package's "bin" directory, along with the other daemon binaries.</p>
<p>To use HDFS, set <a class="el" href="mcsconfigurationfile.html#mcselementconnector">MCS Element "&lt;connector&gt;"</a> to "hdfs". Also set <a class="el" href="mcsconfigurationfile.html#mcselementpropertiesfile">MCS Element "&lt;properties-file&gt;"</a> to a file which contains properties that the MCS's "hdfs" connector expects: </p><ul>
<li>
hdfs_core_site_file_path - path name of XML resource file containing read-only configuration defaults for hadoop. </li>
<li>
hdfs_hdfs_site_file_path - path name of XML resource file containing site-specific configuration for a given hadoop installation. </li>
</ul>
<p>See hadoop documentation for details on the resource files.</p>
<p>Example hdfs properties file: </p><pre class="fragment">hdfs_core_site_file_path=/mcs/hdfs_core.xml
hdfs_hdfs_site_file_path=/mcs/hdfs_site.xml
</pre><p><br />
 </p>
<h2><a class="anchor" id="userdevelopedcollector"></a>
User-Developed Collector&nbsp;&nbsp;<small><a href="#userdevelopedcollector">&lt;-</a></small></h2>
<p>For UM users have taken either the <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Operations/example.tag:../example/" href="../example/index.html#examplelbmmon_c">Example lbmmon.c</a> or the <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Operations/java_example.tag:../java_example/" href="../java_example/index.html#examplelbmmon_java">Example lbmmon.java</a> source file and modified it to create a monitoring application, you may want to enhance your program to take advantage of new capabilities introduced in 6.14. Note that there is also a .NET example: <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Operations/dotnet_example.tag:../dotnet_example/" href="../dotnet_example/index.html#examplelbmmon_cs">Example lbmmon.cs</a>, which is still functional but is no longer being enhanced. Users are requested to write their collector using C/C++ or Java.</p>
<p>Prior to UM version 6.14, different types of published data required different methods for receiving and accessing them. UM library statistics were received using the "lbmmon" library, Store and DRO daemon stats were received as C-style binary data structures, and SRS stats were received as JSON.</p>
<p>Starting with 6.14, library, Store, and DRO stats have been unified with <a href="https://developers.google.com/protocol-buffers">Google Protocol Buffers</a>. Starting with 6.15, the SRS joined them in supporting protocol buffers. See <a class="el" href="monitoring.html#monitoringumdaemons">Monitoring UM Daemons</a>.</p>
<p>Also, the lbmmon library is enhanced with a "passthrough" mode that gives the monitoring application direct access to the protocol buffer messages. (The SRS daemon statistics are not yet available as protocol buffers.)</p>
<p>The older methods are still functional, but they may not be further enhanced in the future. Informatica recommends migrating to the passthrough mode and the google protocol buffers. To take full advantage of its new capabilities, lbmmon should be run with command-line options: </p><pre class="fragment">  --format=pb --format-opts="passthrough=convert"
</pre><p> This allows lbmmon to receive both proto buff formatted data as well as CSV formatted data. CSV data is converted to proto buff before delivery to the monitoring application.</p>
<p>See <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Operations/example.tag:../example/" href="../example/index.html#examplelbmmon_c">Example lbmmon.c</a> and/or <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Operations/java_example.tag:../java_example/" href="../java_example/index.html#examplelbmmon_java">Example lbmmon.java</a> for details on using both the new and older lbmmon APIs.</p>
<p>You may notice that <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Operations/java_example.tag:../java_example/" href="../java_example/index.html#examplelbmmon_java">Example lbmmon.java</a> no longer contains print lines of the individual fields of the monitoring data objects. These accesses were moved into the lbmmon Jar file as displayString() methods for each statistics data object to simplify the example source code. For convenience, those methods' source code has been collected into an example file, <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Operations/java_example.tag:../java_example/" href="../java_example/index.html#exampledisplayString_java">Example displayString.java</a>.</p>
<p><br />
 </p>
<h1><a class="anchor" id="monitoringformats"></a>
Monitoring Formats&nbsp;&nbsp;<small><a href="#monitoringformats">&lt;-</a></small></h1>
<p>The UM library and UM daemons publish their statistics using several different message formats, depending on the type of data being sent. Starting with UM version 6.14, most of those formats are deprecated in favor of a unified message format based on <a href="https://developers.google.com/protocol-buffers">Google Protocol Buffers</a>.</p>
<p>The data formats are: </p><ul>
<li>
Protocol Buffers. Option for UM library statistics, and Store, DRO, and SRS daemon statistics. Recommended. </li>
<li>
CSV - comma-separated values. Option for UM library statistics. Deprecated, but retained for backward compatibility. </li>
<li>
Binary C-style data structures. Option for UM daemons Store and DRO daemon statistics. Deprecated, but retained for backward compatibility. </li>
<li>
JSON. Option for SRS daemon statistics. Deprecated, but retained for backward compatibility. </li>
</ul>
<p>For applications and UM daemons, Informatica recommends protocol buffers. Users of binary or JSON formats are recommended to migrate to protocol buffers.</p>
<p><br />
 </p>
<h1><a class="anchor" id="protocolbufferformat"></a>
Protocol Buffer Format&nbsp;&nbsp;<small><a href="#protocolbufferformat">&lt;-</a></small></h1>
<p>You can view and use the proto buff definition files at <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Operations/example.tag:../example/" href="../example/index.html#exampleprotocolfiles">Example Protocol Files</a>. Note that most integer fields are defined as "uint64", a 64-bit unsigned value. However, within the UM library, almost all of the integer statistics are maintained as C "unsigned long int" values. Note that different compilers interpret "unsigned long int" in different ways. </p><table class="doxtable">
<tr>
<th>Platform </th><th>Unsigned Long Size </th></tr>
<tr>
<td>Linux 64-bit </td><td>64 bits </td></tr>
<tr>
<td>Linux 32-bit </td><td>32 bits </td></tr>
<tr>
<td>Windows 64-bit </td><td>32 bits </td></tr>
<tr>
<td>Windows 32-bit </td><td>32 bits </td></tr>
</table>
<p>This can make a difference for statistics that increase in value quickly, like <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Operations/api.tag:../API/" href="../API/structlbm__src__transport__stats__lbtrm__t__stct.html#ac9e8875bb28fa479cc3425a69b821fae">lbm_src_transport_stats_lbtrm_t_stct::bytes_sent</a>. On platforms where a "long int" is 32 bits, a high-rate transport session running for a few hours can reach that field's maximum value (4,294,967,295) and then "wrap" back to zero.</p>
<p>Also note that a few statistics represent the "minimum value seen", and are initialized to the maximum possible value. For example, <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Operations/api.tag:../API/" href="../API/structlbm__rcv__transport__stats__lbtrm__t__stct.html#a8ea05ee4effe7f8e41e45051741ee1c6">lbm_rcv_transport_stats_lbtrm_t_stct::nak_tx_min</a> is initialized to the maximum value for "unsigned long int". Thus, GCC on a 32-bit build or the Microsoft compiler will initialize it to 4,294,967,295 (2**32 - 1). GCC on a 64-bit build will initialize it to 18,446,744,073,709,551,615 (2**64 - 1).</p>
<p>To see the underlying data types and descriptions for UM library statistics, look at the C language definitions of the statistics structures. See: </p><ul>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Operations/api.tag:../API/" href="../API/structlbm__rcv__transport__stats__t__stct.html">lbm_rcv_transport_stats_t_stct</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Operations/api.tag:../API/" href="../API/structlbm__src__transport__stats__t__stct.html">lbm_src_transport_stats_t_stct</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Operations/api.tag:../API/" href="../API/structlbm__context__stats__t__stct.html">lbm_context_stats_t_stct</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Operations/api.tag:../API/" href="../API/structlbm__event__queue__stats__t__stct.html">lbm_event_queue_stats_t_stct</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Operations/api.tag:../API/" href="../API/structlbm__rcv__topic__stats__t__stct.html">lbm_rcv_topic_stats_t_stct</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Operations/api.tag:../API/" href="../API/structlbm__wildcard__rcv__stats__t__stct.html">lbm_wildcard_rcv_stats_t_stct</a> </li>
</ul>
<p><br />
<br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
</p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
</body>
</html>
