<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Operations Guide: Monitoring</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen_manual.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Operations Guide
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('monitoring.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Monitoring </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>It is important to monitor Ultra Messaging to ensure smooth operation. By tracking the changes in UM statistics over time, you may be able to predict and avoid future overloads. When contacting support to report anomalous behavior, recording UM statistics can greatly assist the support engineers' root cause analysis.</p>
<p><br />
 </p>
<h1><a class="anchor" id="monitoringtransportstatistics"></a>
Monitoring Transport Statistics&nbsp;&nbsp;<small><a href="#monitoringtransportstatistics">&lt;-</a></small></h1>
<p>Monitoring the activity on your UM transport sessions is the most important component of your UM monitoring effort. UM provides the following four methods to monitor your UM activities.</p>
<ul>
<li>
Use UM API function calls within your applications to retrieve statistics and deliver them to your monitoring application. </li>
<li>
Use the UM Monitoring API to more easily retrieve and send statistics to your monitoring application. </li>
<li>
Use Automatic Monitoring to easily employ the UM Monitoring API to monitor UM activity at an UM context level. </li>
<li>
Use the Ultra Messaging SNMP Agent and MIB (purchased separately to monitor statistics through a Network Management System). See The Ultra Messaging SNMP Agent for detailed information. </li>
</ul>
<p>Automatic Monitoring is the easiest method to implement using configuration options or environment variables. Since many topics can use multiple transport sessions, UM Monitoring doesn't provide transport information for individual topics. From an Operations point of view, however, the health and behavior of your transport sessions is more correlated to system performance. Although UM Monitoring also provides statistics on event queues, these statistics are more specific to a single application and not a system wide health indication.</p>
<p>The interval for collecting statistics should be as short as practical. A too-long interval can hide microbursts of traffic. However, a too-short interval can lead to massive amounts of statistical data which needs to be stored and processed.</p>
<p>Note that certain statistics are initialized to the maximum unsigned value for the fields, i.e. all bits set (-1 if printed signed). This special value indicates that the field has not yet been calculated. This is used for the "min" statistic in a "minimum / maximum" statistics pair. For example, nak_tx_min is initialized to the maximum unsigned long, while nak_tx_max is initialized to zero.</p>
<p>This section lists some of the more important transport statistics to monitor listed by transport type.</p>
<p><br />
 </p>
<h2><a class="anchor" id="lbtrmandlbtrureceiverstatistics"></a>
LBT-RM and LBT-RU Receiver Statistics&nbsp;&nbsp;<small><a href="#lbtrmandlbtrureceiverstatistics">&lt;-</a></small></h2>
<p>Essentially, aside from msg_rcved and bytes_rcved, if any receiver statistics increment, a problem may exist. The following lists the most important statistics.</p>
<ul>
<li>
<b>naks_sent</b> means a transport has a gap in sequence numbers, which can be recoverable or unrecoverable loss. </li>
<li>
<b>unrecovered_txw</b> and unrecovered_tmo loss statistics. Indicates retransmissions not delivered to a receiver. (The receiving application will have received a LBM_MSG_UNRECOVERABLE_LOSS or LBM_MSG_UNRECOVERABLE_LOSS_BURST log message via its receive callback, which should be found in the streaming or API log file. </li>
<li>
<b>lbm_msgs_no_topic_rcved</b> indicates that receivers may be doing too much topic filtering (wasting CPU resource) because they are processing messages in which they have no interest. If this statistic is greater than 25% of msgs_rcvd, a problem may exist or topics may need to be distributed to different transport sessions. </li>
<li>
<b>dgrams_dropped_*</b> - Indicates the reception of invalid datagrams, e.g. a non-UM datagram or datagram from an incompatible version. </li>
</ul>
<p>For additional information, see <a class="el" href="ummonitoringstatistics.html#monitoringreceivingstatistics">Monitoring Receiving Statistics</a>.</p>
<p><br />
 </p>
<h2><a class="anchor" id="lbtrmandlbtrusourcestatistics"></a>
LBT-RM and LBT-RU Source Statistics&nbsp;&nbsp;<small><a href="#lbtrmandlbtrusourcestatistics">&lt;-</a></small></h2>
<p>The following lists the most important statistics.</p>
<ul>
<li>
<b>rxs_sent</b> indicates that some lost messages are being recovered, but the reason for the loss should be investigated and corrected. </li>
<li>
<b>naks_shed</b> indicates the number of retransmission requests (NAKs) the source transport has not fulfilled, sending a NCF instead. This statistics can help pinpoint transport bottlenecks, such as the configuration options <a class="elRef" doxygen="/29W/Amun/home/sford/sfordmac_DEV_HF_6_12/29West/lbm/doc/Operations/config.tag:../Config/" href="../Config/grptransportlbtrmoperation.html#transportlbtrmretransmitratelimitcontext">transport_lbtrm_retransmit_rate_limit (context)</a> and <a class="elRef" doxygen="/29W/Amun/home/sford/sfordmac_DEV_HF_6_12/29West/lbm/doc/Operations/config.tag:../Config/" href="../Config/grptransportlbtruoperation.html#transportlbtruretransmitratelimitcontext">transport_lbtru_retransmit_rate_limit (context)</a>. </li>
</ul>
<p>For additional information, see <a class="el" href="ummonitoringstatistics.html#monitoringsendingstatistics">Monitoring Sending Statistics</a>.</p>
<p><br />
 </p>
<h2><a class="anchor" id="tcpstatistics"></a>
TCP Statistics&nbsp;&nbsp;<small><a href="#tcpstatistics">&lt;-</a></small></h2>
<p>Receiver statistic <b>lbm_msgs_no_topic_rcvd</b> indicates that receivers may be doing too much topic filtering (wasting CPU resource) because they are processing messages in which they have no interest. If this statistic is greater than 25% of msgs_rcvd, a problem may exist or topics may need to be distributed to different transport sessions.</p>
<p><br />
 </p>
<h2><a class="anchor" id="lbtipcstatistics"></a>
LBT-IPC Statistics&nbsp;&nbsp;<small><a href="#lbtipcstatistics">&lt;-</a></small></h2>
<p>Receiver statistic <b>lbm_msgs_no_topic_rcvd</b> indicates that receivers may be doing too much topic filtering (wasting CPU resource) because they are processing messages in which they have no interest. If this statistic is greater than 25% of msgs_rcvd, a problem may exist or topics may need to be distributed to different transport sessions.</p>
<p><br />
 </p>
<h1><a class="anchor" id="monitoringeventqueues"></a>
Monitoring Event Queues&nbsp;&nbsp;<small><a href="#monitoringeventqueues">&lt;-</a></small></h1>
<p>The following lists the most important statistics.</p>
<ul>
<li>
data_msgs &amp; events - Total data messages and events enqueued - check these not growing beyond pre-defined bounds </li>
<li>
age_mean &amp; age_max - If an application uses a receive-side event queue for message delivery rather than direct callbacks, this indicates average and longest time messages wait on that queue before the application starts processing them. </li>
<li>
data_msgs_svc_mean &amp; data_msgs_svc_max - indicates average and longest time the application spends processing each event-queued message. </li>
</ul>
<p>For more information, see <a class="el" href="ummonitoringstatistics.html#monitoringeventqueuestatistics">Monitoring Event Queue Statistics</a>.</p>
<p><br />
 </p>
<h1><a class="anchor" id="monitoringapplicationlogmessages"></a>
Monitoring Application Log Messages&nbsp;&nbsp;<small><a href="#monitoringapplicationlogmessages">&lt;-</a></small></h1>
<p>UM returns log messages to your application when conditions warrant. Your applications can decide what messages to collect and log. Most UM development teams are concerned with the efficiency and performance of their applications and therefore will log any messages returned to their applications from UM. It may be helpful to meet with your UM development team to learn exactly what they log and how best to monitor the log files. Ideally your UM development team includes a timestamp when they log a message, which can be important for comparison of disparate data, such as CPU information to transport statistics.</p>
<p>See the UM Log Messages section for individual messages and descriptions.</p>
<p>UM daemons (lbmrd, umestored, tnwgd) automatically log messages to the log files specified in their XML configuration files.</p>
<p><br />
 </p>
<h1><a class="anchor" id="monitoringthepersistentstoredaemonumestored"></a>
Monitoring the Persistent Store Daemon (umestored)&nbsp;&nbsp;<small><a href="#monitoringthepersistentstoredaemonumestored">&lt;-</a></small></h1>
<p>With the UMP/UMQ products, the Persistent Store provides persistence services to UM sources and receivers. Multiple stores are typically configured in Quorum/Consensus. Monitor every store process.</p>
<p>Monitor the following for all stores. </p><ul>
<li>
Store log files </li>
<li>
Application events and log files </li>
<li>
Store's internal transport statistics </li>
<li>
Persistent Store daemon web monitor </li>
</ul>
<p><br />
 </p>
<h2><a class="anchor" id="monitoringstorelogfile"></a>
Monitoring Store Log File&nbsp;&nbsp;<small><a href="#monitoringstorelogfile">&lt;-</a></small></h2>
<p>The store generates log messages that are used to monitor its health and operation. There is some flexibility on where those log messages are written; see <a class="elRef" doxygen="/29W/Amun/home/sford/sfordmac_DEV_HF_6_12/29West/lbm/doc/Operations/ume.tag:../UME/" href="../UME/designingpersistenceapplications.html#storelogfile">Store Log File</a>. Each store daemon should have its own log file.</p>
<p>To prevent unbounded disk file growth, the Persistent Store log file can be configured to automatically roll. See <a class="elRef" doxygen="/29W/Amun/home/sford/sfordmac_DEV_HF_6_12/29West/lbm/doc/Operations/ume.tag:../UME/" href="../UME/designingpersistenceapplications.html#storerollinglogs">Store Rolling Logs</a> for more information.</p>
<p>The following lists critical things to monitor in a store log file:</p>
<ul>
<li>
aio_warnings - may indicate a problem with the disk (disk full, cannot write, etc.) </li>
<li>
Proxy source creation - indicates that a source 'went away'. This may be fine, but could also indicate an error condition. Discuss with your UM development team when this event is safe and when it indicates a problem. </li>
<li>
Rapid log file growth - Log files growing rapidly or growing much more rapidly than normal, may indicate a problem. Look at what types of messages are being written to the log at higher-than-normal rates to see where the issue might be. </li>
</ul>
<p>In application log files, look for LBM_SRC_EVENT_UME_REGISTRATION_ERROR messages. These can indicate many different problems that will prevent message persistence. See the UM Log Messages section for details.</p>
<p><br />
 </p>
<h2><a class="anchor" id="monitoringastoresinternaltransportstatistics"></a>
Monitoring a Store's Internal Transport Statistics&nbsp;&nbsp;<small><a href="#monitoringastoresinternaltransportstatistics">&lt;-</a></small></h2>
<p>Since umestored is a proprietary UM application developed with the UM API library, you can configure the daemon with automatic monitoring and then access transport statistics for the daemon's internal sources and receivers. To accomplish this, follow the procedure below.</p>
<ol>
<li>
Enable Automatic Monitoring in the UM configuration file cited in the umestored XML configuration file's "&lt;daemon&gt;" element. </li>
<li>
For each store configured in the umestored XML configuration file, add a "&lt;context-name&gt;" element. Automatic Monitoring then maintains complete transport statistics for each store at the interval set in the UM configuration file. </li>
</ol>
<p><br />
 </p>
<h2><a class="anchor" id="persistentstorewebmonitoring"></a>
Persistent Store Web Monitoring&nbsp;&nbsp;<small><a href="#persistentstorewebmonitoring">&lt;-</a></small></h2>
<p>For information about umestored statistics see <a class="elRef" doxygen="/29W/Amun/home/sford/sfordmac_DEV_HF_6_12/29West/lbm/doc/Operations/ume.tag:../UME/" href="../UME/storewebmonitor.html">Store Web Monitor</a>.</p>
<p>The web address of th Store Web Monitor is configured in the store XML configuration file. See <a class="elRef" doxygen="/29W/Amun/home/sford/sfordmac_DEV_HF_6_12/29West/lbm/doc/Operations/ume.tag:../UME/" href="../UME/configurationreferenceforumestored.html#umeelementdaemon">&lt;daemon&gt;</a>.</p>
<p>You can monitor the following information on the umestored Web Monitor:</p>
<ul>
<li>
List of stores the daemon is running. </li>
<li>
List of topics and wildcard topic patterns for each store, along with registration IDs for the sources sending on the topics. </li>
<li>
Source and receiver information for each topic. </li>
<li>
Ultra Messaging statistics or transport-level statistics for underlying receivers in the store. These are similar to the transport statistics mentioned earlier, however they indicate how the store is communicating with its sources for a given topic. For example, a non-zero number of naks_sent indicates that the store is experiencing some loss. </li>
</ul>
<p>TIP: You can build a script that executes the Linux wget command at a 5 second interval to get a web monitor screen shot and save it to a directory or file.</p>
<p><br />
 </p>
<h2><a class="anchor" id="persistentstoredaemonstatistics"></a>
Persistent Store Daemon Statistics&nbsp;&nbsp;<small><a href="#persistentstoredaemonstatistics">&lt;-</a></small></h2>
<p>The Persistent Store daemon has a simple web server which provides operational information. However, while the web-based presentation is convenient for manual, on-demand monitoring, it is not suitable for automated collection and recording of operational information for historical analysis.</p>
<p>Starting with UM version 6.11, a feature called "Daemon Statistics" has been added to the Store daemon. This feature supports the background publishing of their operational information via UM messages. System designers can now subscribe to this information for their own automated monitoring systems.</p>
<p>See <a class="elRef" doxygen="/29W/Amun/home/sford/sfordmac_DEV_HF_6_12/29West/lbm/doc/Operations/ume.tag:../UME/" href="../UME/storedaemonstatistics.html">Store Daemon Statistics</a> for general information on Daemon Statistics, followed by specific information regarding the Store.</p>
<p><br />
 </p>
<h2><a class="anchor" id="detectingpersistentstorefailures"></a>
Detecting Persistent Store Failures&nbsp;&nbsp;<small><a href="#detectingpersistentstorefailures">&lt;-</a></small></h2>
<p>You can detect the loss of a store with the following.</p>
<ul>
<li>
Loss of the Persistent Store's Process ID (PID) </li>
<li>
Application log messages stating the loss of connection to the store </li>
</ul>
<p>Stores can also be "too busy" and therefore cannot service source and receiving applications. Sources declare a store inactive with the <b>LBM_SRC_EVENT_UME_STORE_UNRESPONSIVE</b> event when the store's activity timeout expires. This can be caused by the following.</p>
<ul>
<li>
Disk is too busy (or when the system starts swapping) </li>
<li>
The store is processing an overly-large load of recovery traffic. You may want to recommend that UM administrators consider a larger quorum / consensus group size. </li>
</ul>
<p><br />
 </p>
<h1><a class="anchor" id="monitoringtheumrouterdaemontnwgd"></a>
Monitoring the UM Router Daemon (tnwgd)&nbsp;&nbsp;<small><a href="#monitoringtheumrouterdaemontnwgd">&lt;-</a></small></h1>
<p>The Ultra Messaging UM Router links disjoint topic resolution domains by forwarding multicast and/or unicast topic resolution traffic ensuring that receivers on the "other" side of the UM Router receive the topics to which they subscribe. See the UM Dynamic Routing Guide for more details.</p>
<p>Understand UM Router (tnwgd) output traffic and WAN impacts - especially the use of rate limiters.</p>
<ul>
<li>
WAN overrun is the number one source of UM Router problems </li>
<li>
Test WAN link throughput to determine the real limits of the UM Router and environment </li>
<li>
Make sure WAN bandwidth can cope with UM and any other traffic </li>
</ul>
<p>Review and understand loss conditions unique to using a UM Router. Collaborate with your UM development team to ensure the correct tuning and configurations are applied for your messaging system. Also monitor latency over the UM Router with the UM sample application lbmpong routinely and monitor output.</p>
<p>Monitor the following for UM Routers.</p>
<ul>
<li>
UM Router log files </li>
<li>
Application events and log files </li>
<li>
UM Router internal transport statistics </li>
<li>
UM Router daemon web monitor </li>
</ul>
<p><br />
 </p>
<h2><a class="anchor" id="monitoringumrouterlogfile"></a>
Monitoring UM Router Log File&nbsp;&nbsp;<small><a href="#monitoringumrouterlogfile">&lt;-</a></small></h2>
<p>The UM router generates log messages that are used to monitor its health and operation. There is some flexibility on where those log messages are written; see <a class="elRef" doxygen="/29W/Amun/home/sford/sfordmac_DEV_HF_6_12/29West/lbm/doc/Operations/gateway.tag:../Gateway/" href="../Gateway/umroutermonitoring.html#umrouterlogmessages">UM Router Log Messages</a>. Each UM router should have its own log file.</p>
<p>To prevent unbounded disk file growth, the UM Router log file can be configured to automatically roll. See <a class="elRef" doxygen="/29W/Amun/home/sford/sfordmac_DEV_HF_6_12/29West/lbm/doc/Operations/gateway.tag:../Gateway/" href="../Gateway/umroutermonitoring.html#umrouterrollinglogs">UM Router Rolling Logs</a> for more information.</p>
<p>The following are important UM Router (tnwgd) log messages.</p>
<p><b>Connection Failure Messages to Monitor:</b></p>
<ul>
<li>
<p class="startli">peer portal [name] failed to connect to peer at [IP:port] via [interface]</p>
<p class="endli"></p>
</li>
<li>
peer portal [name] failed to accept connection (accept) [err]: reason </li>
</ul>
<p><b>Lost Connection Messages to Monitor:</b></p>
<ul>
<li>
peer portal [name] lost connection to peer at [IP:port] via [interface] </li>
<li>
peer portal [name] connection destroyed due to socket failure </li>
<li>
peer portal [name] detected dropped inbound connection (read) [err]: reason </li>
<li>
peer portal [name] detected dropped inbound connection (zero-len read) </li>
</ul>
<p><b>Peer Messages to Monitor:</b> Dual TCP: </p><ul>
<li>
peer portal [name] received connection from [IP:port] </li>
<li>
peer portal [name] connected to [IP:port] </li>
</ul>
<p>Single TCP: </p><ul>
<li>
Acceptor: peer portal [name] received connection from [IP:port] </li>
<li>
Initiator: peer portal [name] connected to [IP:port] </li>
<li>
UM Router Transport Statistics </li>
</ul>
<p><br />
 </p>
<h2><a class="anchor" id="umroutertransportstatistics"></a>
UM Router Transport Statistics&nbsp;&nbsp;<small><a href="#umroutertransportstatistics">&lt;-</a></small></h2>
<p>Using the "&lt;monitor&gt;" element in a UM Router's XML configuration file, you can monitor the transport activity between the UM Router and its Topic Resolution Domain. The configuration also provides Context and Event Queue statistics. The statistics output identifies individual portals by name.</p>
<p><br />
 </p>
<h2><a class="anchor" id="umrouterwebmonitoring"></a>
UM Router Web Monitoring&nbsp;&nbsp;<small><a href="#umrouterwebmonitoring">&lt;-</a></small></h2>
<p>The UM Router web monitor provides access to a UM Router's portal and general statistics and information. The UM Router XML configuration file contains the location of the gateway web monitor. The default port is 15305.</p>
<p>A UM Router Web Monitor provides a web page for each endpoint and peer portal configured for the UM Router. Peer portals connect UM Routers and communicate only with other peer portals. Endpoint portals communicate with topic resolution domains. Each statistic display a value for units (messages or fragments) and bytes.</p>
<p>Important statistics you can monitor on the tnwgd Web Monitor include the following.</p>
<p><b>Endpoint Send Statistics</b></p>
<p>Increases in the Endpoint Send Statistics values indicate errors and problems. A separate statistic appears for each of the three types of topic message: transport topic, immediate topic, immediate topicless.</p>
<ul>
<li>
Fragments/bytes dropped due to blocking - Indicates inability to send due to a transport's rate controller. Message rates on other portals probably exceed the rate controller limit on the monitored portal. The UM Router's XML configuration file may need to be adjusted. </li>
<li>
Fragments/bytes dropped due to error - Indicates a possible network socket or memory failure. </li>
<li>
Fragments/Bytes Dropped Due To Fragment Size Error - Indicates a configuration error which should be corrected. Maximum datagram size for all transports must be the same throughout the network. Nonzero indicates fragments were received which were larger than the egress portal's maximum datagram size. </li>
<li>
Current/maximum data bytes enqueued - Indicates how much data is currently queued and indicates the maximum amount of data queued because the incoming rate exceeded what the TCP connection could handle. Results in a latency penalty. Size of the queue is limited, so if the limit is exceeded, messages are dropped due to blocking. </li>
</ul>
<p><b>Peer Send Statistics</b></p>
<p>Increases in the Peer Send Statistics values indicate errors and problems.</p>
<ul>
<li>
Fragments/bytes (or messages/bytes) dropped (blocking) - The result of attempting to send too much data via the peer link. </li>
<li>
Fragments/bytes (or messages/bytes) dropped (not operational) - Peer connection not yet fully established. The UM Router peer could be down or starting up. </li>
<li>
Current/maximum data bytes enqueued - Indicates how much data is currently queued and indicates the maximum amount of data queued because the incoming rate exceeded what the TCP connection could handle. Results in a latency penalty. Size of the queue is limited, so if the limit is exceeded, messages are dropped due to blocking. </li>
<li>
<p class="startli">Messages or bytes Received / Fragments or bytes Forwarded - Increasing counters indicate communicating peers. Stagnant counters indicate a lack of traffic flow. A sender could be down, receivers on the remote side could have no interest for the topics, the peer connection could have failed.</p>
<p class="endli"><br />
 </p>
</li>
</ul>
<h2><a class="anchor" id="op-umrouterdaemonstatistics"></a>
UM Router Daemon Statistics&nbsp;&nbsp;<small><a href="#op-umrouterdaemonstatistics">&lt;-</a></small></h2>
<p>The UM Router daemon has a simple web server which provides operational information. However, while the web-based presentation is convenient for manual, on-demand monitoring, it is not suitable for automated collection and recording of operational information for historical analysis.</p>
<p>Starting with UM version 6.11, a feature called "Daemon Statistics" has been added to the UM Router. This feature supports the background publishing of their operational information via UM messages. System designers can now subscribe to this information for their own automated monitoring systems.</p>
<p>See <a class="elRef" doxygen="/29W/Amun/home/sford/sfordmac_DEV_HF_6_12/29West/lbm/doc/Operations/ume.tag:../UME/" href="../UME/storedaemonstatistics.html">Store Daemon Statistics</a> for general information on Daemon Statistics, followed by specific information regarding the UM Router.</p>
<p><br />
 </p>
<h2><a class="anchor" id="detectingumrouterfailures"></a>
Detecting UM Router Failures&nbsp;&nbsp;<small><a href="#detectingumrouterfailures">&lt;-</a></small></h2>
<p>You can detect the loss of a UM Router by the following.</p>
<ul>
<li>
Loss of the UM Router's Process ID (PID) </li>
<li>
Loss of the UM Router's Web Monitor (you can poll the UM Router's Web Monitor to be sure it is accessible.) </li>
<li>
Monitoring the performance of applications sending messages through the UM Router. <ul>
<li>
Are applications receiving the appropriate volume of data? </li>
<li>
Do you see a high number of retransmissions? </li>
<li>
Are applications generating the expected number of actions? Understanding the expected flow and actions is critical and requires collaboration with your UM development team. </li>
</ul>
</li>
<li>
Monitoring network performance and behavior in and out of the UM Router. Understanding your network topology and the expected network traffic through the UM Router is critical and requires collaboration with your UM development team. </li>
</ul>
<p><br />
 </p>
<h1><a class="anchor" id="monitoringmessagingsystemresources"></a>
Monitoring Messaging System Resources&nbsp;&nbsp;<small><a href="#monitoringmessagingsystemresources">&lt;-</a></small></h1>
<p>In addition to monitoring UM activity, you must also consider the health and activity of your system resources.</p>
<ul>
<li>
CPU usage </li>
<li>
Memory Usage </li>
<li>
UDP loss (netstat -s) </li>
<li>
Latency </li>
</ul>
<p><br />
 </p>
<h2><a class="anchor" id="persistentstoresystemconsiderations"></a>
Persistent Store System Considerations&nbsp;&nbsp;<small><a href="#persistentstoresystemconsiderations">&lt;-</a></small></h2>
<p>Consider the following system issues regarding Persistent Store monitoring.</p>
<ul>
<li>
<p class="startli">Make sure that the environment in which a Persistent Store daemon (umestored) is started has enough available file descriptors for the number of sources in your environment. UM uses a minimum of 2 file descriptors per UM source in addition to normal UM file descriptors for transports and other objects. You can use ulimit in Linux and Process Explorer on Microsoft® Windows® to monitor file handles.</p>
<p class="endli">Note: The reduced-fd repository type uses 5 File Descriptors for the entire store, regardless of the number of topics, in addition to normal UM file descriptors for transports and other objects. Use of this repository type may impact performance. </p>
</li>
<li>
Monitor system resources (CPU usage, memory, disk space, wait%, memory swapping). </li>
<li>
If the system is about to start swapping, your resources are insufficient for the required system performance. Reconfiguration and/or additional resources will be required. </li>
</ul>
<p><br />
 </p>
<h2><a class="anchor" id="sourcesoflatency"></a>
Sources of Latency&nbsp;&nbsp;<small><a href="#sourcesoflatency">&lt;-</a></small></h2>
<p>The following are common sources of latency.</p>
<ul>
<li>
Loss and recovery </li>
<li>
Slow receivers </li>
<li>
Wildcard receivers with overly broad interest patterns </li>
<li>
High resource utilization </li>
<li>
'Busy' applications - messages backed up in event queues. Your UM Development Team can tell you if your UM applications use event queues. </li>
</ul>
<p><br />
 </p>
<h2><a class="anchor" id="runtimediagnostics"></a>
Runtime Diagnostics&nbsp;&nbsp;<small><a href="#runtimediagnostics">&lt;-</a></small></h2>
<p>Use the following to validate a healthy system.</p>
<ul>
<li>
UM monitoring metrics are active as a sign of liveness </li>
<li>
Pre-defined thresholds are not breached in the monitoring systems </li>
<li>
Application logs are clear of errors/warnings </li>
<li>
Required processes are running i.e. lbmrd </li>
<li>
General system resources are within pre-defined bounds i.e. CPU, memory, network stats (specific to the applications) </li>
<li>
Operating system e.g. UDP buffers for loss detection </li>
</ul>
<p>Use the following to validate the system is operating within acceptable limits.</p>
<ul>
<li>
Monitor memory usage and growth over time. <ul>
<li>
Applications with increasing memory could indicate a future problem </li>
<li>
Could indicate apps are misconfigured for required scalability </li>
<li>
Event queue growth (also UM metrics) </li>
<li>
Theoretical memory limits for 32-bit/64-bit processes, dependent on OS and language choice. </li>
</ul>
</li>
<li>
Spikes in CPU usage across multiple systems indicate a system wide event and could be an indication of a "crybaby" receiver causing source retransmissions or a rogue wildcard receiver. </li>
<li>
Monitor network activity across the environment. <ul>
<li>
Switch failures / unplugged cable </li>
<li>
Network Interface Card (NIC) failures </li>
<li>
Symptoms of NIC bonding failure </li>
<li>
Significant changes in overall network traffic could indicate a problem such as loss (discussed later) </li>
</ul>
</li>
<li>
Look for correlated activity. Do CPU spikes and network spikes lead or lag each other? </li>
<li>
Build thresholds based on an established business as usual (BAU) baseline. </li>
<li>
These diagnostics and UM metrics could indicate a general problem with the applications, network or underlying hardware. </li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
</body>
</html>
