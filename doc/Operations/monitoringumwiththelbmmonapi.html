<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Operations Guide: Monitoring UM Applications</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen_manual.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Operations Guide
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('monitoringumwiththelbmmonapi.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Monitoring UM Applications </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="whymonitor"></a><br />
 </p>
<h1><a class="anchor" id="monitoringintroduction"></a>
Monitoring Introduction&nbsp;&nbsp;<small><a href="#monitoringintroduction">&lt;-</a></small></h1>
<p>There are good reasons to monitor any messaging system's operation. </p><ul>
<li>
Identify opportunities to further optimize the system. </li>
<li>
Notice minor problems before they become major problems. </li>
<li>
Watch traffic trends and possibly reallocate resources where they are most needed. </li>
<li>
Be able to provide Informatica Support with requested information when questions or problems arise. </li>
</ul>
<p>Monitoring can aid different groups within an organization.</p>
<ul>
<li>
Developers can spot bugs that impact system performance. </li>
<li>
Performance tuning groups can pinpoint under-performing receivers. </li>
<li>
Testing groups can understand the reaction of a system to stresses like random packet loss during pre- production testing. </li>
<li>
Network or middleware management groups can use monitoring to ensure a production system continues to operate within its design criteria. </li>
</ul>
<p><br />
 </p>
<h2><a class="anchor" id="whattomonitor"></a>
What to Monitor&nbsp;&nbsp;<small><a href="#whattomonitor">&lt;-</a></small></h2>
<p>Before discussing the monitoring statistics that are built into UM, we mention two things that are probably more important to monitor: connectivity and latency. UM provides some assistance for monitoring these, but the final responsibility rests with your applications.</p>
<dl class="section user"><dt><b>Connectivity</b> </dt><dd>If you monitor only one thing, monitor connectivity, defined as the ability of your system components to talk to each other when needed Connectivity failures generally indicate a software, hardware, or network failure and generally require prompt attention. UM features like End Of Source (EOS) events, new source notifications, and receiver connect/disconnect events may help in application connectivity monitoring. See the lbmprice.c example to see techniques for using these to build an awareness of when components of the system come and go.</dd></dl>
<dl class="section user"><dt><b>Message</b> Latency</dt><dd>If you monitor only two things, monitor connectivity and the latency of every message. Connectivity monitoring will catch the hard failures and latency monitoring will catch the soft failures. Many impending hard failures in hardware, software, and networks show up first as rises in average latency or as latency spikes.</dd></dl>
<p><br />
 </p>
<h1><a class="anchor" id="monitoringmethods"></a>
Monitoring Methods&nbsp;&nbsp;<small><a href="#monitoringmethods">&lt;-</a></small></h1>
<p>Broadly speaking, there are two overall approaches to monitoring: </p><ol>
<li>
Applications self-monitor. Each application calls statistics APIs and checks for important metrics such as loss. Usually the application will build that data into its own larger application monitoring infrastructure. See <a class="el" href="monitoringumwiththelbmmonapi.html#umsapifunctionsanddatastructures">UM API Functions and Data Structures</a>. </li>
<li>
Send statistics data to a central UM monitoring application for analysis, display, and storage. That central monitoring application uses a different set of APIs to retrieve statistics from the remote applications. </li>
</ol>
<p>If you choose to send statistics data to a central monitoring application, there are two more application-side approaches to choose from.</p>
<ol>
<li>
Within each application, code can be written to precisely control how and when statistics data are sampled and sent. This is done with the <a class="el" href="monitoringumwiththelbmmonapi.html#lbmmonapi">"lbmmon" Client API</a>. </li>
<li>
The application needs no special monitoring code. Instead, UM's <a class="el" href="monitoringumwiththelbmmonapi.html#automaticmonitoring">Automatic Monitoring</a> feature can be enabled which uses the <a class="el" href="monitoringumwiththelbmmonapi.html#lbmmonapi">"lbmmon" Client API</a> internally. This is the most commonly-used approach. </li>
</ol>
<p>Next you need to decide on the approach to take for the central monitoring application. Again, there are two choices.</p>
<ol>
<li>
Use the Ultra Messaging SNMP Agent and MIB to monitor statistics through a Network Management System. </li>
<li>
Use a different set of functions in the <a class="el" href="monitoringumwiththelbmmonapi.html#lbmmonapi">"lbmmon" Client API</a> to receive statistics data sent by the applications and make the data available to a monitoring application of your own design. See <a class="el" href="monitoringumwiththelbmmonapi.html#receivingmonitoringdata">Receiving Monitoring Data</a> for details. </li>
</ol>
<p><br />
 </p>
<h2><a class="anchor" id="monitoringfieldsizes"></a>
Monitoring Field Sizes&nbsp;&nbsp;<small><a href="#monitoringfieldsizes">&lt;-</a></small></h2>
<p>The monitoring statistics that UM collects are stored in C-language data structures. The counters are of type "unsigned long int". This means that the size of these counters can vary according to the platform.</p>
<table class="doxtable">
<tr>
<th>Platform </th><th>Unsigned Long Size </th></tr>
<tr>
<td>Linux 64-bit </td><td>64 bits </td></tr>
<tr>
<td>Linux 32-bit </td><td>32 bits </td></tr>
<tr>
<td>Windows 64-bit </td><td>32 bits </td></tr>
<tr>
<td>Windows 32-bit </td><td>32 bits </td></tr>
</table>
<p>Note that some of the counters, like bytes sent, can easily exceed the capacity of a 32-bit unsigned long in a single day, leading to roll-over. I.e. a 32-bit counter will go from 4,294,967,295 to 0. In contrast, it would take thousands of years of continuous operation for a 64-bit counter to roll over.</p>
<p>Also note that if the monitoring application is using the <a class="el" href="monitoringumwiththelbmmonapi.html#lbmmonapi">"lbmmon" Client API</a> to receive data, those same data structures are used. Thus, the platform used for the monitoring application determines the bit size of the counters seen by the monitoring application. For example, if a 64-bit Linux application is sending statistics, those counter values can exceed 4,294,967,295. But if the monitoring application is running on, for example, 64-bit Windows, the data structures will be populated with 32-bit counters. In the case of receiving statistics from 64-bit Linux, any counters that exceed 4,294,967,295 will be stored modulo 4,294,967,296. I.e. it will be stored as if it had wrapped like a 32-bit counter would have wrapped.</p>
<p><br />
 </p>
<h2><a class="anchor" id="monitoringcontext"></a>
Application Monitoring Context&nbsp;&nbsp;<small><a href="#monitoringcontext">&lt;-</a></small></h2>
<p>Within the application, it is common to create a separate context for sampling and sending statistics data. This happens automatically if UM's <a class="el" href="monitoringumwiththelbmmonapi.html#automaticmonitoring">Automatic Monitoring</a> feature is enabled.</p>
<p>Since the statistics data is published via a source on separate context, that source and context need to be configured. You might choose to have it configured identically to the application, or you might choose to have them different. For example, some customers configure a separate <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/design.tag:../Design/" href="../Design/fundamentalconcepts.html#topicresolutiondomain">Topic Resolution Domain</a> so that the monitoring data does not mix with the application data. In fact, it can be configured to use a different network interface so that there is no interference between sending monitoring data and the exchange of application messages. See <a class="el" href="monitoringumwiththelbmmonapi.html#thelbmtransportmodule">The LBM Transport Module</a> or <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/config.tag:../Config/" href="../Config/grpautomaticmonitoring.html">Automatic Monitoring Options</a> for details of how to configure the monitoring context.</p>
<p>As a point of interest, the automatic monitoring feature <em>uses</em> UM to send the statistics data. So now you have the question: should the context and source used to send monitoring data be included in the monitoring data? UM's automatic monitoring feature answers that question with "no".</p>
<p>The monitoring context and source are explicitly excluded from being monitored. This involves hard-coding certain configuration options as follows: The <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/config.tag:../Config/" href="../Config/grpautomaticmonitoring.html#monitorintervalcontext">monitor_interval (context)</a> option is forced to zero (it is not possible to monitor the monitoring context). The <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/config.tag:../Config/" href="../Config/grpunicastimmediatemessagingnetwork.html#requesttcpbindrequestportcontext">request_tcp_bind_request_port (context)</a> option is forced to zero (this prevents the monitoring context from using <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/design.tag:../Design/" href="../Design/fundamentalconcepts.html#persistence">Persistence</a>, <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/design.tag:../Design/" href="../Design/fundamentalconcepts.html#latejoin">Late Join</a>, and <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/design.tag:../Design/" href="../Design/umfeatures.html#offtransportrecoveryotr">Off-Transport Recovery (OTR)</a>). The <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/config.tag:../Config/" href="../Config/grpmulticastimmediatemessagingnetwork.html#mimincomingaddresscontext">mim_incoming_address (context)</a> option is forced to zero (this reduces the socket count and multicast load of the monitoring context). The <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/config.tag:../Config/" href="../Config/grpudpbasedresolveroperation.html#resolvercachecontext">resolver_cache (context)</a> option is forced to zero (this reduces the memory footprint of the monitoring context).</p>
<p><br />
 </p>
<h1><a class="anchor" id="umsapifunctionsanddatastructures"></a>
UM API Functions and Data Structures&nbsp;&nbsp;<small><a href="#umsapifunctionsanddatastructures">&lt;-</a></small></h1>
<p>The UM API contains functions that retrieve various statistics for a context, event queue, source or receiver. This section lists the functions and constructors you can use to retrieve statistics, along with the data structures UM uses to deliver the statistics. Refer to the UM API documentation (UM C API, UM Java API or UM .NET API) for specific information about the functions and constructors. Links to the data structures appear in the tables to provide quick access to the specific statistics available.</p>
<p><br />
 </p>
<h2><a class="anchor" id="contextstatistics"></a>
Context Statistics&nbsp;&nbsp;<small><a href="#contextstatistics">&lt;-</a></small></h2>
<p>Context statistics help you monitor topic resolution activity, along with the number of unknown messages received and the number of sends and responses that were blocked or returned <b>EWOULDBLOCK</b>. Context statistics also contain transport statistics for Multicast Immediate Messaging (MIM) activity and transport statistics for all the sources or receivers in a context.</p>
<center> <table class="doxtable">
<tr>
<th>C API Function</th><th>Java or .NET API Constructor</th><th>Data Structure </th></tr>
<tr>
<td><a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbm_8h.html#aa8f2d2e5b28e2c97911117acb099c48e">lbm_context_retrieve_stats()</a> </td><td>LBMContextStatistics() </td><td><a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbm_8h.html#ab86e72a3f715d7c8ddc49c6431455839">lbm_context_stats_t</a> </td></tr>
<tr>
<td><a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbm_8h.html#a147a3639e45780731e3a2a37adb529f2">lbm_context_retrieve_rcv_transport_stats()</a> </td><td>LBMReceiverStatistics() </td><td><a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbm_8h.html#a9bdc2628dece44f0675b0bdebfb3d52c">lbm_rcv_transport_stats_t</a> </td></tr>
<tr>
<td><a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbm_8h.html#a14e652f7827e5abfe07fcd3522b19b44">lbm_context_retrieve_src_transport_stats()</a> </td><td>LBMSourceStatistics() </td><td><a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbm_8h.html#a0a0c54fd8e9a7008f1db0126373fca92">lbm_src_transport_stats_t</a> </td></tr>
<tr>
<td><a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbm_8h.html#a3a167b88f0a789dce27eb77160a9d2f2">lbm_context_retrieve_im_rcv_transport_stats()</a> </td><td>LBMMIMReceiverStatistics() </td><td><a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbm_8h.html#a9bdc2628dece44f0675b0bdebfb3d52c">lbm_rcv_transport_stats_t</a> </td></tr>
<tr>
<td><a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbm_8h.html#adeb93551e63dcb44a871f2fd97d3b87f">lbm_context_retrieve_im_src_transport_stats()</a> </td><td>LBMMIMSourceStatistics() </td><td><a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbm_8h.html#a0a0c54fd8e9a7008f1db0126373fca92">lbm_src_transport_stats_t</a> </td></tr>
</table>
</center><p><br />
 </p>
<h2><a class="anchor" id="eventqueuestatistics"></a>
Event Queue Statistics&nbsp;&nbsp;<small><a href="#eventqueuestatistics">&lt;-</a></small></h2>
<p>Event Queue statistics help you monitor the number of events currently on the queue, how long it takes to service them (maximum, minimum and mean service times) and the total number of events for the monitoring period. These statistics are available for the following types of events.</p>
<ul>
<li>
Data messages </li>
<li>
Request messages </li>
<li>
Immediate messages </li>
<li>
Wildcard receiver messages </li>
<li>
I/O events </li>
<li>
Timer events </li>
<li>
Source events </li>
<li>
Unblock events </li>
<li>
Cancel events </li>
<li>
Callback events </li>
<li>
Context source events </li>
<li>
Total events </li>
<li>
Age of events </li>
</ul>
<p>When monitoring Event Queue statistics you must enable the Event Queue UM Configuration Options <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/config.tag:../Config/" href="../Config/grpeventqueue.html#queueageenabledeventqueue">queue_age_enabled (event_queue)</a>, <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/config.tag:../Config/" href="../Config/grpeventqueue.html#queuecountenabledeventqueue">queue_count_enabled (event_queue)</a>, <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/config.tag:../Config/" href="../Config/grpeventqueue.html#queueservicetimeenabledeventqueue">queue_service_time_enabled (event_queue)</a>. UM disables these options by default, which produces no event queue statistics.</p>
<center> <table class="doxtable">
<tr>
<th>C API Function</th><th>Java or .NET API Constructor</th><th>Data Structure </th></tr>
<tr>
<td><a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbm_8h.html#aeb9ed445a630f0db48f8c9d24bf23178">lbm_event_queue_retrieve_stats()</a> </td><td>LBMEventQueueStatistics() </td><td><a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbm_8h.html#aa533d6a23589618291f552e988a426f6">lbm_event_queue_stats_t</a> </td></tr>
</table>
</center><p><br />
 </p>
<h2><a class="anchor" id="sourceorreceivertransportstatistics"></a>
Source or Receiver Transport Statistics&nbsp;&nbsp;<small><a href="#sourceorreceivertransportstatistics">&lt;-</a></small></h2>
<p>You can retrieve transport statistics for different types of transports. In addition, you can limit these transport statistics to a specific source sending on the particular transport or a specific receiver receiving messages over the transport. Source statistics for LBT-RM, for example, include the number of message datagrams sent and the number of retransmissions sent. For receiver LBT-RM, statistics include, for example, the number of message datagrams received and number of UM messages received.</p>
<dl class="section note"><dt>Note</dt><dd>None of the transport statistics are topic level statistics. Currently UM does not provide statistics that show the activity of a specific topic on one or more transport sessions.</dd></dl>
<center> <table class="doxtable">
<tr>
<th>C API Function</th><th>Java or .NET API Constructor</th><th>Data Structure </th></tr>
<tr>
<td><a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbm_8h.html#a4094c703f97a7ebe340b985b2ed1ac2b">lbm_rcv_retrieve_transport_stats()</a> </td><td>LBMReceiverStatistics() </td><td><a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbm_8h.html#a9bdc2628dece44f0675b0bdebfb3d52c">lbm_rcv_transport_stats_t</a> </td></tr>
<tr>
<td><a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbm_8h.html#af49cc8ea36d829820466790d9857f9de">lbm_rcv_retrieve_all_transport_stats()</a> </td><td>LBMReceiverStatistics() </td><td><a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbm_8h.html#a9bdc2628dece44f0675b0bdebfb3d52c">lbm_rcv_transport_stats_t</a> </td></tr>
<tr>
<td><a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbm_8h.html#a976eeac5bd741e2c320a1f341a22af1a">lbm_src_retrieve_transport_stats()</a> </td><td>LBMSourceStatistics() </td><td><a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbm_8h.html#a0a0c54fd8e9a7008f1db0126373fca92">lbm_src_transport_stats_t</a> </td></tr>
</table>
</center><p><br />
 </p>
<h1><a class="anchor" id="lbmmonapi"></a>
"lbmmon" Client API&nbsp;&nbsp;<small><a href="#lbmmonapi">&lt;-</a></small></h1>
<p>The "lbmmon" API (see <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbmmon_8h.html">lbmmon.h</a> or the LBMMonitor classes in the Java API and the .NET API) provides a framework to easily gather UM transport statistics and send them to a monitoring or reporting application. Transport sessions for sources and receivers, along with all transport sessions for a given context can be monitored. This API can be implemented in one of two ways.</p>
<ul>
<li>
Build monitoring into your application with the UM Monitoring API functions. </li>
<li>
Turn on Automatic Monitoring with UM configuration options. See <a class="el" href="monitoringumwiththelbmmonapi.html#automaticmonitoring">Automatic Monitoring</a>. </li>
</ul>
<p>An application requesting transport monitoring is called a monitor source, and an application accepting statistics is a monitor receiver. These monitoring objects deal only with transport session statistics and should not be confused with UM sources and UM receivers, which deal with UM messages. Statistics for both UM sources and UM receivers can be forwarded by a monitor source application.</p>
<p>Both a monitor source and monitor receiver comprise three modules:</p>
<ul>
<li>
A format module, responsible for serializing and de-serializing the statistics. The proper transmission between monitor source and monitor receiver requires this serialization. </li>
<li>
A transport module that is responsible for sending and receiving statistics data. </li>
<li>
A control module, responsible for gathering the statistics, and calling the appropriate functions from the format and transport modules. </li>
</ul>
<p>You can substitute format and transport modules of your own choosing or creation. UM Monitoring provides the following sample modules:</p>
<ul>
<li>
LBMMON CSV format module </li>
<li>
LBMMON UM transport module </li>
<li>
LBMMON UDP transport module </li>
<li>
LBMMON SNMP transport module </li>
</ul>
<p>To view the source code for all LBMMON transport modules, see <a href="../API/lbmmon_examples.html">LBMMON Example source code</a>.</p>
<p><br />
 </p>
<h2><a class="anchor" id="monitoringprocessflow"></a>
Monitoring Process Flow&nbsp;&nbsp;<small><a href="#monitoringprocessflow">&lt;-</a></small></h2>
<p>The overall process flow appears in the diagram below.</p>
<div class="image">
<img src="lbmmon.png" alt="lbmmon.png"/>
</div>
 <ol>
<li>
Your application creates the monitor source controller, specifying the format and transport modules to use. It also calls lbmmon functions to start monitoring an UM context, UM source or UM receiver. </li>
<li>
The monitor source controller passes those statistics to the format module serialization function. </li>
<li>
The monitor source controller passes the resulting serialized data to the transport module send function. </li>
<li>
The transport module transmits the data over some transport medium (such as a network). </li>
<li>
The monitor receiver controller transport module receives the serialized data. (Your monitoring application has already created the monitor receiver controller specifying the format and transport modules to use, along with the application callback functions to use upon the receipt of UM source or UM receiver statistics data.) </li>
<li>
The monitor receiver controller calls the format module's de-serialization function. </li>
<li>
Finally, the monitor receiver controller passes the statistics to your monitoring application via the specified application callback functions. </li>
</ol>
<p>Your applications only calls functions in the controller modules, which calls the appropriate functions in the transport and format modules.</p>
<p><br />
 </p>
<h2><a class="anchor" id="apiframeworkflexibility"></a>
API Framework Flexibility&nbsp;&nbsp;<small><a href="#apiframeworkflexibility">&lt;-</a></small></h2>
<p>The segregation of UM Monitoring into control, format, and transport modules provides flexibility for monitor receivers in two ways.</p>
<ul>
<li>
Allows you to use languages for which no UM API or binding exists. </li>
<li>
Allows you to use monitoring products which do not integrate with UM. </li>
</ul>
<p>As an example, assume you have a Perl application which currently gathers statistics from other network applications (or, you are simply most comfortable working in Perl for such tasks). There is no Perl binding for UM. However, Perl can handle UDP packets very nicely, and can pick apart CSV data easily. By implementing a UDP transport module to be used by the monitor sources, your Perl application can read the UDP packets and process the statistics.</p>
<p><br />
 </p>
<h2><a class="anchor" id="initialmonitoringquestions"></a>
Initial Monitoring Questions&nbsp;&nbsp;<small><a href="#initialmonitoringquestions">&lt;-</a></small></h2>
<p>If you can answer the following questions, you're already on your way.</p>
<ol>
<li>
What format module will you use? LBMMON CSV Format module or a different one. </li>
<li>
What transport module will you use? One of the 3 LBMMON modules or a different one. </li>
<li>
Do you want to monitor individual sources/receivers, or an entire context? The difference is in how the statistics are aggregated. <ul>
<li>
Monitoring a context aggregates transport statistics for all sources and receivers associated with a context, by transport. Note that this is not by transport type. The default configuration for TCP, for example, allocates up to 10 ports, forming up to 10 separate transport sessions. Absent any specific instructions, UM allocates sources and receivers to these 10 transports in a round-robin fashion. So the statistics for a specific transport on a context will aggregate all sources and receivers which use that specific transport. </li>
<li>
Ultra Messaging recommends that you monitor either a context or source/receiver, but not both. For example if Topic1 and Topic2 are mapped to the same transport session (which is the only transport session for the context) and you monitor both the receivers and the context, you will get 3 identical sets of statistics: one for Topic1 reporting the stats for it's transport session, one for Topic2 reporting the stats for the same transport session, and one for the transport session via the context. </li>
<li>
In the case of wildcard receivers, only the context may be monitored. UM creates wildcard receivers dynamically as it detects topics which match the wildcard pattern. The application does not have access to these dynamically-created receivers. So the only way to monitor a wildcard receiver is to monitor the context on which it was created. </li>
</ul>
</li>
<li>
Should statistics be sent automatically, or on demand? <ul>
<li>
Automatic sending of statistics is by far the simplest approach. You simply indicate how often the statistics should be gathered and sent. The rest is taken care of. </li>
<li>
On-demand is somewhat more involved. Your application decides when statistics should be gathered and sent. If you intend to use the arrival of statistics as a type of heartbeat, this is the method you should use. </li>
</ul>
</li>
</ol>
<p>The following sections present more discussion and sample source code about starting monitor sources, monitor receivers and the LBMMON format and transport modules.</p>
<p><br />
 </p>
<h2><a class="anchor" id="creatingamonitoringsource"></a>
Creating a Monitoring Source&nbsp;&nbsp;<small><a href="#creatingamonitoringsource">&lt;-</a></small></h2>
<p>The following examples demonstrate how to use the UM Monitoring API to enable monitoring in your application.</p>
<p>First, create a monitoring source controller:</p>
<div class="fragment"><div class="line"><a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbm_8h.html#a9f6ec97839a8f264eb4059de01174f3c">lbm_context_t</a> * ctx;</div><div class="line"><a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbm_8h.html#a717ff27bb10ae7800330c21d810dffb8">lbm_src_t</a> * src;</div><div class="line"><a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbm_8h.html#a0a4af6b8247cc5a0a24a8578fb6e83bd">lbm_rcv_t</a> * rcv;</div><div class="line"><a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbmmon_8h.html#a4fbc26b3a219f366dbdbeeb40638a437">lbmmon_sctl_t</a> * monctl;</div><div class="line"></div><div class="line"><span class="keywordflow">if</span> (<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbmmon_8h.html#a393a4f0563c7dbda75582053c3a56209">lbmmon_sctl_create</a>(&amp;monctl, lbmmon_format_csv_module(), NULL, lbmmon_transport_lbm_module(), NULL) == -1)</div><div class="line">{</div><div class="line">  fprintf(stderr, <span class="stringliteral">&quot;lbmmon_sctl_create() failed\n&quot;</span>);</div><div class="line">  exit(1);</div><div class="line">}</div></div><!-- fragment --><p>The above code tacitly assumes that the ctx, src, and rcv variables have been previously assigned via the appropriate UM API calls.</p>
<p>The monitoring source controller object must be passed to subsequent calls to reference a specific source controller. One implication of this is that it is possible to have multiple monitoring source controllers within a single application, each perhaps monitoring a different set of objects.</p>
<p>In the above example, the default CSV format module and default UM transport module are specified via the provided module functions lbmmon_format_csv_module() and lbmmon_transport_lbm_module().</p>
<p><br />
 </p>
<h2><a class="anchor" id="specifyingtheobjecttomonitor"></a>
Specifying the Object to Monitor&nbsp;&nbsp;<small><a href="#specifyingtheobjecttomonitor">&lt;-</a></small></h2>
<p>Once a monitoring source controller is created, the application can monitor a specific context using:</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbmmon_8h.html#afe461c7e4c25b9af6e17e86ec6c68ca9">lbmmon_context_monitor</a>(monctl, ctx, NULL, 10) == -1)</div><div class="line">{</div><div class="line">  fprintf(stderr, <span class="stringliteral">&quot;lbmmon_context_monitor() failed\n&quot;</span>);</div><div class="line">  exit(1);</div><div class="line">}</div></div><!-- fragment --><p>The above example indicates that statistics for all transports on the specified context will be gathered and sent every 10 seconds.</p>
<p>A UM source can be monitored using:</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbmmon_8h.html#a17c8902529e1ada7f2c93807824f3186">lbmmon_src_monitor</a>(monctl, src, NULL, 10) == -1)</div><div class="line">{</div><div class="line">  fprintf(stderr, <span class="stringliteral">&quot;lbmmon_src_monitor() failed\n&quot;</span>);</div><div class="line">  exit(1);</div><div class="line">}</div></div><!-- fragment --><p>Finally, an UM receiver can be monitored using:</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbmmon_8h.html#a6003e89b269f91cb2b54a848fc49ed0f">lbmmon_rcv_monitor</a>(monctl, rcv, NULL, 10) == -1)</div><div class="line">{</div><div class="line">  fprintf(stderr, <span class="stringliteral">&quot;lbmmon_rcv_monitor() failed\n&quot;</span>);</div><div class="line">  exit(1);</div><div class="line">}</div></div><!-- fragment --><p>The two above examples also request that statistics for all transports on the specified source or receiver be gathered and sent every 10 seconds.</p>
<p>Statistics can also be gathered and sent in an on-demand manner. Passing 0 for the Seconds parameter to <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbmmon_8h.html#afe461c7e4c25b9af6e17e86ec6c68ca9">lbmmon_context_monitor()</a>, <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbmmon_8h.html#a17c8902529e1ada7f2c93807824f3186">lbmmon_src_monitor()</a>, or <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbmmon_8h.html#a6003e89b269f91cb2b54a848fc49ed0f">lbmmon_rcv_monitor()</a> prevents the automatic gathering and sending of statistics. To trigger the gather/send process, use:</p>
<div class="fragment"><div class="line"><a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbmmon_8h.html#a657d3c8a78ce6424254d4c04ea151dd1">lbmmon_sctl_sample</a>(monctl);</div></div><!-- fragment --><p>Such a call will perform a single gather/send action on all monitored objects (contexts, sources, and receivers) which were registered as on-demand.</p>
<p>As part of application cleanup, the created monitoring objects should be destroyed. Each individual object can be de-registered using <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbmmon_8h.html#a9c9df74b579a8d671cc35ae0a45dc712">lbmmon_context_unmonitor()</a>, <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbmmon_8h.html#accdc082c8a0335ada54924517bdab61e">lbmmon_src_unmonitor()</a>, or <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbmmon_8h.html#aec702c07918485584dbf3f1c837a0945">lbmmon_rcv_unmonitor()</a>. Finally, the monitoring source controller can be destroyed using:</p>
<div class="fragment"><div class="line"><a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbmmon_8h.html#a414ffaef09c93babbb68348122e90f50">lbmmon_sctl_destroy</a>(monctl);</div></div><!-- fragment --><p>Any objects which are still registered will be automatically de-registered by <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbmmon_8h.html#a414ffaef09c93babbb68348122e90f50">lbmmon_sctl_destroy()</a>.</p>
<p><br />
 </p>
<h2><a class="anchor" id="receivingmonitoringdata"></a>
Receiving Monitoring Data&nbsp;&nbsp;<small><a href="#receivingmonitoringdata">&lt;-</a></small></h2>
<p>To make use of the statistics, an application must be running which receives the monitor data. This application creates a monitoring receive controller, and specifies callback functions which are called upon the receipt of source or receiver statistics data.</p>
<p>Use the following to create a monitoring receive controller:</p>
<div class="fragment"><div class="line"><a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbmmon_8h.html#ab78e437e68e7744fd2e5617a013ec44b">lbmmon_rctl_t</a> * monctl;</div><div class="line"><a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbmmon_8h.html#a620373eb83e49e3900f52b4e59303c67">lbmmon_rctl_attr_t</a> * attr;</div><div class="line"><span class="comment">/* &quot;rcv_statistics_cb&quot; ... &quot;ctx_statistics_cb&quot; are user functions defined elsewhere */</span></div><div class="line"><a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/structlbmmon__rcv__statistics__func__t__stct.html">lbmmon_rcv_statistics_func_t</a> rcvcb = { rcv_statistics_cb };</div><div class="line"><a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/structlbmmon__src__statistics__func__t__stct.html">lbmmon_src_statistics_func_t</a> srccb = { src_statistics_cb };</div><div class="line"><a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/structlbmmon__evq__statistics__func__t__stct.html">lbmmon_evq_statistics_func_t</a> evqcb = { evq_statistics_cb };</div><div class="line"><a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/structlbmmon__ctx__statistics__func__t__stct.html">lbmmon_ctx_statistics_func_t</a> ctxcb = { ctx_statistics_cb };</div><div class="line"></div><div class="line"><span class="keywordflow">if</span> (<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbmmon_8h.html#afe42964b515bf9f78dfcc8f0d1b0f815">lbmmon_rctl_attr_create</a>(&amp;attr) != 0)</div><div class="line">{</div><div class="line">  fprintf(stderr, <span class="stringliteral">&quot;call to lbmmon_rctl_attr_create() failed, %s\n&quot;</span>, <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbmmon_8h.html#aa48237baee1c9804ab4f4cd0c197796b">lbmmon_errmsg</a>());</div><div class="line">  exit(1);</div><div class="line">}</div><div class="line"><span class="keywordflow">if</span> (<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbmmon_8h.html#a6a003fc7cd1e98e1eacc50b79b5d91de">lbmmon_rctl_attr_setopt</a>(attr, LBMMON_RCTL_RECEIVER_CALLBACK, (<span class="keywordtype">void</span> *) &amp;rcvcb, <span class="keyword">sizeof</span>(rcvcb)) != 0)</div><div class="line">{</div><div class="line">  fprintf(stderr, <span class="stringliteral">&quot;call to lbmmon_rctl_attr_setopt() failed, %s\n&quot;</span>, <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbmmon_8h.html#aa48237baee1c9804ab4f4cd0c197796b">lbmmon_errmsg</a>());</div><div class="line">  exit(1);</div><div class="line">}</div><div class="line"><span class="keywordflow">if</span> (<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbmmon_8h.html#a6a003fc7cd1e98e1eacc50b79b5d91de">lbmmon_rctl_attr_setopt</a>(attr, LBMMON_RCTL_SOURCE_CALLBACK, (<span class="keywordtype">void</span> *) &amp;srccb, <span class="keyword">sizeof</span>(srccb)) != 0)</div><div class="line">{</div><div class="line">  fprintf(stderr, <span class="stringliteral">&quot;call to lbmmon_rctl_attr_setopt() failed, %s\n&quot;</span>, <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbmmon_8h.html#aa48237baee1c9804ab4f4cd0c197796b">lbmmon_errmsg</a>());</div><div class="line">  exit(1);</div><div class="line">}</div><div class="line"><span class="keywordflow">if</span> (<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbmmon_8h.html#a6a003fc7cd1e98e1eacc50b79b5d91de">lbmmon_rctl_attr_setopt</a>(attr, LBMMON_RCTL_EVENT_QUEUE_CALLBACK, (<span class="keywordtype">void</span> *) &amp;evqcb, <span class="keyword">sizeof</span>(evqcb)) != 0)</div><div class="line">{</div><div class="line">  fprintf(stderr, <span class="stringliteral">&quot;call to lbmmon_rctl_attr_setopt() failed, %s\n&quot;</span>, <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbmmon_8h.html#aa48237baee1c9804ab4f4cd0c197796b">lbmmon_errmsg</a>());</div><div class="line">  exit(1);</div><div class="line">}</div><div class="line"><span class="keywordflow">if</span> (<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbmmon_8h.html#a6a003fc7cd1e98e1eacc50b79b5d91de">lbmmon_rctl_attr_setopt</a>(attr, LBMMON_RCTL_CONTEXT_CALLBACK, (<span class="keywordtype">void</span> *) &amp;sctxcb, <span class="keyword">sizeof</span>(ctxcb)) != 0)</div><div class="line">{</div><div class="line">  fprintf(stderr, <span class="stringliteral">&quot;call to lbmmon_rctl_attr_setopt() failed, %s\n&quot;</span>, <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbmmon_8h.html#aa48237baee1c9804ab4f4cd0c197796b">lbmmon_errmsg</a>());</div><div class="line">  exit(1);</div><div class="line">}</div><div class="line"><span class="keywordflow">if</span> (<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbmmon_8h.html#a3c327a6086714f1cbdb0b95905457043">lbmmon_rctl_create</a>(&amp;monctl, lbmmon_format_csv_module(), NULL, lbmmon_transport_lbm_module(), (<span class="keywordtype">void</span> *)transport_options, attr) != 0)</div><div class="line">{</div><div class="line">  fprintf(stderr, <span class="stringliteral">&quot;call to lbmmon_rctl_create() failed, %s\n&quot;</span>, <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbmmon_8h.html#aa48237baee1c9804ab4f4cd0c197796b">lbmmon_errmsg</a>());</div><div class="line">  exit(1);</div><div class="line">}</div><div class="line"><span class="keywordflow">if</span> (<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbmmon_8h.html#a339fffd31601c7f362eaa974d1a9aa65">lbmmon_rctl_attr_delete</a>(attr) != 0)</div><div class="line">{</div><div class="line">  fprintf(stderr, <span class="stringliteral">&quot;call to lbmmon_rctl_attr_delete() failed, %s\n&quot;</span>, <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbmmon_8h.html#aa48237baee1c9804ab4f4cd0c197796b">lbmmon_errmsg</a>());</div><div class="line">  exit(1);</div><div class="line">}</div></div><!-- fragment --><p>As in the earlier example, the default CSV format module and default UM transport module are specified via the provided module functions lbmmon_format_csv_module() and lbmmon_transport_lbm_module().</p>
<p>As an example of minimal callback functions, consider the following example:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> rcv_statistics_cb(<span class="keyword">const</span> <span class="keywordtype">void</span> * AttributeBlock, <span class="keyword">const</span> <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/structlbm__rcv__transport__stats__t__stct.html">lbm_rcv_transport_stats_t</a> * Statistics)</div><div class="line">{</div><div class="line">  <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbm_8h.html#a72438fab15bf500af58d2a8a521e470d">lbm_ulong_t</a> source = <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbmmon_8h.html#a1f8af0e7a7c4707cbd0dbe78831317b3">LBMMON_ATTR_SOURCE_NORMAL</a>;</div><div class="line">  <span class="keywordflow">if</span> (<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbmmon_8h.html#a41ccaa93d3dc2ca15af876340ad56071">lbmmon_attr_get_source</a>(AttributeBlock, &amp;source) != 0)</div><div class="line">  {</div><div class="line">    source = <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbmmon_8h.html#a1f8af0e7a7c4707cbd0dbe78831317b3">LBMMON_ATTR_SOURCE_NORMAL</a>;</div><div class="line">  }</div><div class="line">  <span class="keywordflow">switch</span> (Statistics-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/structlbm__rcv__transport__stats__t__stct.html#a3111b4af23afc72ffb71b3794b4a0835">type</a>)</div><div class="line">  {</div><div class="line">  <span class="keywordflow">case</span> <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbm_8h.html#a6da60dbd4d5790ee0df30d6c3048f977">LBM_TRANSPORT_STAT_TCP</a>:</div><div class="line">    handle_rcv_tcp_statistics();</div><div class="line">    <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">  <span class="keywordflow">case</span> <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbm_8h.html#a32e0d3eee1fe69fa87e985f3343830b3">LBM_TRANSPORT_STAT_LBTRM</a>:</div><div class="line">    <span class="keywordflow">switch</span> (source)</div><div class="line">    {</div><div class="line">    <span class="keywordflow">case</span> <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbmmon_8h.html#a9c423fb2c8d4cef4ca3e8d8b38932ac5">LBMMON_ATTR_SOURCE_IM</a>:</div><div class="line">      handle_rcv_im_lbtrm_statistics();</div><div class="line">      <span class="keywordflow">break</span>;</div><div class="line">    <span class="keywordflow">default</span>:</div><div class="line">      handle_rcv_lbtrm_statistics();</div><div class="line">      <span class="keywordflow">break</span>;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">  <span class="keywordflow">case</span> <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbm_8h.html#a1f4acd28e4192be6809ce2cc496cb514">LBM_TRANSPORT_STAT_LBTRU</a>:</div><div class="line">    handle_rcv_lbtru_statistics();</div><div class="line">    <span class="keywordflow">break</span>;</div><div class="line">  }</div><div class="line">}  <span class="comment">/* rcv_statistics_cb */</span></div><div class="line"></div><div class="line"><span class="keywordtype">void</span> src_statistics_cb(<span class="keyword">const</span> <span class="keywordtype">void</span> * AttributeBlock, <span class="keyword">const</span> <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/structlbm__src__transport__stats__t__stct.html">lbm_src_transport_stats_t</a> * Statistics)</div><div class="line">{</div><div class="line">  <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbm_8h.html#a72438fab15bf500af58d2a8a521e470d">lbm_ulong_t</a> source = <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbmmon_8h.html#a1f8af0e7a7c4707cbd0dbe78831317b3">LBMMON_ATTR_SOURCE_NORMAL</a>;</div><div class="line">  <span class="keywordflow">if</span> (<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbmmon_8h.html#a41ccaa93d3dc2ca15af876340ad56071">lbmmon_attr_get_source</a>(AttributeBlock, &amp;source) != 0)</div><div class="line">  {</div><div class="line">    source = <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbmmon_8h.html#a1f8af0e7a7c4707cbd0dbe78831317b3">LBMMON_ATTR_SOURCE_NORMAL</a>;</div><div class="line">  }</div><div class="line">  <span class="keywordflow">switch</span> (Statistics-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/structlbm__src__transport__stats__t__stct.html#a9f9aef06b06d3432b1b7ba10583413ce">type</a>)</div><div class="line">  {</div><div class="line">  <span class="keywordflow">case</span> <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbm_8h.html#a6da60dbd4d5790ee0df30d6c3048f977">LBM_TRANSPORT_STAT_TCP</a>:</div><div class="line">    handle_src_tcp_statistics();</div><div class="line">    <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">  <span class="keywordflow">case</span> <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbm_8h.html#a32e0d3eee1fe69fa87e985f3343830b3">LBM_TRANSPORT_STAT_LBTRM</a>:</div><div class="line">    <span class="keywordflow">switch</span> (source)</div><div class="line">    {</div><div class="line">    <span class="keywordflow">case</span> <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbmmon_8h.html#a9c423fb2c8d4cef4ca3e8d8b38932ac5">LBMMON_ATTR_SOURCE_IM</a>:</div><div class="line">      handle_src_im_lbtrm_statistics();</div><div class="line">      <span class="keywordflow">break</span>;</div><div class="line">    <span class="keywordflow">default</span>:</div><div class="line">      handle_src_lbtrm_statistics();</div><div class="line">      <span class="keywordflow">break</span>;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">  <span class="keywordflow">case</span> <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbm_8h.html#a1f4acd28e4192be6809ce2cc496cb514">LBM_TRANSPORT_STAT_LBTRU</a>:</div><div class="line">    handle_src_lbtru_statistics();</div><div class="line">    <span class="keywordflow">break</span>;</div><div class="line">  }</div><div class="line">}  <span class="comment">/* src_statistics_cb */</span></div><div class="line"></div><div class="line"><span class="keywordtype">void</span> ctx_statistics_cb(<span class="keyword">const</span> <span class="keywordtype">void</span> * AttributeBlock, <span class="keyword">const</span> <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/structlbm__context__stats__t__stct.html">lbm_context_stats_t</a> * Statistics)</div><div class="line">{</div><div class="line">  <span class="comment">/* Handle context stats */</span></div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> evq_statistics_cb(<span class="keyword">const</span> <span class="keywordtype">void</span> * AttributeBlock, <span class="keyword">const</span> <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/structlbm__event__queue__stats__t__stct.html">lbm_event_queue_stats_t</a> * Statistics)</div><div class="line">{</div><div class="line">  <span class="comment">/* Handle event queue stats */</span></div><div class="line">}</div></div><!-- fragment --><p>Upon receipt of a statistics message, the appropriate callback function is called. The application can then do whatever is desired with the statistics data, which might include writing it to a file or database, performing calculations, or whatever is appropriate.</p>
<p>Beyond the actual statistics, several additional pieces of data are sent with each statistics packet. These data are stored in an attribute block, and are accessible via the lbmmon_attr_get_*() functions. Currently, these data include the IPV4 address of machine which sent the statistics data, the timestamp (as a time_t) at which the statistics were generated, and the application ID string supplied by the sending application at the time the object was registered for monitoring. See <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbmmon_8h.html#ab16d9370962d8ca02594907e3c25a43b">lbmmon_attr_get_ipv4sender()</a>, <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbmmon_8h.html#aeece67d10751090afb55d1cd15fcba0a">lbmmon_attr_get_timestamp()</a>, and <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbmmon_8h.html#a8d85d6ca99a27546ff88e09108044756">lbmmon_attr_get_appsourceid()</a> for more information.</p>
<p><br />
 </p>
<h1><a class="anchor" id="monitoringtransportmodules"></a>
Monitoring Transport Modules&nbsp;&nbsp;<small><a href="#monitoringtransportmodules">&lt;-</a></small></h1>
<p>The lbmmon library comes with three pre-written transport modules:</p>
<dl class="section user"><dt><b>LBM</b> </dt><dd>A normal UM topic is used to send/receive statistics.</dd></dl>
<dl class="section user"><dt><b>UDP</b> </dt><dd>Statistics are sent to a simple multicast or unicast UDP port.</dd></dl>
<dl class="section user"><dt><b>SNMP</b> </dt><dd>Identical to LBM but with some configuration parameters pre-set to be compatible with the UM SNMP agent component.</dd></dl>
<p><br />
 </p>
<h2><a class="anchor" id="thelbmtransportmodule"></a>
The LBM Transport Module&nbsp;&nbsp;<small><a href="#thelbmtransportmodule">&lt;-</a></small></h2>
<p>The LBM transport module understands several options which may be used to customize your use of the module. The options are passed via the TransportOptions parameter to the <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbmmon_8h.html#a393a4f0563c7dbda75582053c3a56209">lbmmon_sctl_create()</a> and <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbmmon_8h.html#a3c327a6086714f1cbdb0b95905457043">lbmmon_rctl_create()</a> functions, as a null-terminated string containing semicolon-separated name/value pairs.</p>
<p>The <a href="../example/lbmmon.c">lbmmon.c</a> example program's command-line option "--transport-opts" is used for the TransportOptions string for the LBM transport module.</p>
<p>The following name/value pairs are available:</p>
<ul>
<li>
<b>config=file_name</b> specifies a configuration file. This file is processed in a manner similar to <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbm_8h.html#aecac05969bba0d6057589ca03dfe60a2">lbm_config()</a>. However, unlike <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbm_8h.html#aecac05969bba0d6057589ca03dfe60a2">lbm_config()</a>, the current default attributes are not changed. Instead, the options parsed from the configuration file are applied only to the UM objects created by the module. See <a class="el" href="monitoringumwiththelbmmonapi.html#monitoringcontext">Application Monitoring Context</a> for information about the limitations of configuring the monitoring context. </li>
<li>
<b>topic=topic_name</b> specifies the topic name to use for sending and receiving statistics. By default, the topic <code>/29west/statistics</code> is used. </li>
<li>
<b>wctopic=topic_pattern</b> specifies (for monitor receivers only) a wildcard pattern to be used to receive statistics. </li>
<li>
<b>context|option_name=option_value</b> specifies UM a configuration option for the monitoring context. </li>
<li>
<b>source|option_name=option_value</b> specifies UM a configuration option for the source used to publish monitoring data. </li>
<li>
<b>receiver|option_name=option_value</b> specifies UM a configuration option for the receiver used to subscribe to monitoring data. </li>
<li>
<b>wildcard_receiver|option_name=option_value</b> specifies UM a configuration option for the wildcard receiver used to subscribe to monitoring data. </li>
</ul>
<p>As an example, assume your application needs to use a special configuration file for statistics. The following call allows your application to customize the UM transport module using the configuration file stats.cfg.</p>
<div class="fragment"><div class="line"><a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbmmon_8h.html#a4fbc26b3a219f366dbdbeeb40638a437">lbmmon_sctl_t</a> * monctl;</div><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> * tropt = <span class="stringliteral">&quot;config=stats.cfg&quot;</span>;</div><div class="line"></div><div class="line"><span class="keywordflow">if</span> (<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbmmon_8h.html#a393a4f0563c7dbda75582053c3a56209">lbmmon_sctl_create</a>(&amp;monctl, lbmmon_format_csv_module(), NULL, lbmmon_transport_lbm_module(), tropt) == -1)</div><div class="line">{</div><div class="line">  fprintf(stderr, <span class="stringliteral">&quot;lbmmon_sctl_create() failed\n&quot;</span>);</div><div class="line">  exit(1);</div><div class="line">}</div></div><!-- fragment --><p>If your application also needs to use a specific topic for statistics, the following code specifies that, in addition to the configuration file, the topic StatisticsTopic be used for statistics.</p>
<div class="fragment"><div class="line"><a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbmmon_8h.html#a4fbc26b3a219f366dbdbeeb40638a437">lbmmon_sctl_t</a> * monctl;</div><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> * tropt = <span class="stringliteral">&quot;config=stats.cfg;topic=StatisticsTopic&quot;</span>;</div><div class="line"></div><div class="line"><span class="keywordflow">if</span> (<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbmmon_8h.html#a393a4f0563c7dbda75582053c3a56209">lbmmon_sctl_create</a>(&amp;monctl, lbmmon_format_csv_module(), NULL, lbmmon_transport_lbm_module(),</div><div class="line">tropt) == -1)</div><div class="line">{</div><div class="line">  fprintf(stderr, <span class="stringliteral">&quot;lbmmon_sctl_create() failed\n&quot;</span>);</div><div class="line">  exit(1);</div><div class="line">}</div></div><!-- fragment --><p>It is important to use the same topic and configuration for both monitor sources and receivers. Otherwise your applications may send the statistics, but the monitor receiver won't be able to receive them.</p>
<p>To view the source code for the LBM transport module, see <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbmmontrlbm_c_page.html">Source code for lbmmontrlbm.c</a>.</p>
<p><br />
 </p>
<h2><a class="anchor" id="theudptransportmodule"></a>
The UDP Transport Module&nbsp;&nbsp;<small><a href="#theudptransportmodule">&lt;-</a></small></h2>
<p>The UDP transport module understands several options which may be used to customize your use of the module. The options are passed via the TransportOptions parameter to the <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbmmon_8h.html#a393a4f0563c7dbda75582053c3a56209">lbmmon_sctl_create()</a> and <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbmmon_8h.html#a3c327a6086714f1cbdb0b95905457043">lbmmon_rctl_create()</a> functions, as a null-terminated string containing semicolon-separated name/value pairs.</p>
<p>The <a href="../example/lbmmon.c">lbmmon.c</a> example program's command-line option "--transport-opts" is used for the TransportOptions string for the UDP transport module.</p>
<p>The UDP module supports sending and receiving via UDP unicast, UDP broadcast, and UDP multicast. The following name/value pairs are available:</p>
<ul>
<li>
<b>address=dest_ip</b> specifies the unicast IP address to which statistics are sent via UDP. Applicable to sender only. </li>
<li>
<b>port=port_num</b> is the IP port packets are sent to. Defaults to 2933. </li>
<li>
<b>interface=interface_spec</b> specifies the network interface over which multicast UDP is sent or received. See <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/config.tag:../Config/" href="../Config/generalconfigurationguidelines.html#specifyinginterfaces">Specifying Interfaces</a> for formats. </li>
<li>
<b>mcgroup=ip</b> is the multicast group on which to send and receive UDP packets. </li>
<li>
<b>bcaddress=ip</b> specifies the broadcast address to which UDP packets are sent. Applicable to sender only. </li>
<li>
<b>ttl=val</b> specifies the TTL for each multicast UDP packet. Applicable to sender only. </li>
</ul>
<p>To view the source code for the UDP transport module, see <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbmmontrudp_c_page.html">Source code for lbmmontrudp.c</a>.</p>
<p><br />
 </p>
<h2><a class="anchor" id="thesnmptransportmodule"></a>
The SNMP Transport Module&nbsp;&nbsp;<small><a href="#thesnmptransportmodule">&lt;-</a></small></h2>
<p>The SNMP transport modules operates in identical fashion to <a class="el" href="monitoringumwiththelbmmonapi.html#thelbmtransportmodule">The LBM Transport Module</a>. Some configuration options are hard-coded to be compatible with the UM SNMP Agent component.</p>
<p>To view the source code for the SNMP transport module, see <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbmmontrlbmsnmp_c_page.html">Source code for lbmmontrlbmsnmp.c</a>.</p>
<p><br />
 </p>
<h1><a class="anchor" id="monitoringformatmodules"></a>
Monitoring Format Modules&nbsp;&nbsp;<small><a href="#monitoringformatmodules">&lt;-</a></small></h1>
<p>The lbmmon library comes with one pre-written format module:</p>
<dl class="section user"><dt><b>CSV</b> </dt><dd>Statistics are formatted in textual CSV (Comma-Separated Values) form.</dd></dl>
<p><br />
 </p>
<h2><a class="anchor" id="thecsvformatmodule"></a>
The CSV Format Module&nbsp;&nbsp;<small><a href="#thecsvformatmodule">&lt;-</a></small></h2>
<p>The CSV format module sends the statistics as simple comma-separated values. Options are passed via the FormatOptions parameter to the <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbmmon_8h.html#a393a4f0563c7dbda75582053c3a56209">lbmmon_sctl_create()</a> and <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbmmon_8h.html#a3c327a6086714f1cbdb0b95905457043">lbmmon_rctl_create()</a> functions, as a null-terminated string containing semicolon-separated name/value pairs.</p>
<p>The <a href="../example/lbmmon.c">lbmmon.c</a> example program's command-line option "--format-opts" is used for the FormatOptions string for the CSV format module.</p>
<p>The following name/value pairs are available:</p>
<ul>
<li>
<b>separator=character</b> specifies a single character to be used as field separator. Defaults to comma. </li>
</ul>
<p>To view the source code for the CSV format module, see <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbmmonfmtcsv_c_page.html">Source code for lbmmonfmtcsv.c</a>.</p>
<p><br />
 </p>
<h1><a class="anchor" id="automaticmonitoring"></a>
Automatic Monitoring&nbsp;&nbsp;<small><a href="#automaticmonitoring">&lt;-</a></small></h1>
<p>Instead of building a monitoring capability into your application using the UM Monitoring API, automatic monitoring allows you to easily produce monitoring statistics with the UM Monitoring API by setting a few simple UM configuration options. Automatic monitoring does not require any changes to your application.</p>
<p>You can enable Automatic Monitoring for either or both of the following.</p>
<ul>
<li>
Transport Statistics - Automatic monitoring of transport statistics reflect data for all the transport sessions within the UM context. You cannot, however, receive statistics for an individual transport session. Essentially, you turn on automatic monitoring of a context's transport sessions by configuring <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/config.tag:../Config/" href="../Config/grpautomaticmonitoring.html#monitorintervalcontext">monitor_interval (context)</a>. The use of the Ultra Messaging SNMP Agent requires configuring <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/config.tag:../Config/" href="../Config/grpautomaticmonitoring.html#monitortransportcontext">monitor_transport (context)</a> to <b>lbmsnmp</b>. </li>
<li>
Event Queue Statistics - Automatic Monitoring of Event Queues provides statistics for all the Event Queues within the UM context. You turn on automatic monitoring of a context's Event Queues by configuring <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/config.tag:../Config/" href="../Config/grpautomaticmonitoring.html#monitorintervaleventqueue">monitor_interval (event_queue)</a>. </li>
</ul>
<p>You can also set environment variables to turn on automatic monitoring for all UM contexts (transports and event queues).</p>
<p>See <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/config.tag:../Config/" href="../Config/grpautomaticmonitoring.html">Automatic Monitoring Options</a> for more information.</p>
<p><br />
 </p>
<h1><a class="anchor" id="monitoringexamples"></a>
Monitoring Examples&nbsp;&nbsp;<small><a href="#monitoringexamples">&lt;-</a></small></h1>
<p>This section demonstrates the use of the two UM monitoring example applications described in the <a href="../example/index.html">C examples</a>. We present advice based on what we have seen productively monitored by customers and our own knowledge of transport statistics that might be of interest. Of course, what you choose to monitor depends on your needs so merge these thoughts with your own needs to determine what is best for you.</p>
<p><br />
 </p>
<h2><a class="anchor" id="lbmmonc"></a>
lbmmon.c&nbsp;&nbsp;<small><a href="#lbmmonc">&lt;-</a></small></h2>
<p>The example application <a href="../example/lbmmon.c">lbmmon.c</a> acts as a Monitor Receiver and is provided in both executable and source form. It writes monitoring statistics to the screen and can be used in conjunction with other example applications (which act as the Monitor Sources). The following procedure uses lbmrcv and lbmsrc to create messaging traffic and adds a configuration file in order to specify the LBT-RM transport instead of the TCP default. (The LBT-RM transport displays more statistics than TCP.)</p>
<p>Since UM does not generate monitoring statistics by default, you must activate monitoring in your application. For the example application, use the <code>--monitor-ctx=n</code> option where n is the number of seconds between reports. The following procedure activates monitoring on the receiver, specifying the context (ctx) to create a complete set of receiver statistics. You could activate monitoring in a similar fashion on the source and create source statistics.</p>
<p>To use lbmmon to view statistics from sample application output:</p>
<ol>
<li>
Create configuration file with the single option of source transport lbtrm and name it LBTRM.cfg. </li>
<li>
Run <code>lbmmon --transport-opts="config=LBTRM.cfg"</code> </li>
<li>
Run <code>lbmrcv -c LBTRM.cfg --monitor-ctx="5" Arizona</code> </li>
<li>
Run <code>lbmsrc -c LBTRM.cfg Arizona</code> </li>
</ol>
<p>After lbmsrc completes, the final output for lbmmon should closely resemble the following:</p>
<div class="fragment"><div class="line">...</div><div class="line">Source: LBTRM:10.29.1.78:4391:323382d8:224.10.10.10:4400</div><div class="line">Transport: LBT-RM</div><div class="line">LBT-RM messages received                                 : 45455</div><div class="line">Bytes received                                           : 370000000</div><div class="line">LBT-RM NAK packets sent                                  : 0</div><div class="line">LBT-RM NAKs sent                                         : 0</div><div class="line">Lost LBT-RM messages detected                            : 0</div><div class="line">NCFs received (ignored)                                  : 0</div><div class="line">NCFs received (shed)                                     : 0</div><div class="line">NCFs received (retransmit delay)                         : 0</div><div class="line">NCFs received (unknown)                                  : 0</div><div class="line">Loss recovery minimum time                               : 4294967295ms</div><div class="line">Loss recovery mean time                                  : 0ms</div><div class="line">Loss recovery maximum time                               : 0ms</div><div class="line">Minimum transmissions per individual NAK                 : 4294967295</div><div class="line">Mean transmissions per individual NAK                    : 0</div><div class="line">Maximum transmissions per individual NAK                 : 0</div><div class="line">Duplicate LBT-RM data messages received                  : 0</div><div class="line">LBT-RM messages unrecoverable (window advance)           : 0</div><div class="line">LBT-RM messages unrecoverable (NAK generation expiration): 0</div><div class="line">LBT-RM LBM messages received                             : 10000000</div><div class="line">LBT-RM LBM messages received with no topic               : 0</div><div class="line">LBT-RM LBM requests received                             : 0</div></div><!-- fragment --><p>Notes:</p>
<ul>
<li>
The <code>--transport-opt</code> command-line option is a string passed to the desired transport module. The format of this string depends on the specific transport module selected (defaults to "lbm"). See <a class="el" href="monitoringumwiththelbmmonapi.html#monitoringtransportmodules">Monitoring Transport Modules</a> for details. </li>
<li>
Although not shown above, the <code>--format-opt</code> command-line option is a string passed to the desired format module. The format of this string depends on the specific format module selected (defaults to "csv"). See <a class="el" href="monitoringumwiththelbmmonapi.html#monitoringformatmodules">Monitoring Format Modules</a> for details. </li>
<li>
Since this procedure was done on a single machine. No packets were lost and therefore lbmrcv did not generate any NAKs and lbmsrc did not send any NCFs. If you run this procedure across a network, packets may be lost and you would see statistics for NAKs, NCFs and loss recovery. </li>
<li>
This procedure activates monitoring on the receiver, specifying the context (<code>--monitor-ctx</code>) to create a complete set of receiver transport statistics. You could activate monitoring in a similar fashion on the source and create source statistics. Each set of statistics shows one side of the transmission. For example, source statistics contain information about NAKs received by the source (ignored, shed, retransmit delay, etc.) where receiver statistics contain data about NCFs received. Each view can be helpful. </li>
<li>
Moreover, as explained earlier in Specifying the Object to Monitor, individual receivers or sources can be monitored instead of all transport activity for a context. For this procedure, use <code>--monitor-rcv</code> or <code>--monitor-src</code>. </li>
<li>
You could run this procedure again specifying a different transport (LBT-RU or TCP) in the configuration file and receive a different set of statistics. For descriptions of all the transport statistics, refer to the transport statistics data structures in the C Application Programmer's Interface. Click on the Data Structures tab at the top and click on <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbm_8h.html#a9bdc2628dece44f0675b0bdebfb3d52c">lbm_rcv_transport_stats_t</a> or <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbm_8h.html#a0a0c54fd8e9a7008f1db0126373fca92">lbm_src_transport_stats_t</a>. </li>
</ul>
<p><br />
 </p>
<h2><a class="anchor" id="lbmmonudpcandlbmmondiagpl"></a>
lbmmonudp.c and lbmmondiag.pl&nbsp;&nbsp;<small><a href="#lbmmonudpcandlbmmondiagpl">&lt;-</a></small></h2>
<p>The example application, <a href="../example/lbmmonudp.c">lbmmonudp.c</a> receives UM statistics and forwards them as CSV data over a UDP transport. The Perl script, <a href="../example/lbmmondiag.pl">lbmmondiag.pl</a> can read UDP packets and process the statistics, reporting Severity 1 and Severity 2 events. This script only reports on LBT-RM transports.</p>
<p>To run <b>lbmmonudp.c</b> with <b>lbmmondiag.pl</b>, use the following procedure.</p>
<ol>
<li>
Create configuration file with the single option of source transport lbtrm and name it LBTRM.cfg. </li>
<li>
Run <code>lbmmonudp -a 127.0.0.1 --transport-opts="config=LBTRM.cfg"</code> </li>
<li>
Run <code>lbmrcv -c LBTRM.cfg --monitor-ctx="5" Arizona</code> </li>
<li>
Run <code>lbmsrc -c LBTRM.cfg Arizona</code> </li>
<li>
Run <code>lbmmondiag.pl</code> </li>
</ol>
<p>The following sections discuss some of the possible results of this procedure. Your results will vary depending upon conditions in your network or if you run the procedure on a single machine.</p>
<p><b>Severity 1 - Monitoring Unrecoverable Loss</b></p>
<p>The most severe system problems are often due to unrecoverable datagram loss at the reliable transport level. These are reported as severity 1 events by the lbmmondiag.pl example script. Many of the scalability and latency benefits of UM come from the use of reliable transport protocols like LBT-RM and LBT-RU. These protocols provide loss detection, retransmission, and recovery up to the limits specified by an application. Unrecoverable loss is reported by the transport when loss repair is impossible within the specified limits.</p>
<p>Unrecoverable transport loss often (but not always) leads to unrecoverable message loss so it is very significant to applications that benefit from lossless message delivery.</p>
<p>Unrecoverable loss can be declared by receivers when the <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/config.tag:../Config/" href="../Config/grptransportlbtrmreliability.html#transportlbtrmnakgenerationintervalreceiver">transport_lbtrm_nak_generation_interval (receiver)</a> has ended without receipt of repair. Each such loss event is recorded by incrementing the <b>unrecovered_tmo</b> field in <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbm_8h.html#a9bdc2628dece44f0675b0bdebfb3d52c">lbm_rcv_transport_stats_t</a>. Output from lbmmondiag.pl might look like this:</p>
<div class="fragment"><div class="line">Sev1: 34 datagrams unrecovered due to NAK generation interval ending</div></div><!-- fragment --><p>Unrecoverable loss can also be triggered at receivers by notice from a source that the lost datagram has passed out of the source's transmission window. Each such loss event is recorded by incrementing the <b>unrecovered_txw</b> field in <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbm_8h.html#a9bdc2628dece44f0675b0bdebfb3d52c">lbm_rcv_transport_stats_t</a>. Output from lbmmondiag.pl might look like this:</p>
<div class="fragment"><div class="line">Sev1: 249 datagrams unrecovered due to transmission window advancement</div></div><!-- fragment --><p><b>Severity 2 - Monitoring Rate Controller Activity</b></p>
<p>The data and retransmission rate controllers built into LBT-RM provide for stable operation under all traffic conditions. These rate controllers introduce some latency at the source since that is generally preferable to the alternative of NAK storms or other unstable states. The <b>lbmmondiag.pl</b> example script reports this activity as a severity 2 event since latency is normally the only effect of their operation.</p>
<p>Activity of the rate controller indicates that a source tried to send faster than the configured <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/config.tag:../Config/" href="../Config/grptransportlbtrmoperation.html#transportlbtrmdataratelimitcontext">transport_lbtrm_data_rate_limit (context)</a>. Normally, this limit is set to the speed of the fastest receivers. Sending faster than this rate would induce loss in all receivers so it is generally best to add latency at the source or avoid sending in such situations.</p>
<p>The current number of datagrams queued by the rate controller is given in the <b>rctlr_data_msgs</b> field in <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbm_8h.html#a0a0c54fd8e9a7008f1db0126373fca92">lbm_src_transport_stats_t</a>. No more than 10 datagrams are ever queued. Output from <b>lbmmondiag.pl</b> might look like this:</p>
<div class="fragment"><div class="line">Sev2: 10 datagrams queued by data rate controller</div></div><!-- fragment --><p>Activity of the retransmission rate controller indicates that receivers have requested retransmissions in excess of the configured <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/config.tag:../Config/" href="../Config/grptransportlbtrmoperation.html#transportlbtrmretransmitratelimitcontext">transport_lbtrm_retransmit_rate_limit (context)</a>. Latency is added to retransmission requests in excess of the limit to control the amount of latency they may add to messages being sent the first time. This behavior avoids NAK storms.</p>
<p>The current number of datagrams queued by the retransmission rate controller is given in the <b>rctlr_rx_msgs</b> field in <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbm_8h.html#a0a0c54fd8e9a7008f1db0126373fca92">lbm_src_transport_stats_t</a>. No more than 101 datagrams are ever queued. Output from <b>lbmmondiag.pl</b> might look like this:</p>
<div class="fragment"><div class="line">Sev2: 101 datagrams queued by retransmission rate controller</div></div><!-- fragment --><p><b>Severity 2 - Monitoring Loss Recovery Activity for a Receiver</b></p>
<p>It is important to monitor loss recovery activity because it always adds latency if the loss is successfully repaired. UM defaults generally provide for quite a bit of loss recovery activity before loss would become unrecoverable. Statistics on such activity are maintained at both the source and receiver. Unrecoverable loss will normally be preceded by a burst of such activity.</p>
<p>UM receivers measure the amount of time required to repair each loss detected. For each transport session, an exponentially weighted moving average is computed from repair times and the maximum and minimum times are tracked.</p>
<p>The total number of losses detected appears in the <b>lost</b> field in <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbm_8h.html#a9bdc2628dece44f0675b0bdebfb3d52c">lbm_rcv_transport_stats_t</a>. It may be multiplied by the average repair time given in the <b>nak_stm_mean</b> field in <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbm_8h.html#a9bdc2628dece44f0675b0bdebfb3d52c">lbm_rcv_transport_stats_t</a> to estimate of the amount of latency that was added to repair loss. This is probably the single most important metric to track for those interested in minimizing repair latency. The <b>lbmmondiag.pl</b> script reports this whenever the lost field changes and the average repair time is nonzero. Output might look like this:</p>
<div class="fragment"><div class="line">Sev2: 310 datagrams lost</div><div class="line">Sev2: 112.236 seconds estimated total latency due to repair of 564 losses</div></div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>This estimate only includes latency added in the recovery of lost messages. Requiring ordered delivery also adds latency for all messages that arrive after the time of loss and before the time that repair arrives.</dd></dl>
<p>See the <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/config.tag:../Config/" href="../Config/grpmajoroptions.html#ordereddeliveryreceiver">ordered_delivery (receiver)</a> option to control this.</p>
<p>In addition to counting losses detected, UM reliable receivers also count the number of NAKs generated in the <b>naks_sent</b> field in <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbm_8h.html#a9bdc2628dece44f0675b0bdebfb3d52c">lbm_rcv_transport_stats_t</a>. Output from <b>lbmmondiag.pl</b> might look like this:</p>
<div class="fragment"><div class="line">Sev2: 58 NAKs sent</div></div><!-- fragment --><p>Those who are new to reliable multicast protocols are sometimes surprised to learn that losses detected do not always lead to NAK generation. If a datagram is lost in the network close to the source, it is common for many receivers to detect loss simultaneously when a datagram following the loss arrives. Scalability would suffer if all receivers that detected loss reported it by generating a NAK at the same time. To improve scalability, a random delay is added to NAK generation at each receiver. Since retransmissions are multicast, often only one NAK is generated to repair the loss for all receivers. Thus it is common for the number of losses detected to be much larger than the number of NAKs sent, especially when there are many receivers with similar loss patterns.</p>
<p><b>Severity 2 - Monitoring Loss Recovery Activity for a Source</b></p>
<p>For sources, the principal concern is often understanding how much the retransmission of messages already sent at least once slowed down the source. Obviously, bandwidth and CPU time spent servicing retransmission requests cannot be used to send new messages. This is the way that lossy receivers add latency for lossless receivers.</p>
<p>UM sources track the number of NAKs received in the <b>naks_rcved</b> field in <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbm_8h.html#a0a0c54fd8e9a7008f1db0126373fca92">lbm_src_transport_stats_t</a>. The number of datagrams that they retransmit to repair loss is recorded in the <b>rxs_sent</b> field in <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbm_8h.html#a0a0c54fd8e9a7008f1db0126373fca92">lbm_src_transport_stats_t</a>.</p>
<p>The number of retransmitted datagrams may be multiplied by the average datagram size and divided by the wire speed to estimate the amount of latency added to new messages by retransmission. Output from the example lbmmondiag.pl script might look like this:</p>
<div class="fragment"><div class="line">Sev2: 7478 NAKs received</div><div class="line">Sev2: 50 retransmissions sent</div><div class="line">Sev2: 0.015056 seconds estimated total latency due to retransmissions</div></div><!-- fragment --><p><br />
 </p>
<h1><a class="anchor" id="interpretinglbtrmsourcestatistics"></a>
Interpreting LBT-RM Source Statistics&nbsp;&nbsp;<small><a href="#interpretinglbtrmsourcestatistics">&lt;-</a></small></h1>
<p>LBT-RM sources maintain many statistics that can be useful in diagnosing reliable multicast problems. See the UM API documentation <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/api.tag:../API/" href="../API/lbm_8h.html#ad7cd86fcb1fc5cd16760106b11ba9e07">lbm_src_transport_stats_lbtrm_t</a> Structure Reference for a description of the fields. The remainder of this section gives advice on interpreting the statistics.</p>
<p>Divide <b>naks_rcved</b> by <b>msgs_sent</b> to find the likelihood that sending a message resulted in a NAK being received. Expect no more than a few percent on a network with reasonable loss levels.</p>
<p>Divide <b>rxs_sent</b> by <b>msgs_sent</b> to find the ratio of retransmissions to new data. Many NAKs arriving at a source will cause many retransmissions.</p>
<p>Divide <b>naks_shed</b> by <b>naks_rcved</b> to find the likelihood that excessive NAKs were ignored. Consider reducing loss to avoid NAK generation.</p>
<p>Divide <b>naks_rcved</b> by <b>nak_pckts_rcved</b> to find the likelihood that NAKs arrived individually (~1 -&gt; individual NAKs likely; ~0 -&gt; NAKs likely to have arrived grouped in a single packet). Individual NAKs often indicate sporadic loss while grouped NAKs often indicate burst loss.</p>
<p>Divide <b>naks_rx_delay_ignored</b> by <b>naks_ignored</b> to find the likelihood that NAKs arrived during the ignore interval following a retransmission. The configuration option <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/Operations/config.tag:../Config/" href="../Config/grptransportlbtrmreliability.html#transportlbtrmignoreintervalsource">transport_lbtrm_ignore_interval (source)</a> controls the length of this interval.</p>
<p><br />
<br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
</p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
</body>
</html>
