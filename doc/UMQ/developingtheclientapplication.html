<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Guide to Queuing: Developing the Client Application</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen_manual.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Guide to Queuing
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('developingtheclientapplication.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Developing the Client Application </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>A queuing client application can have a combination of sources and receivers.</p>
<p>To write queuing client applications, use standard Ultra Messaging programming practices. A UMQ queuing context must be able to establish broker connections. If the client application contains non-brokered sources or receivers, these sources or receivers must use a separate, non-brokered context.</p>
<p>Writing UMQ source and receiver applications includes creating brokered contexts, creating sources, creating receivers, and setting attributes by configuration files or other methods.</p>
<p>Coding examples are in C language.</p>
<p><br />
 </p>
<h1><a class="anchor" id="beforeyoustart"></a>
Before You Start&nbsp;&nbsp;<small><a href="#beforeyoustart">&lt;-</a></small></h1>
<p>Before starting to develop client applications, decide on a language, verify that the Ultra Messaging libraries work with your development environment, and determine a general approach for setting configuration options.</p>
<dl class="section user"><dt><b>Decide</b> <b>on</b> <b>the</b> <b>language</b> <b>to</b> <b>write</b> <b>sending</b> <b>and</b> <b>receiving</b> <b>client</b> <b>applications</b>.</dt><dd>You can use C, Java, or for the .NET framework, C#. To use Java or .NET, you must install the optional Java or .NET Ultra Messaging APIs.</dd></dl>
<dl class="section user"><dt><b>Decide</b> <b>how</b> <b>to</b> <b>set</b> <b>configuration</b> <b>options</b>.</dt><dd>For options that are unique to the application and which are not expected to change, you might want to use attribute-setting functions or methods. To be able to select and set option values without recompiling, use configuration files.</dd></dl>
<dl class="section user"><dt><b>Verify</b> <b>that</b> <b>the</b> <b>correct</b> <b>libraries</b> <b>are</b> <b>installed</b> <b>and</b> <b>accessible</b> <b>by</b> <b>the</b> <b>client</b> <b>applications</b>.</dt><dd>You must install the following libraries: </dd></dl>
<dl class="section user"><dt></dt><dd><ul>
<li>
Ultra Messaging C API and included third-party APIs </li>
<li>
For Java or .NET, the appropriate Ultra Messaging Java or .NET API </li>
</ul>
</dd></dl>
<dl class="section user"><dt><b>Decide</b> <b>on</b> <b>locations</b> <b>for</b> <b>Ultra</b> <b>Messaging</b> <b>and</b> <b>broker</b> <b>configuration</b> <b>files</b> </dt><dd>Environment variables or configuration file calls point to these locations.</dd></dl>
<p><br />
 </p>
<h1><a class="anchor" id="createthecontext"></a>
Create the Context&nbsp;&nbsp;<small><a href="#createthecontext">&lt;-</a></small></h1>
<p>A client application that sends or receives messages must have one or more context objects.</p>
<p>When you create a brokered context, set the IP address and port of the broker, and configure the attributes in a context attribute object. After you create the context, you can delete the context attribute object. The following code fragments show context coding concepts.</p>
<p>Create a context attribute object with the current default configuration.</p>
<pre class="fragment">if (lbm_context_attr_create_from_xml(&amp;cattr, "MyCtx") == LBM_FAILURE) {
    fprintf(stderr, "lbm_context_attr_create_from_xml: %s\n", lbm_errmsg());
    exit(1);
}
</pre><p>Set the configuration options that must be unique or permanent for the context. The following example sets configuration option broker to 10.29.3.190:5672.</p>
<pre class="fragment">if (lbm_context_attr_str_setopt(cattr, "broker", "10.29.3.190:5672") == LBM_FAILURE) {
    fprintf(stderr, "lbm_context_attr_str_setopt:broker: %s\n", lbm_errmsg());
    exit(1);
}
</pre><p>Create the context object using the context attribute object.</p>
<pre class="fragment">if (lbm_context_create(&amp;ctx, cattr, NULL, NULL) == LBM_FAILURE) {
    fprintf(stderr, "lbm_context_create: %s\n", lbm_errmsg());
    exit(1);
}
</pre><p>Delete the context attribute object, which is no longer needed.</p>
<pre class="fragment">lbm_context_attr_delete(cattr);
</pre><p><br />
 </p>
<h1><a class="anchor" id="createthesources"></a>
Create the Sources&nbsp;&nbsp;<small><a href="#createthesources">&lt;-</a></small></h1>
<p>A client application that sends messages must have at least one source object.</p>
<p>When you create a source, configure the attributes in a topic attribute object. After you create the source, you can delete the topic attribute object. The following code fragments show source coding concepts.</p>
<p>Create a topic attribute object with the current default configuration. The topic name supplied should be the same as is passed to <a class="elRef" doxygen="/29W/Amun/home/sford/sfordmac_DEV_HF_6_12/29West/lbm/doc/UMQ/api.tag:../API/" href="../API/lbm_8h.html#a1ba60407fa2bde0997aab6d5a5d2da1a">lbm_src_topic_alloc()</a> below.</p>
<pre class="fragment">if (lbm_src_topic_attr_create_from_xml(&amp;tattr, "MyCtx", "QueueName") == LBM_FAILURE) {
    fprintf(stderr, "lbm_src_topic_attr_create_from_xml: %s\n", lbm_errmsg());
    exit(1);
}
</pre><p>Set configuration options that must be unique or permanent for the source. The following example sets configuration option transport to BROKER.</p>
<pre class="fragment">if (lbm_src_topic_attr_str_setopt(tattr, "transport", "BROKER") == LBM_FAILURE) {
    fprintf(stderr, "lbm_src_topic_attr_str_setopt:transport: %s\n", lbm_errmsg());
    exit(1);
}
</pre><p>Create a source topic object using the context and topic attribute object. The topic string becomes the queue name.</p>
<pre class="fragment">if (lbm_src_topic_alloc(&amp;topic, ctx, "QueueName", tattr) == LBM_FAILURE) {
    fprintf(stderr, "lbm_src_topic_alloc: %s\n", lbm_errmsg());
    exit(1);
}
</pre><p>Delete the topic attribute object, or retain it for subsequent source topic allocation.</p>
<pre class="fragment">lbm_src_topic_attr_delete(tattr);
</pre><p>Create the source object using context and source topic object. An example of the function "app_src_callback" is shown below.</p>
<pre class="fragment">if (lbm_src_create(&amp;src, ctx, topic, app_src_callback, NULL, NULL) == LBM_FAILURE) {
    fprintf(stderr, "lbm_src_create: %s\n", lbm_errmsg());
    exit(1);
}
</pre><p>If needed, set the message properties for the message. In this example we set message property Price to a value of 170 and message property Quan to 49.</p>
<pre class="fragment">lbm_src_send_ex_info_t info; int32_t value;
int ret;
...
/* setup */
memset(&amp;info, 0, sizeof(lbm_src_send_ex_info_t));
info.flags = LBM_SRC_SEND_EX_FLAG_PROPERTIES;
lbm_msg_properties_create(&amp;info.properties);

/* set user defined message properties */
value = 170;
ret = lbm_msg_properties_set(info.properties, "Price",
                             (void *) &amp;value,
                             LBM_MSG_PROPERTY_INT, sizeof(int32_t));
assert(ret==LBM_OK);

value = 49;
ret = lbm_msg_properties_set(info.properties, "Quan",
                             (void *) &amp;value, LBM_MSG_PROPERTY_INT,
                             sizeof(int32_t));
assert(ret==LBM_OK);
</pre><p>Send the message and delete the message properties object.</p>
<pre class="fragment">lbm_src_send_ex(src, "HelloWorld", 10, 0, &amp;info);
...
lbm_msg_properties_delete(info.properties);
</pre><p>Verify that the source has registered with the broker. Verify that the sent message is stable at the broker.</p>
<pre class="fragment">int app_src_callback(lbm_src_t *src, int event, void *ed, void *cd) {
    ...
    switch (event) {
        ...
        case LBM_SRC_EVENT_UMQ_REGISTRATION_COMPLETE_EX:
            ... /* handle the registration complete */
            break;
        case LBM_SRC_EVENT_UMQ_MESSAGE_STABLE_EX:
            .... /* handle message stability */
            break;
        }
        ...
    }
    ...
}
</pre><p><br />
 </p>
<h1><a class="anchor" id="createthereceivers"></a>
Create the Receivers&nbsp;&nbsp;<small><a href="#createthereceivers">&lt;-</a></small></h1>
<p>A client application that receives messages must have at least one receiver object.</p>
<p>When you create a receiver, configure the attributes in a topic attribute object. The following code fragments show receiver coding concepts.</p>
<p>Create a receiver topic object using the context object with the current default configuration. The topic string is the queue name.</p>
<pre class="fragment">if (lbm_rcv_topic_lookup(&amp;topic, ctx, "QueueName", NULL) == LBM_FAILURE) {
    fprintf(stderr, "lbm_rcv_topic_lookup: %s\n", lbm_errmsg());
    exit(1);
}
</pre><p>Create the receiver object using the context and topic object.</p>
<pre class="fragment">if (lbm_rcv_create(&amp;rcv, ctx, topic, app_rcv_callback, NULL, NULL) == LBM_FAILURE) {
    fprintf(stderr, "lbm_rcv_create: %s\n", lbm_errmsg());
    exit(1);
}
</pre><p>Ultra Messaging receives a message and then delivers the message to the application. The message might have message properties. After the callback delivers the message and returns, Ultra Messaging automatically tells the broker that the message is consumed.</p>
<pre class="fragment">/* Message callback function provided at Receiver Create */
int app_rcv_callback(lbm_rcv_t *rcv, lbm_msg_t *msg, void *clientd) {
    ...
    switch (msg-&gt;type) {
    case LBM_MSG_DATA:
        if (msg-&gt;properties != NULL) {
            int ret;
            lbm_msg_properties_iter_t *prop_iter=NULL;

            ret = lbm_msg_properties_iter_create(&amp;prop_iter);
            assert(ret==LBM_OK);

            ret = lbm_msg_properties_iter_first(prop_iter, msg-&gt;properties);
            while (ret == LBM_OK) {
                if (strcmp("Price", prop_iter-&gt;name) == 0) {
                    assert(prop_iter-&gt;type==LBM_MSG_PROPERTY_INT);
                    printf("Price is %d\n", (int32_t) *((int32_t *) prop_iter-&gt;data));
                }
                else if (strcmp("Quan", prop_iter-&gt;name) == 0) {
                    assert(prop_iter-&gt;type==LBM_MSG_PROPERTY_INT);
                    printf("Quantity is %d\n", (int32_t) *((int32_t *) prop_iter-&gt;data));
                }
                else {
                    printf("Error: Unknown property name: %s, type: %d",
                           prop_iter-&gt;name, prop_iter-&gt;type);
                }
                ret = lbm_msg_properties_iter_next(prop_iter);
            }
            lbm_msg_properties_iter_delete(prop_iter);
        }
        ... /* implement processing the payload in msg-&gt;data */ }
        break;
    ... /* implement processing for other message types */
    default:
        ... /* implement default handler */
        break;
    }
}
</pre><p><br />
 </p>
<h1><a class="anchor" id="clientconfiguration"></a>
Client Configuration&nbsp;&nbsp;<small><a href="#clientconfiguration">&lt;-</a></small></h1>
<p>Ultra Messaging has multiple ways to set configuration options. Determine which methods are most appropriate for your application.</p>
<p>You can set configuration options programmatically or with configuration files. You can set configuration options in the following ways:</p>
<ul>
<li>
Use a plain text configuration file. You can also assign the file pathname to an environment variable. You can read this file with a function or method. </li>
<li>
Use an XML configuration file for a more flexible approach to setting configuration options. You can point to this file in the same way you use a plain text configuration file. A single XML file can contain options for multiple applications. Moreover, for a single application, you can configure multiple objects such as named contexts and event queues, with different values for the same options. Also, Ultra Messaging Manager (UMM) can manage XML configuration files. </li>
<li>
Set configuration options individually using function or method calls. You can use this technique to override options set from configuration files. </li>
</ul>
<p>For detailed information about setting configuration options, see <a class="elRef" doxygen="/29W/Amun/home/sford/sfordmac_DEV_HF_6_12/29West/lbm/doc/UMQ/config.tag:../Config/" href="../Config/index.html#configurationoverview">Configuration Overview</a>.</p>
<p><br />
 </p>
<h1><a class="anchor" id="sampleapplications"></a>
Sample Applications&nbsp;&nbsp;<small><a href="#sampleapplications">&lt;-</a></small></h1>
<p>The UMQ package includes sample applications for testing and educational purposes.</p>
<ul>
<li>
<p class="startli">umqrcv (source at <a href="../example/umqrcv.c">umqrcv.c</a>)</p>
<p class="endli"></p>
</li>
<li>
umqsrc (source at <a href="../example/umqsrc.c">umqsrc.c</a>) </li>
</ul>
<p>For descriptions and argument information on example applications, as well as source code for all languages, see the <a href="../example/index.html">C Examples</a> source code, <a href="../java_example/index.html">Java Examples</a> source code, or <a href="../dotnet_example/index.html">.NET Examples</a> source code documentation.</p>
<p><br />
 </p>
<h1><a class="anchor" id="developingclientapplicationsforjms"></a>
Developing Client Applications for JMS&nbsp;&nbsp;<small><a href="#developingclientapplicationsforjms">&lt;-</a></small></h1>
<p>You can write messaging applications with the Java Message Service (JMS) API and programming model.</p>
<p>Use the Oracle JMS API to develop or port Java messaging applications written according to the JMS specification. The Oracle JMS Specification 1.1 contains requirements and guidelines for developing JMS- based Java messaging applications.</p>
<p>You can write Ultra Messaging and JMS applications that interoperate through the broker by setting and getting message properties.</p>
<p><br />
 </p>
<h2><a class="anchor" id="messagetypes"></a>
Message Types&nbsp;&nbsp;<small><a href="#messagetypes">&lt;-</a></small></h2>
<p>The JMS message consists of a header and body. You can set a JMS body type in the application and optionally identify the body type in a header field.</p>
<p>The following table shows JMS message types and their Ultra Messaging message property JMS_UM_MessageType numeric values:</p>
<center> <table class="doxtable">
<tr>
<th>JMS Message Type</th><th><code>JMS_UM_MessageType</code> Value </th></tr>
<tr>
<td>TextMessage</td><td>0 </td></tr>
<tr>
<td>BytesMessage</td><td>1 </td></tr>
<tr>
<td>MapMessage</td><td>2* </td></tr>
<tr>
<td>Message</td><td>3 </td></tr>
<tr>
<td>ObjectMessage</td><td>4* </td></tr>
<tr>
<td>StreamMessage</td><td>5* </td></tr>
</table>
</center><ul>
<li>Not supported in Ultra Messaging queuing. Ultra Messaging handles this JMS message type as a BytesMessage.</li>
</ul>
<p><br />
 </p>
<h1><a class="anchor" id="messagecomponents"></a>
Message Components&nbsp;&nbsp;<small><a href="#messagecomponents">&lt;-</a></small></h1>
<p>When a broker delivers a message to an Ultra Messaging receiver, Ultra Messaging maps JMS message properties and header fields to Ultra Messaging message properties. When an Ultra Messaging source application sends a message to a broker, Ultra Messaging maps message properties to JMS message properties and header fields.</p>
<p>JMS header fields, JMS-defined properties, provider-specific properties, and user properties map to message properties in an Ultra Messaging message. JMS message data in the message body maps to data in an Ultra Messaging message.</p>
<p>The following figure shows how a JMS message maps to an Ultra Messaging message:</p>
<div class="image">
<img src="jms_message.png" alt="jms_message.png"/>
</div>
 <p>A JMS message header consists of the following header fields:</p>
<ul>
<li>
JMSDestination </li>
<li>
JMSDeliveryMode </li>
<li>
JMSMessageID </li>
<li>
JMSTimestamp </li>
<li>
JMSCorrelationID </li>
<li>
JMSReplyTo </li>
<li>
JMSRedelivered </li>
<li>
JMSType </li>
<li>
JMSExpiration </li>
<li>
JMSPriority </li>
</ul>
<p><br />
 </p>
<h1><a class="anchor" id="jmsmessageproperties"></a>
JMS Message Properties&nbsp;&nbsp;<small><a href="#jmsmessageproperties">&lt;-</a></small></h1>
<p>Ultra Messaging transports JMS message properties of the following categories:</p>
<p><br />
 </p>
<h2><a class="anchor" id="jmsdefinedproperties"></a>
JMS-defined Properties&nbsp;&nbsp;<small><a href="#jmsdefinedproperties">&lt;-</a></small></h2>
<p>The JMS Specification defines these properties and reserves the use of their names. JMS-defined properties use a "JMSX" prefix.</p>
<p><br />
 </p>
<h2><a class="anchor" id="providerspecificproperties"></a>
Provider-specific Properties&nbsp;&nbsp;<small><a href="#providerspecificproperties">&lt;-</a></small></h2>
<p>Ultra messaging defines and reserves the following provider-specific properties:</p>
<ul>
<li>
JMS_UM_MessageType </li>
<li>
JMS_UM_Regid </li>
<li>
JMS_UM_Stamp </li>
<li>
JMS_UM_SQN </li>
</ul>
<p><br />
 </p>
<h2><a class="anchor" id="userproperties"></a>
User Properties&nbsp;&nbsp;<small><a href="#userproperties">&lt;-</a></small></h2>
<p>Properties that you define for applications. You can use User Properties as Message Selectors. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
</body>
</html>
