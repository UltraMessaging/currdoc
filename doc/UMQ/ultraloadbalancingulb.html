<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Guide to Queuing: Ultra Load Balancing (ULB)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen_manual.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Guide to Queuing
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('ultraloadbalancingulb.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Ultra Load Balancing (ULB) </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Use Ultra Load Balancing (ULB) to evenly distribute a message load to receiving applications without a broker between sending and receiving applications.</p>
<p>A ULB source sends messages on a UM topic. The source also sends receiver assignment control information. This control information identifies which receiver is to process each message. Receivers unicast message consumption reports back to the source.</p>
<p>ULB sources and receivers use standard Ultra Messaging contexts and do not connect to brokers.</p>
<p>For information on ULB configuration options, see <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.14_RC6/doc/UMQ/config.tag:../Config/" href="../Config/grpultramessagingqueuing.html">Ultra Messaging Queuing Options</a>, paying special attention to options with "ulb" in the name.</p>
<dl class="section attention"><dt>Attention</dt><dd>The ULB feature is not compatible with setting <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.14_RC6/doc/UMQ/config.tag:../Config/" href="../Config/grpmajoroptions.html#ordereddeliveryreceiver">ordered_delivery (receiver)</a> to <code>"0"</code> (arrival order without reassembly).</dd></dl>
<p><br />
 </p>
<h1><a class="anchor" id="applicationsetsandreceivertypeids"></a>
Application Sets and Receiver Type IDs&nbsp;&nbsp;<small><a href="#applicationsetsandreceivertypeids">&lt;-</a></small></h1>
<p>You must group ULB receivers into one or more groups called application sets. Within an application set, a ULB source assigns each sent message to only one receiver. If multiple applications sets are defined, then each message is assigned to one receiver <em>in each set</em>. I.e. multiple copies of each message are sent, one for each application set.</p>
<p>The following diagram shows how an ULB source disseminates messages to receivers in application sets:</p>
<div class="image">
<img src="ulb_psd_appsets.png" alt="ulb_psd_appsets.png"/>
</div>
 <p>Subscribing applications create ULB receivers that register with a ULB source. The source adds each receiver to an application set according to a <em>receiver type ID</em> which is supplied by the subscribing application. The source's configuration defines which receivers are added to which application sets using the configuration option <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.14_RC6/doc/UMQ/config.tag:../Config/" href="../Config/grpultramessagingqueuing.html#umqulbapplicationsetsource">umq_ulb_application_set (source)</a>.</p>
<p><b>Application Sets</b> are identified with an integer between 0 and 65535. The sets must be numbered consecutively, starting from 0. In the diagram above, application set "A" would be 0, and "B" would be 1.</p>
<p><b>Receiver Type IDs</b> are arbitrary 32-bit integers selected and managed by the application designer. There is no requirement for these IDs to be consecutively numbered. When a receiver registers with the source, the ID is used by the source to determine various configuration options to be associated with that receiver, such as which application set the receiver belongs in. Here are the configuration options that the source associates with receivers by their type IDs: </p><ul>
<li>
<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.14_RC6/doc/UMQ/config.tag:../Config/" href="../Config/grpultramessagingqueuing.html#umqulbapplicationsetsource">umq_ulb_application_set (source)</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.14_RC6/doc/UMQ/config.tag:../Config/" href="../Config/grpultramessagingqueuing.html#umqulbreceiverportionsource">umq_ulb_receiver_portion (source)</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.14_RC6/doc/UMQ/config.tag:../Config/" href="../Config/grpultramessagingqueuing.html#umqulbreceiverprioritysource">umq_ulb_receiver_priority (source)</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.14_RC6/doc/UMQ/config.tag:../Config/" href="../Config/grpultramessagingqueuing.html#umqulbreceivereventssource">umq_ulb_receiver_events (source)</a> </li>
</ul>
<p>For example, in the diagram above the source might be an order entry system, load balancing orders across a set of three execution engines (application set A), and also load balancing those same orders across a set of two logger processes (application set B). We could define execution engines to be type 10 and the loggers to be type 20. The source would be configured as: </p><pre class="fragment">source umq_ulb_application_set 0:10;1:20
</pre><p> Three execution engines would start up, each setting <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.14_RC6/doc/UMQ/config.tag:../Config/" href="../Config/grpultramessagingqueuing.html#umqreceivertypeidreceiver">umq_receiver_type_id (receiver)</a> to 10. Two logger processes would start up, each setting <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.14_RC6/doc/UMQ/config.tag:../Config/" href="../Config/grpultramessagingqueuing.html#umqreceivertypeidreceiver">umq_receiver_type_id (receiver)</a> to 20. Thus, each order will be sent to two receivers: one of the execution engines and one of the loggers.</p>
<p>A ULB source sends both the message data and the assignment control information on the same transport session to all receivers. The source also sends assignment data so that the assigned receiver in each application set processes the message. The receivers not assigned ignore the message. When the assigned receivers process their messages, they unicast Consumed reports back to the source.</p>
<p><br />
 </p>
<h1><a class="anchor" id="loadbalancing"></a>
Load Balancing&nbsp;&nbsp;<small><a href="#loadbalancing">&lt;-</a></small></h1>
<p>ULB differs from brokered queues regarding assignment uniformity (fairness). Multiple ULB sources to the same topic do not coordinate their assignments with each other. It is possible for multiple ULB sources to all send their next message to the same receiver.</p>
<p>Ultra Load Balancing governs fairness between sources by using the following information:</p>
<ul>
<li>
receiver feedback information </li>
<li>
receiver portion size </li>
<li>
configuration option <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.14_RC6/doc/UMQ/config.tag:../Config/" href="../Config/grpultramessagingqueuing.html#umqulbapplicationsetloadfactorbehaviorsource">umq_ulb_application_set_load_factor_behavior (source)</a> </li>
</ul>
<p><br />
 </p>
<h2><a class="anchor" id="ulbperformance"></a>
ULB Performance&nbsp;&nbsp;<small><a href="#ulbperformance">&lt;-</a></small></h2>
<p>ULB is built on top of standard UM sources and receivers. As such, all receivers receive all messages sent to the topic, even ULB receivers. The normal load-balancing queuing semantics are implemented above the transport, so that only the assigned receiver delivers a particular message to the application; the other un-assigned receivers discard the message.</p>
<p>For multicast-based data transport (LBT-RM), there is no performance penalty to sending each message to all receivers. However, for unicast-based data transports (e.g. LBT-RU, LBT-TCP), the normal source semantic of delivering each message to all receivers represents an inefficiency and limits the maximum sustainable throughput. As receivers are added to a ULB topic, the efficiency continues to drop due to unnecessary sends of messages to unassigned receivers, thus lowering the maximum sustainable throughput further with each added receiver.</p>
<p><b>ULB Source-Side Filtering</b></p>
<p>Starting with UM version 6.12, the Source-Side Filtering feature has been enhanced to support load-balancing queue semantics. Configure the ULB source with the option <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.14_RC6/doc/UMQ/config.tag:../Config/" href="../Config/grpmajoroptions.html#transportsourcesidefilteringbehaviorsource">transport_source_side_filtering_behavior (source)</a> set to <code>"ulb"</code>. This causes the unicast source to send a particular message to <em>only</em> the assigned receiver. This reduces work for both the unicast source and for the un-assigned receivers. As receivers are added, the maximum sustainable throughput does not significantly drop.</p>
<p>To benefit from this feature, receivers <em>must</em> be configured for arrival order delivery by setting <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.14_RC6/doc/UMQ/config.tag:../Config/" href="../Config/grpmajoroptions.html#ordereddeliveryreceiver">ordered_delivery (receiver)</a> to <code>-1</code>. Receivers without that setting will work correctly with the source, but will not benefit from the ULB Source-Side Filtering feature. I.e. receivers configured for ordered delivery value <code>1</code> (the default) will continue to receive all messages sent, and discard the non-assigned messages.</p>
<p>A ULB source must be at UM version 6.12 or beyond to enable ULB Source Side Filtering. That source is fully interoperable with receivers at UM versions before 6.12, but the older receivers will not benefit from the ULB Source-Side Filtering feature. I.e. pre-6.12 receivers will continue to receive all messages sent, and discard the non-assigned messages.</p>
<p><br />
 </p>
<h1><a class="anchor" id="ultraloadbalancingflightsize"></a>
Ultra Load Balancing Flight Size&nbsp;&nbsp;<small><a href="#ultraloadbalancingflightsize">&lt;-</a></small></h1>
<p>Ultra Load Balancing uses a flight size mechanism to limit the number of messages sent but not consumed, and blocks a source or warns when a send exceeds the configured flight size. Set Ultra Load Balancing with configuration option <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.14_RC6/doc/UMQ/config.tag:../Config/" href="../Config/grpultramessagingqueuing.html#umqulbflightsizesource">umq_ulb_flight_size (source)</a>.</p>
<p>You can set configuration option <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.14_RC6/doc/UMQ/config.tag:../Config/" href="../Config/grpultramessagingqueuing.html#umqulbflightsizebehaviorsource">umq_ulb_flight_size_behavior (source)</a> to either of the following behaviors:</p>
<ul>
<li>
Block any sends that would exceed the flight size. </li>
<li>
Continue to allow sends while notifying the sending application. </li>
</ul>
<p>Ultra Load Balancing considers a message in-flight until the source receives the <b>MSG_COMPLETE</b> event, based on a message consumption or a message timeout from all assigned receivers.</p>
<p><br />
 </p>
<h1><a class="anchor" id="indexedultraloadbalancing"></a>
Indexed Ultra Load Balancing&nbsp;&nbsp;<small><a href="#indexedultraloadbalancing">&lt;-</a></small></h1>
<p>Indexed Ultra Load Balancing is a way to group messages and ensure that one receiver processes all messages in the group in the order they are sent. The source uses an index to assign the messages in a group. An index is an application-defined 64-bit unsigned number or free-form string.</p>
<p>If you must process a set of messages in order, it can be more efficient for one receiver to process the messages. You can set the same index in all related messages to ensure that they all go to one receiver.</p>
<p>Send messages with an index using send call <b><a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.14_RC6/doc/UMQ/api.tag:../API/" href="../API/lbm_8h.html#a4d883eaaa22baf81abf21d495f471c8b">lbm_src_sendv_ex()</a></b> that includes a pointer to <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.14_RC6/doc/UMQ/api.tag:../API/" href="../API/lbm_8h.html#af038a0415aaf7dc4285a944bc93e5ea2">lbm_umq_index_info_t</a> in <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.14_RC6/doc/UMQ/api.tag:../API/" href="../API/lbm_8h.html#a21504de56612c7c6e4be655402b47a37">lbm_src_send_ex_info_t</a>.</p>
<p>By default, all receivers are eligible for index assignment. When the source assigns the first message with a particular index to a receiver in each application set, the source assigns subsequent messages with that same index to those same receivers.</p>
<p>Note that because Ultra Load Balancing sources make assignment decisions independently, multiple sources that send on the same index might assign the index to different receivers.</p>
<p><br />
 </p>
<h1><a class="anchor" id="totalmessagelifetimesforultraloadbalancing"></a>
Total Message Lifetimes for Ultra Load Balancing&nbsp;&nbsp;<small><a href="#totalmessagelifetimesforultraloadbalancing">&lt;-</a></small></h1>
<p>You can set a total message lifetime for Ultra Load Balancing applications in different ways.</p>
<p>An Ultra Load Balancing message total lifetime starts when the source sends the message, and ends when the source receives a consumption report or times out. In each case, you set the timeout to a value in milliseconds. If the message times out, the source reclaims the memory.</p>
<p>By default, there is no message lifetime limit. Messages must be consumed.</p>
<p>A timeout can be set with the configuration option <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.14_RC6/doc/UMQ/config.tag:../Config/" href="../Config/grpultramessagingqueuing.html#umqulbapplicationsetmessagelifetimesource">umq_ulb_application_set_message_lifetime (source)</a>.</p>
<p>Also, it is possible to set a timeout on a per-message basis using the <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.14_RC6/doc/UMQ/api.tag:../API/" href="../API/lbm_8h.html#a091b5806bf18d10ebd0d9117e0c70229">lbm_src_send_ex()</a> API. Set <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.14_RC6/doc/UMQ/api.tag:../API/" href="../API/structlbm__src__send__ex__info__t__stct.html#a5335e2eb3550544263d7be7f690837d9">lbm_src_send_ex_info_t_stct::umq_total_lifetime</a> to point at a <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.14_RC6/doc/UMQ/api.tag:../API/" href="../API/lbm_8h.html#ab8b20fc8f822cdc1b8e78960b59d5739">lbm_umq_msg_total_lifetime_info_t</a> structure, and fill in the <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.14_RC6/doc/UMQ/api.tag:../API/" href="../API/structlbm__umq__msg__total__lifetime__info__t__stct.html#a1773d754611aada145ee2077d008a473">lbm_umq_msg_total_lifetime_info_t_stct::umq_msg_total_lifetime</a> field.</p>
<p>If you set a timeout using both the configuration option and the API, the API overrides the configured setting.</p>
<p><br />
<br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
</p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
</body>
</html>
