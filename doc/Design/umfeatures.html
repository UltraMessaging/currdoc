<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Concepts Guide: UM Features</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen_manual.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Concepts Guide
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('umfeatures.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">UM Features </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Except where otherwise indicated, the features described in this section are available in the UMS, UMP, and UMQ products.</p>
<p><br />
 </p>
<h1><a class="anchor" id="transportservicesproviderxsp"></a>
Transport Services Provider (XSP)&nbsp;&nbsp;<small><a href="#transportservicesproviderxsp">&lt;-</a></small></h1>
<p>As of UM version 6.11, a new receive-side object is available to the user: the <a class="el" href="umobjects.html#transportservicesproviderobject">Transport Services Provider Object</a>.</p>
<p>The earlier feature, Multi-Transport Threads (MTT), is removed from UM in favor of XSP.</p>
<p>By default, a UM context combines all network data reception into a single <em>context thread</em>. This thread is responsible for reception and processing of application messages, topic resolution, and immediate message traffic (UIM and MIM). The context thread is also used for processing timers. This single-threaded model conserves CPU core resources, and can simplify application design. However, it can also introduce significant latency outliers (<a class="el" href="umglossary.html#glossaryjitter">jitter</a>) if a time-sensitive user message is waiting behind, say, a topic resolution message, or a timer callback.</p>
<p>Using an XSP object, an application can reassign the processing of a subscribed <a class="el" href="fundamentalconcepts.html#transportsessions">Transport Session</a> to an independent thread. This allows concurrent processing of received messages with topic resolution and timers, and even allows different groups Transport Sessions to be processed concurrently with each other.</p>
<p>By default, when an XSP object is created, UM creates a new thread associated with the XSP. Alternatively, the XSP can be created with <a class="el" href="architecture.html#sequentialmode">Sequential Mode</a>, which gives the responsibility of thread creation to the application. Either way, the XSP uses its independent thread to read data from the sockets associated with one or more subscribed Transport Sessions. That thread then delivers received messages to the application via a normal receive application callback function.</p>
<p>Creation of an XSP does not by itself cause any receiver Transport Sessions to be assigned to it. Central to the use of XSPs is an application-supplied mapping callback function which tells UM which XSP to associate with subscribed Transport Sessions as they are discovered and joined. This callback allows the application to examine the newly-joined Transport Session, if desired. Then the callback returns, informing UM which XSP, if any, to assign the receiver Transport Session to.</p>
<p><br />
 </p>
<h2><a class="anchor" id="xsphandlestransportsessionsnottopics"></a>
XSP Handles Transport Sessions, Not Topics&nbsp;&nbsp;<small><a href="#xsphandlestransportsessionsnottopics">&lt;-</a></small></h2>
<p>Conceptually, an application designer might want to assign the reception and processing of received data to XSPs on a topic basis. This is not always possible. The XSP thread must process received data on a socket basis, and sockets map to <em>Transport Sessions</em>. As mentioned in <a class="el" href="fundamentalconcepts.html#umtransports">UM Transports</a>, a publishing application maps one or more topic-based sources to a Transport Session.</p>
<p>Consider the following example:</p>
<div class="image">
<img src="xsp_1.png" alt="xsp_1.png"/>
</div>
 <p>Publisher A and B are two separate application instances, both of which create a source for topic "X". A subscriber application might create two XSPs and assign one Transport Session to each. In this case, you have two independent threads delivering messages to the subscriber's receiver callback, which may not be what the developer wanted. If the developer wants topic X to be serialized, a single XSP should be created and mapped to both Transport Sessions:</p>
<div class="image">
<img src="xsp_2.png" alt="xsp_2.png"/>
</div>
 <p>Now let's introduce a second topic. The developer might want to create two XSPs so that each topic will be handled by an independent thread. However, this is not possible, given the way that the topics are mapped to Transport Sessions in the following example:</p>
<div class="image">
<img src="xsp_3.png" alt="xsp_3.png"/>
</div>
 <p>In this case, XSP 1 is delivering both topics X and Y from Publisher A, and XSP 2 is delivering topics X and Y from Publisher B. Once again, the receiver callback for topic X will be called by two independent threads, which is not desired.</p>
<p>The only way to achieve independent processing of topics is to design the publishers to map their topics to Transport Sessions carefully. For example:</p>
<div class="image">
<img src="xsp_4.png" alt="xsp_4.png"/>
</div>
 <p><br />
 </p>
<h2><a class="anchor" id="xspthreadingconsiderations"></a>
XSP Threading Considerations&nbsp;&nbsp;<small><a href="#xspthreadingconsiderations">&lt;-</a></small></h2>
<p>When contexts are used single-threaded, the application programmer can assume serialization of event delivery to the application callbacks. This can greatly simplify the design of applications, at the cost of added latency outliers (<a class="el" href="umglossary.html#glossaryjitter">jitter</a>).</p>
<p>When XSPs are used to provide multi-threaded receivers, care must be taken in application design to account for potential concurrent calls to application callbacks. This is especially true if multiple subscribed Transport Sessions are assigned different XSPs, as demonstrated in <a class="el" href="umfeatures.html#xsphandlestransportsessionsnottopics">XSP Handles Transport Sessions, Not Topics</a>.</p>
<p>Even in the most simple case, where a single XSP is created and used for all subscribed Transport Sessions, there are still events generated by the main context thread which can be called concurrently with XSP callbacks. Reception of MIM or UIM messages, scheduled timers, and some topic resolution-related callbacks all come from the main context thread, and can all be invoked concurrently with XSP callbacks.</p>
<dl class="section warning"><dt>Warning</dt><dd>Remember that MIM and UIM messages can be sent to a topic. If you have regular sources for a topic assigned to an XSP, and somebody sends MIM or UIM messages to the same topic, your receiver callback function can be called concurrently by both the XSP and the main context. Informatica recommends having a given topic sent to by only one type of sender (UIM, MIM, Source).</dd></dl>
<p><b>Threading Example: Message Timeout</b></p>
<p>Consider as an example a common timer use case: message timeout. Application A expects to receive messages for topic "X" every 5 seconds. If 10 seconds pass without a message, the application assumes that the publisher for "X" has exited, so it cleans up internal state and deletes the UM receiver object. Each time a message is received, the current timer is cancelled and re-created for 10 seconds.</p>
<p>Without XSPs, this can be easily coded since message reception and timer expiration events are serialized. The timer callback can clean up and delete the receiver, confident that no receiver events might get delivered while this is in progress.</p>
<p>However, if the Transport Session carrying topic "X" is assigned to an independent XSP thread, message reception and timer expiration events are no longer serialized. Publisher of "X" might send it's message on-time, but a temporary network outage could delay its delivery, introducing a race condition between message delivery and timer expiration. Consider the case where the timer expiration is a little ahead of the message callback. The timer callback might clean up application state which the message callback will attempt to use. This could lead to unexpected behavior, possibly including segmentation faults.</p>
<p>In this case, proper sequencing of operations is critical. The timer should delete the receiver first. While inside the receiver delete API, the XSP might deliver messages to the application. However, once the receiver delete API returns, it is guaranteed that the XSP is finished making receiver callbacks.</p>
<p>Note that in this example case, if the message receiver callback attempts to cancel the timer, the cancel API will return an error. This is because the timer has already expired and the execution of the callback has begun, and is inside the receiver delete API. The message receiver callback needs to be able to handle this sequence, presumably by not re-scheduling the timer.</p>
<p><br />
 </p>
<h2><a class="anchor" id="xspusage"></a>
XSP Usage&nbsp;&nbsp;<small><a href="#xspusage">&lt;-</a></small></h2>
<p>This section provides simplified C code fragments that demonstrate some of the XSP-related API calls. For full examples of XSP usage, see <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/example.tag:../example/" href="../example/index.html#examplelbmrcvxsp_c">Example lbmrcvxsp.c</a> (for C) and <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/java_example.tag:../java_example/" href="../java_example/index.html#examplelbmrcvxsp_java">Example lbmrcvxsp.java</a> (for Java).</p>
<dl class="section note"><dt>Note</dt><dd>Each XSP thread has its own Unicast Listener (request) port. You may need to expand the range <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grpunicastimmediatemessagingnetwork.html#requesttcpportlowcontext">request_tcp_port_low (context)</a> - <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grpunicastimmediatemessagingnetwork.html#requesttcpporthighcontext">request_tcp_port_high (context)</a>.</dd></dl>
<p>The common sequence of operations during application initialization is minimally shown below. In the code fragments below, error detection and handling are omitted for clarity.</p>
<ol>
<li>
<p class="startli">Create a context attribute object and set the <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grpmajoroptions.html#transportmappingfunctioncontext">transport_mapping_function (context)</a> option to point at the application's XSP mapping callback function using the structure <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a90dde1ea00f12038cff7195c76d47a46">lbm_transport_mapping_func_t</a>.</p>
<div class="fragment"><div class="line"><a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#acf249ec7a22d6a0eb9fc42d6375bda5a">lbm_context_attr_t</a> *ctx_attr;</div><div class="line">err = <a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a04d99cc97d32f359888c5befcc50512e">lbm_context_attr_create_from_xml</a>(&amp;ctx_attr, <span class="stringliteral">&quot;MyCtx&quot;</span>);</div><div class="line"></div><div class="line"><a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/structlbm__transport__mapping__func__t__stct.html">lbm_transport_mapping_func_t</a> mapping_func;</div><div class="line">mapping_func.<a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/structlbm__transport__mapping__func__t__stct.html#a7b570d25543dd4e60be8b7f5107e6ad6">mapping_func</a> = app_xsp_mapper_callback;</div><div class="line">mapping_func.<a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/structlbm__transport__mapping__func__t__stct.html#a0f67d0ef3770dc1414c7ccbb72752f61">clientd</a> = NULL;             <span class="comment">/* Can include app state pointer. */</span></div><div class="line"></div><div class="line">err = <a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#ab67f641d5a0ad1a9fe53d415da58d961">lbm_context_attr_setopt</a>(ctx_attr, <span class="stringliteral">&quot;transport_mapping_function&quot;</span>,</div><div class="line">        &amp;mapping_func, <span class="keyword">sizeof</span>(mapping_func));</div></div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">Create the context.</p>
<div class="fragment"><div class="line">err = <a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a8058947690bd0995bc2c59d4a61b462f">lbm_context_create</a>(&amp;ctx, ctx_attr, NULL, NULL);</div><div class="line">err = <a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a9c0a3c1f4a8854d8ec5585392c817c85">lbm_context_attr_delete</a>(ctx_attr);  <span class="comment">/* No longer needed. */</span></div></div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">Create XSPs using <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#ae38035c6036a84f07f9ba7cee1747dbf">lbm_xsp_create()</a>. In this example, only a single XSP is created.</p>
<div class="fragment"><div class="line"><a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a300cf24a22429649a1477358ca65bf78">lbm_xsp_t</a> *xsp;  <span class="comment">/* app_xsp_mapper_callback() needs this; see below. */</span></div><div class="line">err = <a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#ae38035c6036a84f07f9ba7cee1747dbf">lbm_xsp_create</a>(&amp;xsp, ctx, NULL, NULL);</div></div><!-- fragment --><p>Note that the application can optionally pass in a context attribute object and an XSP attribute object. The context attribute is because XSP is implemented as a sort of reduced-function sub-context, and so it is possible to modify context options for the XSP. However, this is rarely needed since the default action is for the XSP to inherit all the configuration of the main context.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">Create a receiver for topic "X".</p>
<div class="fragment"><div class="line"><a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a3f0c8cba0e6f00fe7ae0ed717405e46d">lbm_topic_t</a> *topic;</div><div class="line">err = <a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a3de8a6a659896f76475c453683db4e18">lbm_rcv_topic_lookup</a>(&amp;topic, ctx, <span class="stringliteral">&quot;X&quot;</span>, NULL);</div><div class="line"></div><div class="line"><a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a0a4af6b8247cc5a0a24a8578fb6e83bd">lbm_rcv_t</a> *rcv;</div><div class="line">err = <a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#aa7491c50fefbc2b70f8035fce7ac1477">lbm_rcv_create</a>(&amp;rcv, ctx, topic, app_rcv_callback, NULL, NULL);</div></div><!-- fragment --><p><a class="el" href="umobjects.html#eventqueueobject">Event queues</a> may also be used with XSP-assigned Transport Sessions.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">At this point, when the main context discovers a source for topic "X", it will proceed to join the Transport Session. It will call the application's app_xsp_mapper_callback() function, which is minimally this:</p>
<div class="fragment"><div class="line"><a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a300cf24a22429649a1477358ca65bf78">lbm_xsp_t</a> *app_xsp_mapper_callback(<a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a9f6ec97839a8f264eb4059de01174f3c">lbm_context_t</a> *ctx,</div><div class="line">        <a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/structlbm__new__transport__info__t__stct.html">lbm_new_transport_info_t</a> *transp_info, <span class="keywordtype">void</span> *clientd)</div><div class="line">{</div><div class="line">  <span class="comment">/* Retrieve the XSP object created in step 3. */</span></div><div class="line">  <span class="keywordflow">return</span> xsp;</div><div class="line">}</div></div><!-- fragment --><p>This minimal callback simply returns the XSP that was created during initialization (the "clientd" can be helpful for that). By assigning all receiver Transport Sessions to the same XSP, you have effectively separated message processing from UM housekeeping tasks, like processing of topic resolution and timers. This can greatly reduce latency outliers (<a class="el" href="umglossary.html#glossaryjitter">jitter</a>).</p>
<p class="endli">As described in <a class="el" href="umfeatures.html#xsphandlestransportsessionsnottopics">XSP Handles Transport Sessions, Not Topics</a>, some users want to have multiple XSPs and assign the Transport Sessions to XSPs according to application logic. Note that the passed-in <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#ac611697e7263b4b5ea5a3b35eb26dc99">lbm_new_transport_info_t</a> structure contains information about the Transport Session, such as the IP address of the sender. However, this structure does not contain topic information. Applications can use the resolver's source notification callback via the <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grpmajoroptions.html#resolversourcenotificationfunctioncontext">resolver_source_notification_function (context)</a> option to associate topics with source strings. </p>
</li>
</ol>
<dl class="section note"><dt>Note</dt><dd>Most of the time, the application mapping callback will be invoked each time a Transport Session is joined. However, there is one exception to this rule. If a context is already joined to a Transport Session carried on a multicast group and destination port, joining another Transport Session on the same multicast group and destination port does not invoke the mapping callback again. This is because the same socket is used for all Transport Sessions that use the same group:port.</dd></dl>
<p><br />
 </p>
<h2><a class="anchor" id="otherxspoperations"></a>
Other XSP Operations&nbsp;&nbsp;<small><a href="#otherxspoperations">&lt;-</a></small></h2>
<p>As of UM 6.12, XSP supports persistent receivers.</p>
<p>When an XSP object is created, an XSP attribute object can be supplied to set XSP options. The XSP options are: </p><ul>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grpmajoroptions.html#operationalmodexsp">operational_mode (xsp)</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grpmajoroptions.html#zerotransportsfunctionxsp">zero_transports_function (xsp)</a> </li>
</ul>
<p>To create and manipulate an XSP attribute object, see: </p><ul>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#ae52cbac6a22b495a3b48a70bf23fc118">lbm_xsp_attr_setopt()</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a62363973a939a8555eac38846492dbb2">lbm_xsp_attr_getopt()</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#adfc416faf8fbc79cfd16a1485341f469">lbm_xsp_attr_delete()</a> </li>
</ul>
<p>To delete an XSP, all receivers associated with Transport Sessions handled by that XSP must first be deleted. Then the XSP can be deleted using <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#ac61812a1c86eb9d240054f9d3ba32ac5">lbm_xsp_delete()</a>.</p>
<p>To register and cancel an application file descriptor with an XSP, see: </p><ul>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#ae289a20cdc857feeda3eaba9f286b946">lbm_xsp_register_fd()</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#aa8d3582b9bb8126a34924063ed00b8c4">lbm_xsp_cancel_fd()</a> </li>
</ul>
<p><br />
 </p>
<h2><a class="anchor" id="xsplimitations"></a>
XSP Limitations&nbsp;&nbsp;<small><a href="#xsplimitations">&lt;-</a></small></h2>
<p>There are some restrictions and limitations on the XSP feature.</p>
<ul>
<li>
<p class="startli">The only transport types currently supported are LBT-RM, LBT-RU, and TCP. The XSP feature is not compatible with transport types IPC, SMX, or DBL.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">An application receiver callback must not create a new XSP.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">For a persistent receiver assigned to an XSP, <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grpultramessagingpersistence.html#umeproactivekeepaliveintervalcontext">ume_proactive_keepalive_interval (context)</a> must be enabled.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">XSP is not currently compatible with <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/umq.tag:../UMQ/" href="../UMQ/ultraloadbalancingulb.html">Ultra Load Balancing (ULB)</a>.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">XSP is not currently compatible with <a class="el" href="umfeatures.html#hotfailoverhf">Hot Failover (HF)</a>.</p>
<p class="endli"></p>
</li>
<li>
XSP is not currently compatible with <a class="el" href="advancedoptimizations.html#receivesidebatching">Receive-Side Batching</a>. </li>
</ul>
<p><br />
 </p>
<h1><a class="anchor" id="usinglatejoin"></a>
Using Late Join&nbsp;&nbsp;<small><a href="#usinglatejoin">&lt;-</a></small></h1>
<p>This section introduces the use of Ultra Messaging Late Join in default and specialized configurations. See <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grplatejoin.html">Late Join Options</a> for more information.</p>
<dl class="section note"><dt>Note</dt><dd>If your application is running within a Ultra Messaging context with configuration option <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grpunicastimmediatemessagingnetwork.html#requesttcpbindrequestportcontext">request_tcp_bind_request_port (context)</a> set to zero, then UIM port binding has been turned off, which also disables the Late Join feature.</dd>
<dd>
With the UMQ product, you cannot use Late Join with Queuing (both Brokered and ULB).</dd></dl>
<p>The Late Join feature enables newly created receivers to receive previously transmitted messages. Sources configured for Late Join maintain a retention buffer (not to be confused with a transport retransmission window), which holds transmitted messages for late-joining receivers.</p>
<p>A Late Join operation follows the following sequence:</p>
<ol>
<li>
A new receiver configured for Late Join with <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grplatejoin.html#uselatejoinreceiver">use_late_join (receiver)</a> completes topic resolution. Topic advertisements from the source contain a flag that indicates the source is configured for Late Join with <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grplatejoin.html#latejoinsource">late_join (source)</a>. </li>
<li>
The new receiver sends a Late Join Information Request (LJIR) to request a previously transmitted messages. The receiver configuration option, <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grplatejoin.html#retransmitrequestoutstandingmaximumreceiver">retransmit_request_outstanding_maximum (receiver)</a>, determines the number of messages the receiver requests. </li>
<li>
The source responds with a Late Join Information (LJI) message containing the sequence numbers for the retained messages that are available for retransmission. </li>
<li>
The source unicasts the messages. </li>
<li>
When <a class="el" href="umfeatures.html#configuringlatejoinforlargenumbersofmessages">Configuring Late Join for Large Numbers of Messages</a>, the receiver issues additional requests, and the source retransmits these additional groups of older messages, oldest first. </li>
</ol>
<div class="image">
<img src="LateJoin.png" alt="LateJoin.png"/>
</div>
 <p>The source's retention buffer's is not pre-allocated and occupies an increasing amount of memory as the source sends messages and adds them to the buffer. If a retention buffer grows to a size equal to the value of the source configuration option, <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grplatejoin.html#retransmitretentionsizethresholdsource">retransmit_retention_size_threshold (source)</a>, the source deletes older messages as it adds new ones. The source configuration option <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grplatejoin.html#retransmitretentionagethresholdsource">retransmit_retention_age_threshold (source)</a>, controls message deletion based on message age.</p>
<p>UM uses control-structure overhead memory on a per-message basis for messages held in the retention buffer, in addition to the retention buffer's memory. Such memory usage can become significantly higher when retained messages are smaller in size, since more of them can then fit in the retention buffer.</p>
<dl class="section note"><dt>Note</dt><dd>If you set the receiver configuration option <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grpmajoroptions.html#ordereddeliveryreceiver">ordered_delivery (receiver)</a> to 1, the receiver must deliver messages to your application in sequence number order. The receiver holds out-of-order messages in an ordered list cache until messages arrive to fill the sequence number gaps. If an out-of-order message arrives with a sequence number that creates a message gap greater than the value of <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grplatejoin.html#retransmitmessagecachingproximityreceiver">retransmit_message_caching_proximity (receiver)</a>, the receiver creates a burst loss event and terminates the Late Join recovery operation. You can increase the value of the proximity option and restart the receiver, but a burst loss is a significant event and you should investigate your network and message system components for failures.</dd></dl>
<p><br />
 </p>
<h2><a class="anchor" id="latejoinwithump"></a>
Late Join With Persistence&nbsp;&nbsp;<small><a href="#latejoinwithump">&lt;-</a></small></h2>
<p>With the UMP/UMQ products, late Join can be implemented in conjunction with the persistent Store, however in this configuration, it functions somewhat differently from Streaming. After a late-Join-enabled receiver has been created, resolved a topic, and become registered with a Store, it may then request older messages. The Store unicasts the retransmission messages. If the Store does not have these messages, it requests them of the source (assuming option retransmission-request-forwarding is enabled), thus initiating Late Join.</p>
<p><br />
 </p>
<h2><a class="anchor" id="latejoinoptionssummary"></a>
Late Join Options Summary&nbsp;&nbsp;<small><a href="#latejoinoptionssummary">&lt;-</a></small></h2>
<ul>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grplatejoin.html#latejoinsource">late_join (source)</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grplatejoin.html#retransmitretentionagethresholdsource">retransmit_retention_age_threshold (source)</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grplatejoin.html#retransmitretentionsizelimitsource">retransmit_retention_size_limit (source)</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grplatejoin.html#retransmitretentionsizethresholdsource">retransmit_retention_size_threshold (source)</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grplatejoin.html#uselatejoinreceiver">use_late_join (receiver)</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grplatejoin.html#retransmitinitialsequencenumberrequestreceiver">retransmit_initial_sequence_number_request (receiver)</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grplatejoin.html#retransmitmessagecachingproximityreceiver">retransmit_message_caching_proximity (receiver)</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grplatejoin.html#retransmitrequestmessagetimeoutreceiver">retransmit_request_message_timeout (receiver)</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grplatejoin.html#retransmitrequestintervalreceiver">retransmit_request_interval (receiver)</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grplatejoin.html#retransmitrequestmaximumreceiver">retransmit_request_maximum (receiver)</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grplatejoin.html#retransmitrequestoutstandingmaximumreceiver">retransmit_request_outstanding_maximum (receiver)</a> </li>
</ul>
<p><br />
 </p>
<h2><a class="anchor" id="usingdefaultlatejoinoptions"></a>
Using Default Late Join Options&nbsp;&nbsp;<small><a href="#usingdefaultlatejoinoptions">&lt;-</a></small></h2>
<p>To implement Late Join with default options, set the Late Join configuration options to activate the feature on both a source and receiver in the following manner.</p>
<ol>
<li>
<p class="startli">Create a configuration file with source and receiver Late Join activation options set to 1. For example, file cfg1.cfg containing the two lines:</p>
<pre class="fragment">source late_join 1
receiver use_late_join 1
</pre><p class="endli"></p>
</li>
<li>
<p class="startli">Run an application that starts a Late-Join-enabled source. For example:</p>
<pre class="fragment">lbmsrc -c cfg1.cfg -P 1000 topicName
</pre><p class="endli"></p>
</li>
<li>
<p class="startli">Wait a few seconds, then run an application that starts a Late-Join-enabled receiver. For example:</p>
<pre class="fragment">lbmrcv -c cfg1.cfg -v topicName
</pre> </li>
</ol>
<p>The output for each should closely resemble the following:</p>
<p><b>LBMSRC</b></p>
<pre class="fragment">$ lbmsrc -c cfg1.cfg -P 1000 topicName
LOG Level 5: NOTICE: Source "topicName" has no retention settings (1 message retained max)
Sending 10000000 messages of size 25 bytes to topic [topicName]
Receiver connect [TCP:10.29.3.77:34200]
</pre><p><b>LBMRCV</b></p>
<pre class="fragment">$ lbmrcv -c cfg1.cfg -v topicName
Immediate messaging target: TCP:10.29.3.77:4391
[topicName][TCP:10.29.3.76:4371][2]-RX-, 25 bytes
1.001 secs. 0.0009988 Kmsgs/sec. 0.1998 Kbps
[topicName][TCP:10.29.3.76:4371][3], 25 bytes
1.002 secs. 0.0009982 Kmsgs/sec. 0.1996 Kbps
[topicName][TCP:10.29.3.76:4371][4], 25 bytes
1.003 secs. 0.0009972 Kmsgs/sec. 0.1994 Kbps
[topicName][TCP:10.29.3.76:4371][5], 25 bytes
1.003 secs. 0.0009972 Kmsgs/sec. 0.1994 Kbps
...
</pre><p>Note that the source only retained 1 Late Join message (due to default retention settings) and that this message appears as a retransmit (-RX-). Also note that it is possible to sometimes receive 2 RX messages in this scenario (see <a class="el" href="umfeatures.html#retransmittingonlyrecentmessages">Retransmitting Only Recent Messages</a>.)</p>
<p><br />
 </p>
<h2><a class="anchor" id="specifyingarangeofmessagestoretransmit"></a>
Specifying a Range of Messages to Retransmit&nbsp;&nbsp;<small><a href="#specifyingarangeofmessagestoretransmit">&lt;-</a></small></h2>
<p>To receive more than one or two Late Join messages, increase the source's <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grplatejoin.html#retransmitretentionsizethresholdsource">retransmit_retention_size_threshold (source)</a> from its default value of 0. Once the buffer exceeds this threshold, the source allows the next new message entering the retention buffer to bump out the oldest one. Note that this threshold's units are bytes (which includes a small overhead per message).</p>
<p>While the retention threshold endeavors to keep the buffer size close to its value, it does not set hard upper limit for retention buffer size. For this, the <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grplatejoin.html#retransmitretentionsizelimitsource">retransmit_retention_size_limit (source)</a> configuration option (also in bytes) sets this boundary.</p>
<p>Follow the steps below to demonstrate how a source can retain about 50MB of messages, but no more than 60MB:</p>
<ol>
<li>
<p class="startli">Create a second configuration file (cfg2.cfg) with the following options:</p>
<pre class="fragment">source late_join 1
source retransmit_retention_size_threshold 50000000
source retransmit_retention_size_limit 60000000
receiver use_late_join 1
</pre> </li>
<li>
Run lbmsrc -c cfg2.cfg -P 1000 topicName. </li>
<li>
Wait a few seconds and run <code>lbmrcv -c cfg2.cfg -v topicName</code>. The output for each should closely resemble the following: </li>
</ol>
<p><b>LBMSRC</b></p>
<pre class="fragment">$ lbmsrc -c cfg2.cfg -P 1000 topicName
Sending 10000000 messages of size 25 bytes to topic [topicName]
Receiver connect [TCP:10.29.3.76:34444]
</pre><p><b>LBMRCV</b></p>
<pre class="fragment">$ lbmrcv -c cfg2.cfg -v topicName
Immediate messaging target: TCP:10.29.3.76:4391
[topicName][TCP:10.29.3.77:4371][0]-RX-, 25 bytes
[topicName][TCP:10.29.3.77:4371][1]-RX-, 25 bytes
[topicName][TCP:10.29.3.77:4371][2]-RX-, 25 bytes
[topicName][TCP:10.29.3.77:4371][3]-RX-, 25 bytes
[topicName][TCP:10.29.3.77:4371][4]-RX-, 25 bytes
1.002 secs. 0.004991 Kmsgs/sec. 0.9981 Kbps
[topicName][TCP:10.29.3.77:4371][5], 25 bytes
1.002 secs. 0.0009984 Kmsgs/sec. 0.1997 Kbps
[topicName][TCP:10.29.3.77:4371][6], 25 bytes
1.002 secs. 0.0009983 Kmsgs/sec. 0.1997 Kbps
[topicName][TCP:10.29.3.77:4371][7], 25 bytes
...
</pre><p>Note that lbmrcv received live messages with sequence numbers 7, 6, and 5, and RX messages going from 4 all the way back to Sequence Number 0.</p>
<p><br />
 </p>
<h2><a class="anchor" id="retransmittingonlyrecentmessages"></a>
Retransmitting Only Recent Messages&nbsp;&nbsp;<small><a href="#retransmittingonlyrecentmessages">&lt;-</a></small></h2>
<p>Thus far we have worked with only source late join settings, but suppose that you want to receive only the last 10 messages. To do this, configure the receiver option <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grplatejoin.html#retransmitrequestmaximumreceiver">retransmit_request_maximum (receiver)</a> to set how many messages to request backwards from the latest message.</p>
<p>Follow the steps below to set this option to 10.</p>
<ol>
<li>
<p class="startli">Add the following line to cfg2.cfg and rename it cfg3.cfg:</p>
<pre class="fragment">receiver retransmitrequestmaximumreceiver 10
</pre><p class="endli"></p>
</li>
<li>
<p class="startli">Run:</p>
<pre class="fragment">lbmsrc -c cfg3.cfg -P 1000 topicName
</pre><p class="endli"></p>
</li>
<li>
Wait a few seconds and run <code>lbmrcv -c cfg3.cfg -v topicName</code>. The output for each should closely resemble the following. </li>
</ol>
<p><b>LBMSRC</b></p>
<pre class="fragment">$ lbmsrc -c cfg3.cfg -P 1000 topicName
Sending 10000000 messages of size 25 bytes to topic [topicName]
Receiver connect [TCP:10.29.3.76:34448]
</pre><p><b>LBMRCV</b></p>
<pre class="fragment">$ lbmrcv -c cfg3.cfg -v topicName
Immediate messaging target: TCP:10.29.3.76:4391
[topicName][TCP:10.29.3.77:4371][13]-RX-, 25 bytes
[topicName][TCP:10.29.3.77:4371][14]-RX-, 25 bytes
[topicName][TCP:10.29.3.77:4371][15]-RX-, 25 bytes
[topicName][TCP:10.29.3.77:4371][16]-RX-, 25 bytes
[topicName][TCP:10.29.3.77:4371][17]-RX-, 25 bytes
[topicName][TCP:10.29.3.77:4371][18]-RX-, 25 bytes
[topicName][TCP:10.29.3.77:4371][19]-RX-, 25 bytes
[topicName][TCP:10.29.3.77:4371][20]-RX-, 25 bytes
[topicName][TCP:10.29.3.77:4371][21]-RX-, 25 bytes
[topicName][TCP:10.29.3.77:4371][22]-RX-, 25 bytes
[topicName][TCP:10.29.3.77:4371][23]-RX-, 25 bytes
1.002 secs. 0.01097 Kmsgs/sec. 2.195 Kbps
[topicName][TCP:10.29.3.77:4371][24], 25 bytes
1.002 secs. 0.0009984 Kmsgs/sec. 0.1997 Kbps
[topicName][TCP:10.29.3.77:4371][25], 25 bytes
1.002 secs. 0.0009984 Kmsgs/sec. 0.1997 Kbps
[topicName][TCP:10.29.3.77:4371][26], 25 bytes
...
</pre><p>Note that 11, not 10, retransmits were actually received. This can happen because network and timing circumstances may have one RX already in transit while the specific RX amount is being processed. (Hence, it is not possible to guarantee one and only one RX message for every possible Late Join recovery.)</p>
<p><br />
 </p>
<h2><a class="anchor" id="configuringlatejoinforlargenumbersofmessages"></a>
Configuring Late Join for Large Numbers of Messages&nbsp;&nbsp;<small><a href="#configuringlatejoinforlargenumbersofmessages">&lt;-</a></small></h2>
<p>Suppose you have a persistent receiver that comes up at midday and must gracefully catch up on the large number of messages it has missed. The following discussion explains the relevant Late Join options and how to use them. (The discussion also applies to streaming-based late join, but since streaming sources must hold all retained messages in memory, there are typically far fewer messages available.)</p>
<p><b>Option:</b> <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grplatejoin.html#retransmitrequestoutstandingmaximumreceiver">retransmit_request_outstanding_maximum (receiver)</a></p>
<p>When a receiver comes up and begins requesting Late Join messages, it does not simply request messages starting at Sequence Number 0 through 1000000. Rather, it requests the messages a little at a time, depending upon how option <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grplatejoin.html#retransmitrequestoutstandingmaximumreceiver">retransmit_request_outstanding_maximum (receiver)</a> is set. For example, when set to the default of 10, the receiver sends requests the first 10 messages (Sequence Number 0 - 9). Upon receiving Sequence Number 0, it then requests the next message (10), and so on, limiting the number of outstanding unfulfilled requests to 10.</p>
<p>Note that higher for values retransmit_request_outstanding_maximum can increase the rate of RXs received, which can reduce the time required for receiver recovery. However, this can lead to heavy loading of the Store, potentially making it unable to sustain the incoming data rate.</p>
<p>Also, be aware that increasing retransmit_request_outstanding_maximum may require a corresponding increase to <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grplatejoin.html#retransmitrequestintervalreceiver">retransmit_request_interval (receiver)</a>. Otherwise you can have a situation where messages time out because it takes a Store longer than retransmit_request_interval to process all retransmit_request_outstanding_maximum requests. When this happens, you can see messages needlessly requested and sent many times (generates warnings to the receiver application log file).</p>
<p><b>Option:</b> <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grplatejoin.html#retransmitmessagecachingproximityreceiver">retransmit_message_caching_proximity (receiver)</a></p>
<p>When sequence number delivery order is used, long recoveries of active sources can create receiver memory cache problems due to the processing of both new and retransmitted messages. This option provides a method to control caching and cache size during recovery.</p>
<p>It does this by comparing the option value (default 2147483647) to the difference between the newest (live) received sequence number and the latest received RX sequence number. If the difference is less than the option's value, the receiver caches incoming live new messages. Otherwise, new messages are dropped and not cached (with the assumption that they can be requested later as retransmissions).</p>
<p>For example, as shown in the diagram below, a receiver may be receiving both live streaming messages (latest, #200) and catch-up retransmissions (latest, #100). The difference here is 100. If <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grplatejoin.html#retransmitmessagecachingproximityreceiver">retransmit_message_caching_proximity (receiver)</a> is 75, the receiver caches the live messages and will deliver them when it is all caught up with the retransmissions. However, if this option is 150, streamed messages are dropped and later picked up again as a retransmission.</p>
<div class="image">
<img src="proximity_option.png" alt="proximity_option.png"/>
</div>
 <p>The default value of this option is high enough to still encourage caching most of the time, and should be optimal for most receivers.</p>
<p>If your source streams faster than it retransmits, caching is beneficial, as it ensures new data are received only once, thus reducing recovery time. If the source retransmits faster than it streams, which is the optimal condition, you can lower the value of this option to use less memory during recovery, with little performance impact.</p>
<p><br />
 </p>
<h1><a class="anchor" id="offtransportrecoveryotr"></a>
Off-Transport Recovery (OTR)&nbsp;&nbsp;<small><a href="#offtransportrecoveryotr">&lt;-</a></small></h1>
<p>Off-Transport Recovery (OTR) is a lost-message-recovery feature that provides a level of hedging against the possibility of brief and incidental unrecoverable loss at the transport level or from a <a class="el" href="fundamentalconcepts.html#umrouter">DRO</a>. This section describes the OTR feature.</p>
<dl class="section note"><dt>Note</dt><dd>With the UMQ product, you cannot use OTR with Queuing (both Brokered and ULB).</dd></dl>
<p>When a transport cannot recover lost messages, OTR engages and looks to the source for message recovery. It does this by accessing the source's retention buffer (used also by the Late Join feature) to re-request messages that no longer exist in a transport's transmission window, or other places such as a persistent Store or redundant source.</p>
<p>OTR functions in a manner very similar to that of Late Join, but differs mainly in that it activates in message loss situations rather than following the creation of a receiver, and shares only the <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grplatejoin.html#latejoinsource">late_join (source)</a> option setting.</p>
<p>Upon detecting loss, a receiver initiates OTR by sending repeated, spaced, OTR requests to the source, until it recovers lost messages or a timeout period elapses.</p>
<p>OTR operates independently from transport-level recovery mechanisms such as NAKs for LBT-RU or LBT-RM. When you enable OTR for a receiver with <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grpofftransportrecovery.html#useotrreceiver">use_otr (receiver)</a>, the <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grpofftransportrecovery.html#otrrequestinitialdelayreceiver">otr_request_initial_delay (receiver)</a> period starts as soon as the <a class="el" href="architecture.html#deliverycontroller">Delivery Controller</a> detects a sequence gap. If the gap is not resolved by the end of the delay interval, OTR recovery initiates. OTR recovery can occur before, during or after transport-level recovery attempts.</p>
<p>When a receiver initiates OTR, the intervals between OTR requests increases twofold after each request, until the maximum interval is reached (assuming the receiver is still waiting to receive the retransmission). You use configuration options <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grpofftransportrecovery.html#otrrequestminimumintervalreceiver">otr_request_minimum_interval (receiver)</a> and <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grpofftransportrecovery.html#otrrequestmaximumintervalreceiver">otr_request_maximum_interval (receiver)</a> to set the initial (minimum) and maximum intervals, respectively.</p>
<p>The source retransmits lost messages to the recovered receiver via unicast.</p>
<p><br />
 </p>
<h2><a class="anchor" id="otrwithsequencenumberordereddelivery"></a>
OTR with Sequence Number Ordered Delivery&nbsp;&nbsp;<small><a href="#otrwithsequencenumberordereddelivery">&lt;-</a></small></h2>
<p>When sequence number delivery order is used and a gap of missing messages occurs, a receiver buffers the new incoming messages while it attempts to recover the earlier missing ones. Long recoveries of actively streaming sources can cause excessive receiver cache memory growth due to the processing of both new and retransmitted messages. You can control caching and cache size during recovery with options <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grpofftransportrecovery.html#otrmessagecachingthresholdreceiver">otr_message_caching_threshold (receiver)</a> and <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grplatejoin.html#retransmitmessagecachingproximityreceiver">retransmit_message_caching_proximity (receiver)</a>.</p>
<p>The option <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grpofftransportrecovery.html#otrmessagecachingthresholdreceiver">otr_message_caching_threshold (receiver)</a> sets the maximum number of messages a receiver can buffer. When the number of cached messages hits this threshold, new streamed messages are dropped and not cached, with the assumption that they can be requested later as retransmissions.</p>
<p>The <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grplatejoin.html#retransmitmessagecachingproximityreceiver">retransmit_message_caching_proximity (receiver)</a>, which is also used by Late Join (see <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grplatejoin.html#retransmitmessagecachingproximityreceiver">retransmit_message_caching_proximity (receiver)</a>), turns off this caching if there are too many messages to buffer between the last delivered message and the currently streaming messages.</p>
<p>Both of these option thresholds must be satisfied before caching resumes.</p>
<p><br />
 </p>
<h2><a class="anchor" id="otrwithump"></a>
OTR With Persistence&nbsp;&nbsp;<small><a href="#otrwithump">&lt;-</a></small></h2>
<p>With the UMP/UMQ products, you can implement OTR in conjunction with the persistent Store, however in this configuration, it functions somewhat differently from Streaming. If an OTR-enabled receiver registered with a Store detects a sequence gap in the live stream and that gap is not resolved by other means within the next <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grpofftransportrecovery.html#otrrequestinitialdelayreceiver">otr_request_initial_delay (receiver)</a> period, the receiver requests those messages from the Store(s). If the Store does not have some of the requested messages, the receiver requests them from the source. Regardless of whether the messages are recovered from a Store or from the source, OTR delivers all recovered messages with the LBM_MSG_OTR flag, unlike Late Join, which uses the LBM_MSG_RETRANSMIT flag.</p>
<p><br />
 </p>
<h2><a class="anchor" id="otroptionssummary"></a>
OTR Options Summary&nbsp;&nbsp;<small><a href="#otroptionssummary">&lt;-</a></small></h2>
<ul>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grplatejoin.html#latejoinsource">late_join (source)</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grplatejoin.html#retransmitretentionagethresholdsource">retransmit_retention_age_threshold (source)</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grplatejoin.html#retransmitretentionsizelimitsource">retransmit_retention_size_limit (source)</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grplatejoin.html#retransmitretentionsizethresholdsource">retransmit_retention_size_threshold (source)</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grpofftransportrecovery.html#useotrreceiver">use_otr (receiver)</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grpofftransportrecovery.html#otrrequestmessagetimeoutreceiver">otr_request_message_timeout (receiver)</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grpofftransportrecovery.html#otrrequestinitialdelayreceiver">otr_request_initial_delay (receiver)</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grpofftransportrecovery.html#otrrequestlogalertcooldownreceiver">otr_request_log_alert_cooldown (receiver)</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grpofftransportrecovery.html#otrrequestmaximumintervalreceiver">otr_request_maximum_interval (receiver)</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grpofftransportrecovery.html#otrrequestminimumintervalreceiver">otr_request_minimum_interval (receiver)</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grpofftransportrecovery.html#otrrequestoutstandingmaximumreceiver">otr_request_outstanding_maximum (receiver)</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grpofftransportrecovery.html#otrmessagecachingthresholdreceiver">otr_message_caching_threshold (receiver)</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grplatejoin.html#retransmitmessagecachingproximityreceiver">retransmit_message_caching_proximity (receiver)</a> </li>
</ul>
<dl class="section note"><dt>Note</dt><dd>With <a class="el" href="advancedoptimizations.html#smartsources">Smart Sources</a>, the following configuration options have limited or no support: <ul>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grplatejoin.html#retransmitretentionsizethresholdsource">retransmit_retention_size_threshold (source)</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grplatejoin.html#retransmitretentionsizelimitsource">retransmit_retention_size_limit (source)</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grplatejoin.html#retransmitretentionagethresholdsource">retransmit_retention_age_threshold (source)</a> </li>
</ul>
</dd></dl>
<p><br />
 </p>
<h1><a class="anchor" id="encryptedtcp"></a>
Encrypted TCP&nbsp;&nbsp;<small><a href="#encryptedtcp">&lt;-</a></small></h1>
<p>This section introduces the use of Transport Layer Security (TLS), sometimes known by its older designation Secure Sockets Layer (SSL).</p>
<p>The goal of the Ultra Messaging (UM) TLS feature is to provide encrypted transport of application data. TLS supports authentication (through certificates), data confidentiality (through encryption), and data integrity (ensuring data are not changed, removed, or added-to). UM can be configured to apply TLS security measures to all Streaming and/or Persisted TCP communication, including <a class="el" href="fundamentalconcepts.html#umrouter">DRO</a> peer links. Non-TCP communication is not encrypted (e.g. topic resolution).</p>
<p>TLS is a family of standard protocols and algorithms for securing TCP communication between a client and a server. It is sometimes referred as "SSL", which technically is the name of an older (less secure) version of the protocol. Over the years, security researchers (and hackers) have discovered flaws in SSL/TLS. However, the vast majority of the widely publicized security vulnerabilities have been flaws in the implementations of TLS, not in the recent TLS protocols or algorithms themselves. As of UM version 6.9, there are no known security weaknesses in TLS version 1.2, the version used by UM.</p>
<p>TLS is generally implemented by several different software packages. UM makes use of OpenSSL, a widely deployed and actively maintained open-source project.</p>
<p><br />
 </p>
<h2><a class="anchor" id="tlsauthentication"></a>
TLS Authentication&nbsp;&nbsp;<small><a href="#tlsauthentication">&lt;-</a></small></h2>
<p>TLS authentication uses X.509 digital certificates. Certificate creation and management is the responsibility of the user. Ultra Messaging's usage of OpenSSL expects PEM encoded certificates. There are a variety of generally available tools for converting certificates between different encodings. Since user infrastructures vary widely, the UM package does not include tools for creation, formatting, or management of certificates.</p>
<p>Although UM is designed as a peer-to-peer messaging system, TLS has the concept of client and server. The client initiates the TCP connection and the server accepts it. In the case of a TCP source, the receiver initiates and is therefore the client, with the source (sender of data) being the server. However, with unicast immediate messages, the sender of data is the client, and the recipient is the server. Due to the fact that unicast immediate messages are used by UM for internal control and coordination, it is typically not possible to constrain a given application to only operate as a pure client or pure server. For this reason, UM requires all applications participating in encryption to have a certificate. Server-only authentication (i.e. anonymous client, as is used by web browsers) is not supported. It is permissible for groups of processes, or even all processes, to share the same certificate.</p>
<p>A detailed discussion of certificate usage is beyond the scope of the Ultra Messaging documentation. However, you can find a step-by-step procedure for creating a self-signed X.509 security certificate here: <a href="https://kb.informatica.com/howto/6/Pages/18/432752.aspx">https://kb.informatica.com/howto/6/Pages/18/432752.aspx</a></p>
<p><br />
 </p>
<h2><a class="anchor" id="tlsbackwardscompatibility"></a>
TLS Backwards Compatibility&nbsp;&nbsp;<small><a href="#tlsbackwardscompatibility">&lt;-</a></small></h2>
<p>The TLS protocol was designed to allow for a high degree of backwards compatibility. During the connection establishment phase, the client and server perform a negotiation handshake in which they identify the highest common versions of various security options. For example, an old web browser might pre-date the introduction of TLS and only support the older SSL protocol. OpenSSL is often configured to allow clients and servers to "negotiate down" to those older, less-secure protocols or algorithms.</p>
<p>Ultra Messaging has the advantage of not needing to communicate with old versions of SSL or TLS. UM's default configuration directs OpenSSL to require both the client and the server to use protocols and algorithms which were highly regarded, as of UM's release date. If vulnerabilities are discovered in the future, the user can override UM's defaults and chose other protocols or algorithms.</p>
<p><br />
 </p>
<h2><a class="anchor" id="tlsefficiency"></a>
TLS Efficiency&nbsp;&nbsp;<small><a href="#tlsefficiency">&lt;-</a></small></h2>
<p>When a TLS connection is initiated, a handshake takes place prior to application data encryption. Once the handshake is completed, the CPU effort required to encrypt and decrypt application data is minimal. However, the handshake phase involves the use of much less efficient algorithms.</p>
<p>There are two factors under the user's control, which greatly affect the handshake efficiency: the choice of cipher suite and the key length. We have seen an RSA key of 8192 bits take 4 seconds of CPU time on a 1.3GHz SparcV9 processor just to complete the handshake for a single TLS connection.</p>
<p>Users should make their choices with an understanding of the threat profiles they are protecting against. For example, it is estimated that a 1024-bit RSA key can be broken in about a year by brute force using specialized hardware (see <a href="http://www.tau.ac.il/~tromer/papers/cbtwirl.pdf">http://www.tau.ac.il/~tromer/papers/cbtwirl.pdf</a>). This may be beyond the means of the average hacker, but well within the means of a large government. RSA keys of 2048 bits are generally considered secure for the foreseeable future.</p>
<p><br />
 </p>
<h2><a class="anchor" id="tlsconfiguration"></a>
TLS Configuration&nbsp;&nbsp;<small><a href="#tlsconfiguration">&lt;-</a></small></h2>
<p>TLS is enabled on a context basis. When enabled, all Streaming and Persistence related TCP-based communication into or out of the context is encrypted by TLS. A context with TLS enabled will not accept source creation with transports other than TCP.</p>
<p>Subscribers will only successfully receive data if the receiver's context and the source's context share the same encryption settings. A receiver created in an encrypted enabled context will ignore topic resolution source advertisements for non-encrypted sources, and will therefore not subscribe. Similarly, a receiver created in a non-encrypted context will ignore topic resolution source advertisements for encrypted sources. Topic resolution queries are also ignored by mismatched contexts. No warning will be logged when these topic resolution datagrams are ignored, but each time this happens, the context-level statistic tr_dgrams_dropped_type is incremented.</p>
<p>TLS is applied to unicast immediate messages as well, as invoked either directly by the user, or internally by functions like late join, request/response, and Persistence-related communication between sources, receivers, and Stores.</p>
<p>Brokered Queuing using AMQP does not use the UM TLS feature. A UM brokered context does not allow TLS to be enabled.</p>
<p><br />
 </p>
<h2><a class="anchor" id="tlsoptionssummary"></a>
TLS Options Summary&nbsp;&nbsp;<small><a href="#tlsoptionssummary">&lt;-</a></small></h2>
<ul>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grpencryptedtcp.html#usetlscontext">use_tls (context)</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grpencryptedtcp.html#tlsciphersuitescontext">tls_cipher_suites (context)</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grpencryptedtcp.html#tlscertificatecontext">tls_certificate (context)</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grpencryptedtcp.html#tlscertificatekeycontext">tls_certificate_key (context)</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grpencryptedtcp.html#tlscertificatekeypasswordcontext">tls_certificate_key_password (context)</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grpencryptedtcp.html#tlstrustedcertificatescontext">tls_trusted_certificates (context)</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grpencryptedtcp.html#tlscompressionnegotiationtimeoutcontext">tls_compression_negotiation_timeout (context)</a> </li>
</ul>
<p>The <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grpencryptedtcp.html#tlsciphersuitescontext">tls_cipher_suites (context)</a> configuration option defines the list of one or more (comma separated) cipher suites that are acceptable to this context. If more than one is supplied, they should be in descending order of preference. When a remote context negotiates encrypted TCP, the two sides must find a cipher suite in common, otherwise the connection will be canceled.</p>
<p>OpenSSL uses the cipher suite to define the algorithms and key lengths for encrypting the data stream. The choice of cipher suite is critical for ensuring the security of the connection. To achieve a high degree of backwards compatibility, OpenSSL supports old cipher suites which are no longer considered secure. The user is advised to use UM's default suite.</p>
<p>OpenSSL follows its own naming convention for cipher suites. See OpenSSL's <a href="https://www.openssl.org/docs/manmaster/man1/openssl-ciphers.html#CIPHER-SUITE-NAMES">Cipher Suite Names</a> for the full list of suite names. When configuring UM, use the OpenSSL names (with dashes), not* the IANA names (with underscores).</p>
<p><br />
 </p>
<h2><a class="anchor" id="tlsandpersistence"></a>
TLS and Persistence&nbsp;&nbsp;<small><a href="#tlsandpersistence">&lt;-</a></small></h2>
<p>TLS is designed to encrypt a TCP connection, and works with TCP-based persisted data <a class="el" href="fundamentalconcepts.html#transportsessions">Transport Sessions</a> and control traffic. However, TLS is not intended to encrypt data at rest. When a persistent Store is used with the UM TLS feature, the user messages are written to disk in plaintext form, not encrypted.</p>
<p><br />
 </p>
<h2><a class="anchor" id="tlsandqueuing"></a>
TLS and Queuing&nbsp;&nbsp;<small><a href="#tlsandqueuing">&lt;-</a></small></h2>
<p>The UM TLS feature does not apply to the AMQP connection to the brokered queue. UM does not currently support security on the AMQP connection.</p>
<p>However, the ULB form of queuing does not use a broker. For ULB sources that are configured for TCP, the UM TLS feature will encrypt the application data.</p>
<p><br />
 </p>
<h2><a class="anchor" id="tlsandthedynamicroutingoptiondro"></a>
TLS and the DRO&nbsp;&nbsp;<small><a href="#tlsandthedynamicroutingoptiondro">&lt;-</a></small></h2>
<p>When a <a class="el" href="fundamentalconcepts.html#umrouter">DRO</a> is used to route messages across <a class="el" href="fundamentalconcepts.html#topicresolutiondomain">Topic Resolution Domains</a> (TRDs), be aware that the TLS session is terminated at the DRO's proxy receiver/source. Because each endpoint portal on a DRO is implemented with its own context, care must be taken to ensure end-to-end security. It is possible to have a TLS source publishing in one TRD, received by a DRO (via an endpoint portal also configured for TLS), and re-published to a different TRD via an endpoint portal configured with a non-encrypted context. This would allow a non-encrypted receiver to access messages that the source intended to be encrypted. As a message is forwarded through a DRO network, it does not propagate the security settings of the originator, so each portal needs to be appropriately encrypted. The user is strongly encouraged to configure ALL portals on an interconnected network of DROs with the same encryption settings.</p>
<p>The encryption feature is extended to DRO peer links, however peer links are not context-based and are not configured the same way. The following XML elements are used by the DRO to configure a peer link:</p>
<ul>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/gateway.tag:../Gateway/" href="../Gateway/xmlconfigurationreference.html#droelementtls">Router Element "&lt;tls&gt;"</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/gateway.tag:../Gateway/" href="../Gateway/xmlconfigurationreference.html#droelementciphersuites">Router Element "&lt;cipher-suites&gt;"</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/gateway.tag:../Gateway/" href="../Gateway/xmlconfigurationreference.html#droelementcertificate">Router Element "&lt;certificate&gt;"</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/gateway.tag:../Gateway/" href="../Gateway/xmlconfigurationreference.html#droelementcertificatekey">Router Element "&lt;certificate-key&gt;"</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/gateway.tag:../Gateway/" href="../Gateway/xmlconfigurationreference.html#droelementcertificatekeypassword">Router Element "&lt;certificate-key-password&gt;"</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/gateway.tag:../Gateway/" href="../Gateway/xmlconfigurationreference.html#droelementtrustedcertificates">Router Element "&lt;trusted-certificates&gt;"</a> </li>
</ul>
<p>As with sources and receivers, the portals on both sides of a peer link must be configured for compatible encryption settings.</p>
<p>Notice that there is no DRO element corresponding to the context option <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grpencryptedtcp.html#tlscompressionnegotiationtimeoutcontext">tls_compression_negotiation_timeout (context)</a>. The DRO peer link's negotiation timeout is hard-coded to 5 seconds.</p>
<p>See <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/gateway.tag:../Gateway/" href="../Gateway/xmlconfigurationreference.html#umrouterconfigurationdtd">DRO Configuration DTD</a> for details.</p>
<p><br />
 </p>
<h2><a class="anchor" id="tlsandcompression"></a>
TLS and Compression&nbsp;&nbsp;<small><a href="#tlsandcompression">&lt;-</a></small></h2>
<p>Many users have advanced network equipment (switches/routers), which transparently compress packets as they traverse the network. This compression is especially valued to conserve bandwidth over long-haul WAN links. However, when packets are encrypted, the network compressors are typically not able to reduce the size of the data. If the user desires UM messages to be compressed and encrypted, the data needs to be compressed before it is encrypted.</p>
<p>The UM compression feature (see <a class="el" href="umfeatures.html#compressedtcp">Compressed TCP</a>) accomplishes this. When both TLS and compression are enabled, the compression is applied to user data first, then encryption.</p>
<p>Be aware that there can be information leakage when compression is applied and an attacker is able to inject data of known content over a compressed and encrypted session. For example, this leakage is exploited by the <a href="https://en.wikipedia.org/wiki/CRIME">CRIME</a> attack, albeit primarily for web browsers. Users must weigh the benefits of compression against the potential risk of information leakage.</p>
<p><b>Version Interoperability</b></p>
<p>It is not recommended to mix pre-6.9 contexts with encrypted contexts on topics of shared interest. If a process with a pre-6.9 version of UM creates a receiver, and another process with UM 6.9 or beyond creates a TLS source, the pre-6.9 receiver will attempt to join the TLS source. After a timeout, the handshake will fail and the source will disconnect. The pre-6.9 receiver will retry the connection, leading to flapping.</p>
<p>Note that in the reverse situation, a 6.9 TLS receiver will simply ignore a pre-6.9 source. I.e. no attempt will be made to join, and no flapping will occur.</p>
<p><br />
 </p>
<h2><a class="anchor" id="openssldependency"></a>
OpenSSL Dependency&nbsp;&nbsp;<small><a href="#openssldependency">&lt;-</a></small></h2>
<p>For UM versions 6.9 through 6.12, the UM dynamic library was linked with OpenSSL in such a way as to require its presence in order for UM to load and initialize. I.e. it was a load-time dependency.</p>
<p>As of UM version 6.12.1, the linkage with OpenSSL is made at run-time. If encryption features are not used, the OpenSSL libraries do not need to be present on the system. UM is able to initialize without OpenSSL.</p>
<p>There are two UM features which utilize encryption provided by OpenSSL: </p><ul>
<li>
<a class="el" href="umfeatures.html#encryptedtcp">Encrypted TCP</a>. </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/umm.tag:../UMM/" href="../UMM/index.html#ummanageroverview">UM Manager (UMM)</a> with <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/umm.tag:../UMM/" href="../UMM/ummdaemonoverview.html#securingummdaemoncommunicationwithssl">secure communication</a> enabled. </li>
</ul>
<p><br />
 </p>
<h1><a class="anchor" id="compressedtcp"></a>
Compressed TCP&nbsp;&nbsp;<small><a href="#compressedtcp">&lt;-</a></small></h1>
<p>This section introduces the use of Compression with TCP connections.</p>
<p>The goal of the Ultra Messaging (UM) compression feature is to decrease the size of transmitted application data. UM can be configured to apply compression to all Streaming and/or Persisted TCP communication.</p>
<p>Non-TCP communication is not compressed (e.g. topic resolution).</p>
<p>Compression is generally implemented by any of several different software packages. UM makes use of LZ4, a widely deployed open-source project.</p>
<p>While the UM compression feature is usable for TCP-based sources and receivers, it is possibly most useful when applied to <a class="el" href="fundamentalconcepts.html#umrouter">DRO</a> peer links.</p>
<p><br />
 </p>
<h2><a class="anchor" id="compressionconfiguration"></a>
Compression Configuration&nbsp;&nbsp;<small><a href="#compressionconfiguration">&lt;-</a></small></h2>
<p>Compression is enabled on a context basis. When enabled, all Streaming and Persistence related TCP-based communication into or out of the context is compressed by LZ4. A context with compression enabled will not accept source creation with transports other than TCP.</p>
<p>Subscribers will only successfully receive data if the receiver's context and the source's context share the same compression settings. A receiver created in a compression-enabled context will ignore topic resolution source advertisements for non-compressed sources, and will therefore not subscribe. Similarly, a receiver created in an non-compressed context will ignore topic resolution source advertisements for compressed sources. Topic resolution queries are also ignored by mismatched contexts. No warning will be logged when these topic resolution datagrams are ignored, but each time this happens, the context-level statistic tr_dgrams_dropped_type is incremented.</p>
<p>Compression is applied to unicast immediate messages as well, as invoked either directly by the user, or internally by functions like late join, request/response, and Persistence-related communication between sources, receivers, and Stores.</p>
<p>Brokered Queuing using AMQP does not use the UM compression feature. A UM brokered context does not allow compression to be enabled.</p>
<p>The compression-related configuration options used by the Ultra Messaging library are:</p>
<ul>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grpcompressedtcp.html#compressioncontext">compression (context)</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grpencryptedtcp.html#tlscompressionnegotiationtimeoutcontext">tls_compression_negotiation_timeout (context)</a> </li>
</ul>
<p><br />
 </p>
<h2><a class="anchor" id="compressionandpersistence"></a>
Compression and Persistence&nbsp;&nbsp;<small><a href="#compressionandpersistence">&lt;-</a></small></h2>
<p>Compression is designed to compress a data Transport Session. It is not intended to compress data at rest. When a persistent Store is used with the UM compression feature, the user messages are written to disk in uncompressed form.</p>
<p><br />
 </p>
<h2><a class="anchor" id="compressionandqueuing"></a>
Compression and Queuing&nbsp;&nbsp;<small><a href="#compressionandqueuing">&lt;-</a></small></h2>
<p>The UM compression feature does not apply to the AMQP connection to the brokered queue. UM does not currently support compression on the AMQP connection.</p>
<p>However, the ULB form of queuing does not use a broker. For ULB sources that are configured for TCP, the UM compression feature will compress the application data.</p>
<p><br />
 </p>
<h2><a class="anchor" id="compressionandthedynamicroutingoptiondro"></a>
Compression and the DRO&nbsp;&nbsp;<small><a href="#compressionandthedynamicroutingoptiondro">&lt;-</a></small></h2>
<p>When a DRO is used to route messages across <a class="el" href="fundamentalconcepts.html#topicresolutiondomain">Topic Resolution Domains</a> (TRDs), be aware that the compression session is terminated at the DRO's proxy receiver/source. Because each endpoint portal on a DRO is implemented with its own context, care must be taken to ensure end-to-end compression (if desired). As a message is forwarded through a DRO network, it does not propagate the compression setting of the originator, so each portal needs to be appropriately compressed.</p>
<p>Possibly the most-useful application of the UM compression feature is not TCP sources, but rather DRO peer links. The compression feature is extended to DRO peer links, however peer links are not context-based and are not configured the same way. The following XML elements are used by the DRO to configure a peer link:</p>
<ul>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/gateway.tag:../Gateway/" href="../Gateway/xmlconfigurationreference.html#droelementcompression">Router Element "&lt;compression&gt;"</a> </li>
</ul>
<p>As with sources and receivers, the portals on both sides of a peer link must be configured for the same compression setting.</p>
<p>Notice that there is no DRO element corresponding to the context option <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grpencryptedtcp.html#tlscompressionnegotiationtimeoutcontext">tls_compression_negotiation_timeout (context)</a>. The DRO peer link's negotiation timeout is hard-coded to 5 seconds.</p>
<p>See <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/gateway.tag:../Gateway/" href="../Gateway/xmlconfigurationreference.html#umrouterconfigurationdtd">DRO Configuration DTD</a> for details.</p>
<p><br />
 </p>
<h2><a class="anchor" id="compressionandencryption"></a>
Compression and Encryption&nbsp;&nbsp;<small><a href="#compressionandencryption">&lt;-</a></small></h2>
<p>See <a class="el" href="umfeatures.html#tlsandcompression">TLS and Compression</a>.</p>
<p><br />
 </p>
<h2><a class="anchor" id="versioninteroperability"></a>
Version Interoperability&nbsp;&nbsp;<small><a href="#versioninteroperability">&lt;-</a></small></h2>
<p>It is not recommended to mix pre-6.9 contexts with compressed contexts on topics of shared interest. As mentioned above, if a compressed and an uncompressed context connect via TCP, the connection will fail and retry, resulting in flapping.</p>
<p><br />
 </p>
<h1><a class="anchor" id="highresolutiontimestamps"></a>
High-resolution Timestamps&nbsp;&nbsp;<small><a href="#highresolutiontimestamps">&lt;-</a></small></h1>
<p>This section introduces the use of high-resolution timestamps with LBT-RM.</p>
<p>The Ultra Messaging (UM) high-resolution message timestamp feature leverages the hardware timestamping function of certain Solarflare network interface cards (NICs) to measure sub-microsecond times that packets are transmitted and received. Solarflare's NICs and Onload kernel-bypass driver implement PTP to synchronize timestamps across the network, allowing very accurate one-way latency measurements. The UM timestamp feature requires Onload version 201509 or later.</p>
<p>For subscribers, each message's receive timestamp is delivered in the message's header structure (for C programs, <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#aaa7a945411e63884f12918417e8d117c">lbm_msg_t</a> field <b>hr_timestamp</b>, of type <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a60ce419ca9bccc4d2b61b9acb70fe30e">lbm_timespec_t</a>). Each timestamp is a structure of 32 bits worth of seconds and 32 bits worth of nanoseconds. When both values are zero, the timestamp is not available.</p>
<p>For publishers, each message's transmit timestamp is delivered via the source event callback (for C programs, event type LBM_SRC_EVENT_TIMESTAMP). The same timestamp structure as above is delivered with the event, as well as the message's sequence number. Sending applications can be informed of the outgoing sequence number range of each message by using the extended form of the send function and supplying the LBM_SRC_SEND_EX_FLAG_SEQUENCE_NUMBER_INFO flag. This causes the LBM_SRC_EVENT_SEQUENCE_NUMBER_INFO event to be delivered to the source event handler.</p>
<p><br />
 </p>
<h2><a class="anchor" id="timestamprestrictions"></a>
Timestamp Restrictions&nbsp;&nbsp;<small><a href="#timestamprestrictions">&lt;-</a></small></h2>
<p>Due to the specialized nature of this feature, there are several restrictions in its use.</p>
<ul>
<li>
<b>Operating system</b>: Linux only. No timestamps will be delivered on other operating systems. Also, since the feature makes use of the rcvmmsg() function, no timestamps will be delivered on Linux kernels prior to 2.6.33 and glibc libraries prior to 2.12 (which was released in 2010). </li>
<li>
<b>Transport</b>: Source-based LBT-RM (multicast) Transport Sessions only. No timestamps will be delivered for MIM or other transport types. </li>
<li>
<b>Queuing</b>: Timestamps are not supported for broker-based queuing. If a ULB source is configured for LBT-RM, send-side timestamps are not supported and will not be delivered if one or more receivers are registered. However, on the receive side, ULB messages are time stamped. </li>
<li>
<b>Loss</b>: If packet loss triggers LBT-RM's NAK/retransmit sequence, the send side will have multiple timestamps delivered, one for each multicast transmission. On the receive side, the timestamp of the first successfully received multicast datagram will be delivered. </li>
<li>
<b>Recovery</b>: For missed messages which are recovered via Late Join, Off-Transport Recovery (OTR), or the persistent Store, no timestamp will be delivered, either on the send side or the receive side. </li>
<li>
<b>Implicit batching</b>: If implicit batching is being used, only the first message in a batch will have a send-side timestamp delivered. When implicit batching is used, the sender must be prepared for some messages to not have timestamps delivered. On the receive side, all messages in a batch will have the same timestamp. </li>
<li>
<b>UM Fragmentation, send-side</b>: If user messages are too large to be contained in a single datagram, UM will fragment the message into multiple datagrams. On the send side, each datagram will trigger delivery of a timestamp. <ul>
<li>
UM Fragmentation, receive-side with <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grpmajoroptions.html#ordereddeliveryreceiver">ordered_delivery (receiver)</a> set to 0 (arrival): Arrival-order delivery will result in each fragment being delivered separately, as it is received. Each fragment's message header will contain a timestamp. Arrival order delivery provides an accurate timestamp of when the complete message is received (although, as mentioned above, any fragment recovered via OTR or the persistent Store will not have a timestamp). </li>
<li>
UM Fragmentation, receive-side with <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grpmajoroptions.html#ordereddeliveryreceiver">ordered_delivery (receiver)</a> set to 1 or -1, (reassembly): Delivery with reassembly results in a single timestamp included in the message header. That timestamp corresponds to the arrival of the last fragment of the message (although, as mentioned above, any fragment recovered via OTR or the persistent Store will not have a timestamp). Note that this is not necessarily the last fragment received; if an intermediate datagram is lost and subsequently re-transmitted after a delay, that intermediate datagram will be the last one received, but its timestamp will not be used for the message. For example, if a three-fragment message is received in the order of F0, F2, F1, the timestamp for the message will correspond to F2, the last fragment of the message. If fragmented messages are being sent, and an accurate time of message completion is needed, arrival order delivery must be used. </li>
</ul>
</li>
<li>
<b>UM Fragmentation plus implicit batching</b>: If user messages vary widely in size, some requiring fragmentation, and implicit batching is used be aware that a full fragment does not completely fill a datagram. For example, if a small message (less than 300 bytes) is sent followed by a large message requiring fragmentation, the first fragment of the large message will fit in the same datagram as the small message. In that case, on the send side, a timestamp will not be delivered for that first fragment. However, a timestamp will be delivered for the second fragment. On the receive side, the same restrictions apply as described with UM fragmentation. </li>
<li>
<b>Local loopback</b>: If an LBT-RM source and receiver share the same physical machine, the receive side will not have timestamps delivered. </li>
</ul>
<p><br />
 </p>
<h2><a class="anchor" id="timestampconfigurationsummary"></a>
Timestamp Configuration Summary&nbsp;&nbsp;<small><a href="#timestampconfigurationsummary">&lt;-</a></small></h2>
<ul>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grptransportlbtrmoperation.html#transportlbtrmsourcetimestampcontext">transport_lbtrm_source_timestamp (context)</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grptransportlbtrmoperation.html#transportlbtrmreceivertimestampcontext">transport_lbtrm_receiver_timestamp (context)</a> </li>
</ul>
<p><br />
 </p>
<h1><a class="anchor" id="unicastimmediatemessaging"></a>
Unicast Immediate Messaging&nbsp;&nbsp;<small><a href="#unicastimmediatemessaging">&lt;-</a></small></h1>
<p>Unicast Immediate Messaging (UIM) deviates from the normal publish/subscribe paradigm by allowing the publisher to send messages to a specific destination application context. Various features within UM make use of UIMs transparently to the application. For example, a persistent receiver sends consumption acknowledgements to the Store using UIM messages.</p>
<p>The application can make direct use of UIM in two ways: </p><ul>
<li>
Calling a UIM send API function. See <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a497d77b133cea1547c3346fcba99872a">lbm_unicast_immediate_message()</a> and <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#ae011c7a66e1db1f012d7f9633dbd321d">lbm_unicast_immediate_request()</a>. </li>
<li>
Sending a response to a message using the <a class="el" href="fundamentalconcepts.html#requestresponse">Request/Response</a> feature. See <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a0bbc01b600ccc2ae874474e35955eb85">lbm_send_response()</a>. </li>
</ul>
<p>A UIM message can be associated with a topic string, but that topic is not used to determine where the message is sent to. Instead, the topic string is included in the message header, and the application must specify the destination of the desired context in the UIM send call.</p>
<p>Alternatively, an application can send a UIM message without a topic string. This so-called "topicless" message is not delivered to the receiving application via the normal receiver callback. Instead it is delivered by an optional context callback. See <a class="el" href="umfeatures.html#receivingauim">Receiving a UIM</a>.</p>
<p>UIM messages are sent using the TCP protocol; no other protocol is supported for UIM. The TCP connection is created dynamically as-needed, when a message is sent. That is, when an application sends its first UIM message to a particular destination context, the sender's context holds the message and initiates the TCP connection. When the connection is accepted by the destination context, the sender sends the message. When the message is fully sent, the sender will keep the TCP connection open for a period of time in case more UIMs are sent to the same destination context. See <a class="el" href="umfeatures.html#uimconnectionmanagement">UIM Connection Management</a>.</p>
<p><br />
 </p>
<h2><a class="anchor" id="uimreliability"></a>
UIM Reliability&nbsp;&nbsp;<small><a href="#uimreliability">&lt;-</a></small></h2>
<p>Although UIM is implemented using TCP, it should not be considered "reliable" in the same way that UM sources are. There are a variety of ways that a UIM message can fail to be delivered to the destination. For example, if an overloaded DRO must forward the message to the destination TRD, the DRO might have to drop the message.</p>
<p>Note that the success or failure of delivery of a UIM cannot be determined by the sender. For example, calling <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a497d77b133cea1547c3346fcba99872a">lbm_unicast_immediate_message()</a> or <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a0bbc01b600ccc2ae874474e35955eb85">lbm_send_response()</a> might return a successful status, but the message might have been queued internally for later transmission. So the success status only means that it was queued successfully. A subsequent failure may or may not trigger an error log; it depends on what the nature of the failure is.</p>
<p>As a result, applications are responsible for detecting failures (typically using timeouts) and implementing retry logic. If a higher degree of messaging reliability is required, normal UM sources should be used.</p>
<p>(For UIM messages that are sent transparently by UM features, various timeout/retry mechanisms are implemented internally.)</p>
<p>UIMs can also be lost as a result of TCP disconnections. See <a class="el" href="packetloss.html#tcpdisconnections">TCP Disconnections</a> for more information.</p>
<p><br />
 </p>
<h2><a class="anchor" id="uimaddressing"></a>
UIM Addressing&nbsp;&nbsp;<small><a href="#uimaddressing">&lt;-</a></small></h2>
<p>There are three ways to specify the destination address of a UIM: </p><ul>
<li>
Implicit &ndash; this method is used when a response is sent using the <a class="el" href="fundamentalconcepts.html#requestresponse">Request/Response</a> feature. See <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a0bbc01b600ccc2ae874474e35955eb85">lbm_send_response()</a> for details. </li>
<li>
Explicit &ndash; this method uses a string of the form: "TCP:ip:port" (no DRO) or "TCP:domain:ip:port" (DRO in use). See <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a497d77b133cea1547c3346fcba99872a">lbm_unicast_immediate_message()</a> for details. </li>
<li>
Source &ndash; this method uses a source string to send messages to the context which hosts a given source. See <a class="el" href="umfeatures.html#sendingtosources">Sending to Sources</a> for details. </li>
</ul>
<p>In the Explicit addressing method, the "ip" and "port" refer to the binding of the destination context's UIM port (also called "request port"). By default, when a context is created, UM will select values from a range of possibilities for ip and port. However, this makes it difficult for a sender to construct an explicit address since the ip and port are not deterministic.</p>
<p>One solution is to explicitly set the ip and port for the context's UIM port using the configuration options: <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grpunicastimmediatemessagingnetwork.html#requesttcpportcontext">request_tcp_port (context)</a> and <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grpunicastimmediatemessagingnetwork.html#requesttcpinterfacecontext">request_tcp_interface (context)</a>.</p>
<p><br />
 </p>
<h2><a class="anchor" id="receivingauim"></a>
Receiving a UIM&nbsp;&nbsp;<small><a href="#receivingauim">&lt;-</a></small></h2>
<p>There are two kinds of UIM messages: </p><ul>
<li>
UIMs with a topic. </li>
<li>
UIMs with no topic (topicless). </li>
</ul>
<p>To receive UIM messages with a topic, an application simply creates a normal receiver for that topic. Alternatively, it can create a wildcard receiver for a matching topic pattern. Finally, the application can also register a callback specifically for UIM messages that contain a topic but for which no matching receiver exists, using <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grpmulticastimmediatemessagingoperation.html#immediatemessagetopicreceiverfunctioncontext">immediate_message_topic_receiver_function (context)</a>. Alternatively, <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#abdefbb3bd3ff3a3b2ec6e20ca2f5dc19">lbm_context_rcv_immediate_topic_msgs()</a> can be used.</p>
<p>To receive UIM messages with no topic (topicless), the application must register a callback with the context for topicless messages, using <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grpmulticastimmediatemessagingoperation.html#immediatemessagereceiverfunctioncontext">immediate_message_receiver_function (context)</a>). Alternatively, the API <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a374f135dddf7794130509f97b1e96cf8">lbm_context_rcv_immediate_msgs()</a> can be used to register that callback.</p>
<p>Note that only the specified destination context will deliver the message. If other applications have a receiver for that same topic, they will not receive a copy of that UIM message.</p>
<p><b>UIM Port</b></p>
<p>To receive UIMs, a context must bind to and listen on the "UIM Port", also known as the "Request Port". See <a class="el" href="umfeatures.html#uimaddressing">UIM Addressing</a> for details.</p>
<p><br />
 </p>
<h2><a class="anchor" id="sendingauim"></a>
Sending a UIM&nbsp;&nbsp;<small><a href="#sendingauim">&lt;-</a></small></h2>
<p>The following APIs are used to send application UIM messages: </p><ul>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a497d77b133cea1547c3346fcba99872a">lbm_unicast_immediate_message()</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#ae011c7a66e1db1f012d7f9633dbd321d">lbm_unicast_immediate_request()</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a0bbc01b600ccc2ae874474e35955eb85">lbm_send_response()</a> &ndash; see <a class="el" href="fundamentalconcepts.html#requestresponse">Request/Response</a> for more information. </li>
<li>
</li>
</ul>
<p>For the <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a497d77b133cea1547c3346fcba99872a">lbm_unicast_immediate_message()</a> and <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#ae011c7a66e1db1f012d7f9633dbd321d">lbm_unicast_immediate_request()</a> APIs, the user has a choice between sending messages with a topic or without a topic (topicless). With the C API, passing a NULL pointer for the topic string sends a topicless message.</p>
<p><br />
 </p>
<h2><a class="anchor" id="uimconnectionmanagement"></a>
UIM Connection Management&nbsp;&nbsp;<small><a href="#uimconnectionmanagement">&lt;-</a></small></h2>
<p>The act of sending a UIM message will check to see if the context already has a TCP connection open to the destination context. If so, the existing connection is used to send the UIM. Otherwise, UM will initiate a new TCP connection to the destination context.</p>
<p>Once the message is sent, an activity deletion timer is started for the connection; see <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grpunicastimmediatemessagingoperation.html#responsetcpdeletiontimeoutcontext">response_tcp_deletion_timeout (context)</a>. If another UIM message is sent to the same destination, the activity deletion timer is canceled and restarted. Thus, if messages are sent periodically with a shorter period than the activity deletion timer, the TCP connection will remain established.</p>
<p>However, if no messages are sent for more time than the activity deletion timer, the timer will expire and the TCP connection will be deleted and resources cleaned up.</p>
<p>An exception to this workflow exists for the <a class="el" href="fundamentalconcepts.html#requestresponse">Request/Response</a> feature. When a request message is received by a context, the context automatically initiates a connection to the requester, even though the application has not yet sent its response UIM. The activity deletion timer is not started at this time. When the application's receiver callback is invoked with the request message, the message contains a reference to a response object. This response object is used for sending response UIMs back to the requester. However, the act of sending these responses also does not start the activity deletion timer for the TCP connection. The activity deletion timer is only started when the response object is deleted (usually implicitly when the message itself is deleted, usually as a result of returning from the receiver callback).</p>
<p>Note that the application that receives a request has the option of retaining the message, which delays deletion of the message until the application explicitly decides to delete it. In this case, the TCP connection is held open for as long as the application retains the response object. When the application has finished sending any and all of its responses to the request and does not need the request object any more, it deletes the request object. This starts the activity deletion timer running.</p>
<p>Finally, note that there is a queue in front of the UIM connection which holds messages when the connection is slow. It is possible that messages are still held in the queue for transmission after the response object is deleted, and if the response message is very large and/or the destination application is slow processing responses, it is possible for data to still be queued when the activity deletion timer expires. In that case, UM does <em>not</em> delete the TCP connection, and instead restarts the activity deletion timer for the connection.</p>
<p><br />
 </p>
<h1><a class="anchor" id="multicastimmediatemessaging"></a>
Multicast Immediate Messaging&nbsp;&nbsp;<small><a href="#multicastimmediatemessaging">&lt;-</a></small></h1>
<dl class="section warning"><dt>Warning</dt><dd>Multicast Immediate Messaging (MIM) is not recommended for general use. It is inefficient and can affect the operation of all applications on a UM network. This is partly because every message sent via the MIM protocol is distributed to <em>every</em> other application on the network, regardless of that application's interest in such messages.</dd></dl>
<p>MIM uses the same reliable multicast protocol as normal LBT-RM sources. MIM messages can be sent to a topic, in which case each receiving context will filter that message, discarding it if no receiver exists for that topic. MIM avoids using Topic Resolution by including the full topic string in the message, and sending it to a multicast group that all application contexts are configured to use.</p>
<dl class="section attention"><dt>Attention</dt><dd>MIM reception is disabled by default. If you want an application to be able to receive MIM messages, you must set the configuration option <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grpmulticastimmediatemessagingnetwork.html#mimaddresscontext">mim_address (context)</a> to the desired multicast group address.</dd></dl>
<p>A receiving context will receive the message and check to see if the application created a receiver for the topic. If so, then the message is delivered. However, if no receiver exists for that topic, the context checks to see if <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grpmulticastimmediatemessagingoperation.html#immediatemessagetopicreceiverfunctioncontext">immediate_message_topic_receiver_function (context)</a> is configured. If so, then the message is delivered. But if neither exists, then the receiving context discards the message.</p>
<p>It is also possible to send a "topicless" message via MIM. The recipient context must have configured a topicless receiver using <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grpmulticastimmediatemessagingoperation.html#immediatemessagereceiverfunctioncontext">immediate_message_receiver_function (context)</a>; otherwise the message is discarded.</p>
<p>A valid use case for MIM might be an application that starts running, sends a request message, gets back a response, and then exits. With this kind of short-lived application, it can be a burden to create a source and wait for it to resolve. With MIM, topic resolution is skipped, so no delay is needed prior to sending.</p>
<p>MIM is typically not used for normal Streaming data because messages are somewhat less efficiently handled than source-based messages. Inefficiencies derive from larger message sizes due to the inclusion of the topic name, and on the receiving side, the MIM Delivery Controller hashing of topic names to find receivers, which consumes some extra CPU. If you have a high-message-rate stream, you should use a source-based method and not MIM. If head-loss is a concern and delay before sending is not feasible, then consider using late join (although this replaces head-loss with some head latency).</p>
<p>Multicast Immediate Messaging can benefit from hardware acceleration. See <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grptransportacceleration.html">Transport Acceleration Options</a> for more information</p>
<dl class="section note"><dt>Note</dt><dd>MIM is not compatible with Queuing, including ULB.</dd></dl>
<p><br />
 </p>
<h2><a class="anchor" id="temporarytransportsession"></a>
Temporary Transport Session&nbsp;&nbsp;<small><a href="#temporarytransportsession">&lt;-</a></small></h2>
<p>MIM uses the same reliable multicast algorithms as LBT-RM. When a publisher sends a message with <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a24e5bff3a70e571bb12024af67b47cbb">lbm_multicast_immediate_message()</a>, MIM creates a temporary Transport Session. Note that no topic-level source object is created.</p>
<p>MIM automatically deletes the temporary Transport Session after a period of inactivity defined by <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grpmulticastimmediatemessagingoperation.html#mimsrcdeletiontimeoutcontext">mim_src_deletion_timeout (context)</a> which defaults to 30 seconds. A subsequent send creates a new Transport Session. Due to the possibility of head-loss in the switch, it is recommended that publisher use a long deletion timeout if they continue to use MIM after significant periods of inactivity.</p>
<p>MIM forces all topics across all publishers to be concentrated onto a single multicast address to which ALL applications listen, even if they aren't interested in any of the topics. Thus, all topic filtering must happen in UM.</p>
<p>MIM can also be used to send an UM request message with <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a54f3933e4dd154a9c7bb72598d0d9ef1">lbm_multicast_immediate_request()</a>. For example, an application can use MIM to request initialization information right when it starts up. MIM sends the response directly to the initializing application, avoiding the topic resolution delay inherent in the normal source-based <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#ad4d06f66b8404684e191ca178e0cc09b">lbm_send_request()</a> function.</p>
<p><br />
 </p>
<h2><a class="anchor" id="mimnotifications"></a>
MIM Notifications&nbsp;&nbsp;<small><a href="#mimnotifications">&lt;-</a></small></h2>
<p>MIM notifications differ in the following ways from normal UM source-based sending.</p>
<ul>
<li>
When a publisher's MIM Transport Session times out and is deleted, the receiving applications do not receive an EOS notification. </li>
<li>
Applications with a source notification callback (<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grpmajoroptions.html#resolversourcenotificationfunctioncontext">resolver_source_notification_function (context)</a>) are not informed of a MIM sender. This is because source notification is based on Topic Resolution, and MIM does not use it. </li>
<li>
MIM sending supports the non-blocking flag. However, it does not provide an <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#aa905cb268bbee255c71b74694370fe61">LBM_SRC_EVENT_WAKEUP</a> notification when the MIM session becomes writable again. </li>
<li>
MIM sends unrecoverable loss notifications to a context callback, not to a receiver callback. See <a class="el" href="umfeatures.html#mimlosshandling">MIM Loss Handling</a>. </li>
</ul>
<p><br />
 </p>
<h2><a class="anchor" id="receivingimmediatemessages"></a>
Receiving Immediate Messages&nbsp;&nbsp;<small><a href="#receivingimmediatemessages">&lt;-</a></small></h2>
<p>To receive MIM messages with a topic, an application simply creates a normal receiver for that topic. Alternatively, it can create a wildcard receiver for a matching topic pattern. Finally, the application can also register a callback specifically for UIM messages that contain a topic but for which no matching receiver exists, using <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grpmulticastimmediatemessagingoperation.html#immediatemessagetopicreceiverfunctioncontext">immediate_message_topic_receiver_function (context)</a>. Alternatively, <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#abdefbb3bd3ff3a3b2ec6e20ca2f5dc19">lbm_context_rcv_immediate_topic_msgs()</a> can be used.</p>
<p>To receive MIM messages with no topic (topicless), the application must register a callback for topicless messages, using <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grpmulticastimmediatemessagingoperation.html#immediatemessagereceiverfunctioncontext">immediate_message_receiver_function (context)</a>). Alternatively, <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a374f135dddf7794130509f97b1e96cf8">lbm_context_rcv_immediate_msgs()</a> can be used.</p>
<p>If needed, an application can send topicless messages using MIM. A MIM sender passes in a NULL string instead of a topic name. The message goes out on the MIM multicast address and is received by all other receivers. A receiving application can use <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a374f135dddf7794130509f97b1e96cf8">lbm_context_rcv_immediate_msgs()</a> to set the callback procedure and delivery method for topicless immediate messages.</p>
<p><br />
 </p>
<h2><a class="anchor" id="mimandwildcardreceivers"></a>
MIM and Wildcard Receivers&nbsp;&nbsp;<small><a href="#mimandwildcardreceivers">&lt;-</a></small></h2>
<p>When an application receives an immediate message, it's topic is hashed to see if there is at least one regular (non-wildcard) receiver object listening to the topic. If so, then MIM delivers the message data to the list of receivers.</p>
<p>However, if there are no regular receivers for that topic in the receive hash, MIM runs the message topic through all existing wildcard patterns and delivers matches to the appropriate wildcard receiver objects without creating sub-receivers. The next MIM message received for the same topic will again be run through all existing wildcard patterns. This can consume significant CPU resources since it is done on a per-message basis.</p>
<p><br />
 </p>
<h2><a class="anchor" id="mimlosshandling"></a>
MIM Loss Handling&nbsp;&nbsp;<small><a href="#mimlosshandling">&lt;-</a></small></h2>
<p>The receiving application can set up a context callback to be notified of MIM unrecoverable loss (<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a7129f39b95974676e0ca74d88f58c498">lbm_mim_unrecloss_function_cb()</a>). It is not possible to do this notification on a topic basis because the receiving UM has no way of knowing which topics were affected by the loss.</p>
<p><br />
 </p>
<h2><a class="anchor" id="mimconfiguration"></a>
MIM Configuration&nbsp;&nbsp;<small><a href="#mimconfiguration">&lt;-</a></small></h2>
<ul>
<li>
As of UM 3.1, MIM supports ordered delivery. </li>
<li>
As of UM 3.3.2, the MIM configuration option, <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grpmulticastimmediatemessagingoperation.html#mimordereddeliverycontext">mim_ordered_delivery (context)</a> defaults to ordered delivery. </li>
<li>
<b>IMPORTANT:</b> As of UM 6.8, MIM reception is disabled by default. If you want an application to be able to receive MIM messages, you must set the configuration option <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grpmulticastimmediatemessagingnetwork.html#mimaddresscontext">mim_address (context)</a> to the desired multicast group address. </li>
</ul>
<p>The configuration options for MIM are described here:</p>
<ul>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grpmulticastimmediatemessagingnetwork.html">Multicast Immediate Messaging Network Options</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grpmulticastimmediatemessagingreliability.html">Multicast Immediate Messaging Reliability Options</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grpmulticastimmediatemessagingoperation.html">Multicast Immediate Messaging Operation Options</a> </li>
</ul>
<p><br />
 </p>
<h2><a class="anchor" id="mimexampleapplications"></a>
MIM Example Applications&nbsp;&nbsp;<small><a href="#mimexampleapplications">&lt;-</a></small></h2>
<p>UM includes two example applications that illustrate MIM.</p>
<ul>
<li>
<p class="startli"><a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/example.tag:../example/" href="../example/index.html#examplelbmimsg_c">Example lbmimsg.c</a> - application that sends immediate messages as fast as it can to a given topic (single source). See also the Java example, <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/java_example.tag:../java_example/" href="../java_example/index.html#examplelbmimsg_java">Example lbmimsg.java</a>, and the .NET example, <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/dotnet_example.tag:../dotnet_example/" href="../dotnet_example/index.html#examplelbmimsg_cs">Example lbmimsg.cs</a>.</p>
<p class="endli"></p>
</li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/example.tag:../example/" href="../example/index.html#examplelbmireq_c">Example lbmireq.c</a> - application that sends immediate requests to a given topic (single source) and waits for responses. </li>
</ul>
<p><br />
 </p>
<h1><a class="anchor" id="hypertopics"></a>
HyperTopics&nbsp;&nbsp;<small><a href="#hypertopics">&lt;-</a></small></h1>
<dl class="section warning"><dt>Warning</dt><dd><b>The HyperTopics feature is deprecated and may be removed in a future release</b>. Users should use normal wildcard receivers with "PCRE" regular expression pattern matching. See <a class="el" href="umobjects.html#umwildcardreceivers">UM Wildcard Receivers</a>.</dd></dl>
<p>For information regarding HyperTopics, see <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/chypertopicsdetails.html">C HyperTopics Details</a>.</p>
<p><br />
 </p>
<h1><a class="anchor" id="applicationheaders"></a>
Application Headers&nbsp;&nbsp;<small><a href="#applicationheaders">&lt;-</a></small></h1>
<p>The Application Headers feature is an older method of adding untyped, unstructured metadata to messages.</p>
<dl class="section warning"><dt>Warning</dt><dd>The Application Headers feature is deprecated and may be removed in a future version. Informatica recommends using <a class="el" href="umfeatures.html#messageproperties">Message Properties</a>.</dd></dl>
<p><br />
 </p>
<h2><a class="anchor" id="applicationheadersusage"></a>
Application Headers Usage&nbsp;&nbsp;<small><a href="#applicationheadersusage">&lt;-</a></small></h2>
<p><b>Send Message with Application Headers</b></p>
<p>To send a message with one or more application headers attached, follow these steps: </p><ol>
<li>
<p class="startli">Create an application header chain object using <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a40a3fe706dc6cf4a6bd23ebe721ce636">lbm_apphdr_chain_create()</a>.</p>
<div class="fragment"><div class="line"><a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a8b5f5e773cf27c0b55f7685c3b8c223f">lbm_apphdr_chain_t</a> *chain_obj;</div><div class="line">...</div><div class="line">err = <a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a40a3fe706dc6cf4a6bd23ebe721ce636">lbm_apphdr_chain_create</a>(&amp;chain_obj);</div></div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">Declare a chain element structure <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a5ea92c8be5a30771d27a5c5ba7ba9cd3">lbm_apphdr_chain_elem_t</a>.</p>
<div class="fragment"><div class="line"><a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/structlbm__apphdr__chain__elem__t__stct.html">lbm_apphdr_chain_elem_t</a> chain_el;</div></div><!-- fragment --><p class="endli"></p>
</li>
<li>
Set <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/structlbm__apphdr__chain__elem__t__stct.html#adc95068fade7a25378777e4fed6d2c00">lbm_apphdr_chain_elem_t_stct::type</a> to LBM_CHAIN_ELEM_USER_DATA. </li>
<li>
Set <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/structlbm__apphdr__chain__elem__t__stct.html#a1bac3b4b4c8736d83037489b39fd6a26">lbm_apphdr_chain_elem_t_stct::subtype</a> to a desired integer. </li>
<li>
Set <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/structlbm__apphdr__chain__elem__t__stct.html#a819089b2849cb394d8e3e16a03bcf83d">lbm_apphdr_chain_elem_t_stct::data</a> to point to the desired bytes of data. </li>
<li>
<p class="startli">Set <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/structlbm__apphdr__chain__elem__t__stct.html#ae10daab41bc205bb5c596f8479e0b3c4">lbm_apphdr_chain_elem_t_stct::len</a> to the number of bytes of data.</p>
<div class="fragment"><div class="line">chain_el.<a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/structlbm__apphdr__chain__elem__t__stct.html#adc95068fade7a25378777e4fed6d2c00">type</a> = <a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a37233effa75b0b79c0ad518010a96646">LBM_CHAIN_ELEM_USER_DATA</a>;</div><div class="line">chain_el.<a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/structlbm__apphdr__chain__elem__t__stct.html#a1bac3b4b4c8736d83037489b39fd6a26">subtype</a> = MY_SUBTYPE;</div><div class="line">chain_el.<a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/structlbm__apphdr__chain__elem__t__stct.html#a819089b2849cb394d8e3e16a03bcf83d">data</a> = <span class="stringliteral">&quot;abc&quot;</span>;</div><div class="line">chain_el.<a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/structlbm__apphdr__chain__elem__t__stct.html#ae10daab41bc205bb5c596f8479e0b3c4">len</a> = 4;</div></div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">Declare an extended send information structure <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a21504de56612c7c6e4be655402b47a37">lbm_src_send_ex_info_t</a>.</p>
<div class="fragment"><div class="line"><a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/structlbm__src__send__ex__info__t__stct.html">lbm_src_send_ex_info_t</a> ex_info;</div></div><!-- fragment --><p class="endli"></p>
</li>
<li>
Set the <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a71368905028cc0d6480c239a0228b49c">LBM_SRC_SEND_EX_FLAG_APPHDR_CHAIN</a> bit in the <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/structlbm__src__send__ex__info__t__stct.html#aa450a079510ebdc97b19625d10bd18ea">lbm_src_send_ex_info_t_stct::flags</a> field. </li>
<li>
<p class="startli">Set the <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/structlbm__src__send__ex__info__t__stct.html#ab5d177886b035d3cbbb730c522bee207">lbm_src_send_ex_info_t_stct::apphdr_chain</a> field with the application header chain object created in step 1.</p>
<div class="fragment"><div class="line">memset(&amp;ex_info, 0, <span class="keyword">sizeof</span>(ex_info));</div><div class="line">ex_info.<a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/structlbm__src__send__ex__info__t__stct.html#aa450a079510ebdc97b19625d10bd18ea">flags</a> = <a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a71368905028cc0d6480c239a0228b49c">LBM_SRC_SEND_EX_FLAG_APPHDR_CHAIN</a>;</div><div class="line">ex_info.<a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/structlbm__src__send__ex__info__t__stct.html#ab5d177886b035d3cbbb730c522bee207">apphdr_chain</a> = chain_obj;</div></div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">Call <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a091b5806bf18d10ebd0d9117e0c70229">lbm_src_send_ex()</a> passing the extended send information structure.</p>
<div class="fragment"><div class="line">err = <a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a091b5806bf18d10ebd0d9117e0c70229">lbm_src_send_ex</a>(src, my_buffer, my_len, LBM_MSG_FLUSH, &amp;ex_info)</div></div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">Delete the application header chain object using <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a4f468c363d3d1735507be95fe4638d09">lbm_apphdr_chain_delete()</a>.</p>
<div class="fragment"><div class="line">err = <a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a4f468c363d3d1735507be95fe4638d09">lbm_apphdr_chain_delete</a>(chain_obj);</div></div><!-- fragment --> </li>
</ol>
<p>Instead of creating and deleting the application header chain with each message, it may be retained and re-used. However, it may not be modified.</p>
<p><b>Receive Message with Application Headers</b></p>
<p>To handle a received message that may contain application headers, follow these steps:</p>
<ol>
<li>
<p class="startli">In the receiver callback, create an application header iterator using <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a316dcfdb28460ee670cc6399d6d94b9f">lbm_apphdr_chain_iter_create_from_msg()</a>. If it returns LBM_FAILURE then the message has no application headers.</p>
<div class="fragment"><div class="line"><a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a73c7309003ea3c7588b7997e325b35f4">lbm_apphdr_chain_iter_t</a> *apphdr_itr;</div><div class="line">...</div><div class="line">err = <a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a316dcfdb28460ee670cc6399d6d94b9f">lbm_apphdr_chain_iter_create_from_msg</a>(&amp;apphdr_itr, msg);</div><div class="line"><span class="keywordflow">if</span> (err == LBM_OK) {  <span class="comment">/* App header exists. */</span></div></div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">If <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a316dcfdb28460ee670cc6399d6d94b9f">lbm_apphdr_chain_iter_create_from_msg()</a> returns LBM_OK, declare a chain element structure <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a5ea92c8be5a30771d27a5c5ba7ba9cd3">lbm_apphdr_chain_elem_t</a> pointer and set it using <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#adb432d65e72c04a7d5866bed9961e673">lbm_apphdr_chain_iter_current()</a>.</p>
<div class="fragment"><div class="line"><span class="keywordflow">do</span> {  <span class="comment">/* Loop through each app header. */</span></div><div class="line">  <a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/structlbm__apphdr__chain__elem__t__stct.html">lbm_apphdr_chain_elem_t</a> *chain_el;</div><div class="line">  chain_el = <a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#adb432d65e72c04a7d5866bed9961e673">lbm_apphdr_chain_iter_current</a>(&amp;apphdr_itr);</div></div><!-- fragment --><p class="endli"></p>
</li>
<li>
Access the chain element subtype through the chain element structure using <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/structlbm__apphdr__chain__elem__t__stct.html#a1bac3b4b4c8736d83037489b39fd6a26">lbm_apphdr_chain_elem_t_stct::subtype</a>. </li>
<li>
Access the chain element length through the chain element structure using <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/structlbm__apphdr__chain__elem__t__stct.html#ae10daab41bc205bb5c596f8479e0b3c4">lbm_apphdr_chain_elem_t_stct::len</a>. </li>
<li>
<p class="startli">Access the chain element data through the chain element structure using <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/structlbm__apphdr__chain__elem__t__stct.html#a819089b2849cb394d8e3e16a03bcf83d">lbm_apphdr_chain_elem_t_stct::data</a>.</p>
<div class="fragment"><div class="line">printf(<span class="stringliteral">&quot;  chain_el.type=%d, chain_el.len=%lu, chain_el.data=&#39;%s&#39;\n&quot;</span>,</div><div class="line">       chain_el-&gt;<a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/structlbm__apphdr__chain__elem__t__stct.html#adc95068fade7a25378777e4fed6d2c00">type</a>, chain_el-&gt;<a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/structlbm__apphdr__chain__elem__t__stct.html#ae10daab41bc205bb5c596f8479e0b3c4">len</a>, (<span class="keywordtype">char</span> *)chain_el-&gt;<a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/structlbm__apphdr__chain__elem__t__stct.html#a819089b2849cb394d8e3e16a03bcf83d">data</a>);</div></div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">To step to the next application header (if any), call <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a6729d5b35c12874bc82be08ce708339a">lbm_apphdr_chain_iter_next()</a>. This function returns LBM_OK if there is another application header; go to step 3.</p>
<div class="fragment"><div class="line">  err = <a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a6729d5b35c12874bc82be08ce708339a">lbm_apphdr_chain_iter_next</a>(&amp;apphdr_itr);</div><div class="line"><span class="keywordflow">while</span> (err == LBM_OK);</div></div><!-- fragment --><p class="endli"></p>
</li>
<li>
If there are no more application headers, it returns LBM_FAILURE. </li>
<li>
<p class="startli">Delete the iterator using <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a2fe460bfd35bf3d9f492dae02a08e77c">lbm_apphdr_chain_iter_delete()</a>.</p>
<div class="fragment"><div class="line">err = <a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a2fe460bfd35bf3d9f492dae02a08e77c">lbm_apphdr_chain_iter_delete</a>(apphdr_itr);</div></div><!-- fragment --> </li>
</ol>
<p>Application Headers are not compatible with the following UM features: </p><ul>
<li>
<a class="el" href="advancedoptimizations.html#smartsources">Smart Sources</a>. </li>
<li>
<a class="el" href="fundamentalconcepts.html#requestresponse">Request/Response</a> </li>
<li>
<a class="el" href="umfeatures.html#unicastimmediatemessaging">Unicast Immediate Messaging</a> </li>
<li>
<a class="el" href="umfeatures.html#multicastimmediatemessaging">Multicast Immediate Messaging</a> </li>
</ul>
<p>Note that the user data provided for the application header is not typed. UM cannot reformat messages for architectural differences in a heterogeneous environment. For example, UM does not do byte-swapping between big and little endian CPUs.</p>
<p><br />
 </p>
<h1><a class="anchor" id="messageproperties"></a>
Message Properties&nbsp;&nbsp;<small><a href="#messageproperties">&lt;-</a></small></h1>
<p>The Message Properties feature allows your application to add typed metadata to messages as name/value pairs. UM allows eight property types: boolean, byte, short, int, long, float, double, and string. See <a class="el" href="umfeatures.html#messagepropertiesdatatypes">Message Properties Data Types</a>.</p>
<p>With the UMQ product, the UM message property object supports the standard JMS message properties specification.</p>
<p><b>Message properties are not compatible with the following UM features:</b> </p><ul>
<li>
<a class="el" href="architecture.html#arrivalorderfragmentsnotreassembled">Arrival Order, Fragments Not Reassembled</a> (ordered_delivery 0). </li>
<li>
<a class="el" href="transporttypes.html#transportlbtsmx">Transport LBT-SMX</a>. </li>
</ul>
<p><br />
 </p>
<h2><a class="anchor" id="messagepropertiesusage"></a>
Message Properties Usage&nbsp;&nbsp;<small><a href="#messagepropertiesusage">&lt;-</a></small></h2>
<p><b>Send Message with Message Properties</b></p>
<p>For sending messages with message properties using Smart Sources, see <a class="el" href="umfeatures.html#smartsourcesandmessageproperties">Smart Sources and Message Properties</a>.</p>
<p>To send a message with one or more message properties attached using normal sources (i.e. not Smart Sources), follow these steps:</p>
<ol>
<li>
<p class="startli">Create a message properties object using <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#abda1a4224f1c3e94b10b74051be3dd53">lbm_msg_properties_create()</a>.</p>
<div class="fragment"><div class="line"><a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a9155c3d6d70b67c426089d53b3eacaac">lbm_msg_properties_t</a> *prop_obj;</div><div class="line">...</div><div class="line">err = <a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#abda1a4224f1c3e94b10b74051be3dd53">lbm_msg_properties_create</a>(&amp;prop_obj);</div></div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">Add one or more properties using <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#acec18484fc06996fe3b61e76a593d5fb">lbm_msg_properties_set()</a>.</p>
<div class="fragment"><div class="line"><a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a5dfd61ade99cd24213125c293b15ef4a">lbm_uint32_t</a> int_prop_val = MY_VAL;</div><div class="line">...</div><div class="line">err = <a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#acec18484fc06996fe3b61e76a593d5fb">lbm_msg_properties_set</a>(prop_obj, <span class="stringliteral">&quot;My Prop 1&quot;</span>, &amp;int_prop_val,</div><div class="line">                             LBM_MSG_PROPERTY_INT, <span class="keyword">sizeof</span>(int_prop_val));</div></div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">Declare an extended send information structure <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a21504de56612c7c6e4be655402b47a37">lbm_src_send_ex_info_t</a>.</p>
<div class="fragment"><div class="line"><a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/structlbm__src__send__ex__info__t__stct.html">lbm_src_send_ex_info_t</a> ex_info;</div></div><!-- fragment --><p class="endli"></p>
</li>
<li>
Set the <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a169eb19b58d383875b718117b2def6e5">LBM_SRC_SEND_EX_FLAG_PROPERTIES</a> bit in the <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/structlbm__src__send__ex__info__t__stct.html#aa450a079510ebdc97b19625d10bd18ea">lbm_src_send_ex_info_t_stct::flags</a> field. </li>
<li>
<p class="startli">Set the <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/structlbm__src__send__ex__info__t__stct.html#a69ae228b9501f0466bfec8da2a479cbf">lbm_src_send_ex_info_t_stct::properties</a> field with the properties object created in step 1.</p>
<div class="fragment"><div class="line">memset(&amp;ex_info, 0, <span class="keyword">sizeof</span>(ex_info));</div><div class="line">ex_info.<a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/structlbm__src__send__ex__info__t__stct.html#aa450a079510ebdc97b19625d10bd18ea">flags</a> = <a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a169eb19b58d383875b718117b2def6e5">LBM_SRC_SEND_EX_FLAG_PROPERTIES</a>;</div><div class="line">ex_info.<a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/structlbm__src__send__ex__info__t__stct.html#a69ae228b9501f0466bfec8da2a479cbf">properties</a> = prop_obj;</div></div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">Call <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a091b5806bf18d10ebd0d9117e0c70229">lbm_src_send_ex()</a> passing the extended send information structure.</p>
<div class="fragment"><div class="line">err = <a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a091b5806bf18d10ebd0d9117e0c70229">lbm_src_send_ex</a>(src, my_buffer, my_len, LBM_MSG_FLUSH, &amp;ex_info);</div></div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">Delete the message properties object using <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a80152f12d64394821a61287e99c5db33">lbm_msg_properties_delete()</a>.</p>
<div class="fragment"><div class="line">err = <a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a80152f12d64394821a61287e99c5db33">lbm_msg_properties_delete</a>(prop_obj);</div></div><!-- fragment --> </li>
</ol>
<p>Instead of creating and deleting the properties object with each message, it may be retained and re-used. It can also be modified using <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#aaea0bf981a9fe47287db442026ca13ca">lbm_msg_properties_clear()</a> and <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#acec18484fc06996fe3b61e76a593d5fb">lbm_msg_properties_set()</a>.</p>
<p><b>Receive Message with Message Properties</b></p>
<p>To handle a received message that may contain message properties, follow these steps:</p>
<ol>
<li>
<p class="startli">In the receiver callback, check the message's properties field <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/structlbm__msg__t__stct.html#ae494fd38e1139a128d58616fa9d2e439">lbm_msg_t_stct::properties</a>. If it is NULL, the message has no properties.</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (msg-&gt;properties != NULL) {</div><div class="line">  <span class="comment">/* Handle message properties. */</span></div></div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">If <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/structlbm__msg__t__stct.html#ae494fd38e1139a128d58616fa9d2e439">lbm_msg_t_stct::properties</a> is non-null, create a property iterator object using <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#aa08b2aa8f00b1b97c6d496834a4432dd">lbm_msg_properties_iter_create()</a>.</p>
<div class="fragment"><div class="line"><a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/structlbm__msg__properties__iter__t__stct.html">lbm_msg_properties_iter_t</a> *prop_itr;</div><div class="line">...</div><div class="line">err = <a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#aa08b2aa8f00b1b97c6d496834a4432dd">lbm_msg_properties_iter_create</a>(&amp;prop_itr);</div></div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">Set the iterator to the first property in the message using <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#acfa02c8316e97baeb9894daa991ef1fb">lbm_msg_properties_iter_first()</a>.</p>
<div class="fragment"><div class="line">err = <a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#acfa02c8316e97baeb9894daa991ef1fb">lbm_msg_properties_iter_first</a>(prop_itr, msg-&gt;properties);</div><div class="line"><span class="keywordflow">do</span> {  <span class="comment">/* Loop through the properties. */</span></div></div><!-- fragment --><p class="endli"></p>
</li>
<li>
Access that property's name through the iterator using <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/structlbm__msg__properties__iter__t__stct.html#ab65ef874c567498e4b7c574d25fb6b64">lbm_msg_properties_iter_t_stct::name</a>. </li>
<li>
Access that property's type through the iterator using <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/structlbm__msg__properties__iter__t__stct.html#a0b96a99d0c7a3ffe64a8607f9497abb8">lbm_msg_properties_iter_t_stct::type</a>. </li>
<li>
<p class="startli">Access that property's value through the iterator using <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/structlbm__msg__properties__iter__t__stct.html#ab69a16304cbd0e23b3da0bb7c5312b97">lbm_msg_properties_iter_t_stct::data</a> (must be cast to the appropriate data type).</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (prop_itr-&gt;<a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/structlbm__msg__properties__iter__t__stct.html#a0b96a99d0c7a3ffe64a8607f9497abb8">type</a> == LBM_MSG_PROPERTY_INT) {</div><div class="line">  printf(<span class="stringliteral">&quot;  prop_itr.data=%d\n&quot;</span>, *((<a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a5dfd61ade99cd24213125c293b15ef4a">lbm_uint32_t</a> *)(prop_itr-&gt;<a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/structlbm__msg__properties__iter__t__stct.html#ab69a16304cbd0e23b3da0bb7c5312b97">data</a>)));</div></div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">To step to the next property (if any), call <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a2876985a82c92ade238b8196a1ec3da7">lbm_msg_properties_iter_next()</a>. This function returns LBM_OK if there is another property; go to step 4. If there are no more properties, it returns LBM_FAILURE.</p>
<div class="fragment"><div class="line">  err = <a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a2876985a82c92ade238b8196a1ec3da7">lbm_msg_properties_iter_next</a>(prop_itr);</div><div class="line">} <span class="keywordflow">while</span> (err == LBM_OK);</div></div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">Delete the iterator using <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a79db125bc40762da0b462c70f9e8c4b4">lbm_msg_properties_iter_delete()</a>.</p>
<div class="fragment"><div class="line">err = <a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a79db125bc40762da0b462c70f9e8c4b4">lbm_msg_properties_iter_delete</a>(prop_itr);</div></div><!-- fragment --> </li>
</ol>
<p>Instead of iterating through the properties, it is also possible to access properties by name using <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#aac0dc50537a458d2a2ca418a394fd21b">lbm_msg_properties_get()</a>. However, this can be less efficient.</p>
<p>For a C example on how to iterate received message properties, see <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/example.tag:../example/" href="../example/index.html#examplelbmrcv_c">Example lbmrcv.c</a>.</p>
<p>Note that if a publisher sends a message with no properties set, best practice is to not pass the property object to the send function. It is permissible to pass a property object with no properties set, but it adds latency and overhead. Also, it causes the receiver to get a non-null msg-&gt;properties field. When the receiver calls <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#acfa02c8316e97baeb9894daa991ef1fb">lbm_msg_properties_iter_first()</a>, it will return an error because there isn't a "first" property. It is better for the publisher to not pass an empty properties object so that the receiver will get a NULL msg-&gt;properties field.</p>
<p><br />
 </p>
<h2><a class="anchor" id="messagepropertiesdatatypes"></a>
Message Properties Data Types&nbsp;&nbsp;<small><a href="#messagepropertiesdatatypes">&lt;-</a></small></h2>
<p>Due to differences in the integer variable sizes on different compilers on different platforms, Informatica recommends using the following C data types for the corresponding message property data types:</p>
<table class="doxtable">
<tr>
<th>Property Type </th><th>C Type </th></tr>
<tr>
<td><a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#ade4e8a8380aead4cecd99d34074febd2">LBM_MSG_PROPERTY_BOOLEAN</a> </td><td>char </td></tr>
<tr>
<td><a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a3bc28e91b1571e511d7bf5f8c101cc43">LBM_MSG_PROPERTY_BYTE</a> </td><td>char </td></tr>
<tr>
<td><a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#acac3a9e4b1dc7d3d9f1d42acabbcd514">LBM_MSG_PROPERTY_SHORT</a> </td><td><a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a86897f2fdd66aa7021683a4e72a4537b">lbm_uint16_t</a> </td></tr>
<tr>
<td><a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a77a1d3090e2e8e1dce799ae56859ce47">LBM_MSG_PROPERTY_INT</a> </td><td><a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a9b7c2c2a29915efc7ead2ff7f58f6f59">lbm_int32_t</a> </td></tr>
<tr>
<td><a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#aac5202e17486cd42934756b8be785ad4">LBM_MSG_PROPERTY_LONG</a> </td><td><a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#ac80aef6c36b7e5ae0984d81ab4af062a">lbm_int64_t</a> </td></tr>
<tr>
<td><a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a179ee6d46f98f273b358bba2bdfba75c">LBM_MSG_PROPERTY_FLOAT</a> </td><td>float </td></tr>
<tr>
<td><a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a4bbd5d39680d349384d4e80079d602b2">LBM_MSG_PROPERTY_DOUBLE</a> </td><td>double </td></tr>
<tr>
<td><a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#abd04d3a94da9cc86cf2886b3f0849bb7">LBM_MSG_PROPERTY_STRING</a> </td><td>char array </td></tr>
</table>
<p><br />
 </p>
<h2><a class="anchor" id="messagepropertiesperformanceconsiderations"></a>
Message Properties Performance Considerations&nbsp;&nbsp;<small><a href="#messagepropertiesperformanceconsiderations">&lt;-</a></small></h2>
<p>Ultra Messaging sends property names on the wire with every message. To reduce bandwidth requirements, minimize the length and number of properties. When coding sources, consider the following sequence of guidelines:</p>
<ol>
<li>
Allocate a data structure to store message properties objects. This can be a thread-local structure if you use a relatively small number of threads, or a thread-safe pool of objects. </li>
<li>
Before sending, retrieve a message properties object from the pool. If an object is not available, create a new object. </li>
<li>
Set properties for the message. </li>
<li>
Send the message using the appropriate API call, passing in the properties object. </li>
<li>
After the send completes, clear the message properties object and return it to the pool. </li>
</ol>
<p>When coding receivers in Java or .NET, call Dispose() on messages before returning from the application callback. This allows Ultra Messaging to internally recycle objects, and limits object allocation.</p>
<p><br />
 </p>
<h2><a class="anchor" id="smartsourcesandmessageproperties"></a>
Smart Sources and Message Properties&nbsp;&nbsp;<small><a href="#smartsourcesandmessageproperties">&lt;-</a></small></h2>
<p><a class="el" href="advancedoptimizations.html#smartsources">Smart Sources</a> support a limited form of message properties. Only 32-bit integer property types are allowed with Smart Sources. Also, property names are limited to 7 ASCII characters. Finally, the normal message properties object <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a9155c3d6d70b67c426089d53b3eacaac">lbm_msg_properties_t</a> and its APIs <em>are not used</em> on the sending side. Rather a streamlined method of specifying message properties for sending is used.</p>
<p>As with most of Smart Source's internal design, the message header for message properties must be pre-allocated with the maximum number of desired message properties. This is done at creation time for the Smart Source using the configuration option <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grpsmartsource.html#smartsrcmessagepropertyintcountsource">smart_src_message_property_int_count (source)</a>.</p>
<p>Sending messages with message properties must be done using the <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a2f50f56536778332e9f5712b06546425">lbm_ssrc_send_ex()</a> API, passing it the desired properties with the <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a33886eeac2e67170effea009d2dc3a35">lbm_ssrc_send_ex_info_t</a> structure. The first call to send with message properties will serialize the supplied properties and encode them into the pre-allocated message header.</p>
<p>Subsequent calls to send with message properties will ignore the passed-in properties and simply re-send the previously-serialized header.</p>
<p>If an application needs to change the message property values after that initial send, the "update" flag flag can be used, which will trigger modification of the property values. This "update" flag cannot be used to change the number of properties, or the key names of the properties.</p>
<p>If an application needs messages with different numbers of properties and/or different key names of properties, the most efficient way to accomplish this is with multiple message buffers. Each buffer should be associated with a desired set of properties. When a message needs to be sent, the proper buffer is selected for building the message. This avoid the overhead of serializing the properties with each send call.</p>
<p>However, if the application requires dynamic construction of properties, a single buffer can be used along with the "rebuild" flag to trigger a full serialization of the properties.</p>
<dl class="section note"><dt>Note</dt><dd>If using both message properties and <a class="el" href="umfeatures.html#spectrum">Spectrum</a> with a single Smart Source, there is an added restriction: it is not possible to send a message omitting only one of those features. I.e. if both are enabled when the Smart Source is created, it is not possible to send a message with a message property and not a channel, and it is not possible to send a message with a channel and not a property. This is because the message header is defined at Smart Source creation, and the header either must contain both or neither.</dd></dl>
<p><br />
 </p>
<h2><a class="anchor" id="smartsourcemessagepropertiesusage"></a>
Smart Source Message Properties Usage&nbsp;&nbsp;<small><a href="#smartsourcemessagepropertiesusage">&lt;-</a></small></h2>
<p>For a full example of message property usage with Smart Source, see <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/example.tag:../example/" href="../example/index.html#examplelbmssrc_c">Example lbmssrc.c</a> or <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/java_example.tag:../java_example/" href="../java_example/index.html#examplelbmssrc_java">Example lbmssrc.java</a>.</p>
<p>The first message with a message property sent to a Smart Source follows a specific sequence:</p>
<ol>
<li>
<p class="startli">Create the topic object with the configuration option <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grpsmartsource.html#smartsrcmessagepropertyintcountsource">smart_src_message_property_int_count (source)</a> set to the maximum number of properties desired on a message.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">Create the Smart Source with <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a9a8d169a8c2a90b8442d4eb3e3711c9c">lbm_ssrc_create()</a>.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">Allocate one or more message buffers with <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a98c5450e9fb93f30bd80fa33a2380dfc">lbm_ssrc_buff_get()</a>. You might allocate one for messages that have properties, and another for messages that don't.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">When preparing the first message with message properties to be sent, define the properties using a <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a33886eeac2e67170effea009d2dc3a35">lbm_ssrc_send_ex_info_t</a> structure: </p><div class="fragment"><div class="line"><span class="keywordtype">char</span> *prop_name_array[3]; <span class="comment">/* Array of property names. */</span></div><div class="line">prop_name_array[0] = <span class="stringliteral">&quot;abc&quot;</span>; <span class="comment">/* 7 ascii characters or less. */</span></div><div class="line">prop_name_array[1] = <span class="stringliteral">&quot;XYZ&quot;</span>;</div><div class="line">prop_name_array[2] = <span class="stringliteral">&quot;123&quot;</span>;</div><div class="line"></div><div class="line"><a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a9b7c2c2a29915efc7ead2ff7f58f6f59">lbm_int32_t</a> prop_value_array[3]; <span class="comment">/* Array of property values. */</span></div><div class="line">prop_value_array[0] = 29;</div><div class="line">prop_value_array[1] = -300;</div><div class="line">prop_value_array[2] = 0;</div><div class="line"></div><div class="line"><a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/structlbm__ssrc__send__ex__info__t__stct.html">lbm_ssrc_send_ex_info_t</a> ss_send_info;</div><div class="line">memset((<span class="keywordtype">char</span> *)&amp;ss_send_info, 0, <span class="keyword">sizeof</span>(ss_send_info));</div><div class="line">ss_send_info.<a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/structlbm__ssrc__send__ex__info__t__stct.html#a26e6f73e26bd532ad9ea5c6ceb18c943">mprop_int_cnt</a> = 3;</div><div class="line">ss_send_info.<a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/structlbm__ssrc__send__ex__info__t__stct.html#ad8ba521d9bfb2125401f7106b34055ad">mprop_int_keys</a> = prop_name_array;</div><div class="line">ss_send_info.<a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/structlbm__ssrc__send__ex__info__t__stct.html#ac81546a02860998dd8d751a01edb3b42">mprop_int_vals</a> = prop_value_array;</div></div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">Send the message using <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a2f50f56536778332e9f5712b06546425">lbm_ssrc_send_ex()</a> and the <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#af00465b8e9c560959351ec92f62a190e">LBM_SSRC_SEND_EX_FLAG_PROPERTIES</a> flag: </p><div class="fragment"><div class="line">ss_send_info.<a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/structlbm__ssrc__send__ex__info__t__stct.html#a20b6feb8a3737d2ad4330c64552ba18c">flags</a> = <a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#af00465b8e9c560959351ec92f62a190e">LBM_SSRC_SEND_EX_FLAG_PROPERTIES</a>;</div><div class="line">err = <a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a2f50f56536778332e9f5712b06546425">lbm_ssrc_send_ex</a>(ss, msg_buff, msg_size, 0, &amp;ss_send_info);</div></div><!-- fragment --><p class="endli">Since this is the first send with message properties, UM will serialize the properties and set up the message header. (It is not valid to set the <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a40748fccf40f69c2029d68c16f923704">LBM_SSRC_SEND_EX_FLAG_UPDATE_PROPERTY_VALUES</a> flag on this first send with message properties.) </p>
</li>
</ol>
<p>For subsequent sends, there are different use cases: </p><ul>
<li>
<p class="startli">Send the message with the same properties and values. You can re-use the same message buffer and <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a33886eeac2e67170effea009d2dc3a35">lbm_ssrc_send_ex_info_t</a> structure: </p><div class="fragment"><div class="line"><span class="comment">/* The ss_send_info.flags still has LBM_SSRC_SEND_EX_FLAG_PROPERTIES set */</span></div><div class="line">err = <a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a2f50f56536778332e9f5712b06546425">lbm_ssrc_send_ex</a>(ss, msg_buff, msg_size, 0, &amp;ss_send_info);</div></div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">Send with message properties after having made changes to the property values (but not the keys or the number of properties) by setting the <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a40748fccf40f69c2029d68c16f923704">LBM_SSRC_SEND_EX_FLAG_UPDATE_PROPERTY_VALUES</a> flag: </p><div class="fragment"><div class="line">prop_value_array[0] = 28;  <span class="comment">/* Change property value. */</span></div><div class="line">ss_send_info.<a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/structlbm__ssrc__send__ex__info__t__stct.html#a20b6feb8a3737d2ad4330c64552ba18c">flags</a> |= <a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a40748fccf40f69c2029d68c16f923704">LBM_SSRC_SEND_EX_FLAG_UPDATE_PROPERTY_VALUES</a>;</div><div class="line">err = <a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a2f50f56536778332e9f5712b06546425">lbm_ssrc_send_ex</a>(ss, msg_buff, msg_size, 0, &amp;ss_send_info);</div><div class="line">ss_send_info.<a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/structlbm__ssrc__send__ex__info__t__stct.html#a20b6feb8a3737d2ad4330c64552ba18c">flags</a> &amp;= ~<a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a40748fccf40f69c2029d68c16f923704">LBM_SSRC_SEND_EX_FLAG_UPDATE_PROPERTY_VALUES</a>;</div></div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">Send a message with either a different number of properties, and/or different key names by setting the <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a8e81e2661e6d2845790041d170864b1e">LBM_SSRC_SEND_EX_FLAG_REBUILD_BUFFER</a> flag: </p><div class="fragment"><div class="line"><span class="comment">/* Send with only the first 2 properties. */</span></div><div class="line">ss_send_info.<a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/structlbm__ssrc__send__ex__info__t__stct.html#a26e6f73e26bd532ad9ea5c6ceb18c943">mprop_int_cnt</a> = 2;</div><div class="line">ss_send_info.<a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/structlbm__ssrc__send__ex__info__t__stct.html#a20b6feb8a3737d2ad4330c64552ba18c">flags</a> |= <a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a8e81e2661e6d2845790041d170864b1e">LBM_SSRC_SEND_EX_FLAG_REBUILD_BUFFER</a>;</div><div class="line">err = <a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a2f50f56536778332e9f5712b06546425">lbm_ssrc_send_ex</a>(ss, msg_buff, msg_size, 0, &amp;ss_send_info);</div><div class="line">ss_send_info.<a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/structlbm__ssrc__send__ex__info__t__stct.html#a20b6feb8a3737d2ad4330c64552ba18c">flags</a> &amp;= ~ LBM_SSRC_SEND_EX_FLAG_REBUILD_BUFFER;</div></div><!-- fragment --><p class="endli"></p>
</li>
<li>
Send a message without any message properties. This is a subset of the previous case (changing the number of properties). Use the <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a8e81e2661e6d2845790041d170864b1e">LBM_SSRC_SEND_EX_FLAG_REBUILD_BUFFER</a> flag and clear the <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#af00465b8e9c560959351ec92f62a190e">LBM_SSRC_SEND_EX_FLAG_PROPERTIES</a> flag: <div class="fragment"><div class="line"><span class="comment">/* Clear the properties flag so no properties will be sent. */</span></div><div class="line">ss_send_info.<a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/structlbm__ssrc__send__ex__info__t__stct.html#a20b6feb8a3737d2ad4330c64552ba18c">flags</a> &amp;= ~ LBM_SSRC_SEND_EX_FLAG_PROPERTIES;</div><div class="line">ss_send_info.<a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/structlbm__ssrc__send__ex__info__t__stct.html#a20b6feb8a3737d2ad4330c64552ba18c">flags</a> |= <a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a8e81e2661e6d2845790041d170864b1e">LBM_SSRC_SEND_EX_FLAG_REBUILD_BUFFER</a>;</div><div class="line">err = <a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a2f50f56536778332e9f5712b06546425">lbm_ssrc_send_ex</a>(ss, msg_buff, msg_size, 0, &amp;ss_send_info);</div><div class="line">ss_send_info.<a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/structlbm__ssrc__send__ex__info__t__stct.html#a20b6feb8a3737d2ad4330c64552ba18c">flags</a> &amp;= ~ LBM_SSRC_SEND_EX_FLAG_REBUILD_BUFFER;</div></div><!-- fragment --> </li>
</ul>
<p>To be more efficient, instead of using the <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a8e81e2661e6d2845790041d170864b1e">LBM_SSRC_SEND_EX_FLAG_REBUILD_BUFFER</a> flag, you can use different message buffers (allocated with <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a98c5450e9fb93f30bd80fa33a2380dfc">lbm_ssrc_buff_get()</a>) for each message property structure. This saves the time required to re-serialize the message properties each time you want to use a different property structure.</p>
<p><br />
 </p>
<h1><a class="anchor" id="requestresponsemodel"></a>
Request/Response Model&nbsp;&nbsp;<small><a href="#requestresponsemodel">&lt;-</a></small></h1>
<p>Request/response is a very common messaging model whereby a client sends a "request" message to a server and expects a response. The server processes the request and return a response message to the originating client.</p>
<p>The UM request/response feature simplifies implementation of this model in the following ways: </p><ul>
<li>
Handling the request's "return address", eliminating the need for the client to create an artificial guaranteed-unique topic for the response. </li>
<li>
Establishing a linkage between a request and its response(s), allowing multiple requests to be outstanding, and associating each response message with its corresponding request message. </li>
<li>
Supporting multiple responses per request, both by allowing multiple servers to receive the request and each one responding, and by allowing a given server to respond with multiple messages. </li>
</ul>
<dl class="section attention"><dt>Attention</dt><dd>Although the response messages are sent by TCP, there are still failure scenarios where a response can be lost. The use of <a class="el" href="fundamentalconcepts.html#umrouter">DROs</a> can make it even more likely. Informatica recommends applications that use request/response implement timeout/retry logic. See <a class="el" href="umfeatures.html#uimreliability">UIM Reliability</a>.</dd></dl>
<p><br />
 </p>
<h2><a class="anchor" id="requestmessage"></a>
Request Message&nbsp;&nbsp;<small><a href="#requestmessage">&lt;-</a></small></h2>
<p>UM provides three ways to send a request message.</p>
<ul>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#ad4d06f66b8404684e191ca178e0cc09b">lbm_send_request()</a> to send a request to a topic via a source object. Uses the standard source-based transports (TCP, LBT-RM, LBT-RU). </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a54f3933e4dd154a9c7bb72598d0d9ef1">lbm_multicast_immediate_request()</a> to send a request to a topic as a multicast immediate message. See <a class="el" href="umfeatures.html#multicastimmediatemessaging">Multicast Immediate Messaging</a>. </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#ae011c7a66e1db1f012d7f9633dbd321d">lbm_unicast_immediate_request()</a> to send a request to a topic as a unicast immediate message. </li>
</ul>
<p>When the client application sends a request message, it references an application callback function for responses and a client data pointer for application state. The send call returns a "request object". As one or more responses are returned, the callback is invoked to deliver the response messages, associated with the request's client data pointer. The requesting application decides when its request is satisfied (perhaps by completeness of a response, or by timeout), and it calls <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a0abaa1c2ba62bba7a5eaf1f7f2abbac0">lbm_request_delete()</a> to delete the request object. Even if the server chooses to send additional responses, they will not be delivered to the requesting application after it has deleted the corresponding request object.</p>
<p><br />
 </p>
<h2><a class="anchor" id="responsemessage"></a>
Response Message&nbsp;&nbsp;<small><a href="#responsemessage">&lt;-</a></small></h2>
<p>The server application receives a request via the normal message receive mechanism, but the message is identified as type "request". Contained within that request message's header is a response object, which serves as a return address to the requester. The server application responds to an UM request message by calling <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a0bbc01b600ccc2ae874474e35955eb85">lbm_send_response()</a>. The response message is sent unicast via a dynamic TCP connection managed by UM.</p>
<dl class="section warning"><dt>Warning</dt><dd>The <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a0bbc01b600ccc2ae874474e35955eb85">lbm_send_response()</a> function may not be called from a context thread callback. If the application needs to send the response from the receiver callback (or any other UM callback), it must associate that callback with an <a class="el" href="umobjects.html#eventqueueobject">event queue</a>.</dd></dl>
<p><br />
 </p>
<h2><a class="anchor" id="responsesize"></a>
Response Size&nbsp;&nbsp;<small><a href="#responsesize">&lt;-</a></small></h2>
<p>A UM response message can be of any arbitrary size. However, given that responses are sent as <a class="el" href="umfeatures.html#unicastimmediatemessaging">UIMs</a>, and UIMs are not guaranteed, UM responses can be lost. This is especially true if <a class="el" href="fundamentalconcepts.html#umrouter">DROs</a> are being used. Larger UM responses have a higher probability of being lost than smaller UM responses. In particular, UM responses larger than 65,000 bytes can be lost even if network packets are simply delivered out of order, as might happen if the DROs are configured to use a <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/gateway.tag:../Gateway/" href="../Gateway/droarchitecture.html#udppeerlink">UDP Peer Link</a>.</p>
<p>This does not mean that you must avoid sending large response messages. Rather it emphasizes the importance of using an application-level timeout/retry algorithm for request/response. In practice, even multi-megabyte responses would be lost only rarely, but it can happen.</p>
<p><br />
 </p>
<h2><a class="anchor" id="responsedeletion"></a>
Response Deletion&nbsp;&nbsp;<small><a href="#responsedeletion">&lt;-</a></small></h2>
<p>Since the response object is part of the message header, it is normally deleted at the same time that the message is deleted, which typically happens automatically when the receiver callback returns. However, there are times when the application needs the scope of the response object to extend beyond the execution of the receiver callback. One method of extending the lifetime of the response object is to "retain" the request message, using <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a2b7788ff58f9e78bc89ea890dad0cccf">lbm_msg_retain()</a>.</p>
<p>However, there are times when the size of the request message makes retention of the entire message undesirable. In those cases, the response object itself can be extracted and retained separately by saving a copy of the response object pointer and setting the message header's response pointer to NULL (to prevent UM from deleting the response object when the message is deleted).</p>
<p>There are even occasions when an application needs to transfer the responsibility of responding to a request message to a different process entirely. I.e. the server which receives the request is not itself able to respond, and needs to send a message (not necessarily the original request message) to a different server. In that case, the first server which receives the request must serialize the response object to type <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a54cfbb23ab41a8d22968f68df015e246">lbm_serialized_response_t</a> by calling <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a7595677bf01cb9397d1fd174bd095e9f">lbm_serialize_response()</a>. It includes the serialized response object in the message forwarded to the second server. That server de-serializes the response object by calling <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#ad74f47a1e021b2422b80c0bf8d03f7a9">lbm_deserialize_response()</a>, allowing it to send a response message to the original requesting client.</p>
<p><br />
 </p>
<h2><a class="anchor" id="tcpmanagement"></a>
TCP Management&nbsp;&nbsp;<small><a href="#tcpmanagement">&lt;-</a></small></h2>
<p>UM creates and manages the special TCP connections for responses, maintaining a list of active response connections. When an application sends a response, UM scans that list for an active connection to the destination. If it doesn't find a connection for the response, it creates a new connection and adds it to the list. After the <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a0bbc01b600ccc2ae874474e35955eb85">lbm_send_response()</a> function returns, UM schedules the <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grpunicastimmediatemessagingoperation.html#responsetcpdeletiontimeoutcontext">response_tcp_deletion_timeout (context)</a>, which defaults to 2 seconds. If a second request comes in from the same application before the timer expires, the responding application simply uses the existing connection and restarts the deletion timer.</p>
<p>It is conceivable that a very large response could take more than the <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grpunicastimmediatemessagingoperation.html#responsetcpdeletiontimeoutcontext">response_tcp_deletion_timeout (context)</a> default (2 seconds) to send to a slow-running receiver. In this case, UM automatically increases the deletion timer as needed to ensure the last message completes.</p>
<p><br />
 </p>
<h2><a class="anchor" id="requestresponseconfiguration"></a>
Request/Response Configuration&nbsp;&nbsp;<small><a href="#requestresponseconfiguration">&lt;-</a></small></h2>
<p>See the <a href="../Config/index.html">UM Configuration Guide</a> for the descriptions of the Request/Response configuration options:</p>
<ul>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grpunicastimmediatemessagingnetwork.html">Unicast Immediate Messaging Network Options</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grpunicastimmediatemessagingoperation.html">Unicast Immediate Messaging Operation Options</a> </li>
</ul>
<dl class="section note"><dt>Note</dt><dd>If your application is running within an UM context where the configuration option, <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grpunicastimmediatemessagingnetwork.html#requesttcpbindrequestportcontext">request_tcp_bind_request_port (context)</a> has been set to zero, UIM port binding has been turned off, which also disables the Request/Response feature.</dd></dl>
<p><br />
 </p>
<h2><a class="anchor" id="requestresponseexampleapplications"></a>
Request/Response Example Applications&nbsp;&nbsp;<small><a href="#requestresponseexampleapplications">&lt;-</a></small></h2>
<p>UM includes two example applications that illustrate Request/Response.</p>
<ul>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/example.tag:../example/" href="../example/index.html#examplelbmreq_c">Example lbmreq.c</a> - application that sends requests on a given topic (single source) and waits for responses. See also the Java example, <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/java_example.tag:../java_example/" href="../java_example/index.html#examplelbmreq_java">Example lbmreq.java</a> and the .NET example <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/dotnet_example.tag:../dotnet_example/" href="../dotnet_example/index.html#examplelbmreq_cs">Example lbmreq.cs</a>. </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/example.tag:../example/" href="../example/index.html#examplelbmresp_c">Example lbmresp.c</a> - application that waits for requests and sends responses back on a given topic (single receiver). See also the Java example, <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/java_example.tag:../java_example/" href="../java_example/index.html#examplelbmresp_java">Example lbmresp.java</a> and the .NET example <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/dotnet_example.tag:../dotnet_example/" href="../dotnet_example/index.html#examplelbmresp_cs">Example lbmresp.cs</a>. </li>
</ul>
<p>We can demonstrate a series of 5 requests and responses with the following procedure:</p>
<ul>
<li>
Run <b>lbmresp -v topicname</b> </li>
<li>
Run <b>lbmreq -R 5 -v topicname</b> </li>
</ul>
<p><b>LBMREQ</b></p>
<p>Output for lbmreq should resemble the following:</p>
<pre class="fragment">$ lbmreq -R 5 -q topicname
Event queue in use
Using TCP port 4392 for responses
Delaying requests for 1000 milliseconds
Sending request 0
Starting event pump for 5 seconds.
Receiver connect [TCP:10.29.1.78:4958]
Done waiting for responses. 1 responses (25 bytes) received. Deleting request. Sending request 1
Starting event pump for 5 seconds.
Done waiting for responses. 1 responses (25 bytes) received. Deleting request. Sending request 2
Starting event pump for 5 seconds.
Done waiting for responses. 1 responses (25 bytes) received. Deleting request. Sending request 3
Starting event pump for 5 seconds.
Done waiting for responses. 1 responses (25 bytes) received. Deleting request. Sending request 4
Starting event pump for 5 seconds.
Done waiting for responses. 1 responses (25 bytes) received. Deleting request.
Quitting...
</pre><p><b>LBMRESP</b></p>
<p>Output for lbmresp should resemble the following:</p>
<pre class="fragment">$ lbmresp -v topicname
Request [topicname][TCP:10.29.1.78:14371][0], 25 bytes
Sending response. 1 responses of 25 bytes each (25 total bytes).
Done sending responses. Deleting response.
Request [topicname][TCP:10.29.1.78:14371][1], 25 bytes
Sending response. 1 responses of 25 bytes each (25 total bytes).
Done sending responses. Deleting response.
Request [topicname][TCP:10.29.1.78:14371][2], 25 bytes
Sending response. 1 responses of 25 bytes each (25 total bytes).
Done sending responses. Deleting response.
Request [topicname][TCP:10.29.1.78:14371][3], 25 bytes
Sending response. 1 responses of 25 bytes each (25 total bytes).
Done sending responses. Deleting response.
Request [topicname][TCP:10.29.1.78:14371][4], 25 bytes
Sending response. 1 responses of 25 bytes each (25 total bytes).
Done sending responses. Deleting response.
[topicname][TCP:10.29.1.78:14371], End of Transport Session
</pre><p><br />
 </p>
<h1><a class="anchor" id="selfdescribingmessaging"></a>
Self Describing Messaging&nbsp;&nbsp;<small><a href="#selfdescribingmessaging">&lt;-</a></small></h1>
<p>The UM Self-Describing Messaging (SDM) feature provides an API that simplifies the creation and use of messages by your applications. An SDM message contains one or more fields and each field consists of the following:</p>
<ul>
<li>
A name </li>
<li>
A type </li>
<li>
A value </li>
</ul>
<p>Each named field may appear only once in a message. If multiple fields of the same name and type are needed, array fields are available. A field in a nested message may have the same name as a field in the outer message.</p>
<p>SDM is particularly helpful for creating messages sent across platforms by simplifying the creation of data formats. SDM automatically performs platform-specific data translations, eliminating endian conflicts.</p>
<p>Using SDM also simplifies message maintenance because the message format or structure can be independent of the source and receiver applications. For example, if your receivers query SDM messages for particular fields and ignore the order of the fields within the message, a source can change the field order if necessary with no modification of the receivers needed.</p>
<p>See the <a href="../API/lbmsdm_8h.html">C</a>, <a href="../JavaAPI/classcom_1_1latencybusters_1_1lbm_1_1sdm_1_1LBMSDM.html">Java</a>, and <a href="../DotNetAPI/namespacecom_1_1latencybusters_1_1lbm_1_1sdm.html">.NET</a> API references for details.</p>
<p>Informatica generally recommends the use of <a class="el" href="umfeatures.html#predefinedmessages">Pre-Defined Messages</a>, which is more efficient than self-describing messages.</p>
<p><br />
 </p>
<h1><a class="anchor" id="predefinedmessages"></a>
Pre-Defined Messages&nbsp;&nbsp;<small><a href="#predefinedmessages">&lt;-</a></small></h1>
<p>The UM Pre-Defined Messages (PDM) feature provides an API similar to the SDM API, but allows you to define messages once and then use the definition to create messages that may contain self-describing data. Eliminating the need to repeatedly send a message definition increases the speed of PDM over SDM. The ability to use arrays created in a different programming language also improves performance.</p>
<p>The PDM library lets you create, serialize, and deserialize messages using pre-defined knowledge about the possible fields that may be used. You can create a definition that a) describes the fields to be sent and received in a message, b) creates the corresponding message, and c) adds field values to the message. This approach offers several performance advantages over SDM, as the definition is known in advance. However, the usage pattern is slightly different from the SDM library, where fields are added directly to a message without any type of definition.</p>
<p>A PDM message contains one or more fields and each field consists of the following:</p>
<ul>
<li>
A name </li>
<li>
A type </li>
<li>
A value </li>
</ul>
<p>Each named field may appear only once in a message. If multiple fields of the same name and type are needed, array fields are available. A field in a nested message may have the same name as a field in the outer message.</p>
<p>See the <a href="../API/lbmpdm_8h.html">C</a>, <a href="../JavaAPI/classcom_1_1latencybusters_1_1pdm_1_1PDMMessage.html">Java</a>, and <a href="../DotNetAPI/namespacecom_1_1latencybusters_1_1pdm.html">.NET</a> API references for details.</p>
<p>The C API also has information and code samples about how to create definitions and messages, set field values in a message, set the value of array fields in a message, serialize, deserialize and dispose of messages, and fetch values from a message.</p>
<p>See <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/cpdmdetails.html">C PDM Details</a>.</p>
<p><br />
 </p>
<h2><a class="anchor" id="typicalpdmusagepatterns"></a>
Typical PDM Usage Patterns&nbsp;&nbsp;<small><a href="#typicalpdmusagepatterns">&lt;-</a></small></h2>
<p>The typical PDM usage patterns can usually be broken down into two categories: sources (which need to serialize a message for sending) and receivers (which need to deserialize a message to extract field values). However, for optimum performance for both sources and receivers, first set up the definition and a single instance of the message only once during a setup or initialization phase, as in the following example workflow:</p>
<ol>
<li>
Create a definition and set its id and version. </li>
<li>
Add field information to the definition to describe the types of fields to be in the message. </li>
<li>
Create a single instance of a message based on the definition. </li>
<li>
Set up a source to do the following: <ul>
<li>
Add field values to the message instance. </li>
<li>
Serialize the message so that it can be sent. </li>
</ul>
</li>
<li>
Likewise, set up a receiver to do the following: <ul>
<li>
Deserialize the received bytes into the message instance. </li>
<li>
Extract the field values from the message. </li>
</ul>
</li>
</ol>
<p><br />
 </p>
<h2><a class="anchor" id="gettingstartedwithpdm"></a>
Getting Started with PDM&nbsp;&nbsp;<small><a href="#gettingstartedwithpdm">&lt;-</a></small></h2>
<p>PDM APIs are provided in C, Java, and C#, however, the examples in this section are Java based.</p>
<p><b>PDM Code Example, Source</b></p>
<p>Translating the Typical PDM Usage Patterns to Java for a source produces the following:</p>
<div class="fragment"><div class="line"><span class="keyword">private</span> PDMDefinition defn;</div><div class="line"><span class="keyword">private</span> PDMMessage msg;</div><div class="line"><span class="keyword">private</span> PDMFieldInfo fldInfo100;</div><div class="line"><span class="keyword">private</span> PDMFieldInfo fldInfo101;</div><div class="line"><span class="keyword">private</span> PDMFieldInfo fldInfo102;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keywordtype">void</span> setupPDM() {</div><div class="line">  <span class="comment">//Create the definition with 3 fields and using int field names</span></div><div class="line">  defn = <span class="keyword">new</span> PDMDefinition(3, <span class="keyword">true</span>);</div><div class="line"></div><div class="line">  <span class="comment">//Set the definition id and version</span></div><div class="line">  defn.setId(1001);</div><div class="line">  defn.setMsgVersMajor((byte)1);</div><div class="line">  defn.setMsgVersMinor((byte)0);</div><div class="line"></div><div class="line">  <span class="comment">//Create information for a boolean, int32, and float fields (all required)</span></div><div class="line">  fldInfo100 = defn.addFieldInfo(100, PDMFieldType.BOOLEAN, <span class="keyword">true</span>);</div><div class="line">  fldInfo101 = defn.addFieldInfo(101, PDMFieldType.INT32, <span class="keyword">true</span>);</div><div class="line">  fldInfo102 = defn.addFieldInfo(102, PDMFieldType.FLOAT, <span class="keyword">true</span>);</div><div class="line"></div><div class="line">  <span class="comment">//Finalize the definition and create the message defn.finalizeDef();</span></div><div class="line">  msg = <span class="keyword">new</span> PDMMessage(defn);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keywordtype">void</span> sourceUsePDM() {</div><div class="line">  <span class="comment">//Call the function to setup the definition and message</span></div><div class="line">  setupPDM();</div><div class="line"></div><div class="line">  <span class="comment">//Example values for the message boolean</span></div><div class="line">  fld100Val = <span class="keyword">true</span>;</div><div class="line">  <span class="keywordtype">int</span> fld101Val = 7;</div><div class="line">  <span class="keywordtype">float</span> fld102Val = 3.14F;</div><div class="line"></div><div class="line">  <span class="comment">//Set each field value in the message</span></div><div class="line">  msg.setFieldValue(fldInfo100, fld100Val);</div><div class="line">  msg.setFieldValue(fldInfo101, fld101Val);</div><div class="line">  msg.setFieldValue(fldInfo102, fld102Val);</div><div class="line"></div><div class="line">  <span class="comment">//Serialize the message to bytes</span></div><div class="line">  byte[] buffer = msg.toBytes();</div><div class="line">}</div></div><!-- fragment --><p><b>PDM Code Example, Receiver</b></p>
<p>Translating the Typical PDM Usage Patterns to Java for a receiver produces the following:</p>
<div class="fragment"><div class="line"><span class="keyword">private</span> PDMDefinition defn;</div><div class="line"><span class="keyword">private</span> PDMMessage msg;</div><div class="line"><span class="keyword">private</span> PDMFieldInfo fldInfo100;</div><div class="line"><span class="keyword">private</span> PDMFieldInfo fldInfo101;</div><div class="line"><span class="keyword">private</span> PDMFieldInfo fldInfo102;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keywordtype">void</span> setupPDM() {</div><div class="line">  <span class="comment">//Create the definition with 3 fields and using int field names</span></div><div class="line">  defn = <span class="keyword">new</span> PDMDefinition(3, <span class="keyword">true</span>);</div><div class="line"></div><div class="line">  <span class="comment">//Set the definition id and version</span></div><div class="line">  defn.setId(1001);</div><div class="line">  defn.setMsgVersMajor((byte)1);</div><div class="line">  defn.setMsgVersMinor((byte)0);</div><div class="line"></div><div class="line">  <span class="comment">//Create information for a boolean, int32, and float field (all required)</span></div><div class="line">  fldInfo100 = defn.addFieldInfo(100, PDMFieldType.BOOLEAN, <span class="keyword">true</span>);</div><div class="line">  fldInfo101 = defn.addFieldInfo(101, PDMFieldType.INT32, <span class="keyword">true</span>);</div><div class="line">  fldInfo102 = defn.addFieldInfo(102, PDMFieldType.FLOAT, <span class="keyword">true</span>);</div><div class="line"></div><div class="line">  <span class="comment">//Finalize the definition and create the message</span></div><div class="line">  defn.finalizeDef();</div><div class="line">  msg = <span class="keyword">new</span> PDMMessage(defn);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keywordtype">void</span> receiverUsePDM(byte[] buffer) {</div><div class="line">  <span class="comment">//Call the function to setup the definition and message</span></div><div class="line">  setupPDM();</div><div class="line"></div><div class="line">  <span class="comment">//Values to be retrieved from the message</span></div><div class="line">  <span class="keywordtype">boolean</span> fld100Val;</div><div class="line">  <span class="keywordtype">int</span> fld101Val;</div><div class="line">  <span class="keywordtype">float</span> fld102Val;</div><div class="line"></div><div class="line">  <span class="comment">//Deserialize the bytes into a message</span></div><div class="line">  msg.parse(buffer);</div><div class="line"></div><div class="line">  <span class="comment">//Get each field value from the message</span></div><div class="line">  fld100Val = msg.getFieldValueAsBoolean(fldInfo100);</div><div class="line">  fld101Val = msg.getFieldValueAsInt32(fldInfo101);</div><div class="line">  fld102Val = msg.getFieldValueAsFloat(fldInfo102);</div><div class="line">}</div></div><!-- fragment --><p><b>PDM Code Example Notes</b></p>
<p>In the examples above, the setupPDM() function is called once to set up the PDM definition and message. It is identical in both the source and receiver cases and simply sets up a definition that contains three required fields with integer names (100, 101, 102). Once finalized, it can create a message that leverages its pre-defined knowledge about these three required fields. The source example adds the three sample field values (a boolean, int32, and float) to the message, which is then serialized to a byte array. In the receiver example, the message parses a byte array into the message and then extracts the three field values.</p>
<p><br />
 </p>
<h2><a class="anchor" id="usingthepdmapi"></a>
Using the PDM API&nbsp;&nbsp;<small><a href="#usingthepdmapi">&lt;-</a></small></h2>
<p>The following code snippets expand upon the previous examples to demonstrate the usage of additional PDM functionality (but use "..." to eliminate redundant code).</p>
<p><b>Reusing the Message Object</b></p>
<p>Although the examples use a single message object (which provides performance benefits due to reduced message creation and garbage collection), it is not explicitly required to reuse a single instance. However, multiple threads should not access a single message instance.</p>
<p><b>Number of Fields</b></p>
<p>Although the number of fields above is initially set to 3 in the PDMDefinition constructor, if you add more fields to the definition with the addFieldInfo method, the definition grows to accommodate each field. Once the definition is finalized, you cannot add additional field information because the definition is now locked and ready for use in a message.</p>
<p><b>String Field Names</b></p>
<p>The examples above use integer field names in the setupPDM() function when creating the definition. You can also use string field names when setting up the definition. However, you still must use a FieldInfo object to set or get a field value from a message, regardless of field name type. Notice that false is passed to the PDMDefinition constructor to indicate string field names should be used. Also, the overloaded addFieldInfo function uses string field names (.Field100.) instead of the integer field names.</p>
<div class="fragment"><div class="line">...</div><div class="line">public <span class="keywordtype">void</span> setupPDM() {</div><div class="line">  <span class="comment">//Create the definition with 3 fields and using string field names</span></div><div class="line">  defn = <span class="keyword">new</span> PDMDefinition(3, <span class="keyword">false</span>);</div><div class="line">  ...</div><div class="line">  <span class="comment">//Create information for a boolean, int32, and float field (all required)</span></div><div class="line">  fldInfo100 = defn.addFieldInfo(<span class="stringliteral">&quot;Field100&quot;</span>, PDMFieldType.BOOLEAN, <span class="keyword">true</span>);</div><div class="line">  fldInfo101 = defn.addFieldInfo(<span class="stringliteral">&quot;Field101&quot;</span>, PDMFieldType.INT32, <span class="keyword">true</span>);</div><div class="line">  fldInfo102 = defn.addFieldInfo(<span class="stringliteral">&quot;Field102&quot;</span>, PDMFieldType.FLOAT, <span class="keyword">true</span>);</div><div class="line">  ...</div><div class="line">}</div><div class="line">...</div></div><!-- fragment --><p><b>Retrieving FieldInfo from the Definition</b></p>
<p>At times, it may be easier to lookup the FieldInfo from the definition using the integer name (or string name if used). This eliminates the need to store the reference to the FieldInfo when getting or setting a field value in a message, but it does incur a performance penalty due to the lookup in the definition to retrieve the FieldInfo. Notice that there are no longer FieldInfo objects being used when calling addFieldInfo and a lookup is being done for each call to msg.getFieldValueAs* to retrieve the FieldInfo by integer name.</p>
<div class="fragment"><div class="line"><span class="keyword">private</span> PDMDefinition defn;</div><div class="line"><span class="keyword">private</span> PDMMessage msg;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keywordtype">void</span> setupPDM() {</div><div class="line">  ...</div><div class="line">  <span class="comment">//Create information for a boolean, int32, and float field (all required)</span></div><div class="line">  defn.addFieldInfo(100, PDMFieldType.BOOLEAN, <span class="keyword">true</span>);</div><div class="line">  defn.addFieldInfo(101, PDMFieldType.INT32, <span class="keyword">true</span>);</div><div class="line">  defn.addFieldInfo(102, PDMFieldType.FLOAT, <span class="keyword">true</span>);</div><div class="line">  ...</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keywordtype">void</span> receiverUsePDM(byte[] buffer) {</div><div class="line">  ...</div><div class="line">  <span class="comment">//Get each field value from the message</span></div><div class="line">  fld100Val = msg.getFieldValueAsBoolean(defn.getFieldInfo(100));</div><div class="line">  fld101Val = msg.getFieldValueAsInt32(defn.getFieldInfo(101));</div><div class="line">  fld102Val = msg.getFieldValueAsFloat(defn.getFieldInfo(102));</div><div class="line">}</div></div><!-- fragment --><p><b>Required and Optional Fields</b></p>
<p>When adding field information to a definition, you can indicate that the field is optional and may not be set for every message that uses the definition. Do this by passing false as the third parameter to the addFieldInfo function. Using required fields (fixed-required fields specifically) produces the best performance when serializing and deserializing messages, but causes an exception if all required fields are not set before serializing the message. Optional fields allow the concept of sending "null" as a value for a field by simply not setting that field value on the source side before serializing the message. However, after parsing a message, a receiver should check the isFieldValueSet function for an optional field before attempting to read the value from the field to avoid the exception mentioned above.</p>
<div class="fragment"><div class="line">...</div><div class="line">private PDMFieldInfo fldInfo103;</div><div class="line">...</div><div class="line">public <span class="keywordtype">void</span> setupPDM() {</div><div class="line">  ...</div><div class="line">  <span class="comment">//Create information for a boolean, int32, and float field (all required)</span></div><div class="line">  <span class="comment">// as well as an optional int8 field</span></div><div class="line">  fldInfo100 = defn.addFieldInfo(100, PDMFieldType.BOOLEAN, <span class="keyword">true</span>);</div><div class="line">  fldInfo101 = defn.addFieldInfo(101, PDMFieldType.INT32, <span class="keyword">true</span>);</div><div class="line">  fldInfo102 = defn.addFieldInfo(102, PDMFieldType.FLOAT, <span class="keyword">true</span>);</div><div class="line">  fldInfo103 = defn.addFieldInfo(103, PDMFieldType.INT8, <span class="keyword">false</span>);</div><div class="line">  ...</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keywordtype">void</span> sourceUsePDM() {</div><div class="line">  ...</div><div class="line">  <span class="comment">//Set each field value in the message</span></div><div class="line">  <span class="comment">// except do not set the optional field</span></div><div class="line">  msg.setFieldValue(fldInfo100, fld100Val);</div><div class="line">  msg.setFieldValue(fldInfo101, fld101Val);</div><div class="line">  msg.setFieldValue(fldInfo102, fld102Val);</div><div class="line">  ...</div><div class="line">}</div><div class="line"></div><div class="line">...</div><div class="line">private PDMFieldInfo fldInfo103;</div><div class="line">...</div><div class="line">public <span class="keywordtype">void</span> setupPDM() {</div><div class="line">  ...</div><div class="line">  <span class="comment">//Create information for a boolean, int32, and float field (all required)</span></div><div class="line">  <span class="comment">// as well as an optional int8 field</span></div><div class="line">  fldInfo103 = defn.addFieldInfo(103, PDMFieldType.INT8, <span class="keyword">false</span>);</div><div class="line">  ...</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keywordtype">void</span> receiverUsePDM(byte[] buffer) {</div><div class="line">  ...</div><div class="line">  byte fld103Val;</div><div class="line">  ...</div><div class="line">  <span class="keywordflow">if</span>(msg.isFieldValueSet(fldInfo103)) {</div><div class="line">    fld103Val = msg.getFieldValueAsInt8(fldInfo103);</div><div class="line">  }</div><div class="line">}</div></div><!-- fragment --><p><b>Fixed String and Fixed Unicode Field Types</b></p>
<p>A variable length string typically does not have the performance optimizations of fixed-required fields. However, by indicating "required", as well as the field type FIX_STRING or FIX_UNICODE and specifying an integer number of fixed characters, PDM sets aside an appropriate fixed amount of space in the message for that field and treats it as an optimized fixed-required field. Strings of a smaller length can still be set as the value for the field, but the message allocates the specified fixed number of bytes for the string. Specify Unicode strings in the same manner (with FIX_UNICODE as the type) and in "UTF-8" format.</p>
<div class="fragment"><div class="line">...</div><div class="line">private PDMFieldInfo fldInfo104;</div><div class="line">...</div><div class="line">public <span class="keywordtype">void</span> setupPDM() {</div><div class="line">  ...</div><div class="line">  fldInfo104 = defn.addFieldInfo(104, PDMFieldType.FIX_STRING, 12, <span class="keyword">true</span>);</div><div class="line">  ...</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keywordtype">void</span> sourceUsePDM() {</div><div class="line">  ...</div><div class="line">  String fld104Val = <span class="stringliteral">&quot;Hello World!&quot;</span>;</div><div class="line"></div><div class="line">  <span class="comment">//Set each field value in the message</span></div><div class="line">  <span class="comment">// except do not set the optional field</span></div><div class="line">  msg.setFieldValue(fldInfo100, fld100Val);</div><div class="line">  msg.setFieldValue(fldInfo101, fld101Val);</div><div class="line">  msg.setFieldValue(fldInfo102, fld102Val);</div><div class="line">  msg.setFieldValue(fldInfo104, fld104Val);</div><div class="line">  ...</div><div class="line">}</div><div class="line"></div><div class="line">...</div><div class="line">private PDMFieldInfo fldInfo104;</div><div class="line">...</div><div class="line">public <span class="keywordtype">void</span> setupPDM() {</div><div class="line">  ...</div><div class="line">  fldInfo104 = defn.addFieldInfo(104, PDMFieldType.FIX_STRING, 12, <span class="keyword">true</span>);</div><div class="line">  ...</div><div class="line">}</div><div class="line"><span class="keyword">public</span> <span class="keywordtype">void</span> receiverUsePDM(byte[] buffer) {</div><div class="line">  ...</div><div class="line">  String fld104Val;</div><div class="line">  ...</div><div class="line"></div><div class="line">  fld104Val = msg.getFieldValueAsString(fldInfo104);</div><div class="line">}</div></div><!-- fragment --><p><b>Variable Field Types</b></p>
<p>The field types of STRING, UNICODE, BLOB, and MESSAGE are all variable length field types. They do not require a length to be specified when adding field info to the definition. You can use a BLOB field to store an arbitrary binary objects (in Java as an array of bytes) and a MESSAGE field to store a PDMMessage object,</p>
<p>which enables "nesting" PDMMessages inside other PDMMessages. Creating and using a variable length string field is nearly identical to the previous fixed string example.</p>
<div class="fragment"><div class="line">...</div><div class="line">private PDMFieldInfo fldInfo105;</div><div class="line">...</div><div class="line">public <span class="keywordtype">void</span> setupPDM() {</div><div class="line">  ...</div><div class="line">  fldInfo105 = defn.addFieldInfo(105, PDMFieldType.STRING, <span class="keyword">true</span>);</div><div class="line">  ...</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keywordtype">void</span> sourceUsePDM() {</div><div class="line">  ...</div><div class="line">  String fld105Val = <span class="stringliteral">&quot;variable length value&quot;</span>;</div><div class="line">  ...</div><div class="line">  msg.setFieldValue(fldInfo105, fld105Val);</div><div class="line">  ...</div><div class="line">}</div><div class="line"></div><div class="line">...</div><div class="line">private PDMFieldInfo fldInfo105;</div><div class="line">...</div><div class="line">public <span class="keywordtype">void</span> setupPDM() {</div><div class="line">  ...</div><div class="line">  fldInfo105 = defn.addFieldInfo(105, PDMFieldType.STRING, <span class="keyword">true</span>);</div><div class="line">  ...</div><div class="line">}</div><div class="line"><span class="keyword">public</span> <span class="keywordtype">void</span> receiverUsePDM(byte[] buffer) {</div><div class="line">  ...</div><div class="line">  String fld105Val;</div><div class="line">  ...</div><div class="line"></div><div class="line">  fld105Val = msg.getFieldValueAsString(fldInfo105);</div><div class="line">}</div></div><!-- fragment --><p>Retrieve the BLOB field values with the getFieldValueAsBlob function, and the MESSAGE field values with the getFieldValueAsMessage function.</p>
<p><b>Array Field Types</b></p>
<p>For each of the scalar field types (fixed and variable length), a corresponding array field type uses the convention *_ARR for the type name (ex: BOOLEAN_ARR, INT32_ARR, STRING_ARR, etc.). This lets you set and get Java values such as an int[] or string[] directly into a single field. In addition, all of the array field types can specify a fixed number of elements for the size of the array when they are defined, or if not specified, behave as variable size arrays. Do this by passing an extra parameter to the addFieldInfo function of the definition.</p>
<p>To be treated as a fixed-required field, an array type field must be required as well as be specified as a fixed size array of fixed length elements. For instance, a required BOOLEAN_ARR field defined with a size of 3 would be treated as a fixed-required field. Also, a required FIX_STRING_ARR field defined with a size of 5 and fixed string length of 7 would be treated as a fixed-required field. However, neither a STRING_ARR field nor a BLOB_ARR field are treated as a fixed length field even if the size of the array is specified, since each element of the array can be variable in length. In the example below, field 106 and field 108 are both treated as fixed-required fields, but field 107 is not because it is a variable size array field type.</p>
<div class="fragment"><div class="line">...</div><div class="line">private PDMFieldInfo fldInfo106;</div><div class="line"><span class="keyword">private</span> PDMFieldInfo fldInfo107;</div><div class="line"><span class="keyword">private</span> PDMFieldInfo fldInfo108;</div><div class="line">...</div><div class="line"></div><div class="line">public <span class="keywordtype">void</span> setupPDM() {</div><div class="line">  ...</div><div class="line">  <span class="comment">//Create information for a boolean, int32, and float field (all required)</span></div><div class="line">  <span class="comment">// as well as an optional int8 field</span></div><div class="line">  ...</div><div class="line">  <span class="comment">//A required, fixed size array of 3 boolean elements</span></div><div class="line">  fldInfo106 = defn.addFieldInfo(106, PDMFieldType.BOOLEAN_ARR, <span class="keyword">true</span>, 3);</div><div class="line">  <span class="comment">//An optional, variable size array of int32 elements</span></div><div class="line">  fldInfo107 = defn.addFieldInfo(107, PDMFieldType.INT32_ARR, <span class="keyword">false</span>);</div><div class="line">  <span class="comment">//A required, fixed size array of 2 element which are each 5 character strings</span></div><div class="line">  fldInfo108 = defn.addFieldInfo(108, PDMFieldType.FIX_STRING_ARR, 5, <span class="keyword">true</span>, 2);</div><div class="line">  ...</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keywordtype">void</span> sourceUsePDM() {</div><div class="line">  ...</div><div class="line">  <span class="comment">//Example values for the message</span></div><div class="line">  ...</div><div class="line">  <span class="keywordtype">boolean</span> fld106Val[] = {<span class="keyword">true</span>, <span class="keyword">false</span>, <span class="keyword">true</span>};</div><div class="line">  <span class="keywordtype">int</span> fld107Val[] = {1, 2, 3, 4, 5};</div><div class="line">  String fld108Val[] = {<span class="stringliteral">&quot;aaaaa&quot;</span>, <span class="stringliteral">&quot;bbbbb&quot;</span>};</div><div class="line"></div><div class="line">  <span class="comment">//Set each field value in the message</span></div><div class="line">  ...</div><div class="line">  msg.setFieldValue(fldInfo106, fld106Val);</div><div class="line">  msg.setFieldValue(fldInfo107, fld107Val);</div><div class="line">  msg.setFieldValue(fldInfo108, fld108Val);</div><div class="line">  ...</div><div class="line">}</div><div class="line"></div><div class="line">...</div><div class="line">private PDMFieldInfo fldInfo106;</div><div class="line"><span class="keyword">private</span> PDMFieldInfo fldInfo107;</div><div class="line"><span class="keyword">private</span> PDMFieldInfo fldInfo108;</div><div class="line">...</div><div class="line">public <span class="keywordtype">void</span> setupPDM() {</div><div class="line">  ...</div><div class="line">  <span class="comment">//Create information for a boolean, int32, and float field (all required)</span></div><div class="line">  <span class="comment">// as well as an optional int8 field</span></div><div class="line">  ...</div><div class="line">  <span class="comment">//A required, fixed size array of 3 boolean elements</span></div><div class="line">  fldInfo106 = defn.addFieldInfo(106, PDMFieldType.BOOLEAN_ARR, <span class="keyword">true</span>, 3);</div><div class="line">  <span class="comment">//An optional, variable size array of int32 elements</span></div><div class="line">  fldInfo107 = defn.addFieldInfo(107, PDMFieldType.INT32_ARR, <span class="keyword">false</span>);</div><div class="line">  <span class="comment">//A required, fixed size array of 2 element which are each 5 character strings</span></div><div class="line">  fldInfo108 = defn.addFieldInfo(108, PDMFieldType.FIX_STRING_ARR, 5, <span class="keyword">true</span>, 2);</div><div class="line">  ...</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keywordtype">void</span> receiverUsePDM(byte[] buffer) {</div><div class="line">  ...</div><div class="line">  <span class="comment">//Values to be retrieved from the message</span></div><div class="line">  ...</div><div class="line">  <span class="keywordtype">boolean</span> fld106Val[];</div><div class="line">  <span class="keywordtype">int</span> fld107Val[];</div><div class="line">  String fld108Val[];</div><div class="line"></div><div class="line">  <span class="comment">//Deserialize the bytes into a message</span></div><div class="line">  msg.parse(buffer);</div><div class="line"></div><div class="line">  <span class="comment">//Get each field value from the message</span></div><div class="line">  ...</div><div class="line">  fld106Val = msg.getFieldValueAsBooleanArray(fldInfo106);</div><div class="line">  <span class="keywordflow">if</span>(msg.isFieldValueSet(fldInfo107)) {</div><div class="line">    fld107Val = msg.getFieldValueAsInt32Array(fldInfo107);</div><div class="line">  }</div><div class="line"></div><div class="line">  fld108Val = msg.getFieldValueAsStringArray(fldInfo108);</div><div class="line">}</div></div><!-- fragment --><p><b>Definition Included In Message</b></p>
<p>Optionally, a PDM message can also include the definition when it is serialized to bytes. This enables receivers to parse a PDM message without having pre-defined knowledge of the message, although including the definition with the message affects message size and performance of message deserialization. Notice that the setIncludeDefinition function is called with an argument of true for a source that serializes the definition as part of the message.</p>
<div class="fragment"><div class="line"><span class="keyword">private</span> PDMDefinition defn;</div><div class="line"><span class="keyword">private</span> PDMMessage msg;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keywordtype">void</span> setupPDM() {</div><div class="line">  <span class="comment">//Create the definition with 3 fields and using int field names</span></div><div class="line">  defn = <span class="keyword">new</span> PDMDefinition(3, <span class="keyword">true</span>);</div><div class="line">  ...</div><div class="line"></div><div class="line">  <span class="comment">//Finalize the definition and create the message</span></div><div class="line">  defn.finalizeDef();</div><div class="line">  msg = <span class="keyword">new</span> PDMMessage(defn);</div><div class="line"></div><div class="line">  <span class="comment">//Set the flag to indicate that the definition should also be serialized</span></div><div class="line">  msg.setIncludeDefinition(<span class="keyword">true</span>);</div><div class="line">}</div><div class="line">...</div></div><!-- fragment --><p>For a receiver, the setupPDM function does not need to set any flags for the message but rather should define a message without a definition, since we assume the source provides the definition. If a definition is set for a message, it will attempt to use that definition instead of the definition on the incoming message (unless the ids are different).</p>
<div class="fragment"><div class="line"><span class="keyword">private</span> PDMDefinition defn;</div><div class="line"><span class="keyword">private</span> PDMMessage msg;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keywordtype">void</span> setupPDM() {</div><div class="line">  <span class="comment">//Don&#39;t define a definition</span></div><div class="line"></div><div class="line">  <span class="comment">//Create a message without a definition since the incoming message will have it</span></div><div class="line">  msg = <span class="keyword">new</span> PDMMessage();</div><div class="line">}</div><div class="line">...</div></div><!-- fragment --><p><b>The PDM Field Iterator</b></p>
<p>You can use the PDM Field Iterator to check all defined message fields to see if set, or to extract their values. You can extract a field value as an Object using this method, but due to the casting involved, we recommend you use the type specific get method to extract the exact value. Notice the use of field.isValueSet to check to see if the field value is set and the type specific get methods such as getBooleanValue and getFloatValue.</p>
<div class="fragment"><div class="line">...</div><div class="line"></div><div class="line">public <span class="keywordtype">void</span> setupPDM() {</div><div class="line">  <span class="comment">//Create the definition with 3 fields and using int field names</span></div><div class="line">  defn = <span class="keyword">new</span> PDMDefinition(3, <span class="keyword">true</span>);</div><div class="line"></div><div class="line">  <span class="comment">//Set the definition id and version</span></div><div class="line">  defn.setId(1001);</div><div class="line">  defn.setMsgVersMajor((byte)1);</div><div class="line">  defn.setMsgVersMinor((byte)0);</div><div class="line"></div><div class="line">  <span class="comment">//Create information for a boolean, int32, and float field (all required)</span></div><div class="line">  <span class="comment">// as well as an optional int8 field</span></div><div class="line">  fldInfo100 = defn.addFieldInfo(100, PDMFieldType.BOOLEAN, <span class="keyword">true</span>);</div><div class="line">  fldInfo101 = defn.addFieldInfo(101, PDMFieldType.INT32, <span class="keyword">true</span>);</div><div class="line">  fldInfo102 = defn.addFieldInfo(102, PDMFieldType.FLOAT, <span class="keyword">true</span>);</div><div class="line">  fldInfo103 = defn.addFieldInfo(103, PDMFieldType.INT8, <span class="keyword">false</span>);</div><div class="line">  fldInfo104 = defn.addFieldInfo(104, PDMFieldType.FIX_STRING, 12, <span class="keyword">true</span>);</div><div class="line">  fldInfo105 = defn.addFieldInfo(105, PDMFieldType.STRING, <span class="keyword">true</span>);</div><div class="line">  <span class="comment">//A required, fixed size array of 3 boolean elements</span></div><div class="line">  fldInfo106 = defn.addFieldInfo(106, PDMFieldType.BOOLEAN_ARR, <span class="keyword">true</span>, 3);</div><div class="line">  <span class="comment">//An optional, variable size array of int32 elements</span></div><div class="line">  fldInfo107 = defn.addFieldInfo(107, PDMFieldType.INT32_ARR, <span class="keyword">false</span>);</div><div class="line">  <span class="comment">//A required, fixed size array of 2 element which are each 5 character strings</span></div><div class="line">  fldInfo108 = defn.addFieldInfo(108, PDMFieldType.FIX_STRING_ARR, 5, <span class="keyword">true</span>, 2);</div><div class="line"></div><div class="line">  <span class="comment">//Finalize the definition and create the message</span></div><div class="line">  defn.finalizeDef();</div><div class="line">  msg = <span class="keyword">new</span> PDMMessage(defn);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keywordtype">void</span> receiveAndIterateMessage(byte[] buffer) {</div><div class="line">  msg.parse(buffer);</div><div class="line">  PDMFieldIterator iterator = msg.createFieldIterator();</div><div class="line">  PDMField field = null;</div><div class="line">  <span class="keywordflow">while</span>(iterator.hasNext()) {</div><div class="line">    field = iterator.next();</div><div class="line">    System.out.println(<span class="stringliteral">&quot;Field set? &quot;</span> +field.isValueSet());</div><div class="line">    <span class="keywordflow">switch</span>(field.getIntName()) {</div><div class="line">      <span class="keywordflow">case</span> 100:</div><div class="line">        <span class="keywordtype">boolean</span> val100 = field.getBooleanValue();</div><div class="line">        System.out.println(<span class="stringliteral">&quot;Field 100&#39;s value is: &quot;</span> + val100);</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">      <span class="keywordflow">case</span> 101:</div><div class="line">        <span class="keywordtype">int</span> val101 = field.getInt32Value();</div><div class="line">        System.out.println(<span class="stringliteral">&quot;Field 101&#39;s value is: &quot;</span> + val101);</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">      <span class="keywordflow">case</span> 102:</div><div class="line">        <span class="keywordtype">float</span> val102 = field.getFloatValue();</div><div class="line">        System.out.println(<span class="stringliteral">&quot;Field 102&#39;s value is: &quot;</span> + val102);</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">      <span class="keywordflow">default</span>:</div><div class="line">        <span class="comment">//Casting to object is possible but not recommended</span></div><div class="line">        Object value = field.getValue();</div><div class="line">        <span class="keywordtype">int</span> name = field.getIntName();</div><div class="line">        System.out.println(<span class="stringliteral">&quot;Field &quot;</span> + name + <span class="stringliteral">&quot;&#39;s value is: &quot;</span> + value);</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">    }</div><div class="line">  }</div><div class="line">}</div></div><!-- fragment --><p>Sample Output (106, 107, 108 are array objects as expected):</p>
<pre class="fragment">Field set? true
Field 100's value is: true
Field set? true
Field 101's value is: 7
Field set? true
Field 102's value is: 3.14
Field set? false
Field 103's value is: null
Field set? true
Field 104's value is: Hello World!
Field set? true
Field 105's value is: Variable
Field set? true
Field 106's value is: [Z@527736bd
Field set? true
Field 107's value is: [I@10aadc97
Field set? true
Field 108's value is: [Ljava.lang.String;@4178460d
</pre><p><b>Using the Definition Cache</b></p>
<p>The PDM Definition Cache assists with storing and looking up definitions by their id and version. In some scenarios, it may not be desirable to maintain the references to the message and the definition from a setup phase by the application. A source could optionally create the definition during the setup phase and store it in the definition cache. At a later point in time, it could retrieve the definition from the cache and use it to create the message without needing to maintain any references to the objects.</p>
<div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keywordtype">void</span> createAndStoreDefinition() {</div><div class="line">  PDMDefinition myDefn = <span class="keyword">new</span> PDMDefinition(3, <span class="keyword">true</span>);</div><div class="line">  <span class="comment">//Set the definition id and version</span></div><div class="line">  myDefn.setId(2001);</div><div class="line">  myDefn.setMsgVersMajor((byte)1);</div><div class="line">  myDefn.setMsgVersMinor((byte)0);</div><div class="line"></div><div class="line">  <span class="comment">//Create information for a boolean, int32, and float field (all required)</span></div><div class="line">  myDefn.addFieldInfo(100, PDMFieldType.BOOLEAN, <span class="keyword">true</span>);</div><div class="line">  myDefn.addFieldInfo(101, PDMFieldType.INT32, <span class="keyword">true</span>);</div><div class="line">  myDefn.addFieldInfo(102, PDMFieldType.FLOAT, <span class="keyword">true</span>);</div><div class="line"></div><div class="line">  myDefn.finalizeDef();</div><div class="line"></div><div class="line">  PDMDefinitionCache.getInstance().put(myDefn);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keywordtype">void</span> createMessageUsingCache() {</div><div class="line">  PDMDefinition myFoundDefn = PDMDefinitionCache.getInstance().get(2001, 1, 0);</div><div class="line">  <span class="keywordflow">if</span>(myFoundDefn != null) {</div><div class="line">    PDMMessage myMsg = <span class="keyword">new</span> PDMMessage(myFoundDefn);</div><div class="line">    <span class="comment">//Get FieldInfo from defn and then set field values in myMsg</span></div><div class="line">    <span class="comment">//...</span></div><div class="line">  }</div><div class="line">}</div></div><!-- fragment --><p>A more advanced use of the PDM Definition Cache is by a receiver which may need to receive messages with different definitions and the definitions are not being included with the messages. The receiver can create the definitions in advance and then set a flag that allows automatic lookup into the definition cache when parsing a message (which is not on by default). Before receiving messages, the receiver should do something similar to createAndStoreDefinition (shown below) to set up definitions and put them in the definition cache. Then the flag to allow automatic lookup should be set as shown below in the call to setTryToLoadDefFromCache(true). This allows the PDMMessage to be created without a definition and still successfully parse a message by leveraging the definition cache.</p>
<div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keywordtype">void</span> createAndStoreDefinition() {</div><div class="line">  PDMDefinition myDefn = <span class="keyword">new</span> PDMDefinition(3, <span class="keyword">true</span>);</div><div class="line">  <span class="comment">//Set the definition id and version</span></div><div class="line">  myDefn.setId(2001);</div><div class="line">  myDefn.setMsgVersMajor((byte)1);</div><div class="line">  myDefn.setMsgVersMinor((byte)0);</div><div class="line"></div><div class="line">  <span class="comment">//Create information for a boolean, int32, and float field (all required)</span></div><div class="line">  myDefn.addFieldInfo(100, PDMFieldType.BOOLEAN, <span class="keyword">true</span>);</div><div class="line">  myDefn.addFieldInfo(101, PDMFieldType.INT32, <span class="keyword">true</span>);</div><div class="line">  myDefn.addFieldInfo(102, PDMFieldType.FLOAT, <span class="keyword">true</span>);</div><div class="line"></div><div class="line">  myDefn.finalizeDef();</div><div class="line">  PDMDefinitionCache.getInstance().put(myDefn);</div><div class="line"></div><div class="line">  <span class="comment">//Create and store other definitions</span></div><div class="line">  <span class="comment">//...</span></div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keywordtype">void</span> receiveKnownMessages(byte[] buffer) {</div><div class="line">  PDMMessage myMsg = <span class="keyword">new</span> PDMMessage();</div><div class="line">  <span class="comment">//Set the flag that enables messages to try</span></div><div class="line">  <span class="comment">// looking up the definition in the cache automatically</span></div><div class="line">  <span class="comment">// when parsing a byte buffer</span></div><div class="line">  myMsg.setTryToLoadDefFromCache(<span class="keyword">true</span>);</div><div class="line">  myMsg.parse(buffer);</div><div class="line"></div><div class="line">  <span class="keywordflow">if</span> (myMsg.getDefinition().getId() == 2001</div><div class="line">      &amp;&amp; myMsg.getDefinition().getMsgVersMajor() == 1</div><div class="line">      &amp;&amp; myMsg.getDefinition().getMsgVersMinor() == 0) {</div><div class="line">    PDMDefinition myDefn = PDMDefinitionCache.getInstance().get(2001, 1, 0);</div><div class="line">    PDMFieldInfo fldInfo100 = myDefn.getFieldInfo(100);</div><div class="line">    PDMFieldInfo fldInfo101 = myDefn.getFieldInfo(101);</div><div class="line">    PDMFieldInfo fldInfo102 = myDefn.getFieldInfo(102);</div><div class="line"></div><div class="line">    <span class="keywordtype">boolean</span> fld100Val;</div><div class="line">    <span class="keywordtype">int</span> fld101Val;</div><div class="line">    <span class="keywordtype">float</span> fld102Val;</div><div class="line"></div><div class="line">    <span class="comment">//Get each field value from the message</span></div><div class="line">    fld100Val = myMsg.getFieldValueAsBoolean(fldInfo100);</div><div class="line">    fld101Val = myMsg.getFieldValueAsInt32(fldInfo101);</div><div class="line">    fld102Val = myMsg.getFieldValueAsFloat(fldInfo102);</div><div class="line"></div><div class="line">    System.out.println(fld100Val + <span class="stringliteral">&quot; &quot;</span> + fld101Val + <span class="stringliteral">&quot; &quot;</span> + fld102Val);</div><div class="line">  }</div><div class="line">}</div></div><!-- fragment --><p><br />
 </p>
<h2><a class="anchor" id="migratingfromsdm"></a>
Migrating from SDM&nbsp;&nbsp;<small><a href="#migratingfromsdm">&lt;-</a></small></h2>
<p>Applications using SDM with a known set of message fields are good candidates for migrating from SDM to PDM. With SDM, the source typically adds fields to an SDM message without a definition. But, as shown above in the PDM examples, creating/adding a PDM definition before adding field values is fairly straightforward.</p>
<p>However, certain applications may be incapable of building a definition in advance due to the ad-hoc nature of their messaging needs, in which case a self-describing format like SDM may be preferred.</p>
<p><b>Simple Migration Example</b></p>
<p>The following source code shows a basic application that serializes and deserializes three fields using SDM and PDM. The setup method in both cases initializes the object instances so they can be reused by the source and receiver methods.</p>
<p>The goal of the sourceCreateMessageWith functions is to produce a byte array by setting field values in a message object. With SDM, actual Field classes are created, values are set, the Field classes are added to a</p>
<p>Fields class, and then the Fields class is added to the SDMessage. With PDM, FieldInfo objects are created during the setup phase and then used to set specific values in the PDMMessage.</p>
<p>The goal of the receiverParseMessageWith functions is to produce a message object by parsing the byte array and then extract the field values from the message. With SDM, the specific field is located and casted to the correct field class before getting the field value. With PDM, the appropriate getFieldValueAs function is called with the corresponding FieldInfo object created during the setup phase to extract the field value.</p>
<div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keyword">class </span>Migration {</div><div class="line">  <span class="comment">//SDM Variables</span></div><div class="line">  <span class="keyword">private</span> LBMSDMessage srcSDMMsg;</div><div class="line">  <span class="keyword">private</span> LBMSDMessage rcvSDMMsg;</div><div class="line"></div><div class="line">  <span class="comment">//PDM Variables</span></div><div class="line">  <span class="keyword">private</span> PDMDefinition defn;</div><div class="line">  <span class="keyword">private</span> PDMFieldInfo fldInfo100;</div><div class="line">  <span class="keyword">private</span> PDMFieldInfo fldInfo101;</div><div class="line">  <span class="keyword">private</span> PDMFieldInfo fldInfo102;</div><div class="line">  <span class="keyword">private</span> PDMMessage srcPDMMsg;</div><div class="line">  <span class="keyword">private</span> PDMMessage rcvPDMMsg;</div><div class="line"></div><div class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keywordtype">void</span> main(String[] args) {</div><div class="line">    Migration app = <span class="keyword">new</span> Migration();</div><div class="line">    System.out.println(<span class="stringliteral">&quot;Setting up PDM Definition and Message&quot;</span>);</div><div class="line">    app.setupPDM();</div><div class="line">    System.out.println(<span class="stringliteral">&quot;Setting up SDM Messages&quot;</span>);</div><div class="line">    app.setupSDM();</div><div class="line"></div><div class="line">    byte[] sdmBuffer;</div><div class="line">    sdmBuffer = app.sourceCreateMessageWithSDM();</div><div class="line">    app.receiverParseMessageWithSDM(sdmBuffer);</div><div class="line"></div><div class="line">    byte[] pdmBuffer;</div><div class="line">    pdmBuffer = app.sourceCreateMessageWithPDM();</div><div class="line">    app.receiverParseMessageWithPDM(pdmBuffer);</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="keyword">public</span> <span class="keywordtype">void</span> setupSDM() {</div><div class="line">    rcvSDMMsg = <span class="keyword">new</span> LBMSDMessage();</div><div class="line">    srcSDMMsg = <span class="keyword">new</span> LBMSDMessage();</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="keyword">public</span> <span class="keywordtype">void</span> setupPDM() {</div><div class="line">    <span class="comment">//Create the definition with 3 fields and using int field names</span></div><div class="line">    defn = <span class="keyword">new</span> PDMDefinition(3, <span class="keyword">false</span>);</div><div class="line"></div><div class="line">    <span class="comment">//Set the definition id and version</span></div><div class="line">    defn.setId(1001);</div><div class="line">    defn.setMsgVersMajor((byte)1);</div><div class="line">    defn.setMsgVersMinor((byte)0);</div><div class="line"></div><div class="line">    <span class="comment">//Create information for a boolean, int32, and float field (all required)</span></div><div class="line">    <span class="comment">// as well as an optional int8 field</span></div><div class="line">    fldInfo100 = defn.addFieldInfo(<span class="stringliteral">&quot;Field100&quot;</span>, PDMFieldType.INT8, <span class="keyword">true</span>);</div><div class="line">    fldInfo101 = defn.addFieldInfo(<span class="stringliteral">&quot;Field101&quot;</span>, PDMFieldType.INT16, <span class="keyword">true</span>);</div><div class="line">    fldInfo102 = defn.addFieldInfo(<span class="stringliteral">&quot;Field102&quot;</span>, PDMFieldType.INT32, <span class="keyword">true</span>);</div><div class="line"></div><div class="line">    <span class="comment">//Finalize the definition and create the message defn.finalizeDef();</span></div><div class="line">    srcPDMMsg = <span class="keyword">new</span> PDMMessage(defn);</div><div class="line">    rcvPDMMsg = <span class="keyword">new</span> PDMMessage(defn);</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="keyword">public</span> byte[] sourceCreateMessageWithSDM() {</div><div class="line">    byte[] buffer = null;</div><div class="line"></div><div class="line">    LBMSDMField fld100 = <span class="keyword">new</span> LBMSDMFieldInt8(<span class="stringliteral">&quot;Field100&quot;</span>, (byte)0x42);</div><div class="line">    LBMSDMField fld101 = <span class="keyword">new</span> LBMSDMFieldInt16(<span class="stringliteral">&quot;Field101&quot;</span>, (<span class="keywordtype">short</span>)0x1ead);</div><div class="line">    LBMSDMField fld102 = <span class="keyword">new</span> LBMSDMFieldInt32(<span class="stringliteral">&quot;Field102&quot;</span>, 12345);</div><div class="line">    LBMSDMFields fset = <span class="keyword">new</span> LBMSDMFields();</div><div class="line"></div><div class="line">    <span class="keywordflow">try</span> {</div><div class="line">      fset.add(fld100);</div><div class="line">      fset.add(fld101);</div><div class="line">      fset.add(fld102);</div><div class="line">    } <span class="keywordflow">catch</span> (LBMSDMException e) {</div><div class="line">      System.out.println ( e );</div><div class="line">    }</div><div class="line"></div><div class="line">    srcSDMMsg.set(fset);</div><div class="line">    <span class="keywordflow">try</span> {</div><div class="line">      buffer = srcSDMMsg.data();</div><div class="line">    } <span class="keywordflow">catch</span> (IndexOutOfBoundsException e) {</div><div class="line">      System.out.println ( <span class="stringliteral">&quot;SDM Exception occurred during build of message:&quot;</span> );</div><div class="line">      System.out.println ( e.toString() );</div><div class="line">    } <span class="keywordflow">catch</span> (LBMSDMException e) {</div><div class="line">      System.out.println ( e.toString() );</div><div class="line">    }</div><div class="line">    <span class="keywordflow">return</span> buffer;</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="keyword">public</span> byte[] sourceCreateMessageWithPDM() {</div><div class="line">    <span class="comment">//Set each field value in the message</span></div><div class="line">    srcPDMMsg.setFieldValue(fldInfo100, (byte)0x42);</div><div class="line">    srcPDMMsg.setFieldValue(fldInfo101, (<span class="keywordtype">short</span>)0x1ead);</div><div class="line">    srcPDMMsg.setFieldValue(fldInfo102, 12345);</div><div class="line"></div><div class="line">    <span class="comment">//Serialize the message to bytes</span></div><div class="line">    byte[] buffer = srcPDMMsg.toBytes();</div><div class="line">    <span class="keywordflow">return</span> buffer;</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="keyword">public</span> <span class="keywordtype">void</span> receiverParseMessageWithSDM(byte[] buffer) {</div><div class="line">    <span class="comment">//Values to be retrieved from the message byte fld100Val;</span></div><div class="line">    <span class="keywordtype">short</span> fld101Val;</div><div class="line">    <span class="keywordtype">int</span> fld102Val;</div><div class="line"></div><div class="line">    <span class="comment">//Deserialize the bytes into a message</span></div><div class="line">    <span class="keywordflow">try</span> {</div><div class="line">      rcvSDMMsg.parse(buffer);</div><div class="line">    } <span class="keywordflow">catch</span> (LBMSDMException e) {</div><div class="line">      System.out.println(e.toString());</div><div class="line">    }</div><div class="line"></div><div class="line">    LBMSDMField fld100 = rcvSDMMsg.locate(<span class="stringliteral">&quot;Field100&quot;</span>);</div><div class="line">    LBMSDMField fld101 = rcvSDMMsg.locate(<span class="stringliteral">&quot;Field101&quot;</span>);</div><div class="line">    LBMSDMField fld102 = rcvSDMMsg.locate(<span class="stringliteral">&quot;Field102&quot;</span>);</div><div class="line"></div><div class="line">    <span class="comment">//Get each field value from the message</span></div><div class="line">    fld100Val = ((LBMSDMFieldInt8)fld100).get();</div><div class="line">    fld101Val = ((LBMSDMFieldInt16)fld101).get();</div><div class="line">    fld102Val = ((LBMSDMFieldInt32)fld102).get();</div><div class="line"></div><div class="line">    System.out.println(<span class="stringliteral">&quot;SDM Results: Field100=&quot;</span> + fld100Val +</div><div class="line">                       <span class="stringliteral">&quot;, Field101=&quot;</span> + fld101Val +</div><div class="line">                       <span class="stringliteral">&quot;, Field102=&quot;</span> + fld102Val);</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="keyword">public</span> <span class="keywordtype">void</span> receiverParseMessageWithPDM(byte[] buffer) {</div><div class="line">    <span class="comment">//Values to be retrieved from the message</span></div><div class="line">    byte fld100Val;</div><div class="line">    <span class="keywordtype">short</span> fld101Val;</div><div class="line">    <span class="keywordtype">int</span> fld102Val;</div><div class="line"></div><div class="line">    <span class="comment">//Deserialize the bytes into a message</span></div><div class="line">    rcvPDMMsg.parse(buffer);</div><div class="line"></div><div class="line">    <span class="comment">//Get each field value from the message</span></div><div class="line">    fld100Val = rcvPDMMsg.getFieldValueAsInt8(fldInfo100);</div><div class="line">    fld101Val = rcvPDMMsg.getFieldValueAsInt16(fldInfo101);</div><div class="line">    fld102Val = rcvPDMMsg.getFieldValueAsInt32(fldInfo102);</div><div class="line"></div><div class="line">    System.out.println(<span class="stringliteral">&quot;PDM Results: Field100=&quot;</span> + fld100Val +</div><div class="line">                       <span class="stringliteral">&quot;, Field101=&quot;</span> + fld101Val +</div><div class="line">                       <span class="stringliteral">&quot;, Field102=&quot;</span> + fld102Val);</div><div class="line">  }</div><div class="line">}</div></div><!-- fragment --><p>Notice that with sourceCreateMessageWithSDM function, the three fields (name and value) are created and added to the fset variable, which is then added to the SDM message. On the other hand, the sourceCreateMessageWithPDM function uses the FieldInfo object references to add the field values to the message for each of the three fields.</p>
<p>Also notice that the receiverParseMessageWithSDM requires a cast to the specific field class (like LBMSDMFieldInt8) once the field has been located. After the cast, calling the get method returns the expected value. On the other hand the receiverParseMessageWithPDM uses the FieldInfo object reference to directly retrieve the field value using the appropriate getFieldValueAs* method.</p>
<p><b>SDM Raw Classes</b></p>
<p>Several SDM classes with Raw in their name could be used as the value when creating an LBMSDMField. For example, an LBMSDMRawBlob instance could be created from a byte array and then that the LBMSDMRawBlob could be used as the value to a LBMSDMFieldBlob as shown in the following example.</p>
<div class="fragment"><div class="line">byte[] blob = <span class="keyword">new</span> byte[25];</div><div class="line">LBMSDMRawBlob rawSDMBlob = <span class="keyword">new</span> LBMSDMRawBlob(blob);</div><div class="line"><span class="keywordflow">try</span> {</div><div class="line">  LBMSDMField fld103 = <span class="keyword">new</span> LBMSDMFieldBlob(<span class="stringliteral">&quot;Field103&quot;</span>,rawSDMBlob);</div><div class="line">} <span class="keywordflow">catch</span> (LBMSDMException e1) {</div><div class="line">  System.out.println(e1);</div><div class="line">}</div></div><!-- fragment --><p>The actual field named "Field103" is created in the try block using the rawSDMBlob variable which has been created to wrap the blob byte array. This field can be added to a LBMSDMFields object, which then uses it in a LBMSDMessage.</p>
<p>In PDM, there are no "Raw" classes that can be created. When setting the value for a field for a message, the appropriate variable type should be passed in as the value. For example, setting the field value for a BLOB field would mean simply passing the byte array directly in the setValue method as shown in the following code snippet since the field is defined as type BLOB.</p>
<div class="fragment"><div class="line"><span class="keyword">private</span> PDMFieldInfo fldInfo103;</div><div class="line"><span class="keyword">public</span> <span class="keywordtype">void</span> setupPDM() {</div><div class="line">  ...</div><div class="line">  fldInfo103 = defn.addFieldInfo(<span class="stringliteral">&quot;Field103&quot;</span>, PDMFieldType.BLOB, <span class="keyword">true</span>);</div><div class="line">  ...</div><div class="line">  byte[] blob = <span class="keyword">new</span> byte[25];</div><div class="line"></div><div class="line">  srcPDMMsg.setFieldValue(fldInfo103, blob);</div><div class="line">  ...</div><div class="line">}</div></div><!-- fragment --><p>The PDM types of DECIMAL, TIMESTAMP, and MESSAGE expect a corresponding instance of PDMDecimal, PDMTimestamp, and PDMMessage as the field value when being set in the message so those types do require an instantiation instead of using a native Java type. For example, if "Field103" had been of type PDMFieldType.DECIMAL, the following code would be used to set the value.</p>
<div class="fragment"><div class="line">PDMDecimal decimal = <span class="keyword">new</span> PDMDecimal((<span class="keywordtype">long</span>)2, (byte)32);</div><div class="line">srcPDMMsg.setFieldValue(fldInfo103, decimal);</div></div><!-- fragment --><p><br />
 </p>
<h1><a class="anchor" id="sendingtosources"></a>
Sending to Sources&nbsp;&nbsp;<small><a href="#sendingtosources">&lt;-</a></small></h1>
<p>There are many use cases where a subscriber application wants to send a message to a publisher application. For example, a client application which subscribes to market data may want to send a refresh request to the publishing feed handler. While this is possible to do with normal sources and receivers, UM supports a streamlined method of doing this.</p>
<p>As of UM version 6.10, a <a class="el" href="umobjects.html#sourcestring">Source String</a> can be used as a destination for sending a unicast immediate message. The UM library will establish a TCP connection to the publisher's context via its <em>UIM port</em> (also known as "request port"). The publishing application can receive this message either from a normal <a class="el" href="umobjects.html#receiverobject">Receiver Object</a>, or from a context immediate message callback via configuration options <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grpmulticastimmediatemessagingoperation.html#immediatemessagetopicreceiverfunctioncontext">immediate_message_topic_receiver_function (context)</a> or <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grpmulticastimmediatemessagingoperation.html#immediatemessagereceiverfunctioncontext">immediate_message_receiver_function (context)</a> (for topicless messages).</p>
<p><br />
 </p>
<h2><a class="anchor" id="sourcestringfromreceiveevent"></a>
Source String from Receive Event&nbsp;&nbsp;<small><a href="#sourcestringfromreceiveevent">&lt;-</a></small></h2>
<p>A receiving application's receiver callback function can obtain a source's source string from the message structure. However, that string is not suitable to being passed directly to the unicast immediate message send function.</p>
<p>Here's a code fragment in C for receiving a message from a source, and sending a message back to the originating source. For clarity, error detection and handling code is omitted.</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> user_receiver_callback(<a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a0a4af6b8247cc5a0a24a8578fb6e83bd">lbm_rcv_t</a> *rcv, <a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/structlbm__msg__t__stct.html">lbm_msg_t</a> *msg, <span class="keywordtype">void</span> *clientd)</div><div class="line">{</div><div class="line">  ...</div><div class="line">  <span class="keywordflow">switch</span> (msg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/structlbm__msg__t__stct.html#ab25327dc4b4ebf527106f6e708dbc05f">type</a>) {</div><div class="line">    ...</div><div class="line">  <span class="keywordflow">case</span> <a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#aa47eb604db7dc9fd53f9650ed940e058">LBM_MSG_DATA</a>:</div><div class="line">    <span class="comment">/* user code which processes received message and sets up &quot;msg_for_src&quot; */</span></div><div class="line">    ...</div><div class="line">    <span class="comment">/* A valid UIM destination is &quot;SOURCE:&quot; + source string. */</span></div><div class="line">    <span class="keywordtype">char</span> destination[LBM_MSG_MAX_SOURCE_LEN + 8];</div><div class="line">    strcpy(destination, <span class="stringliteral">&quot;SOURCE:&quot;</span>);</div><div class="line">    strcat(destination, msg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/structlbm__msg__t__stct.html#a6631c87ac29792705794d46c4e1cda06">source</a>);</div><div class="line"></div><div class="line">    err = <a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a497d77b133cea1547c3346fcba99872a">lbm_unicast_immediate_message</a>(ctx, destination, NULL,   <span class="comment">/* no topic */</span></div><div class="line">                                       msg_for_src, <span class="keyword">sizeof</span>(msg_for_src),</div><div class="line">                                       LBM_SRC_NONBLOCK);  <span class="comment">/* Called from context thread. */</span></div><div class="line">    ...</div><div class="line">  }  <span class="comment">/* switch msg-&gt;type */</span></div><div class="line">  ...</div><div class="line">}  <span class="comment">/* user_receiver_callback */</span></div></div><!-- fragment --><p>The <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#aaa7a945411e63884f12918417e8d117c">lbm_msg_t</a> structure supplies the source string, and <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a497d77b133cea1547c3346fcba99872a">lbm_unicast_immediate_message()</a> is used to send a topicless immediate message to the source's context. Alternatively, a request message could be sent with <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#ae011c7a66e1db1f012d7f9633dbd321d">lbm_unicast_immediate_request()</a>. If the receive events are delivered without an <a class="el" href="umobjects.html#eventqueueobject">event queue</a>, then <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#ab8a470f02029480f179cc4872b7fa713">LBM_SRC_NONBLOCK</a> is needed.</p>
<p>The example above uses the <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#aa47eb604db7dc9fd53f9650ed940e058">LBM_MSG_DATA</a> message type. Most receiver event (message) types also contain a valid source string. Other likely candidates for this use case might be: <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#ab5489080adc7157549a9930b30c68425">LBM_MSG_BOS</a>, <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a88920e0a4188081f9a14fc8f76c18578">LBM_MSG_UNRECOVERABLE_LOSS</a>, <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a6629139aaf902976c8df9de3f37d10db">LBM_MSG_UNRECOVERABLE_LOSS_BURST</a>.</p>
<p>Note that in this example, a topicless message is sent. This requires the publishing application to use the <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grpmulticastimmediatemessagingoperation.html#immediatemessagereceiverfunctioncontext">immediate_message_receiver_function (context)</a> option to set up a callback for receipt of topicless immediate messages. Alternatively, a topic name can be supplied to the unicast immediate message function, in which case the publishing application would either create a normal <a class="el" href="umobjects.html#receiverobject">Receiver Object</a> for that topic, or would configure a callback with <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grpmulticastimmediatemessagingoperation.html#immediatemessagetopicreceiverfunctioncontext">immediate_message_topic_receiver_function (context)</a>.</p>
<p>A Java program obtains the source string via <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/javaapi.tag:../JavaAPI/" href="../JavaAPI/classcom_1_1latencybusters_1_1lbm_1_1LBMMessage.html#a5691adf8b8b740c7813d2f8d605c394d">LBMMessage::source()</a>, and sends topicless unicast immediate messages via <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/javaapi.tag:../JavaAPI/" href="../JavaAPI/classcom_1_1latencybusters_1_1lbm_1_1LBMContext.html#af565951d6e1b6b974c8ebd42bc0cfe16">LBMContext::sendTopicless()</a>.</p>
<p>A .NET implementation is essentially the same as Java.</p>
<p><br />
 </p>
<h2><a class="anchor" id="sourcestringfromsourcenotificationfunction"></a>
Source String from Source Notification Function&nbsp;&nbsp;<small><a href="#sourcestringfromsourcenotificationfunction">&lt;-</a></small></h2>
<p>Some subscribing applications need to send a message to the publisher as soon as possible after the publisher is subscribed. Receiver events can sometimes take significant time to be delivered. The source string can be obtained via the <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grpdeliverycontrol.html#sourcenotificationfunctionreceiver">source_notification_function (receiver)</a> configuration option. This defines a callback function which is called at the start of the process of subscribing to a source.</p>
<p>Here's a code fragment in C for sending a message to a newly-discovered source. For clarity, error detection and handling code is omitted.</p>
<p>During initialization, when the receiver is defined, the callback must be configured using the <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/structlbm__rcv__src__notification__func__t__stct.html">lbm_rcv_src_notification_func_t_stct</a> structure:</p>
<div class="fragment"><div class="line"><a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/structlbm__rcv__src__notification__func__t__stct.html">lbm_rcv_src_notification_func_t</a> src_notif_callback_info;</div><div class="line">src_notif_callback_info.<a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/structlbm__rcv__src__notification__func__t__stct.html#a21e8f6ccfe58569a8f25118576ba6e51">create_func</a> = src_notif_callback_create;  <span class="comment">/* User function. */</span></div><div class="line">src_notif_callback_info.<a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/structlbm__rcv__src__notification__func__t__stct.html#aa4153d1fbbe0ffca2259c4f2fdf38584">delete_func</a> = src_notif_callback_delete;  <span class="comment">/* User function. */</span></div><div class="line">src_notif_callback_info.<a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/structlbm__rcv__src__notification__func__t__stct.html#a0dd01701648ecca057c07cee3abd43a9">clientd</a> = NULL;   <span class="comment">/* Can be user&#39;s receiver-specific state. */</span></div><div class="line">...</div><div class="line">lbm_rcv_topic_attr_t *rcv_topic_attr;</div><div class="line">err = <a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a0427c06f6d62e7401d9a7d1f09c79a2c">lbm_rcv_topic_attr_create_from_xml</a>(&amp;rcv_topic_attr, <span class="stringliteral">&quot;MyCtx&quot;</span>, receiver_topic_name);</div><div class="line"></div><div class="line">err = <a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a1afc75f0fb3601d072b3463e7acf16a6">lbm_rcv_topic_attr_setopt</a>(rcv_topic_attr, <span class="stringliteral">&quot;source_notification_function&quot;</span>,</div><div class="line">                               &amp;src_notif_callback_info, <span class="keyword">sizeof</span>(src_notif_callback_info));</div><div class="line"></div><div class="line"><a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a3f0c8cba0e6f00fe7ae0ed717405e46d">lbm_topic_t</a> *receiver_topic;</div><div class="line">err = <a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a3de8a6a659896f76475c453683db4e18">lbm_rcv_topic_lookup</a>(&amp;receiver_topic, ctx, receiver_topic_name, rcv_topic_attr);</div><div class="line"></div><div class="line"><a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a0a4af6b8247cc5a0a24a8578fb6e83bd">lbm_rcv_t</a> *receiver;</div><div class="line">err = <a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#aa7491c50fefbc2b70f8035fce7ac1477">lbm_rcv_create</a>(&amp;receiver, ctx, receiver_topic, ...);</div></div><!-- fragment --><p>This creates the <a class="el" href="umobjects.html#receiverobject">Receiver Object</a> with the source notification callback configured. Note that the source notification callback has both a create and a delete function, to facilitate state management by the user.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> * src_notif_callback_create(<span class="keyword">const</span> <span class="keywordtype">char</span> *source_name, <span class="keywordtype">void</span> *clientd)</div><div class="line">{</div><div class="line">  <span class="comment">/* This function is called when the subscription is being set up. */</span></div><div class="line"></div><div class="line">  <span class="comment">/* user code which sets up &quot;msg_for_src&quot; */</span></div><div class="line">  ...</div><div class="line">  <span class="comment">/* A valid UIM destination is &quot;SOURCE:&quot; + source string. */</span></div><div class="line">  <span class="keywordtype">char</span> destination[LBM_MSG_MAX_SOURCE_LEN + 8];</div><div class="line">  strcpy(destination, <span class="stringliteral">&quot;SOURCE:&quot;</span>);</div><div class="line">  strcat(destination, source_name);</div><div class="line"></div><div class="line">  err = <a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a497d77b133cea1547c3346fcba99872a">lbm_unicast_immediate_message</a>(ctx, destination, NULL,   <span class="comment">/* no topic */</span></div><div class="line">                                     msg_for_src, <span class="keyword">sizeof</span>(msg_for_src),</div><div class="line">                                     LBM_SRC_NONBLOCK);  <span class="comment">/* Called from context thread. */</span></div><div class="line">  ...</div><div class="line">  <span class="keywordflow">return</span> NULL;  <span class="comment">/* Can be per-source state. */</span></div><div class="line">}  <span class="comment">/* src_notif_callback_create */</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> src_notif_callback_delete(<span class="keyword">const</span> <span class="keywordtype">char</span> *source_name, <span class="keywordtype">void</span> *clientd, <span class="keywordtype">void</span> *source_clientd) {</div><div class="line">  <span class="comment">/* This function not used for anything in this example, but could be used to</span></div><div class="line"><span class="comment">   * to clean up per-source state. */</span></div><div class="line">  <span class="keywordflow">return</span> 0;</div><div class="line">}  <span class="comment">/* src_notif_callback_delete */</span></div></div><!-- fragment --><p>A Java program configures the source notification callback via <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/javaapi.tag:../JavaAPI/" href="../JavaAPI/classcom_1_1latencybusters_1_1lbm_1_1LBMReceiverAttributes.html#ada8450c3e6c34d298256279418f026a4">com::latencybusters::lbm::LBMReceiverAttributes::setSourceNotificationCallbacks</a>.</p>
<p>A .NET implementation is essentially the same as Java.</p>
<p><br />
 </p>
<h2><a class="anchor" id="sendingtosourcereadiness"></a>
Sending to Source Readiness&nbsp;&nbsp;<small><a href="#sendingtosourcereadiness">&lt;-</a></small></h2>
<p>In most use cases for sending messages to a source, there is an implicit assumption that a subscribing receiver is fully set up and ready to receive messages from the publisher. However, due to the asynchronous nature of UM, there is no straight-forward way for a receiver to know the earliest point in time when messages sent by the source will be delivered to the receiver. For example, in a routed network (using the <a class="el" href="fundamentalconcepts.html#umrouter">DRO</a>), a receiver might deliver BOS to the application, but that just means that the connection to the proper DRO is complete. There could still be delays in the entire end-to-end path being able to deliver messages.</p>
<p>Also, be aware that although unicast immediate messages are delivered via TCP, these messages are not guaranteed. Especially in a routed network, there exists the possibility that a message will fail to reach the publisher.</p>
<p>In most cases, the immediate message is received by the publisher, and by the time the publisher reacts, the end-to-end source-to-receiver path is active. However, in the unlikely event that something goes wrong, a subscribing application should implement a timeout/retry mechanism. This advice is not specific to the "sending to source" use cases, and should be built into any kind of request/response-oriented use case.</p>
<p><br />
 </p>
<h1><a class="anchor" id="spectrum"></a>
Spectrum&nbsp;&nbsp;<small><a href="#spectrum">&lt;-</a></small></h1>
<p>UM Spectrum, which refers to a "spectrum of channels", allows the application designer to sub-divide a topic into any number of channels, which can be individually subscribed to by a receiving application. This provides an extra level of message filtering.</p>
<p>The publisher first allocates the desired number of source channel objects using <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a73298f53aa9c5572cd0b1e68a4ec435a">lbm_src_channel_create()</a>. Then it creates a topic source in the normal way. Finally, the application sends messages using <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a091b5806bf18d10ebd0d9117e0c70229">lbm_src_send_ex()</a>, specifying the source channel object in the <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a21504de56612c7c6e4be655402b47a37">lbm_src_send_ex_info_t</a>'s channel_info field.</p>
<p>A receiving application first creates a topic receiver in the normal way. Then it subscribes to channels using <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#aa8304114445d291e6f16472d733ab250">lbm_rcv_subscribe_channel()</a> or lbm_wrcv_subscribe_channel(). Since each channel requires a different receiver callback, the receiver application can achieve more granular filtering of messages. Moreover, messages are received in-order across channels since all messages are part of the same topic stream.</p>
<p>It should be noted that a regular topic receiver (one for which no spectrum channels are subscribed) delivers all received messages from a matching spectrum topic source to the receiver's callback without creating the channel_info object.</p>
<p>You can accomplish the same level of filtering with a topic space design that creates separate topics for each channel, however, UM cannot guarantee the delivery of messages from multiple sources/topics in any particular order. Not only can UM Spectrum deliver the messages over many channels in the order they were sent by the source, but it also reduces topic resolution traffic since UM advertises only topics, not channels.</p>
<dl class="section note"><dt>Note</dt><dd>With the UMQ product, you cannot use UM Spectrum with Queuing (both Brokered and ULB).</dd></dl>
<p><br />
 </p>
<h2><a class="anchor" id="spectrumperformanceadvantages"></a>
Spectrum Performance Advantages&nbsp;&nbsp;<small><a href="#spectrumperformanceadvantages">&lt;-</a></small></h2>
<p>The use of separate callbacks for different channels improves filtering and also relieves the source application of the task of including filtering information in the message data.</p>
<p>Java and .NET performance also receives a boost because messages not of interest can be discarded before they transition to the Java or .NET level.</p>
<p><br />
 </p>
<h2><a class="anchor" id="spectrumconfigurationoptions"></a>
Spectrum Configuration Options&nbsp;&nbsp;<small><a href="#spectrumconfigurationoptions">&lt;-</a></small></h2>
<p>Spectrum's default behavior delivers messages on any channels the receiver has subscribed to on the callbacks specified when subscribing, and all other messages on the receiver's default callback. This behavior can be changed with the following configuration options.</p>
<ul>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grpdeliverycontrol.html#nullchannelbehaviorreceiver">null_channel_behavior (receiver)</a> - behavior for messages delivered with no channel information. </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grpdeliverycontrol.html#unrecognizedchannelbehaviorreceiver">unrecognized_channel_behavior (receiver)</a> - behavior for messages delivered with channel information but are on a channel for which the receiver has not registered interest. </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grpdeliverycontrol.html#channelmaptableszreceiver">channel_map_tablesz (receiver)</a> - controls the size of the table used by a receiver to store channel subscriptions. </li>
</ul>
<p><br />
 </p>
<h2><a class="anchor" id="spectrumreceivercallback"></a>
Spectrum Receiver Callback&nbsp;&nbsp;<small><a href="#spectrumreceivercallback">&lt;-</a></small></h2>
<p>When an application subscribes to a spectrum channel, it uses the spectrum subscribe API: </p><ul>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#aa8304114445d291e6f16472d733ab250">lbm_rcv_subscribe_channel()</a> - C/C++ </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/javaapi.tag:../JavaAPI/" href="../JavaAPI/classcom_1_1latencybusters_1_1lbm_1_1LBMReceiver.html#a10b09a02efbc148a9176fd2d642e452b">com::latencybusters::lbm::LBMReceiver::subscribeChannel()</a> - Java/.NET </li>
</ul>
<p>Note that when subscribing to a channel, the receiver callback function is optional. If null is supplied as the callback, UM will invoke the underlying receiver's callback.</p>
<p>If a separate callback is supplied for the channel, be aware that only data message event types (<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#aa47eb604db7dc9fd53f9650ed940e058">LBM_MSG_DATA</a>, <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#ab83f7de50ce32f69651a7252d84ea828">LBM_MSG_REQUEST</a>) will be delivered to it. Non-data events (<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#ab5489080adc7157549a9930b30c68425">LBM_MSG_BOS</a>, <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a2647b87f92adb5a34ea129fbfeeed5a3">LBM_MSG_EOS</a>, <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a88920e0a4188081f9a14fc8f76c18578">LBM_MSG_UNRECOVERABLE_LOSS</a>, etc.) will be delivered to the underlying receiver's callback.</p>
<p><br />
 </p>
<h2><a class="anchor" id="smartsourcesandspectrum"></a>
Smart Sources and Spectrum&nbsp;&nbsp;<small><a href="#smartsourcesandspectrum">&lt;-</a></small></h2>
<p><a class="el" href="advancedoptimizations.html#smartsources">Smart Sources</a> support Spectrum, but via different API functions. You need to tell UM that you intend to use spectrum at Smart Source creation time using the <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grpsmartsource.html#smartsrcenablespectrumchannelsource">smart_src_enable_spectrum_channel (source)</a> configuration option. This pre-allocates space in the message header for the spectrum channel.</p>
<p>With Smart Sources, there is no need to allocate a Spectrum source object with <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a73298f53aa9c5572cd0b1e68a4ec435a">lbm_src_channel_create()</a>. Instead, you simply set the <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a5aa5ef8cbf768dd5ad5bb8a709cf9d78">LBM_SSRC_SEND_EX_FLAG_CHANNEL</a> flag and the spectrum channel number in the <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a33886eeac2e67170effea009d2dc3a35">lbm_ssrc_send_ex_info_t</a> passed to the <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a2f50f56536778332e9f5712b06546425">lbm_ssrc_send_ex()</a> API function. It is also usually necessary to tell UM to rebuild the header. For example:</p>
<div class="fragment"><div class="line"><a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/structlbm__ssrc__send__ex__info__t__stct.html">lbm_ssrc_send_ex_info_t</a> ss_send_info;</div><div class="line">memset((<span class="keywordtype">char</span> *)&amp;ss_send_info, 0, <span class="keyword">sizeof</span>(ss_send_info));</div><div class="line">ss_send_info.<a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/structlbm__ssrc__send__ex__info__t__stct.html#a20b6feb8a3737d2ad4330c64552ba18c">flags</a> = <a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a5aa5ef8cbf768dd5ad5bb8a709cf9d78">LBM_SSRC_SEND_EX_FLAG_CHANNEL</a> | <a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a8e81e2661e6d2845790041d170864b1e">LBM_SSRC_SEND_EX_FLAG_REBUILD_BUFFER</a>;</div><div class="line">ss_send_info.<a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/structlbm__ssrc__send__ex__info__t__stct.html#af3318fcf60e612912d16cd401e8aa39e">channel</a> = desired_channel_number;</div><div class="line"></div><div class="line">err = <a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a2f50f56536778332e9f5712b06546425">lbm_ssrc_send_ex</a>(ss, msg_buff, msg_size, 0, &amp;ss_send_info);</div></div><!-- fragment --><p>Note that if you are sending multiple messages in a row to the same spectrum channel, you can get a small performance boost by leaving the header alone and code subsequent calls as:</p>
<div class="fragment"><div class="line"><a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/structlbm__ssrc__send__ex__info__t__stct.html">lbm_ssrc_send_ex_info_t</a> ss_send_info;</div><div class="line">ss_send_info.<a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/structlbm__ssrc__send__ex__info__t__stct.html#a20b6feb8a3737d2ad4330c64552ba18c">flags</a> = <a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a5aa5ef8cbf768dd5ad5bb8a709cf9d78">LBM_SSRC_SEND_EX_FLAG_CHANNEL</a>;</div><div class="line"></div><div class="line">err = <a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a2f50f56536778332e9f5712b06546425">lbm_ssrc_send_ex</a>(ss, msg_buff, msg_size, 0, &amp;ss_send_info);</div></div><!-- fragment --><p>When a Smart Source is created with Spectrum enabled, it is possible to send messages without a Spectrum channel, either by clearing the LBM_SSRC_SEND_EX_FLAG_CHANNEL flag in <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a33886eeac2e67170effea009d2dc3a35">lbm_ssrc_send_ex_info_t</a>, or by simply not supplying a <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a33886eeac2e67170effea009d2dc3a35">lbm_ssrc_send_ex_info_t</a> object by passing NULL for the <code>info</code> parameter. This suppresses all features enabled by that structure.</p>
<dl class="section note"><dt>Note</dt><dd>If using both Spectrum and <a class="el" href="umfeatures.html#messageproperties">Message Properties</a> with a single Smart Source, there is an added restriction: it is not possible to send a message omitting only one of those features. I.e. if both are enabled when the Smart Source is created, it is not possible to send a message with a message property and not a channel, and it is not possible to send a message with a channel and not a property. This is because the message header is defined at Smart Source creation, and the header either must contain both or neither.</dd></dl>
<p><br />
 </p>
<h1><a class="anchor" id="hotfailoverhf"></a>
Hot Failover (HF)&nbsp;&nbsp;<small><a href="#hotfailoverhf">&lt;-</a></small></h1>
<p>UM Hot Failover (HF) lets you implement sender redundancy in your applications. You can create multiple HF senders in different UM contexts, or, for even greater resiliency, on separate machines. There is no hard limit to the number of HF sources, and different HF sources can use different transport types.</p>
<dl class="section note"><dt>Note</dt><dd>With the UMQ product, you cannot use Hot Failover with Queuing (both Brokered and ULB).</dd></dl>
<p>Hot Failover receivers filter out the duplicate messages and deliver one message to your application. Thus, sources can drop a few messages or even fail completely without causing message loss, as long as the HF receiver receives each message from at least one source.</p>
<p>The following diagram displays Hot Failover operation.</p>
<div class="image">
<img src="Hot_Failover.png" alt="Hot_Failover.png"/>
</div>
 <p>In the figure above, HF sources send copies of Message X. An HF receiver delivers the first copy of Message X it receives to the application, and discards subsequent copies coming from the other sources.</p>
<p><br />
 </p>
<h2><a class="anchor" id="implementinghotfailoversources"></a>
Implementing Hot Failover Sources&nbsp;&nbsp;<small><a href="#implementinghotfailoversources">&lt;-</a></small></h2>
<p>You create Hot Failover sources with <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#ab5f6226d21dd4294bbad7d9f3e7c0bf6">lbm_hf_src_create()</a>. This returns a source object with internal state information that lets it send HF messages. You delete HF sources with the <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a29d45db8f76835b4ae78f4568c25712f">lbm_src_delete()</a> function.</p>
<p>HF sources send HF messages via <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#ac515c1425d9b3f04f1e2cea5d66d3005">lbm_hf_src_send_ex()</a> or <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#acb6f42a8811cb998b4b19748b190f39b">lbm_hf_src_sendv_ex()</a>. These functions take a sequence number, supplied via the exinfo object, that HF receivers use to identify the same message sent from different HF sources. The exinfo has an hf_sequence_number, with a flag (LBM_SRC_SEND_EX_FLAG_HF_32 or LBM_SRC_SEND_EX_FLAG_HF_64) that identifies whether it's a 32- or 64-bit number. Each HF source sends the same message content for a given sequence number, which must be coordinated by your application.</p>
<p>If the source needs to restart its sequence number to an earlier value (e.g. start of day; not needed for normal wraparound), delete and re-create the source and receiver objects. Without re-creating the objects, the receiver sees the smaller sequence number, assumes the data are duplicate, and discards it. In (and only in) cases where this cannot be done, use <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a9f7ed3785938fcfd4771965d6430c4f2">lbm_hf_src_send_rcv_reset()</a>.</p>
<dl class="section note"><dt>Note</dt><dd>Your application must synchronize calling <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#ac515c1425d9b3f04f1e2cea5d66d3005">lbm_hf_src_send_ex()</a> or <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#acb6f42a8811cb998b4b19748b190f39b">lbm_hf_src_sendv_ex()</a> with all threads sending on the same source. (One symptom of not doing so is messages appearing at the receiver as inside intentional gaps and being erroneously discarded.)</dd></dl>
<p>Please be aware that non-HF receivers created for an HF topic receive multiple copies of each message. We recommend you establish local conventions regarding the use of HF sources, such as including "HF" in the topic name.</p>
<p>For an example source application, see <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/example.tag:../example/" href="../example/index.html#examplelbmhfsrc_c">Example lbmhfsrc.c</a>.</p>
<p><br />
 </p>
<h2><a class="anchor" id="implementinghotfailoverreceivers"></a>
Implementing Hot Failover Receivers&nbsp;&nbsp;<small><a href="#implementinghotfailoverreceivers">&lt;-</a></small></h2>
<p>You create HF receivers with <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#ac208c246a6e856e24e1130060e1806c3">lbm_hf_rcv_create()</a>, and delete them using <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#abc68152bcf4d18ef1d31d8f6a15ac080">lbm_hf_rcv_delete()</a> and <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a755bd1ee0a12622098b618cef46d254f">lbm_hf_rcv_delete_ex()</a>.</p>
<p>Incoming messages have an hf_sequence_number field containing the sequence number, and a message flag (LBM_MSG_FLAG_HF_32 or LBM_MSG_FLAG_HF_64) noting the bit size.</p>
<dl class="section note"><dt>Note</dt><dd>Previous UM versions used sequence_number for HF message identification. This field holds a 32-bit value and is still set for backwards compatibility, but if the HF sequence numbers are 64-bit lengths, this non-HF sequence number is set to 0. Also, you can retrieve the original (non-HF) topic sequence number via lbm_msg_retrieve_original_sequence_number() or, in Java and .NET, via LBMMessage.osqn().</dd></dl>
<p>For the maximum time period to recover lost messages, the HF receiver uses the minimum of the LBT-RM and LBT-RU NAK generation intervals (<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grptransportlbtrmreliability.html#transportlbtrmnakgenerationintervalreceiver">transport_lbtrm_nak_generation_interval (receiver)</a>, <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grptransportlbtrureliability.html#transportlbtrunakgenerationintervalreceiver">transport_lbtru_nak_generation_interval (receiver)</a>). Each transport protocol is configured as normal, but the lost message recovery timer is the minimum of the two settings.</p>
<p>Some lbm_msg_t objects coming from HF receivers may be flagged as having "passed through" the HF receiver. This means that the message has not been ordered with other HF messages. These messages have the LBM_MSG_FLAG_HF_PASS_THROUGH flag set. UM flags messages sent from HF sources using <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a91f4b9cb04fe1323ec56833211cc5cb7">lbm_src_send()</a> in this manner, as do all non-HF sources. Also, UM flags EOS, no source notification, and requests in this manner as well.</p>
<p>For an example receiver application, see <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/example.tag:../example/" href="../example/index.html#examplelbmhfrcv_c">Example lbmhfrcv.c</a>.</p>
<p><br />
 </p>
<h2><a class="anchor" id="implementinghotfailoverwildcardreceivers"></a>
Implementing Hot Failover Wildcard Receivers&nbsp;&nbsp;<small><a href="#implementinghotfailoverwildcardreceivers">&lt;-</a></small></h2>
<p>To create an HF wildcard receiver, set option <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grphotfailoveroperation.html#hfreceiverwildcardreceiver">hf_receiver (wildcard_receiver)</a> to 1, then create a wildcard receiver with <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a5b5d52f6b87499213757b73b09bc8160">lbm_wildcard_rcv_create()</a>. This actually creates individual HF receivers on a per-topic basis, so that each topic can have its own set of HF sequence numbers. Once the HF wildcard receiver detects that all sources for a particular topic are gone it closes the individual topic HF receivers and discards the HF sequence information (unlike a standard HF receiver). You can extend or control the delete timeout period of individual HF receivers with option <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grpwildcardreceiver.html#resolvernosourcelingertimeoutwildcardreceiver">resolver_no_source_linger_timeout (wildcard_receiver)</a>.</p>
<p><br />
 </p>
<h2><a class="anchor" id="javaandnet"></a>
Java and .NET&nbsp;&nbsp;<small><a href="#javaandnet">&lt;-</a></small></h2>
<p>For information on implement the HF feature in a Java application, go to UM Java API and see the documentation for classes <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/javaapi.tag:../JavaAPI/" href="../JavaAPI/classcom_1_1latencybusters_1_1lbm_1_1LBMHotFailoverReceiver.html">LBMHotFailoverReceiver</a> and <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/javaapi.tag:../JavaAPI/" href="../JavaAPI/classcom_1_1latencybusters_1_1lbm_1_1LBMHotFailoverSource.html">LBMHotFailoverSource</a>.</p>
<p>For information on implement the HF feature in a .NET application, go to UM .NET API and navigate to Namespaces-&gt;<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/javaapi.tag:../JavaAPI/" href="../JavaAPI/classcom_1_1latencybusters_1_1lbm_1_1LBM.html">com.latencybusters.lbm</a>-&gt;LBMHotFailoverReceiver and LBMHotFailoverSource.</p>
<p><br />
 </p>
<h2><a class="anchor" id="usinghotfailoverwithpersistence"></a>
Using Hot Failover with Persistence&nbsp;&nbsp;<small><a href="#usinghotfailoverwithpersistence">&lt;-</a></small></h2>
<p>When implementing Hot Failover with Persistence, you must consider the following impact on hardware resources:</p>
<ul>
<li>
Additional storage space required for a persistent Store </li>
<li>
Higher disk activity </li>
<li>
Higher network activity </li>
<li>
Increased application complexity regarding message filtering </li>
</ul>
<p>Also note that you must enable <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/ume.tag:../UME/" href="../UME/designingpersistentreceivers.html#explicitacknowledgments">Explicit Acknowledgments</a> and "Hot Failover duplicate delivery" (<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grphotfailoveroperation.html#hfduplicatedeliveryreceiver">hf_duplicate_delivery (receiver)</a>) in each Hot Failover receiving application.</p>
<p>For detailed information on using Hot Failover with Persistence, see the Knowledge Base article <a href="https://kb.informatica.com/faq/5/Pages/80173.aspx">FAQ: Is UMP compatible with Hot Failover?</a></p>
<p><br />
 </p>
<h2><a class="anchor" id="hotfailoverintentionalgapsupport"></a>
Hot Failover Intentional Gap Support&nbsp;&nbsp;<small><a href="#hotfailoverintentionalgapsupport">&lt;-</a></small></h2>
<p>UM supports intentional gaps in HF message streams. Your HF sources can supply message sequence numbers with number gaps up to 1073741824. HF receivers automatically detect the gaps and consider any missing message sequence numbers as not sent and do not attempt recovery for these missing sequence numbers. See the following example.</p>
<ol>
<li>
HF source 1 sends message sequence numbers: 10, 11, 12, 13, 25, 26, 38 </li>
<li>
HF source 2 sends message sequence numbers: 10, 11, 12, 13, 25, 26, 38 </li>
</ol>
<p>HF receiver 1 receives message sequence numbers in order with no pause between any messages: 10, 11, 12, 13, 25, 26, 38</p>
<p><br />
 </p>
<h2><a class="anchor" id="hotfailoveroptionalmessages"></a>
Hot Failover Optional Messages&nbsp;&nbsp;<small><a href="#hotfailoveroptionalmessages">&lt;-</a></small></h2>
<p>Hot Failover sources can send optional messages that HF receivers can be configured to receive or not receive (<a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grphotfailoveroperation.html#hfoptionalmessagesreceiver">hf_optional_messages (receiver)</a>). HF receivers detect an optional message by checking <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/structlbm__msg__t__stct.html#a9041a176f44dca95c3a5c6cc23d32d6c">lbm_msg_t.flags</a> for LBM_MSG_FLAG_HF_OPTIONAL. HF sources indicate an optional message by passing <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a5bf62d916b1acee97156dc8077ac3584">LBM_SRC_SEND_EX_FLAG_HF_OPTIONAL</a> in the <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/structlbm__src__send__ex__info__t__stct.html#aa450a079510ebdc97b19625d10bd18ea">lbm_src_send_ex_info_t.flags</a> field to <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#ac515c1425d9b3f04f1e2cea5d66d3005">lbm_hf_src_send_ex()</a> or <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#acb6f42a8811cb998b4b19748b190f39b">lbm_hf_src_sendv_ex()</a>. In the examples below, optional messages appear with an "o" after the sequence number.</p>
<ol>
<li>
HF source 1 sends message sequence numbers: 10, 11, 12, 13o, 14o, 15, 16o, 17o, 18o, 19o, 20 </li>
<li>
HF source 2 sends message sequence numbers: 10, 11, 12, 13o, 14o, 15, 16o, 17o, 18o, 19o, 20 </li>
</ol>
<p>HF receiver 1 receives: 10, 11, 12, 13o, 14o, 15, 16o, 17o, 18o, 19o, 20</p>
<p>HF receiver 2, configured to ignore optional messages, receives: 10, 11, 12, 15, 20</p>
<p><br />
 </p>
<h2><a class="anchor" id="usinghotfailoverwithordereddelivery"></a>
Using Hot Failover with Ordered Delivery&nbsp;&nbsp;<small><a href="#usinghotfailoverwithordereddelivery">&lt;-</a></small></h2>
<p>An HF receiver takes some of its operating parameters directly from the receive topic attributes. The <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grpmajoroptions.html#ordereddeliveryreceiver">ordered_delivery (receiver)</a> setting indicates the ordering for the HF receiver.</p>
<dl class="section note"><dt>Note</dt><dd>UM supports Arrival Order with HF only when all sources use the same transport type.</dd></dl>
<p><br />
 </p>
<h2><a class="anchor" id="hotfailoveracrossmultiplecontexts"></a>
Hot Failover Across Multiple Contexts (HFX)&nbsp;&nbsp;<small><a href="#hotfailoveracrossmultiplecontexts">&lt;-</a></small></h2>
<dl class="section warning"><dt>Warning</dt><dd><b>The HFX feature is deprecated and may be removed in a future release</b>. Users of HFX are advised to <a href="https://ultramessaging.github.io/UM_Support.html">contact Informatica Support</a>.</dd></dl>
<p>If you have a receiving application on a multi-homed machine receiving HF messages from HF sources, you can set up the Hot Failover Across Contexts (HFX) feature. This involves setting up a separate UM context to receive HF messages over each NIC and then creating an HFX Object, which drops duplicate HF messages arriving over all contexts. Your receiving application then receives only one copy of each HF message. The HFX feature achieves the same effect across multiple contexts as the normal Hot Failover feature does within a single context.</p>
<p>The following diagram displays Hot Failover operation across UM contexts.</p>
<div class="image">
<img src="Hot_Failover_X.png" alt="Hot_Failover_X.png"/>
</div>
 <p>For each context that receives HF messages, create one HFX Receiver per topic. Each HFX Receiver can be configured independently by passing in a UM Receiver attributes object during creation. A unique client data pointer can also be associated with each HFX Receiver. The HFX Object is a special Ultra Messaging object and does not live in any UM context.</p>
<p>Note: You never have to call lbm_topic_lookup() for a HFX Receiver. If you are creating HFX Receivers along with normal UM receivers for the same topic, do not interleave the calls. For example, call <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a82e9efbf70242d83ab287916ac497645">lbm_hfx_create()</a> and <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#ae717b7b9923a6e4277ae9f7409983ffc">lbm_hfx_rcv_create()</a> for the topic. Then call lbm_topic_lookup() and <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#aa7491c50fefbc2b70f8035fce7ac1477">lbm_rcv_create()</a> for the topic to create the normal UM receivers.</p>
<p>The following outlines the general procedure for HFX.</p>
<ol>
<li>
Create an HFX Object for every HF topic of interest with <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a82e9efbf70242d83ab287916ac497645">lbm_hfx_create()</a>, passing in an attributes object created with <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#aabc739544b1a28481e9b4bc51bb49705">lbm_hfx_attr_create_from_xml()</a> to specify any attributes desired. </li>
<li>
Create a context for the first NIC receiving HF messages with <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a8058947690bd0995bc2c59d4a61b462f">lbm_context_create()</a>. </li>
<li>
Create a HFX Receiver for every HF topic with <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#ae717b7b9923a6e4277ae9f7409983ffc">lbm_hfx_rcv_create()</a>, passing in UM Receive Topic Attributes. </li>
<li>
Repeat steps 2 and 3 for all NICs receiving HF message </li>
<li>
Receive messages. The HFX Object identifies and drops all duplicates, delivering messages through a single callback (and optional event queue) specified when you created the HFX Object. </li>
</ol>
<p>Delete each HFX Receiver with <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a096626db73533d6c39b22765014485b7">lbm_hfx_rcv_delete()</a> or <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a08d8cbd7f47af1d7b2199c85ecf7c44c">lbm_hfx_rcv_delete_ex()</a>. Delete the HFX Object with <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#abc9924a0bd826db0c45a42d7199030b1">lbm_hfx_delete()</a>.</p>
<dl class="section note"><dt>Note</dt><dd>When writing source-side HF applications for HFX, be aware that HFX receivers do not support hf_sequence, 64-bit sequence numbers, the <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#a9f7ed3785938fcfd4771965d6430c4f2">lbm_hf_src_send_rcv_reset()</a> function, or HF wildcard receivers. See <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grphotfailoveroperation.html">Hot Failover Operation Options</a>, especially HFX-specific options.</dd></dl>
<p><a class="anchor" id="daemonstatistics"></a><br />
 </p>
<h1><a class="anchor" id="binarydaemonstatistics"></a>
Binary Daemon Statistics&nbsp;&nbsp;<small><a href="#binarydaemonstatistics">&lt;-</a></small></h1>
<dl class="section note"><dt>Note</dt><dd>the C-style binary structure format of daemon statistics is DEPRECATED and may be removed in a future release. Informatica requests that users migrate to protobuf-based format. See <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/operations.tag:../Operations/" href="../Operations/monitoring.html#monitoringumdaemons">Monitoring UM Daemons</a>.</dd></dl>
<p>The <a class="el" href="fundamentalconcepts.html#persistence">Persistence</a> Store daemon and the <a class="el" href="fundamentalconcepts.html#umrouter">DRO</a> daemon each have a simple web server which provides operational information. This information is important for monitoring the operation and performance of these daemons. However, while the web-based presentation is convenient for manual, on-demand monitoring, it is not suitable for automated collection and recording of operational information for historical analysis.</p>
<p>(The <a class="el" href="umglossary.html#glossaryumds">UMDS</a> product also supports Daemon Statistics as of UMDS version 6.12; see UMDS documentation for details.)</p>
<p>Starting with UM version 6.11, a feature called "Daemon Statistics" has been added to the Store and DRO daemons. The Stateful Resolver Service (SRS), added in UM version 6.12, supports Daemon Statistics only (no web server). The Daemon Statistics feature supports the background publishing of their operational information via UM messages. Monitoring systems can now subscribe to this information in much the same way that UM transport statistics can be subscribed.</p>
<p>While the information published by the Store, DRO, and SRS daemon statistics differ in their content, the general feature usage is the same between them. When the feature is configured, the daemon will periodically collect and publish its operational information.</p>
<p>The following sections give general information which is common across daemons, followed by links to daemon-specific details.</p>
<p><br />
 </p>
<h2><a class="anchor" id="daemoncontroller"></a>
Daemon Controller&nbsp;&nbsp;<small><a href="#daemoncontroller">&lt;-</a></small></h2>
<p>With the introduction of the Daemon Statistics feature, a new context is added to the daemons: the Daemon Controller. This context publishes the statistics and also can be configured to accept daemon control requests from external applications. These control requests are primarily used for controlling the Daemon Statistics feature (see <a class="el" href="umfeatures.html#daemoncontrolrequests">Daemon Control Requests</a>), but are also used for a few daemon-specific control functions that are unrelated to Daemon Statistics (for example, <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/ume.tag:../UME/" href="../UME/storedaemonstatistics.html#requestmarkstoredmessageinvalid">Request: Mark Stored Message Invalid</a>).</p>
<p>Note that in every UM component that supports the Daemon Statistics feature, the Daemon Controller defaults to disabled. Each component's Daemon Statistics configuration must be set to enable the function of the Daemon Controller.</p>
<p><br />
 </p>
<h2><a class="anchor" id="daemonstatisticsstructures"></a>
Daemon Statistics Structures&nbsp;&nbsp;<small><a href="#daemonstatisticsstructures">&lt;-</a></small></h2>
<dl class="section note"><dt>Note</dt><dd>the C-style binary structure format of daemon statistics is DEPRECATED and may be removed in a future release. Informatica requests that users migrate to protobuf-based format. See <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/operations.tag:../Operations/" href="../Operations/monitoring.html#monitoringumdaemons">Monitoring UM Daemons</a>.</dd></dl>
<p>The operational information is published as messages of different types sent over a normal UM topic source (topic name configurable). For the Store and DRO daemons, each message is in the form of a binary, C-style data structure.</p>
<p>There are generally two categories of messages: <em>config</em> and <em>stats</em>. A given instance of a category "config" message does not have content which changes over time. An instance of a category "stats" message has content that <em>does</em> change over time. The daemon-specific documentation indicates which messages are in which category.</p>
<p>Each message type is configured for a publishing interval. When the publishing interval for a message type expires, the possible messages are checked to see if its content has materially changed since the last interval. If not, then the message is <em>not</em> republished. The publishing interval for a stat message is typically set to shorter periods to see those changes as they occur.</p>
<p>Note that the SRS message format is JSON, and therefore the granularity of published data is finer. I.e. a given message type might be published, but only a subset of the fields within the message might be included. In contrast, the daemons which publish binary structures send the structures complete.</p>
<p>Finally, note that while the contents of a given instance of a config message does not change over time, new instances of the message type can be sent as a result of state changes. For example, a new instance of <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/umedmonmsgs_8h.html#a3e3a1b935708cc8ac42cb70b0caf6808">umestore_repo_dmon_config_msg_t</a> is published each time a new source registers with the Store.</p>
<p>More detailed information is available in the daemon-specific documentation referenced below.</p>
<p><br />
 </p>
<h2><a class="anchor" id="daemonstatisticsbinarydata"></a>
Daemon Statistics Binary Data&nbsp;&nbsp;<small><a href="#daemonstatisticsbinarydata">&lt;-</a></small></h2>
<dl class="section note"><dt>Note</dt><dd>the C-style binary structure format of daemon statistics is DEPRECATED and may be removed in a future release. Informatica requests that users migrate to protobuf-based format. See <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/operations.tag:../Operations/" href="../Operations/monitoring.html#monitoringumdaemons">Monitoring UM Daemons</a>.</dd></dl>
<p>For the Store and DRO daemons, the messages published are in binary form and map onto the C data structures defined for each message type.</p>
<p>For the SRS service, the messages are formatted as JSON, so this section does not apply to the SRS.</p>
<p>The byte order of the structure fields is defined as the host endian architecture of the publishing daemon. Thus, if a monitoring host receiving the messages has the same endian architecture, the binary structures can be used directly. If the monitoring host has the opposite endian architecture, the receiver must byte-swap the fields.</p>
<p>The message structure is designed to make it possible for a monitoring application to detect a mismatch in endian architecture. Detection and byte swapping is demonstrated with daemon-specific example monitoring applications.</p>
<p>More detailed information is available in the daemon-specific documentation referenced below.</p>
<p><br />
 </p>
<h2><a class="anchor" id="daemonstatisticsversioning"></a>
Daemon Statistics Versioning&nbsp;&nbsp;<small><a href="#daemonstatisticsversioning">&lt;-</a></small></h2>
<dl class="section note"><dt>Note</dt><dd>the C-style binary structure format of daemon statistics is DEPRECATED and may be removed in a future release. Informatica requests that users migrate to protobuf-based format. See <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/operations.tag:../Operations/" href="../Operations/monitoring.html#monitoringumdaemons">Monitoring UM Daemons</a>.</dd></dl>
<p>For the Store and DRO daemons, each message sent by the daemon consists of a standard header followed by a message-type-specific set of fields. The standard header contains a <code>version</code> field which identifies the version of the C include file used to build the daemon.</p>
<p>For the SRS service, the messages are formatted as JSON, so this section does not apply to the SRS.</p>
<p>For example, the Store daemon is built with the include file <code><a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/umedmonmsgs_8h.html">umedmonmsgs.h</a></code>. With each daemon statistics message sent by the Store daemon, it sets the header version field to <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/umedmonmsgs_8h.html#af43ca32ea1917897c4ff1310d214c20b">LBM_UMESTORE_DMON_VERSION</a>. With each new release of the UM package, if that include file changes in a substantive way, the value of <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/umedmonmsgs_8h.html#af43ca32ea1917897c4ff1310d214c20b">LBM_UMESTORE_DMON_VERSION</a> is increased. In this way, a monitoring application can determine if it is receiving messages from a Store daemon whose data structures match the monitoring application's structure definitions.</p>
<p>More detailed information is available in the daemon-specific documentation referenced below.</p>
<p><br />
 </p>
<h2><a class="anchor" id="daemoncontrolrequests"></a>
Daemon Control Requests&nbsp;&nbsp;<small><a href="#daemoncontrolrequests">&lt;-</a></small></h2>
<dl class="section note"><dt>Note</dt><dd>the C-style binary structure format of daemon statistics is DEPRECATED and may be removed in a future release. Informatica requests that users migrate to protobuf-based format. See <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/operations.tag:../Operations/" href="../Operations/monitoring.html#monitoringumdaemons">Monitoring UM Daemons</a>.</dd></dl>
<p>Each daemon publishing binary daemon stats can optionally be configured to accept command-and-control requests from administrative applications. These command-and-control requests are handled by the daemon's <a class="el" href="umfeatures.html#daemoncontroller">Daemon Controller</a>, a context added to support Daemon Statistics.</p>
<dl class="section warning"><dt>Warning</dt><dd>If misused, the Daemon Control Requests feature allows a user to interfere with the messaging infrastructure in potentially disruptive ways. By default, this feature is disabled. However, specially if "config" requests are enabled, Informatica recommends <a class="el" href="umfeatures.html#securingdaemoncontrolrequests">Securing Daemon Control Requests</a>.</dd></dl>
<p>There are different categories of these requests. All daemons have in common categories <em>"snapshot"</em> and <em>"config"</em>, which are related to Daemon Statistics. Other categories are specific to the daemon type.</p>
<p>"Snapshot" requests tell the daemon to immediately republish the desired stats and/or configs without waiting until the next publishing interval. These requests might be sent by a monitoring application which has only just started running and needs a full snapshot of the operational information.</p>
<p>"Config" requests tell the daemon to modify an operational parameter of the running daemon.</p>
<p>An application sends a request to the daemon, and the daemon sends status messages in response. The exchanges are made via standard UM topicless immediate <a class="el" href="fundamentalconcepts.html#requestresponse">Request/Response</a> messaging. These requests should be sent using the Unicast Immediate Messaging (UIM) API for sending the requests using <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/api.tag:../API/" href="../API/lbm_8h.html#ae011c7a66e1db1f012d7f9633dbd321d">lbm_unicast_immediate_request()</a>. See <a class="el" href="umfeatures.html#unicastimmediatemessaging">Unicast Immediate Messaging</a> for details on UIM.</p>
<p>To use UIM effectively, Informatica recommends configuring the daemon monitor context for a specific UIM interface and port using: <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grpunicastimmediatemessagingnetwork.html#requesttcpportcontext">request_tcp_port (context)</a> and <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grpunicastimmediatemessagingnetwork.html#requesttcpinterfacecontext">request_tcp_interface (context)</a>. This enables the monitoring application to know how to address the request UIMs to the proper daemon.</p>
<p>For the Store and DRO daemons, The request message is formatted as a simple ASCII string. For the SRS service, the request message is formatted as a JSON message. The request is sent as a topicless unicast immediate request message. The daemon reacts by parsing the request and sending a UM response with a success/failure response. If the request was parsed successfully, the daemon then performs the requested operation (republishing the data or modifying the operational parameter). There are daemon-specific example applications which demonstrate the use of this request feature.</p>
<p>More detailed information is available in the daemon-specific documentation referenced below.</p>
<p><br />
 </p>
<h2><a class="anchor" id="securingdaemoncontrolrequests"></a>
Securing Daemon Control Requests&nbsp;&nbsp;<small><a href="#securingdaemoncontrolrequests">&lt;-</a></small></h2>
<dl class="section note"><dt>Note</dt><dd>the C-style binary structure format of daemon statistics is DEPRECATED and may be removed in a future release. Informatica requests that users migrate to protobuf-based format. See <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/operations.tag:../Operations/" href="../Operations/monitoring.html#monitoringumdaemons">Monitoring UM Daemons</a>.</dd></dl>
<p>UM Daemon Statistics are implemented using normal UM messaging. In particular, the <a class="el" href="umfeatures.html#daemoncontroller">Daemon Controller</a> capability allows a remote application to send requests to a daemon that modify its behavior. If misused, these behaviors can be disruptive to normal operation. For example, the "umedmon" program can instruct a persistent Store to flag stored messages as invalid, which would prevent their delivery to a recovering receiver.</p>
<p>Note that the UM daemons default to rejecting these command-and-control messages, so taking special security precautions is only necessary if you have configured daemons to enable the Daemon Control requests.</p>
<p>One common way to prevent unauthorized use is to tightly control access to your production network so that no unauthorized users can accidentally or maliciously use Daemon Control requests to interfere with normal operation.</p>
<p>Additionally, you can configure the Daemon Control context for encryption, which supports certificate-based access control. This requires the use of an encrypted <a class="el" href="fundamentalconcepts.html#topicresolutiondomain">TRD</a> for Daemon Statistics. If your normal message data is unencrypted, you will need to define one or more <em>new</em> TRDs for Daemon Statistics that are separate from the normal TRDs (an encrypted TRD must not have unencrypted contexts assigned to it).</p>
<p>Use the <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/config.tag:../Config/" href="../Config/grpencryptedtcp.html#usetlscontext">use_tls (context)</a> configuration option in the UM configuration file you supply for the Daemon Statistics. For example, for the Store Daemon use the <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/ume.tag:../UME/" href="../UME/configurationreferenceforumestored.html#umeelementlbmconfig">UMP Element "&lt;lbm-config&gt;"</a> contained within the <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/ume.tag:../UME/" href="../UME/configurationreferenceforumestored.html#umeelementdaemonmonitor">UMP Element "&lt;daemon-monitor&gt;"</a>.</p>
<p>Note that the use of an encrypted TRD will require that the Daemon Statistics data be configured for the <a class="el" href="transporttypes.html#transporttcp">TCP transport</a>.</p>
<p>Since UM's encryption feature is certificate-based. A user wanting to use a Daemon Control request tool must have access to the proper certificate file(s). This means that unauthorized users must <em>not</em> have access to the certificate file(s).</p>
<p>Finally, be aware that a partially-encrypted DRO network can break the security of an encrypted TRD; see <a class="el" href="umfeatures.html#tlsandthedynamicroutingoptiondro">TLS and the DRO</a>.</p>
<p>See <a class="el" href="umfeatures.html#encryptedtcp">Encrypted TCP</a> for details on using encryption.</p>
<p><br />
 </p>
<h2><a class="anchor" id="daemonstatisticsdetails"></a>
Daemon Statistics Details&nbsp;&nbsp;<small><a href="#daemonstatisticsdetails">&lt;-</a></small></h2>
<dl class="section note"><dt>Note</dt><dd>the C-style binary structure format of daemon statistics is DEPRECATED and may be removed in a future release. Informatica requests that users migrate to protobuf-based format. See <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/operations.tag:../Operations/" href="../Operations/monitoring.html#monitoringumdaemons">Monitoring UM Daemons</a>.</dd></dl>
<p>For details on the persistent Store's daemon statistics feature, see <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/ume.tag:../UME/" href="../UME/storedaemonstatistics.html">Store Binary Daemon Statistics</a>.</p>
<p>For details on the <a class="el" href="fundamentalconcepts.html#umrouter">DRO</a>'s daemon statistics feature, see <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/Design/gateway.tag:../Gateway/" href="../Gateway/umrouterdaemonstatistics.html">DRO Binary Daemon Statistics</a>.</p>
<p>For details on the SRS's daemon statistics feature, see <a class="el" href="srsdaemonstatistics.html">SRS Daemon Statistics</a>.</p>
<p><br />
<br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
</p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
</body>
</html>
