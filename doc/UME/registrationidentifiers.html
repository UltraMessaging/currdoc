<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Guide for Persistence: Registration Identifiers</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen_manual.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Guide for Persistence
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('registrationidentifiers.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Registration Identifiers </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>As mentioned in <a class="el" href="persistenceconcepts.html#registrationidentifierconcept">Registration Identifier Concept</a> and <a class="el" href="enablingpersistence.html#addingfaultrecoverywithregistrationids">Adding Fault Recovery with Registration IDs</a>, Stores use RegIDs to identify sources and receivers. UM offers three main methods for managing RegIDs:</p>
<ul>
<li>
<p class="startli"><b>Recommended</b>: use Session IDs to enable the Store to both assign and manage RegIDs. See <a class="el" href="registrationidentifiers.html#managingregidswithsessionids">Managing RegIDs with Session IDs</a>. Note: while the use of Session IDs is recommended, an understanding of the underlying registration IDs is often helpful to understanding persistence.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">Your applications assign static RegIDs and ensure that the same RegID is not assigned to multiple sources and/or receivers. See <a class="el" href="registrationidentifiers.html#usestaticregids">Use Static RegIDs</a>.</p>
<p class="endli"></p>
</li>
<li>
You can allow Stores to assign RegIDs and then save the assigned RegIDs for subsequent reuse. See <a class="el" href="registrationidentifiers.html#saveassignedregids">Save Assigned RegIDs</a>. </li>
</ul>
<p>Your applications can manage RegIDs for the lifetime of a source or receiver as long as multiple applications do not reuse RegIDs simultaneously on the same Store. RegIDs only need to be unique on the same Store and may be reused between Stores as desired. You can use a static mapping of RegIDs to applications or use some simple service to assign them.</p>
<p><br />
 </p>
<h1><a class="anchor" id="usestaticregids"></a>
Use Static RegIDs&nbsp;&nbsp;<small><a href="#usestaticregids">&lt;-</a></small></h1>
<p>For very small deployments, the simplest method uses static RegIDs for individual applications. This method requires every persistent source connecting to a given Store have a unique RegID from every other persistent source attaching to the same Store. This includes publishing applications that have multiple persistent topics; each topic's source object must have a unique RegID. (The use of session IDs greatly simplifies the management of these RegIDs.)</p>
<p>The following source code examples assign a static RegID to a source by adding the RegID, 1000, to the <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/UME/config.tag:../Config/" href="../Config/grpultramessagingpersistence.html#umestoresource">ume_store (source)</a> LBM configuration option. See also <a href="../example/ume-example-src-2.c">ume-example-src-2.c</a></p>
<p><b>C API</b></p>
<div class="fragment"><div class="line"><a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/UME/api.tag:../API/" href="../API/lbm_8h.html#a30c33f443cf2d228f4772d534ce3ee88">lbm_src_topic_attr_t</a> * sattr;</div><div class="line"></div><div class="line"><span class="keywordflow">if</span> (<a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/UME/api.tag:../API/" href="../API/lbm_8h.html#adc12814cac6280b5bd48bfde41d7c88a">lbm_src_topic_attr_create_from_xml</a>(&amp;sattr, <span class="stringliteral">&quot;MyCtx&quot;</span>, src_topic_name) == LBM_FAILURE) {</div><div class="line">  fprintf(stderr, <span class="stringliteral">&quot;lbm_src_topic_attr_create_from_xml: %s\n&quot;</span>, <a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/UME/api.tag:../API/" href="../API/lbm_8h.html#a22a4650d3a5b649c84a0c05adedcc055">lbm_errmsg</a>());</div><div class="line">  exit(1);</div><div class="line">}</div><div class="line"><span class="keywordflow">if</span> (<a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/UME/api.tag:../API/" href="../API/lbm_8h.html#a422f330bf7ef3efdd7a9f17caabccb24">lbm_src_topic_attr_str_setopt</a>(sattr, <span class="stringliteral">&quot;ume_store&quot;</span>, <span class="stringliteral">&quot;127.0.0.1:14567:1000&quot;</span>)</div><div class="line">== LBM_FAILURE) {</div><div class="line">  fprintf(stderr, <span class="stringliteral">&quot;lbm_src_topic_attr_str_setopt: %s\n&quot;</span>, <a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/UME/api.tag:../API/" href="../API/lbm_8h.html#a22a4650d3a5b649c84a0c05adedcc055">lbm_errmsg</a>());</div><div class="line">  exit(1);</div><div class="line">}</div></div><!-- fragment --><p><b>JAVA API</b></p>
<div class="fragment"><div class="line">LBMSourceAttributes sattr = null;</div><div class="line"><span class="keywordflow">try</span> {</div><div class="line">  sattr = <span class="keyword">new</span> LBMSourceAttributes();</div><div class="line">  sattr.setValue(<span class="stringliteral">&quot;ume_store&quot;</span>, <span class="stringliteral">&quot;127.0.0.1:14567:1000&quot;</span>);</div><div class="line">}</div><div class="line"><span class="keywordflow">catch</span> (LBMException ex) {</div><div class="line">  System.err.println(<span class="stringliteral">&quot;Error creating source attribute: &quot;</span> + ex.toString());</div><div class="line">  System.exit(1);</div><div class="line">}</div></div><!-- fragment --><p><b>.NET API</b></p>
<div class="fragment"><div class="line">LBMSourceAttributes sattr = null;</div><div class="line"><span class="keywordflow">try</span> {</div><div class="line">  sattr = <span class="keyword">new</span> LBMSourceAttributes();</div><div class="line">  sattr.setValue(<span class="stringliteral">&quot;ume_store&quot;</span>, <span class="stringliteral">&quot;127.0.0.1:14567:1000&quot;</span>);</div><div class="line">}</div><div class="line"><span class="keywordflow">catch</span> (LBMException ex) {</div><div class="line">  System.Console.Error.WriteLine (<span class="stringliteral">&quot;Error creating source attribute: &quot;</span> + ex.toString());</div><div class="line">  System.Environment.Exit(1);</div><div class="line">}</div></div><!-- fragment --><p><br />
 </p>
<h1><a class="anchor" id="saveassignedregids"></a>
Save Assigned RegIDs&nbsp;&nbsp;<small><a href="#saveassignedregids">&lt;-</a></small></h1>
<p>When using RegIDs, your application can request that the Store assign it a new and unique RegID when it registers for the first time. That RegID is made available to the application, which can then save it to local storage. Thus, the next time the application starts (or restarts) and wants to use the same registration, it reads the value written to local storage. This method of managing RegIDs is not common. For example, what if the application needs to be restarted on a different server due to hardware failure? If it cannot re-register with its earlier RegID, it will not be able to recover only those messages it had not yet acknowledged. (The use of Session IDs simplifies this greatly by essentially saving the registration IDs for you on the Store itself.)</p>
<p>The following minimal source code example saves the RegID assigned to a source to a file. See also <a href="../example/ume-example-src-3.c">ume-example-src-3.c</a></p>
<p><b>C API</b></p>
<div class="fragment"><div class="line"><span class="comment">/* Callback invoked by UM for source events. */</span></div><div class="line"><span class="keywordtype">int</span> app_src_callback(<a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/UME/api.tag:../API/" href="../API/lbm_8h.html#a717ff27bb10ae7800330c21d810dffb8">lbm_src_t</a> *src, <span class="keywordtype">int</span> event, <span class="keywordtype">void</span> *eventd, <span class="keywordtype">void</span> *clientd)</div><div class="line">{</div><div class="line">  ...</div><div class="line">  <span class="keywordflow">switch</span> (event) {</div><div class="line">  ...</div><div class="line">  <span class="keywordflow">case</span> <a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/UME/api.tag:../API/" href="../API/lbm_8h.html#a99e39b5b7215553654f91f8b74ad98c8">LBM_SRC_EVENT_UME_REGISTRATION_SUCCESS_EX</a>:</div><div class="line">    <span class="comment">/* Get the registration information. */</span></div><div class="line">    <a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/UME/api.tag:../API/" href="../API/structlbm__src__event__ume__registration__ex__t__stct.html">lbm_src_event_ume_registration_ex_t</a> *reginfo = (<a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/UME/api.tag:../API/" href="../API/structlbm__src__event__ume__registration__ex__t__stct.html">lbm_src_event_ume_registration_ex_t</a> *)eventd;</div><div class="line"></div><div class="line">    <span class="comment">/* Might want to do the following conditionally only if we are requesting a new RegID. */</span></div><div class="line">    FILE *fp = fopen(<span class="stringliteral">&quot;UME-example-src-RegID&quot;</span>, <span class="stringliteral">&quot;w&quot;</span>);  <span class="comment">/* Error checking omitted for clarity. */</span></div><div class="line">    fprintf(fp, <span class="stringliteral">&quot;%s:%u&quot;</span>, reginfo-&gt;<a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/UME/api.tag:../API/" href="../API/structlbm__src__event__ume__registration__ex__t__stct.html#af5299bff3739162ccf08da2d4b33cc67">store</a>, reginfo-&gt;<a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/UME/api.tag:../API/" href="../API/structlbm__src__event__ume__registration__ex__t__stct.html#a2597610653b0c77f9d6fb60e2a04a68e">registration_id</a>);</div><div class="line">    fclose(fp);</div><div class="line">  ...</div><div class="line">  }  <span class="comment">/* switch */</span></div><div class="line">  ...</div><div class="line">}  <span class="comment">/* app_src_callback */</span></div><div class="line"></div><div class="line">...</div><div class="line"></div><div class="line">err = <a class="codeRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/UME/api.tag:../API/" href="../API/lbm_8h.html#ab8dd76271bf9df7a5f88476d431f523e">lbm_src_create</a>(&amp;src, ctx, topic, app_src_callback, ...);  <span class="comment">/* Error checking omitted. */</span></div></div><!-- fragment --><p><br />
 </p>
<h1><a class="anchor" id="managingregidswithsessionids"></a>
Managing RegIDs with Session IDs&nbsp;&nbsp;<small><a href="#managingregidswithsessionids">&lt;-</a></small></h1>
<p>The RegIDs used by Stores to identify sources and receivers must be unique. Rather than maintaining RegIDs (either statically or dynamically), applications can use a Session ID, which is simply a 64-bit value that uniquely identifies any set of sources with unique topics and receivers with unique topics. A single Session ID allows Stores to correctly identify all the sources and receivers for a particular application.</p>
<p>In practice, a Session ID is often thought of as an application identifier, although it is more accurately thought of as a context identifier. (For applications that only have a single context with persistent sources and/or receivers, the two are effectively the same.) However, be aware that many application systems run multiple instances of a given program, perhaps for horizontal scaling. Each instance needs its own Session ID.</p>
<p>It is also possible for a single context to host multiple Session IDs, although this is rarely done. The LBM configuration options <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/UME/config.tag:../Config/" href="../Config/grpultramessagingpersistence.html#umesessionidsource">ume_session_id (source)</a> and <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/UME/config.tag:../Config/" href="../Config/grpultramessagingpersistence.html#umesessionidreceiver">ume_session_id (receiver)</a> can be used to arrange individual source and/or receiver objects into registration groupings. However, it is more common to use the option <a class="elRef" doxygen="/29W/Amun/home/sford/backup_exclude/labbox/sfordw_DEV_HF_6_16/29West/lbm/doc/UME/config.tag:../Config/" href="../Config/grpultramessagingpersistence.html#umesessionidcontext">ume_session_id (context)</a> to group all sources and receivers created within a context into a single session ID. (If both a context and a source or receiver option is specified, the source or receiver option will override the context option.)</p>
<p><b>How Stores Associate Session IDs and RegIDs</b></p>
<p>Session IDs do not replace the use of RegIDs by UM but rather simplify RegID management. Using Session IDs equates to your application specifying a 0 (zero) RegID for all sources and receivers. However, instead of your application persisting the RegID assigned by the Store, the Store maintains the RegID for you.</p>
<p>When a Store receives a registration request from a source or receiver with a particular Session ID, it checks to see if it already has a source or receiver for that topic/Session ID. If it does, then it responds with that source's or receiver's RegID.</p>
<p>If it does not find a source or receiver for that topic/Session ID pair, the Store:</p>
<ol>
<li>
Assigns a new RegID. </li>
<li>
Associates the topic/Session ID with the new RegID. </li>
<li>
Responds to the source or receiver with the new RegID. </li>
</ol>
<p>The source can then advertise with the RegID supplied by the Store. Receivers include the source's RegID in their registration request.</p>
<p>All of the above steps happen within UM itself without any intervention by the application. However, the application does have access to the underlying registration ID, if it desires it.</p>
<p><br />
<br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
</p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
</body>
</html>
