<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Guide for Persistence: Persistence Fault Tolerance</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen_manual.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Guide for Persistence
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('persistencefaulttolerance.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Persistence Fault Tolerance </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><br />
 </p>
<h1><a class="anchor" id="messagelossrecovery"></a>
Message Loss Recovery&nbsp;&nbsp;<small><a href="#messagelossrecovery">&lt;-</a></small></h1>
<p>Persistence offers the following message recovery mechanisms:</p>
<table class="doxtable">
<tr>
<th>Method </th><th>Product </th><th>Transports </th><th><p class="starttd">Description</p>
<p class="endtd"></p>
</th></tr>
<tr>
<td>Negative Acknowledgments (NAKs) </td><td>UMS, UMP, UMQ </td><td>LBT-RM, LBT-RU </td><td><p class="starttd">Recovers lost transport datagrams from the source which may contain many small topic messages or fragments of a large message. Receivers send unicast NAKs to the source for missed transport datagrams. Source retransmits datagrams over the configured UM transport.</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>Late Join </td><td>UMS, UMP, UMQ </td><td>All </td><td><p class="starttd">Retransmits messages via unicast to receivers joining the stream after the messages were originally sent. See <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.12_RC3/doc/UME/design.tag:../Design/" href="../Design/umfeatures.html#usinglatejoin">Using Late Join</a>.</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>Durable Receiver Recovery </td><td>UMP, UMQ </td><td>All </td><td><p class="starttd">Recovers messages persisted while a durable receiver was off line. UM initiates recovery when a durable receiver joins a persistent stream. The receiver then requests retransmission from the store starting with the low sequence number, defined as the last message it acknowledged to the store plus one. The store unicasts retransmissions. See <a class="el" href="designingpersistenceapplications.html#persistentreceiverrecovery">Persistent Receiver Recovery</a>.</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>Off Transport Recovery </td><td>UMS, UMP, UMQ </td><td>All </td><td><p class="starttd">Recovers lost topic messages. Receiver detects lost sequence number and requests retransmission from the source or persistent stores (if applicable). UM unicasts retransmissions. See <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.12_RC3/doc/UME/design.tag:../Design/" href="../Design/umfeatures.html#offtransportrecoveryotr">Off-Transport Recovery (OTR)</a>.</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>Proactive Retransmissions </td><td>UMP, UMQ </td><td>All </td><td>Recovers lost messages never received by the store or never acknowledged by the store. Operates independently of any receivers. Source unicasts retransmissions. See <a class="el" href="persistencefaulttolerance.html#proactiveretransmissions">Proactive Retransmissions</a>. </td></tr>
</table>
<p><br />
 </p>
<h1><a class="anchor" id="configuringforpersistenceandrecovery"></a>
Configuring for Persistence and Recovery&nbsp;&nbsp;<small><a href="#configuringforpersistenceandrecovery">&lt;-</a></small></h1>
<p>Deployment decisions play a huge role in the success of any persistent system. Configuration in UM has a number of options that aid in performance, fault recovery, and overall system stability. It is not possible, or at least not wise, to totally divorce configuration from application development for high performance systems. This is true not only for persistent systems, but for practically all distributed systems. When designing systems, deployment considerations need to be taken into account for the following:</p>
<ul>
<li>
<p class="startli">Source Considerations</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">Receiver Considerations</p>
<p class="endli"></p>
</li>
<li>
Store Configuration Considerations </li>
</ul>
<p><br />
 </p>
<h2><a class="anchor" id="sourceconsiderations"></a>
Source Considerations&nbsp;&nbsp;<small><a href="#sourceconsiderations">&lt;-</a></small></h2>
<p>Performance of sources is heavily impacted by:</p>
<ul>
<li>
<p class="startli">the release policy that the source uses</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">streaming methods of the source</p>
<p class="endli"></p>
</li>
<li>
the throughput and latency requirements of the data </li>
</ul>
<p>Source release settings have a direct impact on memory usage. As messages are retained, they consume memory. You reclaim memory when you release messages. Message stability, delivery confirmation and retention size all interact to create your release policies. UM provides a hard limit on the memory usage. When exceeded, UM delivers a Forced Reclamation event. Thus applications that anticipate forced reclamations can handle them appropriately. See also <a class="el" href="designingpersistenceapplications.html#sourcemessageretentionandrelease">Source Message Retention and Release</a>.</p>
<p>How the source streams data has a direct impact on latency and throughput. One streaming method sets a maximum, outstanding count of messages. Once reached, the source does not send any more until message stability notifications come in to reduce the number of outstanding messages. The umesrc example program uses this mechanism to limit the speed of a source to something a store can handle comfortably. This also provides a maximum bound on recovery that can simplify handling of streaming source recovery.</p>
<p>The throughput and latency requirements of the data are normal UM concerns.</p>
<p><br />
 </p>
<h2><a class="anchor" id="receiverconsiderations"></a>
Receiver Considerations&nbsp;&nbsp;<small><a href="#receiverconsiderations">&lt;-</a></small></h2>
<p>In addition to the following, receiver performance shares the same considerations as receivers during normal operation.</p>
<p><b>Acknowledgement Generation</b></p>
<p>Persistent receivers send a message consumption acknowledgement to stores and the message source. Some applications may want to control this acknowledgement explicitly themselves. In this case, <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.12_RC3/doc/UME/config.tag:../Config/" href="../Config/grpultramessagingpersistence.html#umeexplicitackonlyreceiver">ume_explicit_ack_only (receiver)</a> can be used.</p>
<p><b>Controlling Retransmission</b></p>
<p>Persistent receivers during fault recovery are another matter entirely. Receivers send retransmission requests and receive and process retransmissions. Control over this process is crucial when handling very long recoveries, such as hundreds of thousands or millions of messages. A receiver only sends a certain number of retransmission requests at a time.</p>
<p>This means that a receiver will not, unless configured to with <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.12_RC3/doc/UME/config.tag:../Config/" href="../Config/grplatejoin.html#retransmitrequestoutstandingmaximumreceiver">retransmit_request_outstanding_maximum (receiver)</a>, request everything at once. The value of the low sequence number (<a class="el" href="designingpersistenceapplications.html#persistentreceiverrecovery">Persistent Receiver Recovery</a>) has a direct impact on how many requests need to be handled. A receiving application can decide to only handle the last X number of messages instead of recovering them all using the option, <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.12_RC3/doc/UME/config.tag:../Config/" href="../Config/grplatejoin.html#retransmitrequestmaximumreceiver">retransmit_request_maximum (receiver)</a>. The timeout used between requests, if the retransmission does not arrive, is totally controllable with <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.12_RC3/doc/UME/config.tag:../Config/" href="../Config/grplatejoin.html#retransmitrequestintervalreceiver">retransmit_request_interval (receiver)</a>. And the total time given to recover all messages is also controllable.</p>
<p><b>Recovery Process</b></p>
<p>Theoretically, receivers can handle up to roughly 2 billion messages during recovery. This limit is implied from the sequence number arithmetic and not from any other limitation. For recovery, the crucial limiting factor is how a receiver processes and handles retransmissions which come in as fast as UM can request them and a store can retransmit them. This is perhaps much faster than an application can handle them. In this case, it is crucial to realize that as recovery progresses, the source may still be transmitting new data. This data will be buffered until recovery is complete and then handed to the application. It is prudent to understand application processing load when planning on how much recovery is going to be needed and how it may need to be configured within UM.</p>
<p><br />
 </p>
<h2><a class="anchor" id="storeconfigurationconsiderations"></a>
Store Configuration Considerations&nbsp;&nbsp;<small><a href="#storeconfigurationconsiderations">&lt;-</a></small></h2>
<p>UM stores have numerous configuration options. See <a class="el" href="configurationreferenceforumestored.html">Configuration Reference for Umestored</a> for details.</p>
<p><b>Configuring Store Usage per Source</b></p>
<p>A store handles persisted state on a per topic per source basis. Based on the load of topics and sources, it may be prudent to spread the topic space, or just source space, across stores as a way to handle large loads. As configuration of store usage is per source, this is extremely easy to do. It is easy to spread CPU load via multi-threading as well as hard disk usage across stores. A single store process can have a set of virtual stores within it, each with their own thread.</p>
<p><b>Disk vs. Memory</b></p>
<p>As mentioned previously in <a class="el" href="persistenceconcepts.html#persistentstoreconcept">Persistent Store Concept</a>, stores can be memory based or disk based. Disk stores also have the ability to spread hard disk usage across multiple physical disks by using multiple virtual stores within a single store process. This gives great flexibility on a per source basis for spreading data reception and persistent data load.</p>
<p>UM stores provide settings for controlling memory usage and for caching messages for retransmission in memory as well as on disk. All messages in a store, whether in memory or on disk, have some small memory state. This is roughly about 72 bytes per message. For very large caches of messages, this can become non-trivial in size.</p>
<p><b>Activity Timeouts</b></p>
<p>UM stores are NOT archives and are not designed for archival. Stores persist source and receiver state with the aim of providing fault recovery. Central to this is the concept that a source or receiver has an activity timeout attached to it. Once a source or receiver suspends operation or has a failure, it has a set time before the store will forget about it. This activity timeout needs to be long enough to handle the recovery demands of sources and receivers. However, it can not and should not be infinite. Each source takes up memory and disk space, therefore an appropriate timeout should be chosen that meets the requirements of recovery, but is not excessively long so that the limited resources of the store are exhausted.</p>
<p><b>Recommendations for Store Configuration</b></p>
<p>The following conditions allow sources to continue to send messages:</p>
<ul>
<li>
<p class="startli">Quorum - Completed registration of a quorum of stores within at least one group. This is affected by group definitions, plus intragroup and intergroup stability settings. See also <a class="el" href="persistenceconcepts.html#persistentstoreconcept">Persistent Store Concept</a>.</p>
<p class="endli"></p>
</li>
<li>
Flight Size - Maximum number of messages sent but not stable which is determined by store group definitions, intragroup and intergroup stability settings and delivery confirmation setting. See also <a class="el" href="operationalview.html#persistenceflightsize">Persistence Flight Size</a>. </li>
</ul>
<p>Configure your stores to address the failure cases you believe are more probable and from which you want to recover. For example, if a particular store group persists topics of higher importance, you may want to increase the number of stores in that group to maintain quorum in the face of a store failure. Or if a particular location has a higher incidence of failures than other locations, you may want to add additional stores in other locations.</p>
<p>Although many different conditions and requirements can apply to the configuration of persistent stores, Informatica recommends the following best practices:</p>
<ol>
<li>
<p class="startli">Minimum of 3 stores - Requiring a minimum of 3 stores needed for quorum in a single store group is optimal. Using 5 stores, for example, in a group allows sources to keep sending in the face of the loss of up to 2 stores.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">Multiple store groups - When using multiple store groups, Informatica recommends using at least 3 stores in each group.</p>
<p class="endli"></p>
</li>
<li>
Set Intergroup Stability to all-active. This setting for <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.12_RC3/doc/UME/config.tag:../Config/" href="../Config/grpultramessagingpersistence.html#umeretentionintergroupstabilitybehaviorsource">ume_retention_intergroup_stability_behavior (source)</a> provides a more immediate evaluation of your store configuration. Active groups must have at least a quorum of active stores, registered with the source and sending stability acknowledgements for persisted messages. By default, if a store becomes unresponsive, a store group could lose quorum and therefore messages in-flight cannot be stabilized by the unresponsive store's group until the store's <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.12_RC3/doc/UME/config.tag:../Config/" href="../Config/grpultramessagingpersistence.html#umestoreactivitytimeoutsource">ume_store_activity_timeout (source)</a> expires and the store restarts. However, with all-active, the source does not wait for the unresponsive store's <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.12_RC3/doc/UME/config.tag:../Config/" href="../Config/grpultramessagingpersistence.html#umestoreactivitytimeoutsource">ume_store_activity_timeout (source)</a> to expire. The source removes the unresponsive store's group from the list of stores from which the source uses to determine that messages in-flight are stable. An inactive store with a running activity timeout does not impede message stabilization. </li>
</ol>
<p><b>Store Configuration Practices to Avoid</b></p>
<p>Informatica does not support the following store configuration practices:</p>
<ul>
<li>
<p class="startli">Do not use multiple store groups of one store each. Recovery does not work well in this configuration because it allows sources to resume sending as soon as it has registered with a single store, and if that store is not fully up-to-date, this can lead to message loss for receivers.</p>
<p class="endli"></p>
</li>
<li>
Do not use backup stores. The configuration option, <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.12_RC3/doc/UME/config.tag:../Config/" href="../Config/grpultramessagingpersistence.html#umestoregroupsource">ume_store_group (source)</a> allows you to identify a store group and its size in number of stores. Setting the group size in this option to a number of stores less than the number of stores configured with the <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.12_RC3/doc/UME/config.tag:../Config/" href="../Config/grpultramessagingpersistence.html#umestoresource">ume_store (source)</a> option can lead to messages that were reported stable to the source being unavailable for receivers to recover, in the event that multiple stores became unresponsive and were replaced by backup stores. For example, setting <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.12_RC3/doc/UME/config.tag:../Config/" href="../Config/grpultramessagingpersistence.html#umestoregroupsource">ume_store_group (source)</a> with a size of 3 stores, but configuring ume_store with 5 stores is not supported. </li>
</ul>
<p><br />
 </p>
<h1><a class="anchor" id="persistenceproxysources"></a>
Persistence Proxy Sources&nbsp;&nbsp;<small><a href="#persistenceproxysources">&lt;-</a></small></h1>
<p>By default, UM expects persistent sources to be running concurrently with persistent receivers. If a source exits, any persistent receivers will disconnect from that source's transport and will wait for the source to come back. More significantly, if a new receiver starts while the source is absent, the receiver will be unable to discover the stores where the old source's previous messages are stored. So that late-joining receiver will not recover messages until the source finally restarts.</p>
<p>The Proxy Source feature allows you to configure stores to automatically continue sending the source's topic advertisements which allow new receivers to join the source's transport session and request Source Registration Information (SRI) to register with the store and request retransmissions. After the source returns, the store automatically stops acting as a proxy source. Stores can be located across a UM Router or within the same LAN as the failed source.</p>
<p>Some other features of Proxy Sources include:</p>
<ul>
<li>
<p class="startli">Requires a Quorum/Consensus store configuration.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">Normal store failover operation also initiates a new proxy source.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">A store can be running more than one proxy source if more than one source has failed.</p>
<p class="endli"></p>
</li>
<li>
A store can be running multiple proxy sources for the same topic, each one corresponding to a previous instance of a real source. </li>
</ul>
<p>Note that proxy sources do introduce extra network and CPU loading, so proxy sources should only be enabled if their functionality is needed.</p>
<p><br />
 </p>
<h2><a class="anchor" id="howproxysourcesoperate"></a>
How Proxy Sources Operate&nbsp;&nbsp;<small><a href="#howproxysourcesoperate">&lt;-</a></small></h2>
<p>The following sequence illustrates the life of a proxy source:</p>
<ol>
<li>
<p class="startli">A source configured for Proxy Source sends to receivers and a group of Quorum/Consensus stores.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">The source fails.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">The source's <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.12_RC3/doc/UME/config.tag:../Config/" href="../Config/grpultramessagingpersistence.html#umeactivitytimeoutsource">ume_activity_timeout (source)</a> or the store's <a class="el" href="configurationreferenceforumestored.html#umecfgsourceactivitytimeout">source-activity-timeout</a> expires.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">The Quorum/Consensus stores elect a single store to run the proxy source.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">The elected store creates a proxy source and sends topic advertisements.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">The failed source reappears.</p>
<p class="endli"></p>
</li>
<li>
The store deletes the proxy source and the original source resumes activity. </li>
</ol>
<p>If the store running the proxy source fails, the other stores in the Quorum/Consensus group detect a source failure again and elect a new store to initiate a proxy source.</p>
<p>If a loss of quorum occurs, the proxy source can continue to send advertisements, but cannot send messages until a quorum is re-established.</p>
<p><br />
 </p>
<h2><a class="anchor" id="activitytimeoutandstatelifetimes"></a>
Activity Timeout and State Lifetimes&nbsp;&nbsp;<small><a href="#activitytimeoutandstatelifetimes">&lt;-</a></small></h2>
<p>UM provides activity and state lifetime timers for sources and receivers that operate in conjunction with the proxy source option or independently. This section explains how these timers work together and how they work with proxy sources.</p>
<p>The <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.12_RC3/doc/UME/config.tag:../Config/" href="../Config/grpultramessagingpersistence.html#umeactivitytimeoutsource">ume_activity_timeout (source)</a> and <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.12_RC3/doc/UME/config.tag:../Config/" href="../Config/grpultramessagingpersistence.html#umeactivitytimeoutreceiver">ume_activity_timeout (receiver)</a> options determine how long a source or receiver must be inactive before a store allows another source or receiver to register using that RegID. This prevents a second source or receiver from stealing a RegID from an existing source or receiver. An activity timeout can be configured for the source/receiver with the UM Configuration Option cited above or with a topic's <a class="el" href="configurationreferenceforumestored.html#umecfgumeattributes">ume-attribute</a> configured in the umestored XML configuration file. The following diagram illustrates the default activity timeout behavior, which uses <a class="el" href="configurationreferenceforumestored.html#umecfgsourcestatelifetime">source-state-lifetime</a> in the umestored XML configuration file.</p>
<div class="image">
<img src="source_act_timeout_def.png" alt="source_act_timeout_def.png"/>
</div>
 <p>In addition to the activity timeout, you can also configure sources and receivers with a state lifetime timer using the following options.</p>
<ul>
<li>
<p class="startli"><a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.12_RC3/doc/UME/config.tag:../Config/" href="../Config/grpultramessagingpersistence.html#umestatelifetimesource">ume_state_lifetime (source)</a></p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.12_RC3/doc/UME/config.tag:../Config/" href="../Config/grpultramessagingpersistence.html#umestatelifetimereceiver">ume_state_lifetime (receiver)</a></p>
<p class="endli"></p>
</li>
<li>
The topic's ume-attributes options, <a class="el" href="configurationreferenceforumestored.html#umecfgsourcestatelifetime">source-state-lifetime</a> and <a class="el" href="configurationreferenceforumestored.html#umecfgreceiverstatelifetime">receiver-state-lifetime</a>. </li>
</ul>
<p>The <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.12_RC3/doc/UME/config.tag:../Config/" href="../Config/grpultramessagingpersistence.html#umestatelifetimesource">ume_state_lifetime (source)</a> and <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.12_RC3/doc/UME/config.tag:../Config/" href="../Config/grpultramessagingpersistence.html#umestatelifetimereceiver">ume_state_lifetime (receiver)</a> options, when used in conjunction with the <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.12_RC3/doc/UME/config.tag:../Config/" href="../Config/grpultramessagingpersistence.html#umeactivitytimeoutsource">ume_activity_timeout (source)</a> and <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.12_RC3/doc/UME/config.tag:../Config/" href="../Config/grpultramessagingpersistence.html#umeactivitytimeoutreceiver">ume_activity_timeout (receiver)</a> options, determines at what point UM removes the source or receiver state files. UM does not check the state lifetime until the activity timeout expires. The following diagram illustrates this behavior:</p>
<div class="image">
<img src="source_state_lifetime.png" alt="source_state_lifetime.png"/>
</div>
 <p>If you have enabled the Proxy Source option, the <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.12_RC3/doc/UME/config.tag:../Config/" href="../Config/grpultramessagingpersistence.html#umeactivitytimeoutsource">ume_activity_timeout (source)</a> triggers the creation of the proxy source. The following diagram illustrates this behavior:</p>
<div class="image">
<img src="src_act_and_state_timers.png" alt="src_act_and_state_timers.png"/>
</div>
 <p><br />
 </p>
<h2><a class="anchor" id="enablingtheproxysources"></a>
Enabling the Proxy Sources&nbsp;&nbsp;<small><a href="#enablingtheproxysources">&lt;-</a></small></h2>
<p>You must configure both the source and the stores to enable the Proxy Source option.</p>
<ul>
<li>
<p class="startli">Configure the source in a UM Configuration File with the source configuration option, <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.12_RC3/doc/UME/config.tag:../Config/" href="../Config/grpultramessagingpersistence.html#umeproxysourcesource">ume_proxy_source (source)</a>.</p>
<p class="endli"></p>
</li>
<li>
Configure the stores in the umestored XML configuration file with the Store Element Option, <a class="el" href="configurationreferenceforumestored.html#umecfgallowproxysource">allow-proxy-source</a>. </li>
</ul>
<p><br />
 </p>
<h2><a class="anchor" id="proxysourceelections"></a>
Proxy Source Elections&nbsp;&nbsp;<small><a href="#proxysourceelections">&lt;-</a></small></h2>
<p>When multiple stores in a Quorum/Consensus configuration notice the loss of a registered source (expiration of the source's <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.12_RC3/doc/UME/config.tag:../Config/" href="../Config/grpultramessagingpersistence.html#umeactivitytimeoutsource">ume_activity_timeout (source)</a>) configured for proxy sources, only one of the stores needs to create a proxy source to continue sending topic advertisements.</p>
<p>The proxy source election process determines which store creates the proxy source. Each store starts by waiting a randomized amount of time based on its <a class="el" href="configurationreferenceforumestored.html#umecfgproxyelectioninterval">proxy-election-interval</a> option setting. The store creates a proxy source if it has not received a persistent registration request (PREG) from a proxy on a different store. The proxy source then sends a PREG containing a unique random value to the other stores. This value determines which store deletes it's proxy source in the case that any two stores independently determine they should create a proxy source. The nature of the random values ensures that only one store within the Q/C group or configuration of groups keeps its proxy source.</p>
<p><br />
 </p>
<h2><a class="anchor" id="proactiveretransmissions"></a>
Proactive Retransmissions&nbsp;&nbsp;<small><a href="#proactiveretransmissions">&lt;-</a></small></h2>
<p>Proactive Retransmissions, which is enabled by default, address two types of loss:</p>
<ul>
<li>
<p class="startli">loss of message data between the source and a store</p>
<p class="endli"></p>
</li>
<li>
loss of stability acknowledgments (ACK) between the store and the source </li>
</ul>
<p>The store sends message stability acknowledgments to the source after the store persists the message data.</p>
<p>With Proactive Retransmissions, the source maintains an unstable message queue for those messages sent but not acknowledged by the store. The source checks this queue at the <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.12_RC3/doc/UME/config.tag:../Config/" href="../Config/grpultramessagingpersistence.html#umemessagestabilitytimeoutsource">ume_message_stability_timeout (source)</a>. If a message in this queue exceeds its <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.12_RC3/doc/UME/config.tag:../Config/" href="../Config/grpultramessagingpersistence.html#umemessagestabilitytimeoutsource">ume_message_stability_timeout (source)</a>, the source retransmits the message and puts it back on the unstabilized message queue, restarting the message's <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.12_RC3/doc/UME/config.tag:../Config/" href="../Config/grpultramessagingpersistence.html#umemessagestabilitytimeoutsource">ume_message_stability_timeout (source)</a>.</p>
<p>The source continues to retransmit and check the message's stability timeout until the <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.12_RC3/doc/UME/config.tag:../Config/" href="../Config/grpultramessagingpersistence.html#umemessagestabilitylifetimesource">ume_message_stability_lifetime (source)</a> expires or it receives a stability acknowledgment from the store. If the source has not received a stability acknowledgment when the <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.12_RC3/doc/UME/config.tag:../Config/" href="../Config/grpultramessagingpersistence.html#umemessagestabilitylifetimesource">ume_message_stability_lifetime (source)</a> expires, the source sends a Store Message Not Stable source event notification to the application. When the store discards the message because it has not met stability requirements, the store sends a Store Forced Reclaim source event notification to the application.</p>
<p>To disable Proactive Retransmissions, set <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.12_RC3/doc/UME/config.tag:../Config/" href="../Config/grpultramessagingpersistence.html#umemessagestabilitytimeoutsource">ume_message_stability_timeout (source)</a> to 0 (zero). As a result, sources do not create an unstable message queue.</p>
<p>The following applies whether you enable or disable Proactive Retransmissions.</p>
<ul>
<li>
<p class="startli">The store does not discard duplicate messages, but rather always responds to duplicate, retransmitted messages by sending stability acknowledgments even if the message is already stable.</p>
<p class="endli"></p>
</li>
<li>
If the store has marked the message unrecoverably lost and receives a duplicate message from the source, the store sends the source a negative stability acknowledgment (NAK), which induces the source to remove the message from its unstabilized message queue. A stability NAK is identical to a stability ACKs except that it has a NAK flag set. </li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
</body>
</html>
