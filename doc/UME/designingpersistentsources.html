<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Guide for Persistence: Designing Persistent Sources</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen_manual.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Guide for Persistence
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('designingpersistentsources.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Designing Persistent Sources </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The major concerns of sources revolve around RegID management and message retention.</p>
<p><br />
 </p>
<h1><a class="anchor" id="neworreregistration"></a>
New or Re-Registration&nbsp;&nbsp;<small><a href="#neworreregistration">&lt;-</a></small></h1>
<p>Any source needs to know at start-up if it is a new registration or a re-registration. The answer determines how a source registers with the Store. The UM library can not answer this question. Therefore, it is essential that the developer consider what identifies the lifetime of a source and how a source determines the appropriate value to use as the RegID when it is ready to register. RegIDs are per source per topic per Store, thus a single RegID per Store is needed.</p>
<p>The following source code examples look for an existing RegID from a file and uses a new RegID assigned from the Store if it finds no existing RegID. See also <a href="../example/ume-example-src-3.c">ume-example-src-3.c</a></p>
<p><b>C API</b></p>
<div class="fragment"><div class="line">err = <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/lbm_8h.html#a8058947690bd0995bc2c59d4a61b462f">lbm_context_create</a>(&amp;ctx, NULL, NULL, NULL);</div><div class="line"><span class="keywordflow">if</span> (err) {printf(<span class="stringliteral">&quot;line %d: %s\n&quot;</span>, __LINE__, <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/lbm_8h.html#a22a4650d3a5b649c84a0c05adedcc055">lbm_errmsg</a>()); exit(1);}</div><div class="line"></div><div class="line">srcinfo.message_num = 1;</div><div class="line">srcinfo.existing_regid = 0;</div><div class="line"></div><div class="line">err = read_src_regid_from_file(SRC_REGID_SAVE_FILENAME, store_info, <span class="keyword">sizeof</span>(store_info));</div><div class="line"><span class="keywordflow">if</span> (!err) { srcinfo.existing_regid = 1; }</div><div class="line"></div><div class="line">    err = <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/lbm_8h.html#adc12814cac6280b5bd48bfde41d7c88a">lbm_src_topic_attr_create_from_xml</a>(&amp;attr, <span class="stringliteral">&quot;MyCtx&quot;</span>, src_topic_name);</div><div class="line">    <span class="keywordflow">if</span> (err) {printf(<span class="stringliteral">&quot;line %d: %s\n&quot;</span>, __LINE__, <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/lbm_8h.html#a22a4650d3a5b649c84a0c05adedcc055">lbm_errmsg</a>()); exit(1);}</div><div class="line"></div><div class="line">    err = <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/lbm_8h.html#a422f330bf7ef3efdd7a9f17caabccb24">lbm_src_topic_attr_str_setopt</a>(attr, <span class="stringliteral">&quot;ume_store&quot;</span>, store_info);</div><div class="line">    <span class="keywordflow">if</span> (err) {printf(<span class="stringliteral">&quot;line %d: %s\n&quot;</span>, __LINE__, <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/lbm_8h.html#a22a4650d3a5b649c84a0c05adedcc055">lbm_errmsg</a>()); exit(1);}</div></div><!-- fragment --><p>The use of Session IDs allows UM, as opposed to your application, to accomplish the same RegID management. See <a class="el" href="registrationidentifiers.html#managingregidswithsessionids">Managing RegIDs with Session IDs</a> Managing RegIDs with Session IDs.</p>
<p><br />
 </p>
<h1><a class="anchor" id="sourcesmustbeabletoresumesending"></a>
Sources Must Be Able to Resume Sending&nbsp;&nbsp;<small><a href="#sourcesmustbeabletoresumesending">&lt;-</a></small></h1>
<p>A source sends messages unless UM prevents it, in which case, the send function returns an error. A source may lose the ability to send messages temporarily if the Store(s) in use become unresponsive, e.g. the Store(s) die or become disconnected from the source. Once the Store(s) are responsive again, sending can continue. Thus source applications need to take into account that sending may fail temporarily under specific failure cases and be able to resume sending when the failure is removed.</p>
<p>The following source code examples demonstrate how a failed send function can sleep for a second and try again:</p>
<p><b>C API</b></p>
<div class="fragment"><div class="line"><span class="keywordflow">while</span> (<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/lbm_8h.html#a91f4b9cb04fe1323ec56833211cc5cb7">lbm_src_send</a>(src, message, len, 0) == LBM_FAILURE) {</div><div class="line">    If (<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/lbm_8h.html#af3a827eb26d87be5b1a6b9fd3a4b63aa">lbm_errnum</a>() == LBM_EUMENOREG) {</div><div class="line">        printf(<span class="stringliteral">&quot;Send unsuccessful. Waiting...\n&quot;</span>);</div><div class="line">        sleep(1);</div><div class="line">        <span class="keywordflow">continue</span>;</div><div class="line">    }</div><div class="line">    fprintf(stderr, <span class="stringliteral">&quot;lbm_src_send: %s\n&quot;</span>, <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/lbm_8h.html#a22a4650d3a5b649c84a0c05adedcc055">lbm_errmsg</a>());</div><div class="line">    exit(1);</div><div class="line">}</div></div><!-- fragment --><p><b>Java API</b></p>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> (;;) {</div><div class="line">    <span class="keywordflow">try</span> {</div><div class="line">        src.send(message, len, 0);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">catch</span> (UMENoRegException ex) {</div><div class="line">        System.out.println(<span class="stringliteral">&quot;Send unsuccessful. Waiting...&quot;</span>);</div><div class="line">        <span class="keywordflow">try</span> {</div><div class="line">            Thread.sleep(1000);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">catch</span> (InterruptedException e) { }</div><div class="line">        <span class="keywordflow">continue</span>;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">catch</span> (LBMException ex) {</div><div class="line">        System.err.println(<span class="stringliteral">&quot;Error sending message: &quot;</span> + ex.toString());</div><div class="line">        System.exit(1);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">break</span>;</div><div class="line">}</div></div><!-- fragment --><p><b>.NET API</b></p>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> (;;) {</div><div class="line">    <span class="keywordflow">try</span> {</div><div class="line">        src.send(message, len, 0);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">catch</span> (UMENoRegException ex) {</div><div class="line">        System.Console.Out.WriteLine(<span class="stringliteral">&quot;Send unsuccessful. Waiting...&quot;</span>);</div><div class="line">        System.Threading.Thread.Sleep(1000);</div><div class="line">        <span class="keywordflow">continue</span>;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">catch</span> (LBMException ex) {</div><div class="line">        System.Console.Out.WriteLine (<span class="stringliteral">&quot;Error sending message: &quot;</span> + ex.toString());</div><div class="line">        System.exit(1);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">break</span>;</div><div class="line">}</div></div><!-- fragment --><p><br />
 </p>
<h1><a class="anchor" id="sourcemessageretentionandrelease"></a>
Source Message Retention and Release&nbsp;&nbsp;<small><a href="#sourcemessageretentionandrelease">&lt;-</a></small></h1>
<p>UM allows streaming of messages from a source without regard to message stability at a Store, which is one reason for UM's performance advantage over other persistent messaging systems. Sources retain all messages until notified by the active Store(s) that they are stable. This provides a method for Stores to be brought up to date when restarted or started anew.</p>
<p>When messages are considered stable at the Store, the source can release them which frees up source retention memory for new messages. Generally, the source releases older stable messages first. To release the oldest retained message, all the following conditions must be met:</p>
<ul>
<li>
<p class="startli">Message must meet stability requirements of the source, which can range from a single stability notice from the active Store to stability notices from a group of Stores (See <a class="el" href="designingpersistentstores.html#sourcesusingquorumconsensusstoreconfiguration">Sources Using Quorum/Consensus Store Configuration</a>).</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">Message must have been confirmed as delivered by a configured number of receivers (<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/config.tag:../Config/" href="../Config/grpultramessagingpersistence.html#umeretentionuniqueconfirmationssource">ume_retention_unique_confirmations (source)</a>).</p>
<p class="endli"></p>
</li>
<li>
The aggregate amount of buffered messages exceeds <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/config.tag:../Config/" href="../Config/grplatejoin.html#retransmitretentionsizethresholdsource">retransmit_retention_size_threshold (source)</a> bytes in payload and headers. </li>
</ul>
<p>Some things to note:</p>
<ul>
<li>
<p class="startli">If <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/config.tag:../Config/" href="../Config/grplatejoin.html#retransmitretentionsizethresholdsource">retransmit_retention_size_threshold (source)</a> is not met, no messages will be released regardless of stability.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">If the source turns off <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/config.tag:../Config/" href="../Config/grpultramessagingpersistence.html#umemessagestabilitynotificationsource">ume_message_stability_notification (source)</a>, <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/config.tag:../Config/" href="../Config/grpultramessagingpersistence.html#umeretentionuniqueconfirmationssource">ume_retention_unique_confirmations (source)</a> is the only way to allow the source to release messages before retention size options come into play.</p>
<p class="endli"></p>
</li>
<li>
With a quorum/consensus Store configuration, when a quorum of Stores report stability for a message, remaining Stores may or may not send additional stability acks for that message. </li>
</ul>
<dl class="section note"><dt>Note</dt><dd><a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/design.tag:../Design/" href="../Design/advancedoptimizations.html#smartsources">Smart Sources</a> simplify matters somewhat by pre-allocating retention buffers. They are not dynamically allocated or deallocated during operation. See <a class="el" href="enablingpersistence.html#smartsourcesandpersistence">Smart Sources and Persistence</a> for more information.</dd></dl>
<p><br />
 </p>
<h1><a class="anchor" id="forcedreclaims"></a>
Forced Reclaims&nbsp;&nbsp;<small><a href="#forcedreclaims">&lt;-</a></small></h1>
<p>If the aggregate amount of buffered messages exceeds <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/config.tag:../Config/" href="../Config/grplatejoin.html#retransmitretentionsizelimitsource">retransmit_retention_size_limit (source)</a> bytes in payload and headers, then UM forcibly releases the oldest retained message even if it does not meet one or more of the conditions stated in Source Message Retention and Release. This condition should be avoided and Informatica suggests increasing the <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/config.tag:../Config/" href="../Config/grplatejoin.html#retransmitretentionsizelimitsource">retransmit_retention_size_limit (source)</a>.</p>
<p>A second condition that produces a forced reclaim is when a message remains unstabilized when the <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/config.tag:../Config/" href="../Config/grpultramessagingpersistence.html#umemessagestabilitylifetimesource">ume_message_stability_lifetime (source)</a> expires.</p>
<p>Whenever UM performs a Forced Reclaim, it notifies the application in the following ways:</p>
<ul>
<li>
<p class="startli">The source event callback's RECLAIMED_EX event (see <a class="el" href="operationalview.html#persistencesourceevents">Persistence Source Events</a>) includes a "FORCED" flag on the event. (UM uses the same RECLAIMED_EX event, without the FORCED flag, for normal reclaims.)</p>
<p class="endli"></p>
</li>
<li>
Through the separate forced reclaim callback, if registered. You set this separate forced reclaim callback with the <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/config.tag:../Config/" href="../Config/grpultramessagingpersistence.html#umeforcereclaimfunctionsource">ume_force_reclaim_function (source)</a> configuration option. </li>
</ul>
<dl class="section note"><dt>Note</dt><dd>UM retains the separate callback for backwards compatibility purposes and may be deprecated in future releases. The source event FORCED flag is the recommended method of tracking forced reclaims.</dd></dl>
<p>The following sample code, from <a href="../example/umesrc.c">umesrc.c</a>, implements the extended reclaim source event with the 'Forced' flag set if the reclamation is a forced reclaim.</p>
<p><b>C API</b></p>
<div class="fragment"><div class="line"><span class="keywordflow">case</span> <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/lbm_8h.html#a91689d8826be0160f64358ccfcff2877">LBM_SRC_EVENT_UME_MESSAGE_RECLAIMED_EX</a>:</div><div class="line">{</div><div class="line">    <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/structlbm__src__event__ume__ack__ex__info__t__stct.html">lbm_src_event_ume_ack_ex_info_t</a> *ackinfo = (<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/structlbm__src__event__ume__ack__ex__info__t__stct.html">lbm_src_event_ume_ack_ex_info_t</a> *)ed;</div><div class="line">    <span class="keywordflow">if</span> (opts-&gt;verbose) {</div><div class="line">        printf(<span class="stringliteral">&quot;UME message reclaimed (ex) - sequence number %x (cd %p). Flags 0x%x &quot;</span>,</div><div class="line">               ackinfo-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/structlbm__src__event__ume__ack__ex__info__t__stct.html#a8b7e4d03232bb81a0629497ac7b8c2fe">sequence_number</a>, (<span class="keywordtype">char</span>*)(ackinfo-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/structlbm__src__event__ume__ack__ex__info__t__stct.html#a11394d5ea9ee6a873ecf60170732c186">msg_clientd</a>) - 1, ackinfo-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/structlbm__src__event__ume__ack__ex__info__t__stct.html#a207c8b76a154b24274700279bba95600">flags</a>);</div><div class="line">        <span class="keywordflow">if</span> (ackinfo-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/structlbm__src__event__ume__ack__ex__info__t__stct.html#a207c8b76a154b24274700279bba95600">flags</a> &amp; LBM_SRC_EVENT_UME_MESSAGE_RECLAIMED_EX_FLAG_FORCED) {</div><div class="line">            printf(<span class="stringliteral">&quot;FORCED&quot;</span>);</div><div class="line">        }</div><div class="line">        printf(<span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line">    }</div><div class="line">}</div><div class="line"><span class="keywordflow">break</span>;</div></div><!-- fragment --><p><b>Java API</b></p>
<div class="fragment"><div class="line"><span class="keywordflow">case</span> LBM.SRC_EVENT_UME_MESSAGE_RECLAIMED_EX:</div><div class="line">    UMESourceEventAckInfo reclaiminfo = sourceEvent.ackInfo();</div><div class="line">    <span class="keywordflow">if</span> (_verbose &gt; 0) {</div><div class="line">        <span class="keywordflow">if</span> (reclaiminfo.clientObject() != null) {</div><div class="line">            System.out.print(<span class="stringliteral">&quot;UME message reclaimed (ex) - sequence number &quot;</span></div><div class="line">                               + Long.toHexString(reclaiminfo.sequenceNumber())</div><div class="line">                               + <span class="stringliteral">&quot; (cd &quot;</span></div><div class="line">                               + Long.toHexString(((Long)reclaiminfo.clientObject()).longValue())</div><div class="line">                               + <span class="stringliteral">&quot;). Flags 0x&quot;</span></div><div class="line">                               + reclaiminfo.flags());</div><div class="line">        } <span class="keywordflow">else</span> {</div><div class="line">            System.out.print(<span class="stringliteral">&quot;UME message reclaimed (ex) - sequence number &quot;</span></div><div class="line">                               + Long.toHexString(reclaiminfo.sequenceNumber())</div><div class="line">                               + <span class="stringliteral">&quot; Flags 0x&quot;</span></div><div class="line">                               + reclaiminfo.flags());</div><div class="line">        }</div><div class="line">        <span class="keywordflow">if</span> ((reclaiminfo.flags() &amp; LBM.SRC_EVENT_UME_MESSAGE_RECLAIMED_EX_FLAG_FORCED) != 0) {</div><div class="line">            System.out.print(<span class="stringliteral">&quot; FORCED&quot;</span>);</div><div class="line">        }</div><div class="line">        System.out.println();</div><div class="line">    }</div><div class="line">    <span class="keywordflow">break</span>;</div></div><!-- fragment --><p><b>.NET API</b></p>
<div class="fragment"><div class="line"><span class="keywordflow">case</span> LBM.SRC_EVENT_UME_MESSAGE_RECLAIMED_EX:</div><div class="line">    UMESourceEventAckInfo reclaiminfo = sourceEvent.ackInfo();</div><div class="line">    <span class="keywordflow">if</span> (_verbose &gt; 0) {</div><div class="line">        System.Console.Out.Write(<span class="stringliteral">&quot;UME message reclaimed (ex) - sequence number &quot;</span></div><div class="line">                                   + reclaiminfo.sequenceNumber()</div><div class="line">                                   + <span class="stringliteral">&quot; (cd &quot;</span></div><div class="line">                                   + ((uint)reclaiminfo.clientObject()).ToString(<span class="stringliteral">&quot;x&quot;</span>)</div><div class="line">                                   + <span class="stringliteral">&quot;). Flags &quot;</span></div><div class="line">                                   + reclaiminfo.flags());</div><div class="line">        <span class="keywordflow">if</span> ((reclaiminfo.flags() &amp; LBM.SRC_EVENT_UME_MESSAGE_RECLAIMED_EX_FLAG_FORCED) != 0) {</div><div class="line">            System.Console.Out.Write(<span class="stringliteral">&quot; FORCED&quot;</span>);</div><div class="line">        }</div><div class="line">        System.Console.Out.WriteLine();</div><div class="line">    }</div><div class="line">    <span class="keywordflow">break</span>;</div></div><!-- fragment --><p><br />
 </p>
<h1><a class="anchor" id="sourcereleasepolicyoptions"></a>
Source Release Policy Options&nbsp;&nbsp;<small><a href="#sourcereleasepolicyoptions">&lt;-</a></small></h1>
<p>Sources use a set of configuration options to release messages that, in effect, specify the source's release policy. The following configuration options directly impact when the source may release retained messages:</p>
<ul>
<li>
<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/config.tag:../Config/" href="../Config/grpultramessagingpersistence.html#umemessagestabilitynotificationsource">ume_message_stability_notification (source)</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/config.tag:../Config/" href="../Config/grpultramessagingpersistence.html#umeretentionuniqueconfirmationssource">ume_retention_unique_confirmations (source)</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/config.tag:../Config/" href="../Config/grplatejoin.html#retransmitretentionsizethresholdsource">retransmit_retention_size_threshold (source)</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/config.tag:../Config/" href="../Config/grplatejoin.html#retransmitretentionsizelimitsource">retransmit_retention_size_limit (source)</a> </li>
</ul>
<p><br />
 </p>
<h1><a class="anchor" id="confirmeddelivery"></a>
Confirmed Delivery&nbsp;&nbsp;<small><a href="#confirmeddelivery">&lt;-</a></small></h1>
<p>The configuration option <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/config.tag:../Config/" href="../Config/grpultramessagingpersistence.html#umeretentionuniqueconfirmationssource">ume_retention_unique_confirmations (source)</a> requires a message to have a minimum number of unique confirmations from different receivers before the message may be released. This retains messages that have not been confirmed as being received and processed and keeps them available to fulfill any retransmission requests. This provides a form of receiver-pacing; the source will not be allowed to exceed <a class="el" href="operationalview.html#persistenceflightsize">Persistence Flight Size</a> beyond receiving applications.</p>
<p>For example, a topic might have 2 receivers which are considered essential to keep up, and which should therefore contribute to flight size calculation. There might be any number of less-essential receivers which can be allowed to lag behind. In this case, <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/config.tag:../Config/" href="../Config/grpultramessagingpersistence.html#umeretentionuniqueconfirmationssource">ume_retention_unique_confirmations (source)</a> would be set to 2, and the non-essential receivers would set <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/config.tag:../Config/" href="../Config/grpultramessagingpersistence.html#umeallowconfirmeddeliveryreceiver">ume_allow_confirmed_delivery (receiver)</a> to 0.</p>
<dl class="section note"><dt>Note</dt><dd><a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/design.tag:../Design/" href="../Design/advancedoptimizations.html#smartsources">Smart Sources</a> do not support delivery confirmation.</dd></dl>
<p>The following code samples show how to require a message to have 10 unique receiver confirmations</p>
<p><b>C API</b></p>
<div class="fragment"><div class="line"><a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/lbm_8h.html#a30c33f443cf2d228f4772d534ce3ee88">lbm_src_topic_attr_t</a> * sattr;</div><div class="line"></div><div class="line"><span class="keywordflow">if</span> (<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/lbm_8h.html#adc12814cac6280b5bd48bfde41d7c88a">lbm_src_topic_attr_create_from_xml</a>(&amp;sattr, <span class="stringliteral">&quot;MyCtx&quot;</span>, src_topic_name) == LBM_FAILURE) {</div><div class="line">    fprintf(stderr, <span class="stringliteral">&quot;lbm_src_topic_attr_create_from_xml: %s\n&quot;</span>, <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/lbm_8h.html#a22a4650d3a5b649c84a0c05adedcc055">lbm_errmsg</a>());</div><div class="line">    exit(1);</div><div class="line">}</div><div class="line"><span class="keywordflow">if</span> (<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/lbm_8h.html#a422f330bf7ef3efdd7a9f17caabccb24">lbm_src_topic_attr_str_setopt</a>(sattr, <span class="stringliteral">&quot;ume_retention_unique_confirmations&quot;</span>,</div><div class="line">                                  <span class="stringliteral">&quot;10&quot;</span>) == LBM_FAILURE) {</div><div class="line">    fprintf(stderr, <span class="stringliteral">&quot;lbm_src_topic_attr_str_setopt: %s\n&quot;</span>, <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/lbm_8h.html#a22a4650d3a5b649c84a0c05adedcc055">lbm_errmsg</a>());</div><div class="line">    exit(1);</div><div class="line">}</div></div><!-- fragment --><p><b>JAVA API</b></p>
<div class="fragment"><div class="line">LBMSourceAttributes sattr = null;</div><div class="line"><span class="keywordflow">try</span> {</div><div class="line">    sattr = <span class="keyword">new</span> LBMSourceAttributes();</div><div class="line">    sattr.setValue(<span class="stringliteral">&quot;ume_retention_unique_confirmations&quot;</span>, <span class="stringliteral">&quot;10&quot;</span>);</div><div class="line">}</div><div class="line"><span class="keywordflow">catch</span> (LBMException ex) {</div><div class="line">    System.err.println(<span class="stringliteral">&quot;Error creating source attribute: &quot;</span> + ex.toString());</div><div class="line">    System.exit(1);</div><div class="line">}</div></div><!-- fragment --><p><b>.NET API</b></p>
<div class="fragment"><div class="line">LBMSourceAttributes sattr = null;</div><div class="line"><span class="keywordflow">try</span> {</div><div class="line">    sattr = <span class="keyword">new</span> LBMSourceAttributes();</div><div class="line">    sattr.setValue(<span class="stringliteral">&quot;ume_retention_unique_confirmations&quot;</span>, <span class="stringliteral">&quot;10&quot;</span>);</div><div class="line">}</div><div class="line"><span class="keywordflow">catch</span> (LBMException ex) {</div><div class="line">    System.Console.Error.WriteLine (<span class="stringliteral">&quot;Error creating source attribute: &quot;</span> + ex.toString());</div><div class="line">    System.Environment.Exit(1);</div><div class="line">}</div></div><!-- fragment --><p><br />
 </p>
<h1><a class="anchor" id="sourceeventhandler"></a>
Source Event Handler&nbsp;&nbsp;<small><a href="#sourceeventhandler">&lt;-</a></small></h1>
<p>The Source Event Handler is a function callback initialized at source creation to provide source events to your application related to the operation of the source. The following source code examples illustrate the use of a source event handler for registration events. To accept other source events, additional case statements would be required, one for each additional source event. See also <a class="el" href="operationalview.html#persistenceevents">Persistence Events</a>.</p>
<p><b>C API</b></p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> handle_src_event(<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/lbm_8h.html#a717ff27bb10ae7800330c21d810dffb8">lbm_src_t</a> *src, <span class="keywordtype">int</span> event, <span class="keywordtype">void</span> *ed, <span class="keywordtype">void</span> *cd)</div><div class="line">{</div><div class="line">    <span class="keywordflow">switch</span> (event) {</div><div class="line">    <span class="keywordflow">case</span> <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/lbm_8h.html#ab030d061f44d60babc7d9efba6769cc2">LBM_SRC_EVENT_UME_REGISTRATION_ERROR</a>:</div><div class="line">    {</div><div class="line">        <span class="keyword">const</span> <span class="keywordtype">char</span> *errstr = (<span class="keyword">const</span> <span class="keywordtype">char</span> *)ed;</div><div class="line">        printf(<span class="stringliteral">&quot;Error registering source with UME store: %s\n&quot;</span>, errstr);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/lbm_8h.html#a99e39b5b7215553654f91f8b74ad98c8">LBM_SRC_EVENT_UME_REGISTRATION_SUCCESS_EX</a>:</div><div class="line">    {</div><div class="line">        <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/structlbm__src__event__ume__registration__ex__t__stct.html">lbm_src_event_ume_registration_ex_t</a> *reg =</div><div class="line">            (<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/structlbm__src__event__ume__registration__ex__t__stct.html">lbm_src_event_ume_registration_ex_t</a> *)ed;</div><div class="line"></div><div class="line">        printf(<span class="stringliteral">&quot;UME store %u: %s registration success. RegID %u. Flags %x &quot;</span>,</div><div class="line">               reg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/structlbm__src__event__ume__registration__ex__t__stct.html#a72569bff32bf79a0e1bd5d99d3ab9e6b">store_index</a>, reg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/structlbm__src__event__ume__registration__ex__t__stct.html#af5299bff3739162ccf08da2d4b33cc67">store</a>, reg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/structlbm__src__event__ume__registration__ex__t__stct.html#a2597610653b0c77f9d6fb60e2a04a68e">registration_id</a>, reg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/structlbm__src__event__ume__registration__ex__t__stct.html#ae9f5da93dba23287f1a3e21fe900ab37">flags</a>);</div><div class="line">        <span class="keywordflow">if</span> (reg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/structlbm__src__event__ume__registration__ex__t__stct.html#ae9f5da93dba23287f1a3e21fe900ab37">flags</a> &amp; LBM_SRC_EVENT_UME_REGISTRATION_SUCCESS_EX_FLAG_OLD)</div><div class="line">            printf(<span class="stringliteral">&quot;OLD[SQN %x] &quot;</span>, reg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/structlbm__src__event__ume__registration__ex__t__stct.html#ae435ea742defd8af4894b25c9db10cca">sequence_number</a>);</div><div class="line">        <span class="keywordflow">if</span> (reg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/structlbm__src__event__ume__registration__ex__t__stct.html#ae9f5da93dba23287f1a3e21fe900ab37">flags</a> &amp; LBM_SRC_EVENT_UME_REGISTRATION_SUCCESS_EX_FLAG_NOACKS)</div><div class="line">            printf(<span class="stringliteral">&quot;NOACKS &quot;</span>);</div><div class="line">        printf(<span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/lbm_8h.html#a1e46557c499f8e8f97bb7996a1662f26">LBM_SRC_EVENT_UME_REGISTRATION_COMPLETE_EX</a>:</div><div class="line">    {</div><div class="line">        <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/structlbm__src__event__ume__registration__complete__ex__t__stct.html">lbm_src_event_ume_registration_complete_ex_t</a> *reg =</div><div class="line">            (lbm_src_event_ume__complete_ex_t *)ed;</div><div class="line">        printf(<span class="stringliteral">&quot;UME registration complete. SQN %x. Flags %x &quot;</span>,</div><div class="line">               reg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/structlbm__src__event__ume__registration__complete__ex__t__stct.html#aba830cd0f91f4dbdf5d3cbcef96d397c">sequence_number</a>, reg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/structlbm__src__event__ume__registration__complete__ex__t__stct.html#aee2b59249259b8ff8d301392e1e9e725">flags</a>);</div><div class="line">        <span class="keywordflow">if</span> (reg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/structlbm__src__event__ume__registration__complete__ex__t__stct.html#aee2b59249259b8ff8d301392e1e9e725">flags</a> &amp; LBM_SRC_EVENT_UME_REGISTRATION_COMPLETE_EX_FLAG_QUORUM)</div><div class="line">            printf(<span class="stringliteral">&quot;QUORUM &quot;</span>);</div><div class="line">        printf(<span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/lbm_8h.html#a9505bdf346c03c9751b7d1c3755d4843">LBM_SRC_EVENT_UME_STORE_UNRESPONSIVE</a>:</div><div class="line">    {</div><div class="line">        <span class="keyword">const</span> <span class="keywordtype">char</span> *infostr = (<span class="keyword">const</span> <span class="keywordtype">char</span> *)ed;</div><div class="line">        printf(<span class="stringliteral">&quot;UME store: %s\n&quot;</span>, infostr);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">default</span>:</div><div class="line">        printf(<span class="stringliteral">&quot;Unknown source event %d\n&quot;</span>, event);</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><p><b>JAVA API</b></p>
<div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keywordtype">int</span> onSourceEvent(Object arg, LBMSourceEvent sourceEvent)</div><div class="line">{</div><div class="line">    <span class="keywordflow">switch</span> (sourceEvent.type()) {</div><div class="line">    <span class="keywordflow">case</span> LBM.SRC_EVENT_UME_REGISTRATION_ERROR:</div><div class="line">        System.out.println(<span class="stringliteral">&quot;Error registering source with UME store: &quot;</span></div><div class="line">            + sourceEvent.dataString());</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> LBM.SRC_EVENT_UME_REGISTRATION_SUCCESS_EX:</div><div class="line">        UMESourceEventRegistrationSuccessInfo reg =</div><div class="line">            sourceEvent.registrationSuccessInfo();</div><div class="line">        System.out.print(<span class="stringliteral">&quot;UME store &quot;</span> + reg.storeIndex() + <span class="stringliteral">&quot;: &quot;</span> + reg.store()</div><div class="line">            + <span class="stringliteral">&quot; registration success. RegID &quot;</span> + reg.registrationId() + <span class="stringliteral">&quot;. Flags &quot;</span></div><div class="line">            + reg.flags() + <span class="stringliteral">&quot; &quot;</span>);</div><div class="line">        <span class="keywordflow">if</span> (((reg.flags() &amp; LBM.SRC_EVENT_UME_REGISTRATION_SUCCESS_EX_FLAG_OLD)) != 0) {</div><div class="line">            System.out.print(<span class="stringliteral">&quot;OLD[SQN &quot;</span> + reg.sequenceNumber() + <span class="stringliteral">&quot;] &quot;</span>);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">if</span> (((reg.flags() &amp; LBM.SRC_EVENT_UME_REGISTRATION_SUCCESS_EX_FLAG_NOACKS)) != 0) {</div><div class="line">            System.out.print(<span class="stringliteral">&quot;NOACKS &quot;</span>);</div><div class="line">        }</div><div class="line">        System.out.println();</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> LBM.SRC_EVENT_UME_REGISTRATION_COMPLETE_EX:</div><div class="line">        UMESourceEventRegistrationCompleteInfo regcomp =</div><div class="line">            sourceEvent.registrationCompleteInfo();</div><div class="line">        System.out.print(<span class="stringliteral">&quot;UME registration complete. SQN &quot;</span> + regcomp.sequenceNumber()</div><div class="line">            + <span class="stringliteral">&quot;. Flags &quot;</span> + regcomp.flags() + <span class="stringliteral">&quot; &quot;</span>);</div><div class="line">        <span class="keywordflow">if</span> ((regcomp.flags() &amp; LBM.SRC_EVENT_UME_REGISTRATION_COMPLETE_EX_FLAG_QUORUM) != 0) {</div><div class="line">            System.out.print(<span class="stringliteral">&quot;QUORUM &quot;</span>);</div><div class="line">        }</div><div class="line">        System.out.println();</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> LBM.SRC_EVENT_UME_STORE_UNRESPONSIVE:</div><div class="line">        System.out.println(<span class="stringliteral">&quot;UME store: &quot;</span> + sourceEvent.dataString());</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">    ...</div><div class="line">    <span class="keywordflow">default</span>:</div><div class="line">        System.out.println(<span class="stringliteral">&quot;Unknown source event &quot;</span> + sourceEvent.type());</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><p><b>.NET API</b></p>
<div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keywordtype">int</span> onSourceEvent(Object arg, LBMSourceEvent sourceEvent)</div><div class="line">{</div><div class="line">    <span class="keywordflow">switch</span> (sourceEvent.type()) {</div><div class="line">    <span class="keywordflow">case</span> LBM.SRC_EVENT_UME_REGISTRATION_ERROR:</div><div class="line">        System.Console.Out.WriteLine(<span class="stringliteral">&quot;Error registering source with UME store: &quot;</span></div><div class="line">            + sourceEvent.dataString());</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> LBM.SRC_EVENT_UME_REGISTRATION_SUCCESS_EX:</div><div class="line">        UMESourceEventRegistrationSuccessInfo reg = sourceEvent.registrationSuccessInfo();</div><div class="line">        System.Console.Out.Write(<span class="stringliteral">&quot;UME store &quot;</span> + reg.storeIndex() + <span class="stringliteral">&quot;: &quot;</span> + reg.store()</div><div class="line">            + <span class="stringliteral">&quot; registration success. RegID &quot;</span> + reg.registrationId() + <span class="stringliteral">&quot;. Flags &quot;</span></div><div class="line">            + reg.flags() + <span class="stringliteral">&quot; &quot;</span>);</div><div class="line">        <span class="keywordflow">if</span> (((reg.flags() &amp; LBM.SRC_EVENT_UME_REGISTRATION_SUCCESS_EX_FLAG_OLD)) != 0) {</div><div class="line">            System.Console.Out.Write(<span class="stringliteral">&quot;OLD[SQN &quot;</span> + reg.sequenceNumber() + <span class="stringliteral">&quot;] &quot;</span>);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">if</span> (((reg.flags() &amp; LBM.SRC_EVENT_UME_REGISTRATION_SUCCESS_EX_FLAG_NOACKS)) != 0) {</div><div class="line">            System.Console.Out.Write(<span class="stringliteral">&quot;NOACKS &quot;</span>);</div><div class="line">        }</div><div class="line">        System.Console.Out.WriteLine();</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> LBM.SRC_EVENT_UME_REGISTRATION_COMPLETE_EX:</div><div class="line">        UMESourceEventRegistrationCompleteInfo regcomp =</div><div class="line">            sourceEvent.registrationCompleteInfo();</div><div class="line">        System.Console.Out.Write(<span class="stringliteral">&quot;UME registration complete. SQN &quot;</span> +</div><div class="line">            regcomp.sequenceNumber() + <span class="stringliteral">&quot;. Flags &quot;</span> + regcomp.flags() + <span class="stringliteral">&quot; &quot;</span>);</div><div class="line">        <span class="keywordflow">if</span> ((regcomp.flags() &amp; LBM.SRC_EVENT_UME_REGISTRATION_COMPLETE_EX_FLAG_QUORUM) != 0) {</div><div class="line">            System.Console.Out.Write(<span class="stringliteral">&quot;QUORUM &quot;</span>);</div><div class="line">        }</div><div class="line">        System.Console.Out.WriteLine();</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> LBM.SRC_EVENT_UME_STORE_UNRESPONSIVE:</div><div class="line">        System.Console.Out.WriteLine(<span class="stringliteral">&quot;UME store: &quot;</span> + sourceEvent.dataString());</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">    ...</div><div class="line">    <span class="keywordflow">default</span>:</div><div class="line">        System.Console.Out.WriteLine(<span class="stringliteral">&quot;Unknown source event &quot;</span> + sourceEvent.type());</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><p><br />
 </p>
<h1><a class="anchor" id="sourceeventhandlerstabilityconfirmationandrelease"></a>
Source Event Handler - Stability, Confirmation and Release&nbsp;&nbsp;<small><a href="#sourceeventhandlerstabilityconfirmationandrelease">&lt;-</a></small></h1>
<p>As shown in Source Event Handler above, the Source Event Handler can be expanded to handle more source events by adding additional case statements. The following source code examples show case statements to handle message stability events, delivery confirmation events and message release (reclaim) events. See also <a class="el" href="operationalview.html#persistenceevents">Persistence Events</a>.</p>
<p><b>C API</b></p>
<div class="fragment"><div class="line"><span class="keywordflow">case</span> <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/lbm_8h.html#acf1cedd5755e63083db63f3d45e45df6">LBM_SRC_EVENT_UME_MESSAGE_STABLE_EX</a>:</div><div class="line"><span class="comment">/* requires that source ume_message_stability_notification option is enabled */</span></div><div class="line">{</div><div class="line">    <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/structlbm__src__event__ume__ack__ex__info__t__stct.html">lbm_src_event_ume_ack_ex_info_t</a> *info = (<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/structlbm__src__event__ume__ack__ex__info__t__stct.html">lbm_src_event_ume_ack_ex_info_t</a> *)ed;</div><div class="line"></div><div class="line">    printf(<span class="stringliteral">&quot;UME store %u: %s message stable. SQN %x (msgno %d). Flags %x &quot;</span>,</div><div class="line">        info-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/structlbm__src__event__ume__ack__ex__info__t__stct.html#a0fd1ee65ec5045f559538d6d41fbb578">store_index</a>, info-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/structlbm__src__event__ume__ack__ex__info__t__stct.html#a7b71e8d27bf6476e90a27d871bf77a3f">store</a>, info-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/structlbm__src__event__ume__ack__ex__info__t__stct.html#a8b7e4d03232bb81a0629497ac7b8c2fe">sequence_number</a>,</div><div class="line">        (<span class="keywordtype">int</span>)info-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/structlbm__src__event__ume__ack__ex__info__t__stct.html#a11394d5ea9ee6a873ecf60170732c186">msg_clientd</a> - 1, info-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/structlbm__src__event__ume__ack__ex__info__t__stct.html#a207c8b76a154b24274700279bba95600">flags</a>);</div><div class="line">    <span class="keywordflow">if</span> (info-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/structlbm__src__event__ume__ack__ex__info__t__stct.html#a207c8b76a154b24274700279bba95600">flags</a> &amp; LBM_SRC_EVENT_UME_MESSAGE_STABLE_EX_FLAG_INTRAGROUP_STABLE)</div><div class="line">        printf(<span class="stringliteral">&quot;IA &quot;</span>); <span class="comment">/* Stable within Store group */</span></div><div class="line">    <span class="keywordflow">if</span> (info-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/structlbm__src__event__ume__ack__ex__info__t__stct.html#a207c8b76a154b24274700279bba95600">flags</a> &amp; LBM_SRC_EVENT_UME_MESSAGE_STABLE_EX_FLAG_INTERGROUP_STABLE)</div><div class="line">        printf(<span class="stringliteral">&quot;IR &quot;</span>); <span class="comment">/* Stable amongst all Stores */</span></div><div class="line">    <span class="keywordflow">if</span> (info-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/structlbm__src__event__ume__ack__ex__info__t__stct.html#a207c8b76a154b24274700279bba95600">flags</a> &amp; LBM_SRC_EVENT_UME_MESSAGE_STABLE_EX_FLAG_STABLE)</div><div class="line">        printf(<span class="stringliteral">&quot;STABLE &quot;</span>);  <span class="comment">/* Just plain stable */</span></div><div class="line">    <span class="keywordflow">if</span> (info-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/structlbm__src__event__ume__ack__ex__info__t__stct.html#a207c8b76a154b24274700279bba95600">flags</a> &amp; LBM_SRC_EVENT_UME_MESSAGE_STABLE_EX_FLAG_STORE)</div><div class="line">        printf(<span class="stringliteral">&quot;STORE &quot;</span>);   <span class="comment">/* Stability reported by UME Store */</span></div><div class="line">    printf(<span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line">}</div><div class="line"><span class="keywordflow">break</span>;</div><div class="line"></div><div class="line"><span class="keywordflow">case</span> <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/lbm_8h.html#ae7124621f7cab5925ed8354690d736f9">LBM_SRC_EVENT_UME_DELIVERY_CONFIRMATION_EX</a>:</div><div class="line"><span class="comment">/* requires that source ume_confirmed_delivery_notification option is enabled */</span></div><div class="line">{</div><div class="line">    <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/structlbm__src__event__ume__ack__ex__info__t__stct.html">lbm_src_event_ume_ack_ex_info_t</a> *info = (<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/structlbm__src__event__ume__ack__ex__info__t__stct.html">lbm_src_event_ume_ack_ex_info_t</a> *)ed;</div><div class="line"></div><div class="line">    printf(<span class="stringliteral">&quot;UME delivery confirmation. SQN %x, Receiver RegID %u (msgno %d). Flags %x &quot;</span>,</div><div class="line">        info-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/structlbm__src__event__ume__ack__ex__info__t__stct.html#a8b7e4d03232bb81a0629497ac7b8c2fe">sequence_number</a>, info-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/structlbm__src__event__ume__ack__ex__info__t__stct.html#ab19378eb60d2b6e20bb5187bbb64fcd3">rcv_registration_id</a>,</div><div class="line">        (<span class="keywordtype">int</span>)info-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/structlbm__src__event__ume__ack__ex__info__t__stct.html#a11394d5ea9ee6a873ecf60170732c186">msg_clientd</a> - 1, info-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/structlbm__src__event__ume__ack__ex__info__t__stct.html#a207c8b76a154b24274700279bba95600">flags</a>);</div><div class="line">    <span class="keywordflow">if</span> (info-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/structlbm__src__event__ume__ack__ex__info__t__stct.html#a207c8b76a154b24274700279bba95600">flags</a> &amp; LBM_SRC_EVENT_UME_DELIVERY_CONFIRMATION_EX_FLAG_UNIQUEACKS)</div><div class="line">        printf(<span class="stringliteral">&quot;UNIQUEACKS &quot;</span>); <span class="comment">/* Satisfied number of unique ACKs requirement */</span></div><div class="line">    <span class="keywordflow">if</span> (info-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/structlbm__src__event__ume__ack__ex__info__t__stct.html#a207c8b76a154b24274700279bba95600">flags</a> &amp; LBM_SRC_EVENT_UME_DELIVERY_CONFIRMATION_EX_FLAG_UREGID)</div><div class="line">        printf(<span class="stringliteral">&quot;UREGID &quot;</span>); <span class="comment">/* Confirmation contains receiver application registration ID */</span></div><div class="line">    <span class="keywordflow">if</span> (info-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/structlbm__src__event__ume__ack__ex__info__t__stct.html#a207c8b76a154b24274700279bba95600">flags</a> &amp; LBM_SRC_EVENT_UME_DELIVERY_CONFIRMATION_EX_FLAG_OOD)</div><div class="line">        printf(<span class="stringliteral">&quot;OOD &quot;</span>); <span class="comment">/* Confirmation received from arrival order receiver */</span></div><div class="line">    <span class="keywordflow">if</span> (info-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/structlbm__src__event__ume__ack__ex__info__t__stct.html#a207c8b76a154b24274700279bba95600">flags</a> &amp; LBM_SRC_EVENT_UME_DELIVERY_CONFIRMATION_EX_FLAG_EXACK)</div><div class="line">        printf(<span class="stringliteral">&quot;EXACK &quot;</span>); <span class="comment">/* Confirmation explicitly sent by receiver */</span></div><div class="line">    printf(<span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line">}</div><div class="line"><span class="keywordflow">break</span>;</div><div class="line"></div><div class="line"><span class="keywordflow">case</span> <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/lbm_8h.html#ad1821a408b0feaf8c28893ee79816dab">LBM_SRC_EVENT_UME_MESSAGE_RECLAIMED</a>:</div><div class="line"><span class="comment">/* requires that source ume_confirmed_delivery_notification or ume_message_stability_notification</span></div><div class="line"><span class="comment">attributes are enabled */</span></div><div class="line">{</div><div class="line">    <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/structlbm__src__event__ume__ack__info__t__stct.html">lbm_src_event_ume_ack_info_t</a> *ackinfo = (<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/structlbm__src__event__ume__ack__info__t__stct.html">lbm_src_event_ume_ack_info_t</a> *)ed;</div><div class="line"></div><div class="line">    printf(<span class="stringliteral">&quot;UME message released - sequence number %x (msgno %d)\n&quot;</span>,</div><div class="line">        ackinfo-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/structlbm__src__event__ume__ack__info__t__stct.html#ac9a622d66a1542222ff6650fdbc075e7">sequence_number</a>, (<span class="keywordtype">int</span>)ackinfo-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/structlbm__src__event__ume__ack__info__t__stct.html#a6feec78d574fac16931d5a9c26aa59a8">msg_clientd</a> - 1);</div><div class="line">}</div><div class="line"><span class="keywordflow">break</span>;</div></div><!-- fragment --><p><b>JAVA API</b></p>
<div class="fragment"><div class="line"><span class="keywordflow">case</span> LBM.SRC_EVENT_UME_MESSAGE_STABLE_EX:</div><div class="line">    <span class="comment">// requires that source ume_message_stability_notification option is enabled</span></div><div class="line">    UMESourceEventAckInfo staInfo = sourceEvent.ackInfo();</div><div class="line">    System.out.print(<span class="stringliteral">&quot;UME store &quot;</span> + staInfo.storeIndex() + <span class="stringliteral">&quot;: &quot;</span></div><div class="line">                    + staInfo.store() + <span class="stringliteral">&quot; message stable. SQN &quot;</span> + staInfo.sequenceNumber()</div><div class="line">                    + <span class="stringliteral">&quot; (msgno &quot;</span> + staInfo.clientObject() + <span class="stringliteral">&quot;). Flags &quot;</span></div><div class="line">                    + staInfo.flags() + <span class="stringliteral">&quot; &quot;</span>);</div><div class="line">    <span class="keywordflow">if</span> ((staInfo.flags() &amp; LBM.SRC_EVENT_UME_MESSAGE_STABLE_EX_FLAG_INTRAGROUP_STABLE) != 0) {</div><div class="line">        System.out.print(<span class="stringliteral">&quot;IA &quot;</span>); <span class="comment">// Stable within Store group</span></div><div class="line">    }</div><div class="line">    <span class="keywordflow">if</span> ((staInfo.flags() &amp; LBM.SRC_EVENT_UME_MESSAGE_STABLE_EX_FLAG_INTERGROUP_STABLE) != 0) {</div><div class="line">        System.out.print(<span class="stringliteral">&quot;IR &quot;</span>);  <span class="comment">// Stable amongst all Stores</span></div><div class="line">    }</div><div class="line">    <span class="keywordflow">if</span> ((staInfo.flags() &amp; LBM.SRC_EVENT_UME_MESSAGE_STABLE_EX_FLAG_STABLE) != 0) {</div><div class="line">        System.out.print(<span class="stringliteral">&quot;STABLE &quot;</span>);  <span class="comment">// Just plain stable</span></div><div class="line">    }</div><div class="line">    <span class="keywordflow">if</span> ((staInfo.flags() &amp; LBM.SRC_EVENT_UME_MESSAGE_STABLE_EX_FLAG_STORE) != 0) {</div><div class="line">        System.out.print(<span class="stringliteral">&quot;STORE &quot;</span>);   <span class="comment">// Stability reported by UME Store</span></div><div class="line">    }</div><div class="line">    System.out.println();</div><div class="line">    <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line"><span class="keywordflow">case</span> LBM.SRC_EVENT_UME_DELIVERY_CONFIRMATION_EX:</div><div class="line">    <span class="comment">// requires that source ume_confirmed_delivery_notification option is enabled</span></div><div class="line">    UMESourceEventAckInfo cdelvinfo = sourceEvent.ackInfo();</div><div class="line">    System.out.print(<span class="stringliteral">&quot;UME delivery confirmation. SQN &quot;</span> + cdelvinfo.sequenceNumber()</div><div class="line">                    + <span class="stringliteral">&quot;, RcvRegID &quot;</span> + cdelvinfo.receiverRegistrationId() + <span class="stringliteral">&quot; (msgno &quot;</span></div><div class="line">                    + cdelvinfo.clientObject() + <span class="stringliteral">&quot;). Flags &quot;</span> + cdelvinfo.flags() + <span class="stringliteral">&quot; &quot;</span>);</div><div class="line">    <span class="keywordflow">if</span> ((cdelvinfo.flags() &amp; LBM.SRC_EVENT_UME_DELIVERY_CONFIRMATION_EX_FLAG_UNIQUEACKS) != 0) {</div><div class="line">        System.out.print(<span class="stringliteral">&quot;UNIQUEACKS &quot;</span>); <span class="comment">// Satisfied number of unique ACKs requirement</span></div><div class="line">    }</div><div class="line">    <span class="keywordflow">if</span> ((cdelvinfo.flags() &amp; LBM.SRC_EVENT_UME_DELIVERY_CONFIRMATION_EX_FLAG_UREGID) != 0) {</div><div class="line">        System.out.print(<span class="stringliteral">&quot;UREGID &quot;</span>);    <span class="comment">// Confirmation contains receiver application reg ID</span></div><div class="line">    }</div><div class="line">    <span class="keywordflow">if</span> ((cdelvinfo.flags() &amp; LBM.SRC_EVENT_UME_DELIVERY_CONFIRMATION_EX_FLAG_OOD) != 0) {</div><div class="line">        System.out.print(<span class="stringliteral">&quot;OOD &quot;</span>);      <span class="comment">// Confirmation received from arrival order receiver</span></div><div class="line">    }</div><div class="line">    <span class="keywordflow">if</span> ((cdelvinfo.flags() &amp; LBM.SRC_EVENT_UME_DELIVERY_CONFIRMATION_EX_FLAG_EXACK) != 0) {</div><div class="line">        System.out.print(<span class="stringliteral">&quot;EXACK &quot;</span>);    <span class="comment">// Confirmation explicitly sent by receiver</span></div><div class="line">    }</div><div class="line">    System.out.println();</div><div class="line">    <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line"><span class="keywordflow">case</span> LBM.SRC_EVENT_UME_MESSAGE_RECLAIMED:</div><div class="line">    <span class="comment">// requires that source ume_confirmed_delivery_notification or</span></div><div class="line">    <span class="comment">// ume_message_stability_notification attributes are enabled</span></div><div class="line">    System.out.println(<span class="stringliteral">&quot;UME message released - sequence number &quot;</span></div><div class="line">                + Long.toHexString(sourceEvent.sequenceNumber())</div><div class="line">                + <span class="stringliteral">&quot; (msgno &quot;</span></div><div class="line">                + Long.toHexString(((Integer)sourceEvent.clientObject()).longValue())</div><div class="line">                + <span class="stringliteral">&quot;)&quot;</span>);</div><div class="line">    <span class="keywordflow">break</span>;</div></div><!-- fragment --><p><b>.NET API</b></p>
<div class="fragment"><div class="line"><span class="keywordflow">case</span> LBM.SRC_EVENT_UME_MESSAGE_STABLE_EX:</div><div class="line">    <span class="comment">// requires that source ume_message_stability_notification option is enabled</span></div><div class="line">    UMESourceEventAckInfo staInfo = sourceEvent.ackInfo();</div><div class="line">    System.Console.Out.Write(<span class="stringliteral">&quot;UME store &quot;</span> + staInfo.storeIndex() + <span class="stringliteral">&quot;: &quot;</span></div><div class="line">                        + staInfo.store() + <span class="stringliteral">&quot; message stable. SQN &quot;</span> + staInfo.sequenceNumber()</div><div class="line">                        + <span class="stringliteral">&quot; (msgno &quot;</span> + ((int)staInfo.clientObject()).ToString(<span class="stringliteral">&quot;x&quot;</span>) + <span class="stringliteral">&quot;).</span></div><div class="line"><span class="stringliteral">                        Flags &quot;</span> + staInfo.flags() + <span class="stringliteral">&quot; &quot;</span>);</div><div class="line">    <span class="keywordflow">if</span> ((staInfo.flags() &amp; LBM.SRC_EVENT_UME_MESSAGE_STABLE_EX_FLAG_INTRAGROUP_STABLE) != 0) {</div><div class="line">        System.Console.Out.Write(<span class="stringliteral">&quot;IA &quot;</span>);  <span class="comment">// Stable within Store group</span></div><div class="line">    }</div><div class="line">    <span class="keywordflow">if</span> ((staInfo.flags() &amp; LBM.SRC_EVENT_UME_MESSAGE_STABLE_EX_FLAG_INTERGROUP_STABLE) != 0) {</div><div class="line">        System.Console.Out.Write(<span class="stringliteral">&quot;IR &quot;</span>);  <span class="comment">// Stable amongst all Stores</span></div><div class="line">    }</div><div class="line">    <span class="keywordflow">if</span> ((staInfo.flags() &amp; LBM.SRC_EVENT_UME_MESSAGE_STABLE_EX_FLAG_STABLE) != 0) {</div><div class="line">        System.Console.Out.Write(<span class="stringliteral">&quot;STABLE &quot;</span>);  <span class="comment">// Just plain stable</span></div><div class="line">    }</div><div class="line">    <span class="keywordflow">if</span> ((staInfo.flags() &amp; LBM.SRC_EVENT_UME_MESSAGE_STABLE_EX_FLAG_STORE) != 0) {</div><div class="line">        System.Console.Out.Write(<span class="stringliteral">&quot;STORE &quot;</span>);  <span class="comment">// Stability reported by UME Store</span></div><div class="line">    }</div><div class="line">    System.Console.Out.WriteLine();</div><div class="line">    <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line"><span class="keywordflow">case</span> LBM.SRC_EVENT_UME_DELIVERY_CONFIRMATION_EX:</div><div class="line">    <span class="comment">// requires that source ume_confirmed_delivery_notification option is enabled</span></div><div class="line"></div><div class="line">    UMESourceEventAckInfo cdelvinfo = sourceEvent.ackInfo();</div><div class="line"></div><div class="line">    System.Console.Out.Write(<span class="stringliteral">&quot;UME delivery confirmation. SQN &quot;</span> +</div><div class="line">    cdelvinfo.sequenceNumber()</div><div class="line">                        + <span class="stringliteral">&quot;, RcvRegID &quot;</span> + cdelvinfo.receiverRegistrationId() + <span class="stringliteral">&quot; (msgno &quot;</span></div><div class="line">                        + ((int)cdelvinfo.clientObject()).ToString(<span class="stringliteral">&quot;x&quot;</span>) + <span class="stringliteral">&quot;). Flags &quot;</span> +</div><div class="line">                        cdelvinfo.flags() + <span class="stringliteral">&quot; &quot;</span>);</div><div class="line">    <span class="keywordflow">if</span> ((cdelvinfo.flags() &amp; LBM.SRC_EVENT_UME_DELIVERY_CONFIRMATION_EX_FLAG_UNIQUEACKS) != 0) {</div><div class="line">        System.Console.Out.Write(<span class="stringliteral">&quot;UNIQUEACKS &quot;</span>);  <span class="comment">// Satisfied number of unique ACKs requirement</span></div><div class="line">    }</div><div class="line">    <span class="keywordflow">if</span> ((cdelvinfo.flags() &amp; LBM.SRC_EVENT_UME_DELIVERY_CONFIRMATION_EX_FLAG_UREGID) != 0) {</div><div class="line">        System.Console.Out.Write(<span class="stringliteral">&quot;UREGID &quot;</span>);  <span class="comment">// Confirmation contains receiver application reg ID</span></div><div class="line">    }</div><div class="line">    <span class="keywordflow">if</span> ((cdelvinfo.flags() &amp; LBM.SRC_EVENT_UME_DELIVERY_CONFIRMATION_EX_FLAG_OOD) != 0) {</div><div class="line">        System.Console.Out.Write(<span class="stringliteral">&quot;OOD &quot;</span>);  <span class="comment">// Confirmation received from arrival order receiver</span></div><div class="line">    }</div><div class="line">    <span class="keywordflow">if</span> ((cdelvinfo.flags() &amp; LBM.SRC_EVENT_UME_DELIVERY_CONFIRMATION_EX_FLAG_EXACK) != 0) {</div><div class="line">        System.Console.Out.Write(<span class="stringliteral">&quot;EXACK &quot;</span>);  <span class="comment">// Confirmation explicitly sent by receiver</span></div><div class="line">    }</div><div class="line">    System.Console.Out.WriteLine();</div><div class="line">    <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line"><span class="keywordflow">case</span> LBM.SRC_EVENT_UME_MESSAGE_RECLAIMED:</div><div class="line">    <span class="comment">// requires that source ume_confirmed_delivery_notification or</span></div><div class="line">    <span class="comment">// ume_message_stability_notification attributes are enabled</span></div><div class="line"></div><div class="line">    System.Console.Out.WriteLine(<span class="stringliteral">&quot;UME message released - sequence number &quot;</span></div><div class="line">                               + sourceEvent.sequenceNumber().ToString(<span class="stringliteral">&quot;x&quot;</span>)</div><div class="line">                               + <span class="stringliteral">&quot; (msgno &quot;</span></div><div class="line">                               + ((int)sourceEvent.clientObject()).ToString(<span class="stringliteral">&quot;x&quot;</span>)</div><div class="line">                               + <span class="stringliteral">&quot;)&quot;</span>);</div><div class="line">    <span class="keywordflow">break</span>;</div></div><!-- fragment --><p><br />
 </p>
<h1><a class="anchor" id="mappingyourmessagenumberstosequencenumbers"></a>
Mapping Your Message Numbers to Sequence Numbers&nbsp;&nbsp;<small><a href="#mappingyourmessagenumberstosequencenumbers">&lt;-</a></small></h1>
<p>The C API function <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/lbm_8h.html#a4d883eaaa22baf81abf21d495f471c8b">lbm_src_sendv_ex()</a> allows you to create a pointer to an object or structure. This pointer will be returned to your application along with all source events. You can then update the object or structure with source event information. For example, if your messages exceed 8K - which requires fragmentation your application's message into more than one UM message - receiving sequence number events with this pointer allows you to determine all the UM sequence numbers for the message and, therefore, how many release (reclaim) events to expect. The following two source code examples show how to:</p>
<ul>
<li>
Enable message sequence number information. </li>
<li>
Handle sequence number source events to determine the application message number in the Source Event Handler. </li>
</ul>
<p><b>C API - Enable Message Information</b></p>
<div class="fragment"><div class="line"><a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/structlbm__src__send__ex__info__t__stct.html">lbm_src_send_ex_info_t</a> exinfo;</div><div class="line"></div><div class="line"><span class="comment">/* Enable message sequence number info to be returned */</span></div><div class="line">exinfo.<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/structlbm__src__send__ex__info__t__stct.html#aa450a079510ebdc97b19625d10bd18ea">flags</a> = <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/lbm_8h.html#a781e689ed6e1178938dc0b2e2bfabc06">LBM_SRC_SEND_EX_FLAG_UME_CLIENTD</a> | <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/lbm_8h.html#ab99586b3f3b469aa6f2e2da632fa5be0">LBM_SRC_SEND_EX_FLAG_SEQUENCE_NUMBER_INFO</a>;</div><div class="line">exinfo.<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/structlbm__src__send__ex__info__t__stct.html#afeb9643e8ca421be3c85d2c1c32fe556">ume_msg_clientd</a> = (<span class="keywordtype">void</span> *)(msgno + 1);</div><div class="line"><span class="comment">/* msgno set to application message number (can&#39;t evaluate to NULL) */</span></div><div class="line"><span class="keywordflow">while</span> (<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/lbm_8h.html#a091b5806bf18d10ebd0d9117e0c70229">lbm_src_send_ex</a>(src, message, msglen, 0, &amp;exinfo) == <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/lbm_8h.html#a06fc87d81c62e9abb8790b6e5713c55baf90fd7c1c303f82795102f289988877a">LBM_FAILURE</a>) {</div><div class="line">    <span class="keywordflow">if</span> (<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/lbm_8h.html#af3a827eb26d87be5b1a6b9fd3a4b63aa">lbm_errnum</a>() == <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/lbm_8h.html#a2ef169e3b343481d569a88755f22bd59">LBM_EUMENOREG</a>) {</div><div class="line">        printf(<span class="stringliteral">&quot;Send unsuccessful. Waiting...\n&quot;</span>);</div><div class="line">                SLEEP_MSEC(1000);    <span class="comment">/* Sleep for 1 second */</span></div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span> {</div><div class="line">         fprintf(stderr, <span class="stringliteral">&quot;lbm_src_send: %s\n&quot;</span>, <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/lbm_8h.html#a22a4650d3a5b649c84a0c05adedcc055">lbm_errmsg</a>());</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><p><b>C API - Sequence Number Event Handler</b></p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> handle_src_event(<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/lbm_8h.html#a717ff27bb10ae7800330c21d810dffb8">lbm_src_t</a> *src, <span class="keywordtype">int</span> event, <span class="keywordtype">void</span> *ed, <span class="keywordtype">void</span> *cd)</div><div class="line">{</div><div class="line">    <span class="keywordflow">switch</span> (event) {</div><div class="line">    <span class="keywordflow">case</span> <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/lbm_8h.html#a350c2cab7f6f029276ebc323b7d73795">LBM_SRC_EVENT_SEQUENCE_NUMBER_INFO</a>:</div><div class="line">        {</div><div class="line">            <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/structlbm__src__event__sequence__number__info__t__stct.html">lbm_src_event_sequence_number_info_t</a> *info =</div><div class="line">                (<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/structlbm__src__event__sequence__number__info__t__stct.html">lbm_src_event_sequence_number_info_t</a> *)ed;</div><div class="line"></div><div class="line">            <span class="keywordflow">if</span> (info-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/structlbm__src__event__sequence__number__info__t__stct.html#a99f1af068bde67ecfc7bafcef99d11c9">first_sequence_number</a> != info-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/structlbm__src__event__sequence__number__info__t__stct.html#a1746ec03d7a7034da58b63bc3d3b6ef2">last_sequence_number</a>) {</div><div class="line">                printf(<span class="stringliteral">&quot;SQN [%x,%x] (msgno %d)\n&quot;</span>, info-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/structlbm__src__event__sequence__number__info__t__stct.html#a99f1af068bde67ecfc7bafcef99d11c9">first_sequence_number</a>,</div><div class="line">                        info-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/structlbm__src__event__sequence__number__info__t__stct.html#a1746ec03d7a7034da58b63bc3d3b6ef2">last_sequence_number</a>, (<span class="keywordtype">int</span>)info-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/structlbm__src__event__sequence__number__info__t__stct.html#a83b9b4f89f90021d3dfdb9f08639076d">msg_clientd</a> - 1);</div><div class="line">            }</div><div class="line">            <span class="keywordflow">else</span> {</div><div class="line">                printf(<span class="stringliteral">&quot;SQN %x (msgno %d)\n&quot;</span>, info-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/structlbm__src__event__sequence__number__info__t__stct.html#a1746ec03d7a7034da58b63bc3d3b6ef2">last_sequence_number</a>,</div><div class="line">                        (<span class="keywordtype">int</span>)info-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/api.tag:../API/" href="../API/structlbm__src__event__sequence__number__info__t__stct.html#a83b9b4f89f90021d3dfdb9f08639076d">msg_clientd</a> - 1);</div><div class="line">            }</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">    ...</div><div class="line">    }</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><p><b>JAVA API - Enable Message Information</b></p>
<div class="fragment"><div class="line">LBMSourceSendExInfo exinfo = <span class="keyword">new</span> LBMSourceSendExInfo();</div><div class="line">exinfo.setClientObject(<span class="keyword">new</span> Integer(msgno));  <span class="comment">// msgno set to application message number</span></div><div class="line">exinfo.setFlags(LBM.SRC_SEND_EX_FLAG_SEQUENCE_NUMBER_INFO);</div><div class="line"><span class="comment">// Enable message sequence number info to be returned</span></div><div class="line"><span class="keywordflow">for</span> (;;)</div><div class="line">{</div><div class="line">    <span class="keywordflow">try</span> {</div><div class="line">        src.send(message, msglen, 0, exinfo);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">catch</span>(UMENoRegException ex) {</div><div class="line">        <span class="keywordflow">try</span> {</div><div class="line">            Thread.sleep(1000);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">catch</span> (InterruptedException e) { }</div><div class="line">        <span class="keywordflow">continue</span>;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">catch</span> (LBMException ex) {</div><div class="line">        System.err.println(<span class="stringliteral">&quot;Error sending message: &quot;</span> + ex.toString());</div><div class="line">    }</div><div class="line">    <span class="keywordflow">break</span>;</div><div class="line">}</div></div><!-- fragment --><p><b>JAVA API - Sequence Number Event Handler</b></p>
<div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keywordtype">int</span> onSourceEvent(Object arg, LBMSourceEvent sourceEvent)</div><div class="line">{</div><div class="line">    <span class="keywordflow">switch</span> (sourceEvent.type())</div><div class="line">    {</div><div class="line">    <span class="keywordflow">case</span> LBM.SRC_EVENT_SEQUENCE_NUMBER_INFO:</div><div class="line">        LBMSourceEventSequenceNumberInfo info = sourceEvent.sequenceNumberInfo();</div><div class="line">        <span class="keywordflow">if</span> (info.firstSequenceNumber() != info.lastSequenceNumber()) {</div><div class="line">            System.out.println(<span class="stringliteral">&quot;SQN [&quot;</span> + info.firstSequenceNumber()</div><div class="line">                            + <span class="stringliteral">&quot;,&quot;</span> + info.lastSequenceNumber() + <span class="stringliteral">&quot;] (msgno &quot;</span></div><div class="line">                            + info.clientObject() + <span class="stringliteral">&quot;)&quot;</span>);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">else</span> {</div><div class="line">            System.out.println(<span class="stringliteral">&quot;SQN &quot;</span> + info.lastSequenceNumber()</div><div class="line">                            + <span class="stringliteral">&quot; (msgno &quot;</span> + info.clientObject() + <span class="stringliteral">&quot;)&quot;</span>);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">    ...</div><div class="line">    }</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><p><b>.NET API - Enable Message Information</b></p>
<div class="fragment"><div class="line">LBMSourceSendExInfo exinfo = <span class="keyword">new</span> LBMSourceSendExInfo();</div><div class="line">exinfo.setClientObject(msgno);  <span class="comment">// msgno set to application message number</span></div><div class="line">exinfo.setFlags(LBM.SRC_SEND_EX_FLAG_SEQUENCE_NUMBER_INFO);</div><div class="line"><span class="comment">// Enable message sequence number info to be returned</span></div><div class="line"><span class="keywordflow">for</span> (;;)</div><div class="line">{</div><div class="line">    <span class="keywordflow">try</span> {</div><div class="line">        src.send(message, msglen, 0, exinfo);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">catch</span>(UMENoRegException ex) {</div><div class="line">        System.Threading.Thread.Sleep(100);</div><div class="line">        <span class="keywordflow">continue</span>;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">catch</span> (LBMException ex) {</div><div class="line">        System.Console.Out.WriteLine(<span class="stringliteral">&quot;Error sending message: &quot;</span> + ex.Message());</div><div class="line">    }</div><div class="line">    <span class="keywordflow">break</span>;</div><div class="line">}</div></div><!-- fragment --><p><b>.NET API - Sequence Number Event Handler</b></p>
<div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keywordtype">void</span> onSourceEvent(Object arg, LBMSourceEvent sourceEvent)</div><div class="line">{</div><div class="line">    <span class="keywordflow">switch</span> (sourceEvent.type())</div><div class="line">    {</div><div class="line">    <span class="keywordflow">case</span> LBM.SRC_EVENT_SEQUENCE_NUMBER_INFO:</div><div class="line">        LBMSourceEventSequenceNumberInfo info = sourceEvent.sequenceNumberInfo();</div><div class="line">        <span class="keywordflow">if</span> (info.firstSequenceNumber() != info.lastSequenceNumber()) {</div><div class="line">            System.Console.Out.WriteLine(<span class="stringliteral">&quot;SQN [&quot;</span> + info.firstSequenceNumber()</div><div class="line">                              + <span class="stringliteral">&quot;,&quot;</span> + info.lastSequenceNumber() + <span class="stringliteral">&quot;] (cd &quot;</span></div><div class="line">                              + ((int)info.clientObject()).ToString(<span class="stringliteral">&quot;x&quot;</span>) + <span class="stringliteral">&quot;)&quot;</span>);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">else</span> {</div><div class="line">            System.Console.Out.WriteLine(<span class="stringliteral">&quot;SQN &quot;</span> + info.lastSequenceNumber()</div><div class="line">                + <span class="stringliteral">&quot; (msgno &quot;</span> + ((int)info.clientObject()).ToString(<span class="stringliteral">&quot;x&quot;</span>) + <span class="stringliteral">&quot;)&quot;</span>);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">    ...</div><div class="line"></div><div class="line">    }</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><p><br />
 </p>
<h1><a class="anchor" id="receiverlivenessdetection"></a>
Receiver Liveness Detection&nbsp;&nbsp;<small><a href="#receiverlivenessdetection">&lt;-</a></small></h1>
<p>As an extension to Confirmed Delivery, you can set receivers to send a keepalive to a source during a measured absence of delivery confirmations (due to traffic lapse). In the event that neither message reaches the source within a designated interval, or if the delivery confirmation TCP connection breaks down, the receiver is assumed to have "died". UM then notifies the publishing application via context event callback. This lets the publisher assign a new subscriber.</p>
<p>To use this feature, set these five configuration options: </p><ul>
<li>
<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/config.tag:../Config/" href="../Config/grpultramessagingpersistence.html#umesourcelivenesstimeoutcontext">ume_source_liveness_timeout (context)</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/config.tag:../Config/" href="../Config/grpultramessagingpersistence.html#umereceiverlivenessintervalcontext">ume_receiver_liveness_interval (context)</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/config.tag:../Config/" href="../Config/grpultramessagingpersistence.html#umeconfirmeddeliverynotificationsource">ume_confirmed_delivery_notification (source)</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/config.tag:../Config/" href="../Config/grpultramessagingpersistence.html#umeuserreceiverregistrationidcontext">ume_user_receiver_registration_id (context)</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/config.tag:../Config/" href="../Config/grpultramessagingpersistence.html#umesessionidcontext">ume_session_id (context)</a>, <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/config.tag:../Config/" href="../Config/grpultramessagingpersistence.html#umesessionidsource">ume_session_id (source)</a>, <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/config.tag:../Config/" href="../Config/grpultramessagingpersistence.html#umesessionidreceiver">ume_session_id (receiver)</a> </li>
</ul>
<dl class="section note"><dt>Note</dt><dd><a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/design.tag:../Design/" href="../Design/advancedoptimizations.html#smartsources">Smart Sources</a> do not support liveness detection.</dd></dl>
<p>This specialized feature is not recommended for general use. If you are considering it, please note the following caveats: </p><ul>
<li>
Do not use in conjunction with a <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/UME/design.tag:../Design/" href="../Design/fundamentalconcepts.html#umrouter">DRO</a>. </li>
<li>
There is a variety of potential network occurrences that can break or reset the TCP connection and falsely indicate the death of a receiver. </li>
<li>
In cases where a receiver object is deleted while its context is not, the publisher may still falsely assume the receiver to be alive. </li>
</ul>
<p>Other false receiver-alive assumptions could be caused by the following: </p><ul>
<li>
TCP connections can enter a half-open or otherwise corrupted state. </li>
<li>
Failed TCP connections sometimes do not fully close, or experience objectionable delays before fully closing. </li>
<li>
A switch or router failure along the path does not affect the TCP connection state. </li>
</ul>
<p><br />
<br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
</p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
</body>
</html>
