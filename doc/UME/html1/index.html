<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Guide for Persistence: Guide for Persistence</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen_manual.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Guide for Persistence
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('index.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title"></div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p> 
<img src="infa_logo.png" width="400" height="138" alt="Informatica"/><br/><br/>
<big><b>Ultra Messaging</b></big> <small>(Version 6.15)</small><br/>
<br/><br/><br/>
<center class="mytitle">Guide for Persistence</center>
<br/><br/><br/>
[&nbsp;<a href="../index.html">Multi-page HTML</a>&nbsp;]&nbsp;&nbsp;|&nbsp;&nbsp;[&nbsp;<a href="../UM_Guide_for_Persistence=en.pdf">PDF</a>&nbsp;]
<br/><br/>
 </p>
<h1><a class="anchor" id="firstsect"></a>
Introduction&nbsp;&nbsp;<small><a href="#firstsect">&lt;-</a></small></h1>
<p>This document describes the Persistence functionality of the UMP and UMQ products.</p>
<p>For policies and procedures related to Ultra Messaging Technical Support, see <a href="https://ultramessaging.github.io/UM_Support.html">UM Support</a>.</p>
<p><b>(C) Copyright 2004,2022 Informatica LLC. All Rights Reserved.</b></p>
<p>This software and documentation are provided only under a separate license agreement containing restrictions on use and disclosure. No part of this document may be reproduced or transmitted in any form, by any means (electronic, photocopying, recording or otherwise) without prior consent of Informatica LLC.</p>
<p>A current list of Informatica trademarks is available on the web at <a href="https://www.informatica.com/trademarks.html">https://www.informatica.com/trademarks.html</a>.</p>
<p>Portions of this software and/or documentation are subject to copyright held by third parties. Required third party notices are included with the product.</p>
<p>This software is protected by patents as detailed at <a href="https://www.informatica.com/legal/patents.html">https://www.informatica.com/legal/patents.html</a>.</p>
<p>The information in this documentation is subject to change without notice. If you find any problems in this documentation, please report them to us in writing at Informatica LLC 2100 Seaport Blvd. Redwood City, CA 94063.</p>
<p>Informatica products are warranted according to the terms and conditions of the agreements under which they are provided. <br />
INFORMATICA LLC PROVIDES THE INFORMATION IN THIS DOCUMENT "AS IS" WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING WITHOUT ANY WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND ANY WARRANTY OR CONDITION OF NON-INFRINGEMENT.</p>
<p>This document assumes familiarity with the <a href="../../Design/index.html">UM Concepts Guide</a>.</p>
<p>See <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/design.tag:../../Design/" href="../../Design/umglossary.html">UM Glossary</a> for Ultra Messaging terminology, abbreviations, and acronyms.</p>
<p><br />
 </p><hr/>
<h1><a class="anchor" id="persistenceoverview"></a>
Persistence Overview&nbsp;&nbsp;<small><a href="#persistenceoverview">&lt;-</a></small></h1>
<p>Ultra Messaging provides two different qualities of service (QOS) levels, related to likelihood of successful message delivery: streaming and persistence.</p>
<p><b>Streaming</b></p>
<p>Streaming is the basic QOS level for UM. With Streaming, a published message will be delivered to a receiver reliably if the following requirements are met:</p>
<ul>
<li>
the publisher and subscriber are both running, </li>
<li>
the message was published <em>after</em> the subscriber has had enough time to discover and join the publisher's data stream (note that UM's <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/design.tag:../../Design/" href="../../Design/fundamentalconcepts.html#latejoin">Late Join</a> feature which somewhat relaxes this requirement), and </li>
<li>
the data link between the publisher and subscriber has a low-enough error rate that any lost data has time to be recovered by the Transport protocol within the time allotted for that recovery. </li>
</ul>
<p>With Streaming, if a subscriber exits mid-stream (either intentionally or by failure), when that subscriber restarts, it typically cannot recover the messages that were sent during its absence.</p>
<p><b>Persistence</b></p>
<p>The higher QOS available for UM is Persistence, by which messages can be delivered even in cases where one or more of the above requirements cannot be met. For example, if a publisher sends a message and then exits, and after that a subscriber starts, Persistence is required for that message to be delivered.</p>
<p>UM's Persistence functionality is implemented by components called "Stores" obtaining copies of published messages and keeping them for a period of time so that receivers can recover messages if necessary.</p>
<p>A "Store Process" contains one or more independent "Store instances", where an "instance" is an independent, addressable, and configurable component. See <a class="el" href="index.html#storeprocessesandinstances">Store Processes and Instances</a> for more detail.</p>
<p>Store instances are used by persistent subscribers to recover messages that cannot be recovered from the source by the transport protocol. For example, messages published prior to the subscriber joining the transport can be recovered from a Store instance. After a period of overload or network outage that leads to loss of live messages, the subscriber uses a Store instance to recover messages that could not be recovered by the transport protocol.</p>
<p>With Persistence, if a subscriber exits mid-stream (either intentionally or by failure), when that subscriber restarts, it will automatically recover the messages sent during its absence.</p>
<p>A system using UM Persistence comprises any number of sources, receivers, and Persistent Stores. Ultra Messaging's unique design provides Parallel Persistence, which refers to the ability of Store instances to run independently of sources and receivers and in parallel with messaging. The Store does not interfere with message delivery to receiving applications.</p>
<dl class="section note"><dt>Note</dt><dd>The UMS product offers streaming QOS. The UMP and UMQ products offer both streaming and persistence QOS.</dd></dl>
<p><br />
 </p><hr/>
<h1><a class="anchor" id="persistenceconcepts"></a>
Persistence Concepts&nbsp;&nbsp;<small><a href="#persistenceconcepts">&lt;-</a></small></h1>
<p>In discussing Persistence, we refer to specific recovery from the failures of sources, receivers, and Persistent Stores.</p>
<ul>
<li>
Failed sources can restart and resume sending data from the point at which they stopped. </li>
<li>
Receivers can recover from failure and begin receiving data from the point immediately prior to failure. This process is sometimes called durable subscription. </li>
<li>
Persistent Stores can also be restarted and continue providing persistence to the sources and receivers that they serve. </li>
</ul>
<p>The user can choose between two different persistence modes:</p>
<ul>
<li>
Source-paced Persistence (SPP) - default mode - the rate of message consumption by receivers does not constrain the rate a source can send. The Store instance writes all messages to storage, and messages are retained until they are overwritten when the allocated storage is filled. See <a class="el" href="index.html#persistencenormaloperation">Persistence Normal Operation</a>. </li>
<li>
Receiver-paced Persistence (RPP) - optional mode - the rate of message consumption by receivers <em>does</em> constrain the rate a source can send. The Store instance only writes message to non-volatile storage if one or more required RPP receivers is absent or slow in consuming the messages. Messages are deleted from the Store instance once all receivers have consumed the RPP message. See <a class="el" href="index.html#receiverpacedpersistenceoperations">RPP: Receiver-Paced Persistence</a>. </li>
</ul>
<p><br />
 </p>
<h2><a class="anchor" id="persistentstoreconcept"></a>
Persistent Store Concept&nbsp;&nbsp;<small><a href="#persistentstoreconcept">&lt;-</a></small></h2>
<p>UM uses a daemon program known as the Store to persist source (publisher) and receiver (subscriber) state. A Store instance can persist state in memory as well as on disk. State is persisted on a per-topic, per-source basis by the Store. Along with each publisher's state is a message cache containing the full message contents of recently-sent messages by the source.</p>
<p>The purpose of the Store is to allow receivers to recover messages that the receiver was not able to receive directly from the source.</p>
<p>The Store is an independent component, not part of the source. If a persistent publisher fails, that source's messages are maintained by the Store according to configurable retention policies.</p>
<p>Note that the design of UM's persistence allows a maximum of 2,147,483,647 messages (2**31 - 1) to be persisted.</p>
<p><br />
 </p>
<h2><a class="anchor" id="persistenceconfigurationconcept"></a>
Persistence Configuration Concept&nbsp;&nbsp;<small><a href="#persistenceconfigurationconcept">&lt;-</a></small></h2>
<p>It is important to remember the different kinds of configuration. </p><ul>
<li>
Applications create UM objects (contexts, sources, receivers) using the UM library. Those objects must be configured to control their operation and behavior using <b>"LBM configuration options"</b>. An application typically uses an <b>"LBM configuration file"</b> in either XML or flat format. For full details on LBM configuration options, see <a href="../../Config/index.html">UM Configuration Guide</a> </li>
<li>
A Store Process is configured using a <b>"Store configuration file"</b> in XML format. For full details on Store configuration files, see <a class="el" href="index.html#configurationreferenceforumestored">Configuration Reference for Umestored</a>. </li>
<li>
A Store Process also internally creates UM objects (contexts, sources, receivers) using the UM library. The Store's objects must also be configured using one or more LBM configuration files. </li>
</ul>
<p>So Stores need two kinds of configuration files: Store configuration files and LBM configuration files. Applications only need LBM configuration files.</p>
<p><br />
 </p>
<h2><a class="anchor" id="registrationidentifierconcept"></a>
Registration Identifier Concept&nbsp;&nbsp;<small><a href="#registrationidentifierconcept">&lt;-</a></small></h2>
<p>UM persistence identifies sources and receivers with Registration Identifiers, also called Registration IDs or RegIDs. A RegID is a 32-bit number that uniquely identifies a source or a receiver to a Store instance. This means that RegIDs are also specific to a Store instance and can be reused between individual Store instances, if needed. No two active sources or receivers can share a RegID or use the same RegID at the same time. This point is critical: since UM enables your application to use and handle RegIDs very freely, you must use RegIDs carefully to avoid destructive results.</p>
<p>RegIDs can also be managed easily through the use of Session IDs. See <a class="el" href="index.html#managingregidswithsessionids">Managing RegIDs with Session IDs</a>.</p>
<p><br />
 </p>
<h2><a class="anchor" id="deliveryconfirmationconcept"></a>
Delivery Confirmation Concept&nbsp;&nbsp;<small><a href="#deliveryconfirmationconcept">&lt;-</a></small></h2>
<p>A persistent receiver provides confirmation (acknowledgement) to the Store instance as it consumes (processes) messages. This is fundamental to the design of UM persistence.</p>
<p>The receiver can optionally provide this confirmation (acknowledgment) to the persistent source. These confirmations are turned off by default, but can be requested through either or both two LBM configuration options: </p><ul>
<li>
<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umeconfirmeddeliverynotificationsource">ume_confirmed_delivery_notification (source)</a> - deliver a source event to the application indicating message consumption. </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umeretentionuniqueconfirmationssource">ume_retention_unique_confirmations (source)</a> - include receiver consumption as part of source flight size calculation. </li>
</ul>
<p>These two options are unrelated to each other, except that they both request the receiver to send delivery confirmations. Note that when either or both of the options are set, the persistent source <em>requests</em> that the persistent receiver supply delivery confirmations. The persistent receiver has the option to decline the request by setting the option <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umeallowconfirmeddeliveryreceiver">ume_allow_confirmed_delivery (receiver)</a> to 0.</p>
<dl class="section note"><dt>Note</dt><dd><a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/design.tag:../../Design/" href="../../Design/advancedoptimizations.html#smartsources">Smart Sources</a> do not support either form of delivery confirmation.</dd></dl>
<p>The latter LBM option, <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umeretentionuniqueconfirmationssource">ume_retention_unique_confirmations (source)</a>, can provide a form of receiver-pacing; the source will not be allowed to exceed <a class="el" href="index.html#persistenceflightsize">Persistence Flight Size</a> beyond receiving applications. For more information, see: <a class="el" href="index.html#confirmeddelivery">Confirmed Delivery</a></p>
<p><br />
 </p>
<h2><a class="anchor" id="releasepolicy"></a>
Release Policy&nbsp;&nbsp;<small><a href="#releasepolicy">&lt;-</a></small></h2>
<p>Sources and Persistent Stores retain messages in memory according to a release policy, which is a set of rules that specifies when a message can be reclaimed. Each rule would allow any message that complies with the rule to be reclaimed. However, a message must comply with all rules before it can be reclaimed. Conversely, any message not complying with all rules will not be reclaimed. A source or Store instance retains messages in memory until its retention policy dictates the message may be removed. Sources and Stores use slightly different retention policies based on their individual roles.</p>
<p>For more information, see <a class="el" href="index.html#sourcemessageretentionandrelease">Source Message Retention and Release</a>.</p>
<p><br />
 </p>
<h2><a class="anchor" id="messagestabilityconcept"></a>
Message Stability Concept&nbsp;&nbsp;<small><a href="#messagestabilityconcept">&lt;-</a></small></h2>
<p>Sources send messages to both receivers and to Store instances. Messages become stable once the message has been persisted at the Store or a set of Stores, and those Stores acknowledge stability to the sources. Since it takes time to write messages to disk and signal stability, the source is allowed to continue sending messages while waiting for stability acknowledgements. Any messages sent but not yet acknowledged are said to be <em>"in flight"</em>. The number of in-flight messages is normally limited. For more information, see <a class="el" href="index.html#persistenceflightsize">Persistence Flight Size</a>.</p>
<p>In addition, UM informs the application when messages are stabilized. Until that stability acknowledgement is received, the source can not assume the messages will be successfully delivered. The message stability acknowledgement is vital to ensuring that messages will not be lost. For more information, see <a class="el" href="index.html#sourcemessageretentionandrelease">Source Message Retention and Release</a>.</p>
<p><br />
 </p>
<h2><a class="anchor" id="quorumconsensusstorefailover"></a>
Quorum/Consensus Store Failover&nbsp;&nbsp;<small><a href="#quorumconsensusstorefailover">&lt;-</a></small></h2>
<p>Typically, multiple Store instances are deployed as a group for redundant operation. In this configuration, one or more Stores (or the hosts they run on) can fail without impacting the message flow from sources to receivers, as long as a <em>quorum</em> of the configured Stores is operational. UM defines a quorum as a majority of the configured Stores. E.g. if 3 Store instances are configured, messaging can continue as long as at least 2 are operational. If 5 Store instances are configured, messaging can continue if at least 3 are operational. (Quorum/Consensus requires an odd number of Store instances in the QC group.)</p>
<p>Sources define the QC group by the LBM configuration option <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umestoresource">ume_store (source)</a>, one for each Store in the group.</p>
<p><br />
 </p><hr/>
<h1><a class="anchor" id="persistencearchitecture"></a>
Persistence Architecture&nbsp;&nbsp;<small><a href="#persistencearchitecture">&lt;-</a></small></h1>
<p>As shown in the diagram, UM provides messaging functionality as well as persistent operation.</p>
<div class="image">
<img src="persistent_architecture.png" alt="persistent_architecture.png"/>
</div>
 <p>The highlights of this architecture are:</p>
<ul>
<li>
Sources communicate with Store instances </li>
<li>
Receivers communicate with Store instances </li>
<li>
Sources communicate with receivers </li>
</ul>
<p>Note that the Store is not supported on all platforms. For example, while Solaris supports persistent clients (source and receiver), you cannot run a Store on an Solaris system. However, an Solaris-based client can interoperate with a Store running an any other supported platform.</p>
<p><br />
 </p>
<h2><a class="anchor" id="persistentstorearchitecture"></a>
Persistent Store Architecture&nbsp;&nbsp;<small><a href="#persistentstorearchitecture">&lt;-</a></small></h2>
<p>The <code>umestored</code> program runs the Store Process. You can configure multiple Store instances per Store Process using the <a class="el" href="index.html#umeelementstore">UMP Element "&lt;store&gt;"</a> in the Store configuration file. See <a class="el" href="index.html#configurationreferenceforumestored">Configuration Reference for Umestored</a>. Individual Store instances can use separate disk cache and disk state directories and be configured to persist messages for multiple sources (topics), which are referred to as "source repositories". Each Store Process has an optional Web Monitor for statistics monitoring. See <a class="el" href="index.html#storewebmonitor">Store Web Monitor</a>.</p>
<div class="image">
<img src="store_architecture.png" alt="store_architecture.png"/>
</div>
 <p><br />
 </p>
<h3><a class="anchor" id="storeprocessesandinstances"></a>
Store Processes and Instances&nbsp;&nbsp;<small><a href="#storeprocessesandinstances">&lt;-</a></small></h3>
<p>When the Store Process is started on a host, the process is known as the "Store Process". That Store Process contains one or more "Store instances". A Store instance is an independent, addressable, and configurable component. Each Store instance is implemented with a set of interacting program threads. The threads of one Instance do not interact or contend with the threads of other Instances in the same Process.</p>
<p>There is very little difference between running one Store Process with two Store instances compared to two Store Processes with one Store instance each. They function and perform mostly the same. The reasons for choosing one over the other have mostly to do with operational convenience. For example, running fewer processes on a host is sometimes easier to manage. So operational simplicity suggests combining multiple Store instances into a single Store Process.</p>
<p>On the other hand, there are times when it is desired to shut down a Store instance. But Store instances cannot be shut down individually; an entire Store Process must be shut down. For example: as message rates increase, you may find that the host's CPU consumption is getting too high. You might want to migrate half of the Store instances to a different host. But if all your Store instances are in one Store Process, it is more disruptive perform the migration since it requires shutting down the entire process and re-configuring. So operational flexibility suggests assigning each desired Store instance to its own Store Process.</p>
<p>One specific case where a single Store Process with multiple Store Instances is generally preferred: using the Store Process as a Windows Service. There is no simple way to run multiple copies of the Store Windows Service.</p>
<p><br />
 </p>
<h3><a class="anchor" id="sourcerepositories"></a>
Source Repositories&nbsp;&nbsp;<small><a href="#sourcerepositories">&lt;-</a></small></h3>
<p>Within a Store instance, you configure repositories for individual topics, and each can have their own set of <a class="el" href="index.html#umeelementtopic">&lt;topic&gt;</a> options that affect the repository's type, size, liveness behavior and much more. If you have multiple sources sending on the same topic, the Store instance creates a separate repository for each source. UM uses the repository options configured for the topic to apply to each source's repository. If you specify 48 MB for the size of the repository and have 10 sources sending on the topic, the Store instance requires 480 MB of storage for that topic.</p>
<p>A repository can be configured as one of the following types:</p>
<ul>
<li>
memory - the repository maintain both state and data only in memory </li>
<li>
disk - the repository maintains state and data on disk, but also uses a memory cache. </li>
</ul>
<p>There are also repository types called "reduced-fd" and "no-cache", which are deprecated and will be removed in a future UM version. The "reduced-fd" repository is similar to <b>"disk"</b> but uses fewer OS File Descriptors. However, it is deprecated due to low performance. The "no-cache" repository maintains state (last sequence numbers published and consumed) but does not maintain message content. It is deprecated due to lack of compelling use cases.</p>
<p>Note that the Store instances within a Store Process can have different repository types.</p>
<p><br />
 </p>
<h3><a class="anchor" id="repositorythresholdsandlimits"></a>
Repository Thresholds and Limits&nbsp;&nbsp;<small><a href="#repositorythresholdsandlimits">&lt;-</a></small></h3>
<p>The Store is designed to retain messages in case they are needed for future recovery. Of course, it is not possible to extend this retention to infinity, so the Store must be configured with policies regarding the removal of messages. There are three possible policies that can be established:</p>
<ol>
<li>
Repository size limit (required) </li>
<li>
Message age limit (optional, for source-paced persistence). </li>
<li>
Consumption by all required receivers (for receiver-paced persistence). </li>
</ol>
<p>In all cases, the repository's size is limited to prevent exhaustion of storage. With source-paced persistence, when the repository size limit is reached, the oldest messages are overwritten by new messages. With receiver-paced persistence, when the repository size limit is reached, the source is prevented from sending more messages.</p>
<p>For receiver-paced persistence, when all required receivers acknowledge consumption of a message, it is removed from the Store. But note that if the required receivers to not acknowledge consumption of messages and the repository fills before the oldest messages are acknowledged, the repository size is enforced and the source is blocked from sending more messages.</p>
<dl class="section note"><dt>Note</dt><dd>When you configure a size limit, it applies to a single persisted source. For example, if you have two publishing applications and each one sends to the topic "EventStream", two separate repositories will be created, one for each source, and each repository will be allowed to grow to the configured size limit. You must provision your repository sizes with knowledge of how many persisted sources will be serviced by a given Store.</dd></dl>
<p>The size configuration options differ depending on whether you are implementing a Memory Repository Store (<a class="el" href="index.html#umecfgrepositorytype">repository-type</a> <b>"memory"</b>) or a Disk Repository Store (<a class="el" href="index.html#umecfgrepositorytype">repository-type</a> <b>"disk"</b>).</p>
<p><b>Memory Repository Size</b></p>
<p>A memory type source repository has three configuration options that manage its size relative to its capacity.</p>
<p>Note that the design of UM's persistence allows a maximum of 2,147,483,647 messages (2**31 - 1) to be persisted.</p>
<ul>
<li>
<p class="startli"><a class="el" href="index.html#umecfgrepositoryagethreshold">repository-age-threshold</a> - This value determines how long the memory repository retains messages. Messages in memory that exceed this time can be deleted from the memory cache.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><a class="el" href="index.html#umecfgrepositorysizethreshold">repository-size-threshold</a> - The size in bytes that a repository can reach before it begins to delete the oldest retained messages. If the repository size falls below the threshold, it stops deleting old messages.</p>
<p class="endli"></p>
</li>
<li>
<a class="el" href="index.html#umecfgrepositorysizelimit">repository-size-limit</a> - The maximum size in bytes for the repository. Once this limit is reached, the repository stops accepting new messages. The age and size thresholds should be set at levels that guarantee the size limit is never met. You should consider how fast the source sends messages, the size of the messages and the reliability of the receivers. For example, more reliable receivers mean less recovery instances, which could mean a younger age threshold. Do not specify a limit that would allow more than 2,147,483,647 messages to be stored. </li>
</ul>
<p><b>Disk Repository Size</b></p>
<p>A disk type source repository maintains a memory cache in addition to the actual disk storage. It continually persists messages from the memory cache to the disk, and uses the memory cache for receiver recovery first before performing disk reads to access needed messages.</p>
<p>Note that the design of UM's persistence allows a maximum of 2,147,483,647 messages (2**31 - 1) to be persisted.</p>
<p>The Store has four configuration options that manage its size relative to its capacity.</p>
<ul>
<li>
<p class="startli"><a class="el" href="index.html#umecfgrepositorysizethreshold">repository-size-threshold</a> - The size in bytes that a repository can reach before it begins to delete the oldest retained messages. These messages could have been persisted to disk and may be available for recovery. If the disk repository memory cache size falls below the threshold, it stops deleting old messages.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><a class="el" href="index.html#umecfgrepositorysizelimit">repository-size-limit</a> - The maximum size in bytes for the disk repository's memory cache. Once this limit is reached, the repository stops accepting new messages. The age and size thresholds should be set at levels that guarantee the size limit is never met. You should consider how fast the source sends messages, the size of the messages and the reliability of the receivers. For example, more reliable receivers mean less recovery instances, which could mean a younger age threshold. Do not specify a limit that would allow more than 2,147,483,647 messages to be stored.</p>
<p class="endli"></p>
</li>
<li>
<a class="el" href="index.html#umecfgrepositorydiskfilesizelimit">repository-disk-file-size-limit</a> - The maximum disk space (in bytes) for the disk repository. Once this limit is reached, the repository overwrites old messages with new messages. Overwriting old messages is not necessarily a negative situation provided you disk file size is adequate. However, if messages needed for recovery are not in either the memory cache or the disk file, you may need to increase the disk file size to ensure that overwritten messages are no longer needed for receiver recovery. Do not specify a limit that would allow more than 2,147,483,647 messages to be stored. </li>
</ul>
<p><br />
 </p>
<h3><a class="anchor" id="persistentstorefault"></a>
Persistent Store Fault Tolerance&nbsp;&nbsp;<small><a href="#persistentstorefault">&lt;-</a></small></h3>
<p>Sources and receivers register with a Store instance and use individual repositories within the Store. Sources can use redundant repositories configured in multiple Stores Instances in Quorum/Consensus (QC) arrangement for fault tolerance. Be aware that the arrangement of Store instances into Quorum/Consensus groups is a function of the source. I.e. the individual Stores of a QC group are not aware of each other and do not coordinate their activities.</p>
<p>Informatica strongly recommends that the Store instances of a QC group run on separate physical hosts.</p>
<p><br />
 </p>
<h3><a class="anchor" id="identifyingpersistentstores"></a>
Identifying Persistent Stores&nbsp;&nbsp;<small><a href="#identifyingpersistentstores">&lt;-</a></small></h3>
<p>A persistent source must be configured to identify one or more Stores to provide persistence services. The source configuration can identify Store instances with one of: </p><ul>
<li>
IP:port or domainID:IP:port using <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umestoresource">ume_store (source)</a>, see <a class="el" href="index.html#ipstore">Store Address</a> </li>
<li>
Store's context name using <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umestorenamesource">ume_store_name (source)</a>, see <a class="el" href="index.html#namedstores">Named Stores</a>). </li>
</ul>
<p>In either case, the store should be told which interface to bind to, which defines its IP address. This is done with the <a class="el" href="index.html#umeelementstore">UMP Element "&lt;store&gt;"</a> in the Store's configuration file. There is a shortcut available to simplify the Store configuration file; see <a class="el" href="index.html#cidrstore">Using a CIDR Range of IP Addresses</a>.</p>
<p><a class="anchor" id="ipstore"></a><b>Store Address: Identify Store with IP:Port</b></p>
<p>Using IP:port is feasible in deployments where there is no DRO; i.e. all components are in a single <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/design.tag:../../Design/" href="../../Design/fundamentalconcepts.html#topicresolutiondomain">Topic Resolution Domain</a> (TRD). Deployments that include DRO and have multiple TRDs require that the domain ID be added to the address: domainID:IP:port.</p>
<p>Configure Store instance for a single IP:port.</p>
<ol>
<li>
<p class="startli">Identify the Store with only the IP:port, specified with the <a class="el" href="index.html#umeelementstore">UMP Element "&lt;store&gt;"</a> in the Store's configuration file. For example: </p><div class="fragment"><div class="line">&lt;store name=<span class="stringliteral">&quot;newyork-1&quot;</span> port=<span class="stringliteral">&quot;14567&quot;</span> interface=<span class="stringliteral">&quot;10.29.3.16&quot;</span>&gt;</div></div><!-- fragment --><p class="endli"></p>
</li>
<li>
Configure the source with the IP:port using the LBM configuration option <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umestoresource">ume_store (source)</a> so sources can find and register with the Store instance. <pre class="fragment">source ume_store 10.29.3.16:14567
</pre> </li>
</ol>
<p><a class="anchor" id="namedstores"></a><b>Named Stores: Identify Store with Context Name</b></p>
<p>A Store is configured with a context name. Sources are then configured to specify the Stores by their names, instead of their IP:Port.</p>
<ol>
<li>
<p class="startli">Give the Store's context a name using the <a class="el" href="index.html#umecfgcontextname">context-name</a> option in the Store configuration file. For example: </p><div class="fragment"><div class="line">&lt;store name=<span class="stringliteral">&quot;newyork-1&quot;</span> port=<span class="stringliteral">&quot;14567&quot;</span> interface=<span class="stringliteral">&quot;10.29.3.0/24&quot;</span>&gt;</div><div class="line">&lt;ume-attributes&gt;</div><div class="line">   &lt;option type=<span class="stringliteral">&quot;store&quot;</span> name=<span class="stringliteral">&quot;context-name&quot;</span> value=<span class="stringliteral">&quot;NEWYORK-1&quot;</span>/&gt;</div><div class="line">&lt;/ume-attributes&gt;</div></div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">Configure the source with the name of the Store's context using the LBM configuration option <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umestorenamesource">ume_store_name (source)</a> so sources can find and register with the Store.</p>
<pre class="fragment">source ume_store_name NEWYORK-1
</pre><p class="endli">Note that you did not have to determine the full IP address of the store's host. </p>
</li>
</ol>
<p>Store context names can be used with or without DROs. UM automatically resolves and maintains a mapping between a Store's context name and its domain ID, IP address and port, as follows: </p><ul>
<li>
Store advertises its context name at startup and in response to queries from sources. </li>
<li>
If a Store receives a context name advertisement that matches its own context name, that Store issues a warning in the Store's log. This represents an invalid configuration and can produce unpredictable results. Always ensure that Store context names are unique within a UM deployment. </li>
<li>
Sources using Store context names issue an information message to the application every time a resolved context name changes its DomainID:IPaddress:port. </li>
</ul>
<p><a class="anchor" id="cidrstore"></a><b>Shortcut: Using a CIDR Range of IP Addresses</b></p>
<p>Configure a Store with a CIDR range of IP addresses (see <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/generalconfigurationguidelines.html#specifyinginterfaces">Specifying Interfaces</a>). This allows multiple Store daemon instances which only differ by their IP address to be configured the same. At initialization time, each Store daemon instance will determine its IP address using the CIDR specification. However, be aware that sources will need to use the full IP address.</p>
<ol>
<li>
<p class="startli">Identify the Store with a range of IP addresses specified in the Store configuration file. For example: </p><div class="fragment"><div class="line">&lt;store name=<span class="stringliteral">&quot;newyork-1&quot;</span> port=<span class="stringliteral">&quot;14567&quot;</span> interface=<span class="stringliteral">&quot;10.29.3.0/24&quot;</span>&gt;`</div></div><!-- fragment --><p> When the Store Process initializes, UM will choose a network interface within that IP address range (10.29.3.0 - 10.29.3.255).</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">Configure the source with the IP:port using the LBM configuration option <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umestoresource">ume_store (source)</a> so sources can find and register with the Store. <b>You must specify the full IP address, not the CIDR range.</b> </p><pre class="fragment">source ume_store 10.29.3.16:14567
</pre><p class="endli"></p>
</li>
<li>
Alternatively, you can use the <a class="el" href="index.html#namedstores">Named Stores</a> feature so that the source doesn't need to specify the full IP. </li>
</ol>
<p><br />
 </p><hr/>
<h1><a class="anchor" id="operationalview"></a>
Operational View&nbsp;&nbsp;<small><a href="#operationalview">&lt;-</a></small></h1>
<p>Sources, receivers, and Store instances interact in very controlled ways. This section illustrates the flow of network traffic between the components during three modes of operation and also provides a reference of persistence events.</p>
<dl class="section note"><dt>Note</dt><dd>If your application is running with the LBM configuration option <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpunicastimmediatemessagingnetwork.html#requesttcpbindrequestportcontext">request_tcp_bind_request_port (context)</a> set to zero, UIM port binding (also known as "request port binding") is turned off, which also disables persistence.</dd></dl>
<p><br />
 </p>
<h2><a class="anchor" id="generalpersistenceoperation"></a>
General Persistence Operation&nbsp;&nbsp;<small><a href="#generalpersistenceoperation">&lt;-</a></small></h2>
<p><br />
 </p>
<h3><a class="anchor" id="sourceregistration"></a>
Source Registration&nbsp;&nbsp;<small><a href="#sourceregistration">&lt;-</a></small></h3>
<p>UM sources heavily influence the persistence registration process. Sources send out registration information to enable receivers to register with Store instances and also monitor Store liveness. If Stores become unresponsive, or if communication among sources, Stores and receivers becomes impaired, the source directs re-registration.</p>
<p>The following outlines the major events in the source registration process with the Store instance:</p>
<ol>
<li>
Source advertises topic over topic resolution transport </li>
<li>
(optional) Source queries for and resolves Store context names </li>
<li>
Source registers with Store by unicast </li>
<li>
Source sends SRI over configured transport </li>
</ol>
<p>The following diagram illustrates network flow during the registration process.</p>
<div class="image">
<img src="source_registration.png" alt="source_registration.png"/>
</div>
 <p>Sources can find the correct Store instance(s) to register with from the values configured for it in the LBM configuration options <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umestoresource">ume_store (source)</a> or <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umestorenamesource">ume_store_name (source)</a>. The LBM configuration option <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umestoresource">ume_store (source)</a> contains the IP address, TCP port, registration ID, and group index for the Store(s) to be used by the source. The LBM configuration option <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umestorenamesource">ume_store_name (source)</a> contains the names of the Stores to be used by the source. <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umestorenamesource">ume_store_name (source)</a> requires that the Store context name is configured with the <a class="el" href="index.html#umecfgcontextname">context-name</a> option in the Store configuration file. See <a class="el" href="index.html#identifyingpersistentstores">Identifying Persistent Stores</a> and the <a class="el" href="index.html#umeelementstore">UMP Element "&lt;store&gt;"</a>.</p>
<p>Sources unicast registrations to the Store instance. The Store unicasts responses back to the source. Registrations are on a per topic per source basis. Stores use RegIDs to identify sources and receivers. After registration sources may send data.</p>
<p>After the source successfully registers with all required Stores, the source delivers a Registration Complete event to the publisher and sends an <a class="el" href="index.html#sourceregistrationinformationsri">SRI</a> over the source's <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/design.tag:../../Design/" href="../../Design/fundamentalconcepts.html#transportsessions">transport session</a>. For multiple Stores in the QC group, the source determines the required number of Stores based on the LBM configuration option <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umeretentionintragroupstabilitybehaviorsource">ume_retention_intragroup_stability_behavior (source)</a>.</p>
<p>The source sends the SRI at the rate set by the LBM configuration option <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umesriintersriintervalsource">ume_sri_inter_sri_interval (source)</a> until it reaches the maximum number of SRIs set by <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umesrimaxnumberofsriperupdatesource">ume_sri_max_number_of_sri_per_update (source)</a>. The Stores must receive this SRI.</p>
<dl class="section note"><dt>Note</dt><dd>Persistence users are advised to follow the recommendations in <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/interrelatedconfigurationoptions.html#preventingstoreregistrationhangs">Preventing Store Registration Hangs</a>.</dd></dl>
<p><br />
 </p>
<h3><a class="anchor" id="sourceregistrationinformationsri"></a>
Source Registration Information (SRI)&nbsp;&nbsp;<small><a href="#sourceregistrationinformationsri">&lt;-</a></small></h3>
<p>An SRI is a control message sent over the UM transport by a source that contains Store information that a receiver needs to register with the Store instance(s).</p>
<p>An SRI contains the following Store information. </p><ul>
<li>
Domain ID </li>
<li>
IP address </li>
<li>
TCP port </li>
<li>
Store index for all the Stores with which the source registered </li>
<li>
group index for all the Stores with which the source registered </li>
<li>
the source's Registration ID </li>
<li>
SRI overall version number and a separate version number for each Store </li>
</ul>
<p>The SRI contains one overall version number and a separate version number for each Store instance. If Stores become unresponsive and the source must re-register when the Store returns, the source increases the SRI version number and the version numbers for the Stores it re-registered with. The highest SRI version number indicates the most current registration information. If a receiver gets an SRI with a higher version number than the version number it has, the receiver examines the individual Store version numbers and re-registers with the those Stores that have higher individual version numbers.</p>
<p><br />
 </p>
<h2><a class="anchor" id="receiverregistration"></a>
Receiver Registration&nbsp;&nbsp;<small><a href="#receiverregistration">&lt;-</a></small></h2>
<p>Receivers register with Store instance(s) after receiving a SRI packet from the source sending on the receiver's topic.</p>
<p>Receiver must receive an SRI before they can register with the Store instance(s). The following lists the major events in the receiver registration process.</p>
<ol>
<li>
Receiver resolves topic over topic resolution transport. </li>
<li>
If source is not sending SRIs, receiver sends SRI request by unicast. </li>
<li>
Receiver receives SRI over its transport. </li>
<li>
Receiver registers with Store(s) by unicast. </li>
</ol>
<p>The following diagram illustrates network flow during the registration process.</p>
<div class="image">
<img src="receiver_registration.png" alt="receiver_registration.png"/>
</div>
 <p><br />
 </p>
<h3><a class="anchor" id="receiverregistrationprocess"></a>
Receiver Registration Process&nbsp;&nbsp;<small><a href="#receiverregistrationprocess">&lt;-</a></small></h3>
<p>Any receivers who have resolved their topic and joined the transport session when the source sends out SRIs can register with the Store instance. Any receivers joining the transport session when the source is not sending SRIs can request an SRI from the source if they find that the persistence flag is set in the source's TIR during topic resolution. The source responds with a SRI record.</p>
<p>Receivers unicast registrations to the Store instance. The Store unicasts responses back to the receivers. Stores use RegIDs to identify sources and receivers. After registration, receivers may handle recovery and send acknowledgements.</p>
<p>Note: If a persistent receiver's initial registration fails, it does not become an Ultra Messaging receiver.</p>
<p><br />
 </p>
<h3><a class="anchor" id="persistencenormaloperation"></a>
Persistence Normal Operation&nbsp;&nbsp;<small><a href="#persistencenormaloperation">&lt;-</a></small></h3>
<p>The following diagram illustrates the normal operation of data reception and acknowledgement and also shows how UM attains Parallel Persistence. The source sends message data to receivers and Stores in parallel.</p>
<div class="image">
<img src="ump_normal_operation.png" alt="ump_normal_operation.png"/>
</div>
 <p>During normal persistence operation:</p>
<ol>
<li>
Sources transmit data to receivers and Stores at the same time over UM multicast or unicast transport protocols. </li>
<li>
As the Store instance receives and persists messages, it unicasts acknowledgements (message stability control messages) to the source letting it know of successful reception and storage. </li>
<li>
As receivers process and consume messages they unicast acknowledgments to the Store letting the Store know of successful consumption of data. </li>
<li>
If the source desires delivery confirmation, the receiver unicasts acknowledgements directly to the source letting the source know of message consumption as well. </li>
</ol>
<p>Normal operation and recovery can proceed at the same time. In addition, as a receiver consumes retransmitted messages, the receiver sends normal acknowledgements for consumption and confirmed delivery (if requested by the source).</p>
<p><br />
 </p>
<h3><a class="anchor" id="persistenceflightsize"></a>
Persistence Flight Size&nbsp;&nbsp;<small><a href="#persistenceflightsize">&lt;-</a></small></h3>
<p>UM supports a flight size mechanism that tracks messages in flight from a persistent source and responds when a send would exceed the configured flight size (LBM configuration options <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umeflightsizesource">ume_flight_size (source)</a> and/or <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umeflightsizebytessource">ume_flight_size_bytes (source)</a>). You can configure <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umeflightsizebehaviorsource">ume_flight_size_behavior (source)</a> to either:</p>
<ul>
<li>
block any sends that would exceed the flight size or, </li>
<li>
allow the sends while notifying your application. </li>
</ul>
<p>UM considers a sent message in flight until the following two conditions are met:</p>
<ul>
<li>
The source receives the configured number of stability acknowledgements from the Store instance(s). </li>
<li>
The source has received the configured number of delivery confirmation notifications. (See <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umeretentionuniqueconfirmationssource">ume_retention_unique_confirmations (source)</a>.) </li>
</ul>
<p>If configuring both <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umeflightsizesource">ume_flight_size (source)</a> and <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umeflightsizebehaviorsource">ume_flight_size_behavior (source)</a>, UM uses the smaller of the two flight sizes on a per send basis.</p>
<table class="doxtable">
<tr>
<th><a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umeflightsizesource">ume_flight_size (source)</a> </th><th><a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umeflightsizebytessource">ume_flight_size_bytes (source)</a> </th><th>Result </th></tr>
<tr>
<td>Exceeded </td><td>Exceeded </td><td><a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umeflightsizebehaviorsource">ume_flight_size_behavior (source)</a> executes </td></tr>
<tr>
<td>Exceeded </td><td>Not Exceeded </td><td><a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umeflightsizebehaviorsource">ume_flight_size_behavior (source)</a> executes </td></tr>
<tr>
<td>Not Exceeded </td><td>Exceeded </td><td><a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umeflightsizebehaviorsource">ume_flight_size_behavior (source)</a> executes </td></tr>
<tr>
<td>Not Exceeded </td><td>Not Exceeded </td><td>No flight size sending restriction </td></tr>
</table>
<p>When using Stores in a Quorum/Consensus configuration, intragroup and intergroup stability settings affect whether UM considers a messages in flight. Consider a case with three Store instances in a single QC group, and two receivers. Given the default configuration, until a source receives a stability notification from two of the three Stores, UM considers a given message in-flight. In addition, if you set <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umeretentionuniqueconfirmationssource">ume_retention_unique_confirmations (source)</a> to 2, that same message would be considered in flight until the source receives two stability notifications AND two delivery confirmation notifications. See also <a class="el" href="index.html#sourcesusingquorumconsensusstoreconfiguration">Sources Using Quorum/Consensus Store Configuration</a>.</p>
<p><b>Blocking Message Sends That Exceed the Flight Size</b></p>
<p>By default, when a source sends a message that exceeds it's flight size, the call to send blocks. For example, suppose the flight size is set to 1. The first send completes but before the source receives a stability notification or delivery confirmation, it initiates a second call to send. If the source uses a blocking send, the send call blocks until the first message stabilizes. If the source uses a non-blocking send, the send returns an LBM_EWOULD_BLOCK.</p>
<p><b>Notification of Message Sends That Exceed the Flight Size</b></p>
<p>Alternatively, <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umeflightsizebehaviorsource">ume_flight_size_behavior (source)</a> can be set to notify your application when a message send surpasses the flight size. A send that exceeds the configured flight size succeeds and also triggers a flight size notification, indicating that the flight size has been surpassed. Once the number of in-flight messages falls below the configured flight size, another flight size notification source event is triggered, this time, informing the application that the number of in-flight messages is below the source's flight size.</p>
<p><br />
 </p>
<h3><a class="anchor" id="receiverrecovery"></a>
Receiver Recovery&nbsp;&nbsp;<small><a href="#receiverrecovery">&lt;-</a></small></h3>
<p>Normal loss retransmission over the UM transport operates identically in persistence as it does in streaming, according to the transport protocol. Stores do not participate in this transport-level loss retransmissions.</p>
<p>Persistent Stores become involved in message recovery in circumstances where the transport protocol is not able to recover. For example, if an application exits (either intentionally or by failure) and then restarts some time later, the transport is not able to recover messages that were sent during the application's down time. When the receiver restarts and re-registers, the receiver discovers the lowest message sequence number it did not receive, and subsequently requests retransmissions of all messages not received, starting from this low sequence number.</p>
<p>For more on this process see, <a class="el" href="index.html#persistentreceiverrecovery">Persistent Receiver Recovery</a>.</p>
<p>Another circumstance in which the Store becomes involved in message recovery is if the transport protocol tries but is unable to recover lost messages. In this case, Off Transport Recovery (OTR) is used. Note that OTR is available in streaming, and is serviced by the source's retention buffer. But for persistent sources, the Store services OTR. See <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/design.tag:../../Design/" href="../../Design/umfeatures.html#offtransportrecoveryotr">Off-Transport Recovery (OTR)</a> for more information.</p>
<p>For more reliable persistence operation, Informatica recommends enabling OTR, especially when using <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/design.tag:../../Design/" href="../../Design/fundamentalconcepts.html#umrouter">DROs</a>.</p>
<p>The following diagram illustrates receiver recovery:</p>
<div class="image">
<img src="receiver_recovery.png" alt="receiver_recovery.png"/>
</div>
 <p>Receivers unicast retransmission requests. If the Store has the message, it unicasts the retransmission to the receiver. If it does not have the message and is configured to forward the request to the source, it unicasts the retransmission request to the source. If the source has the message, it unicasts the retransmission directly to the receiver. See also <a class="el" href="index.html#messagelossrecovery">Message Loss Recovery</a>.</p>
<p>Store sends retransmissions from a thread separate from the main context thread so as not to impede live message data processing. The '<code>&lt;store&gt;</code>' configuration option, <a class="el" href="index.html#umecfgretransmissionrequestprocessingrate">retransmission-request-processing-rate</a>, sets the Store's capacity to process retransmission requests. The retransmission thread processes requests off a retransmission queue which is set at 4 times the size of <a class="el" href="index.html#umecfgretransmissionrequestprocessingrate">retransmission-request-processing-rate</a>. The following UM Web Monitor statistics indicate retransmission activity (see <a class="el" href="index.html#storewebmonitor">Store Web Monitor</a>):</p>
<ul>
<li>
Retransmission requests received rate </li>
<li>
Retransmission requests served rate </li>
<li>
Retransmission requests dropped rate </li>
<li>
Total retransmission requests dropped since Store startup </li>
</ul>
<p><br />
 </p>
<h3><a class="anchor" id="registrationlimitations"></a>
Registration Limitations&nbsp;&nbsp;<small><a href="#registrationlimitations">&lt;-</a></small></h3>
<p>An important use case for UM Persistence is the idea that an application registers, either with a RegID or a SessionID, and can then exit (gracefully or not) and subsequently it can re-register with the same RegID or SessionID and pick up where it left off.</p>
<p>This re-registration has some limitations regarding operational parameters changing between the registration and the re-registration. In general, an application re-registering a source or receiver should use the same operational parameters that it used when it originally registered.</p>
<p>In particular, except as noted below, the re-registering application should use the same values for any "ume_..." configuration options supplied.</p>
<p>There are some exceptions to this rule: </p><ul>
<li>
It is permissible for an application bind to a different IP address and/or Port. This is important because a failure might render the original host unusable, so the application must be allowed to migrate to a different host. </li>
<li>
It is permissible for the application to use a different transport type (TCP, LBT-RM, LBT-RM, IPC, etc). This is important because a migration to a different host might impose different networking restrictions (e.g. no multicast). </li>
<li>
The values for <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umestoresource">ume_store (source)</a> can change (IP/Port/TRD). This is important because a Store might fail and need to be migrated to a different host. </li>
</ul>
<p><br />
 </p>
<h2><a class="anchor" id="receiverpacedpersistenceoperations"></a>
RPP: Receiver-Paced Persistence&nbsp;&nbsp;<small><a href="#receiverpacedpersistenceoperations">&lt;-</a></small></h2>
<p>The Receiver-paced Persistence (RPP) mode of operation is primarily intended to prevent message loss to critical receivers, even if loss prevention requires blocking sources from sending. To achieve this, message retention in the Store is different from Source-paced persistence:</p>
<ul>
<li>
<p class="startli">In Source-paced Persistence (SPP), messages are retained in the Store until the space is needed for new messages. I.e. the message repository is a circular buffer which will overwrite when it "wraps". If a slow or stopped receiver falls behind the source by more than the size of the Store's repository, that receiver will experience unrecoverable loss.</p>
<p class="endli"></p>
</li>
<li>
In Receiver-paced Persistence (RPP), messages are retained only for as long as registered receivers need them to be retained in order to ensure recoverability of unacknowledged messages. When all necessary receivers have acknowledged a message, that message is removed from the Store's repository. If critical receivers are unable to acknowledge messages and the repository has reached its configured capacity, the source is blocked from sending additional messages. Blocking the source prevents sending of messages that would otherwise overwrite unacknowledged messages. </li>
</ul>
<p>Source pacing is typically chosen for applications where outgoing messages are generated by external events or processes that cannot be slowed down or stopped (e.g. market data). Receiver pacing is typically chosen for applications which are able to slow down or even halt the generation of messages (e.g. a user interface which can inhibit user entry).</p>
<p>RPP is enabled with LBM configuration options. No special API calls are needed.</p>
<p>RPP differentiates between two types of receivers:</p>
<ul>
<li>
Blocking: A blocking receiver will block the source if additional messages would overwrite retained messages not yet acknowledged by that receiver. </li>
<li>
Non-blocking: A non-blocking receiver will not block the source; the source will be allowed to overwrite retained messages not yet acknowledged by the non-blocking receiver. Thus a non-blocking receiver will experience unrecoverable message loss if it falls behind the source by more than the configured size of the Store's repository. (Note that this is the same behavior of source-paced persistence.) </li>
</ul>
<p>Each receiver indicates its desired blocking behavior with the <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umereceiverpacedpersistencereceiver">ume_receiver_paced_persistence (receiver)</a> configuration option. Both blocking and non-blocking receivers may register with the same Store and subscribe to the same source.</p>
<p>Here are important points when using RPP:</p>
<ul>
<li>
<p class="startli">The repository must be configured to allow RPP, and sources and receivers must be configured to request RPP behavior during registration. Assuming the Store is configured to allow RPP, the source determines the pacing behavior (receiver v.s. source) when it registers. If a receiver requests a different behavior, its registration will fail.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">The Store tracks the number of registered blocking and non-blocking receivers for each message sent by the source. A message is normally retained in the Store repository until that number of receivers have acknowledged consumption. Once all receivers acknowledge consumption of a message, that message is removed from the repository.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">Sources can modify specific repository configuration options that pertain to RPP.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">Due to RPP's message retention policies, late joining RPP receivers cannot recover previously sent messages.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">With RPP, sources are required to configure their flight size in bytes, in addition to message count. (With SPP, only message count flight size is required.) The value set for the source's <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umeflightsizebytessource">ume_flight_size_bytes (source)</a> configuration option is checked against a maximum allowed value specified in the Store's XML configuration file.</p>
<p class="endli"></p>
</li>
<li>
With RPP, if the Store's repository is full with unacknowledged messages by blocking receivers, the Store will block the source by withholding stability acknowledgements, resulting in flight size blockage. See <a class="el" href="index.html#persistenceflightsize">Persistence Flight Size</a>. (With SPP, once the repository is full, it will simply start overwriting the oldest messages with new messages from the source.) </li>
</ul>
<p>In addition, a disk write delay interval for the repository, improves performance by preventing unnecessary disk activity. If all receivers acknowledge within the write delay interval, the message is deleted from memory without having ever been written to disk. This gives an RPP Store comparable performance to a memory-only Store, while still giving a large disk-based repository if it is needed. (But notice that if slow or absent receivers cause the write delay to expire without the needed acknowledgements, the Store performance will return to the general performance of an SPP Store. You can tell if the Store has resorted to writing to disk by looking at the file size of the cache file. If it is greater than zero, it represents a high water mark of data written to disk since the file was last deleted.</p>
<p>Informatica recommends provisioning Stores based on SPP Store performance.</p>
<p>RPP introduces the capability of a source application to override set the settings for the following operational options on the Store:</p>
<ul>
<li>
<a class="el" href="index.html#umecfgrepositorysizethreshold">repository-size-threshold</a> </li>
<li>
<a class="el" href="index.html#umecfgrepositorysizelimit">repository-size-limit</a> </li>
<li>
<a class="el" href="index.html#umecfgrepositorydiskfilesizelimit">repository-disk-file-size-limit</a> </li>
<li>
<a class="el" href="index.html#umecfgrepositorydiskwritedelay">repository-disk-write-delay</a> </li>
<li>
<a class="el" href="index.html#umecfgrepositoryallowackonreception">repository-allow-ack-on-reception</a> (The source doesn't actually override this option. This option enables the source to set the Store's ACK behavior.) </li>
</ul>
<p>With SPP, those parameters are set only by the Store configuration file alone. With RPP, the source's configuration can optionally request a different value for those operating parameters, with the Store's configured value being used as a maximum allowed threshold.</p>
<p><br />
 </p>
<h3><a class="anchor" id="rppregistration"></a>
RPP Registration&nbsp;&nbsp;<small><a href="#rppregistration">&lt;-</a></small></h3>
<p>A source configures its desired pacing behavior (source paced v.s. receiver paced) with <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umereceiverpacedpersistencesource">ume_receiver_paced_persistence (source)</a> and <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umereceiverpacedpersistencereceiver">ume_receiver_paced_persistence (receiver)</a>. If set to 1, it becomes an RPP source. Assuming the Store is configured to allow RPP, when an RPP source registers with the Store, the Store's repository for that source becomes an RPP repository. The receiver configures its desired pacing behavior with <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umereceiverpacedpersistencereceiver">ume_receiver_paced_persistence (receiver)</a>, where 0 is source-paced and 1 or 2 are receiver-paced. The receiver's pacing must match that of the source and Store, otherwise the receiver's registration will fail. In addition, the choice of 1 or 2 determines the receiver's desired blocking behavior (1=blocking, 2=non-blocking).</p>
<p>Note that although the configured pacing behavior must match between source and receiver, that does not mean that the numerical setting of the <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umereceiverpacedpersistencesource">ume_receiver_paced_persistence (source)</a> and <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umereceiverpacedpersistencereceiver">ume_receiver_paced_persistence (receiver)</a> options must be equal. If the source is 0 (source paced), then the receiver must also be 0. However, if the source is 1 (receiver paced), then the receiver must be either 1 or 2, depending on the receiver's desired blocking behavior.</p>
<p>As with Source-paced Persistence, RPP sources send Source Registration Information (SRI) packets to RPP receivers over the configured UM transport. RPP Receivers must wait for this information before they can initiate registration requests to the Store. See <a class="el" href="index.html#sourceregistration">Source Registration</a> and <a class="el" href="index.html#receiverregistration">Receiver Registration</a> for more information.</p>
<p>A source registration request includes the following:</p>
<ul>
<li>
Designation of an RPP topic </li>
<li>
Reconfigured repository configuration option values. Possible options are the 3 repository size options: <a class="el" href="index.html#umecfgrepositoryallowackonreception">repository-allow-ack-on-reception</a>, <a class="el" href="index.html#umecfgrepositorydiskwritedelay">repository-disk-write-delay</a>, and <a class="el" href="index.html#umecfgsourceflightsizebytesmaximum">source-flight-size-bytes-maximum</a>. </li>
<li>
Re-registration must request the same configuration options as were initially requested, or the Store will reject the request. </li>
</ul>
<p>A receiver registration request includes its designation as a RPP receiver.</p>
<p>The repository's registration response to both a source and a receiver acknowledges RPP mode.</p>
<p><b>Late Registering Receiver</b></p>
<p>A late joining receiver that registers after the first RPP topic message has been sent cannot recover any messages sent prior to its initial registration. It is the user's responsibility to synchronize a receiver's initial registration with the start of message transmission. This restriction does not apply to an RPP receiver that initially registered at an earlier time and is now re-registering, as after a failure and restart. In that case, messages that were sent after the receiver's initial registration will be retained by the Store for recovery by the receiver.</p>
<p><b>Early Exiting Receiver</b></p>
<p>Each registered receiver has associated with it an activity timeout and a state lifetime. During normal operation, the Store monitors the operation of a registered receiver. If the Store hears nothing from a receiver for the duration of the activity timeout, the Store assumes that the receiver has halted operation. Messages will be retained by the Store according to the receiver's configured blocking behavior. This gives the receiver time to restart and re-register. If an inactive receiver re-registers before the state lifetime expires, the receiver will be able to recover all messages that it missed.</p>
<p>However, if a receiver remains halted for the duration of the state lifetime, the Store will delete the receiver state information. If the repository is retaining messages for this receiver, those messages will be implicitly acknowledged on behalf of the expired receiver, making them eligible for deletion if no other receivers' acknowledgements are pending. If the source is blocked waiting for this receiver, the Store will unblock the source. Finally, if the halted receiver re-register after its state lifetime has expired, the Store will treat it as an initial registration, and the messages it missed will not be available.</p>
<p><b>UM Version RPP Compatibility Matrix</b></p>
<p>The following table indicates the result of registration requests across UM versions:</p>
<table class="doxtable">
<tr>
<th>Version/Object </th><th>Pre-ver. 5.3 Store </th><th>Ver. 5.3 RPP Store </th><th><p class="starttd">Ver. 5.3 Non-RPP Store</p>
<p class="endtd"></p>
</th></tr>
<tr>
<td>Pre 5.3 Source </td><td>Granted </td><td>Rejected * </td><td><p class="starttd">Granted *</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>5.3 RPP Source </td><td>Granted - Source Error </td><td>Granted * </td><td><p class="starttd">Rejected *</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>5.3 Non-RPP Source </td><td>Granted </td><td>Rejected * </td><td><p class="starttd">Granted *</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>Pre 5.3 Receiver </td><td>Granted </td><td>Rejected </td><td><p class="starttd">Granted</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>5.3 RPP Receiver </td><td>Granted - Receiver Error </td><td>Granted </td><td><p class="starttd">Rejected</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>5.3 Non-RPP Receiver </td><td>Granted </td><td>Rejected </td><td>Granted </td></tr>
</table>
<p>Where:</p>
<ul>
<li>
Granted - Source Error indicates that the Store granted the registration but the source detected that RPP behavior was not acknowledged by the Store. </li>
<li>
Granted - Receiver Error indicates that the Store granted the registration but the receiver detected that RPP behavior was not acknowledged by the Store. </li>
<li>
* Refers only to the re-registration of a source with an existing source repository because the source determines the repository's behavior for new registrations. </li>
</ul>
<p><br />
 </p>
<h3><a class="anchor" id="rppnormaloperation"></a>
RPP Normal Operation&nbsp;&nbsp;<small><a href="#rppnormaloperation">&lt;-</a></small></h3>
<p>At a high level, the normal sequence of operations for RPP is the same as it is for SPP:</p>
<ol>
<li>
<p class="startli">Sources transmit messages to receivers and Stores at the same time over UM transports. Sources also track stability acknowledgements from the Store. A source is allowed to send messages ahead of stability acknowledgements up to the configured flight size. If the flight size of unstabilized messages is reached, the source is blocked from sending more messages pending stability acknowledgements from the Store.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">Receivers acknowledge consumption of received messages back to Stores, and optionally to the sources.</p>
<p class="endli"></p>
</li>
<li>
Stores retain messages as appropriate, send stability acknowledgements to the sources for messages, and tracks receiver consumption acknowledgements. </li>
</ol>
<p>One important way that RPP differs from SPP is in the sending of stability acknowledgements. With SPP, the Store normally waits to send a stability acknowledgement until a message is "stable" on the configured storage medium, either disk or memory. With RPP, the sending of stability acknowledgements is affected by receiver consumption acknowledgements in two ways:</p>
<ul>
<li>
<p class="startli">If a message is acknowledged by all registered receivers before the message is written to disk, then there is no need to retain the message at all. The message is deleted and a stability acknowledgement is sent to the source.</p>
<p class="endli"></p>
</li>
<li>
If the repository reaches its capacity limit and there are blocking receivers which have not acknowledged the messages, the Store stops sending stability acknowledgements. It is the lack of stability acknowledgements, combined with the configured flight size, which causes the source to block. (To be precise, the Store stops sending stability when there is exactly one flight size worth of room available in the repository.) </li>
</ul>
<p>The following also affect stability acknowledgements:</p>
<ul>
<li>
<p class="startli">Acknowledge on Reception - If the source is configured for <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umerepositoryackonreceptionsource">ume_repository_ack_on_reception (source)</a> and the Store is configured for <a class="el" href="index.html#umecfgrepositoryallowackonreception">repository-allow-ack-on-reception</a>, the Store sends a stability acknowledgement to the source immediately upon reception of a message, even before any receiver acknowledgements are received, and before the message is written to disk. This setting can increase system throughput for some use cases, but also increases the risk of message loss in the event of a Store failure.</p>
<div class="image">
<img src="ack_on_reception.png" alt="ack_on_reception.png"/>
</div>
 <p class="endli"></p>
</li>
<li>
Write Delay - The repository option <a class="el" href="index.html#umecfgrepositorydiskwritedelay">repository-disk-write-delay</a> allows the repository to hold messages in memory cache longer before persisting them to disk. This delay increases the probability that all RPP receivers acknowledge message consumption, eliminating the need to persist the message to disk. </li>
</ul>
<p>For memory Store repositories, the options <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umerepositoryackonreceptionsource">ume_repository_ack_on_reception (source)</a> and <a class="el" href="index.html#umecfgrepositorydiskwritedelay">repository-disk-write-delay</a> have no effect.</p>
<p><br />
 </p>
<h3><a class="anchor" id="rppmessagerecovery"></a>
RPP Message Recovery&nbsp;&nbsp;<small><a href="#rppmessagerecovery">&lt;-</a></small></h3>
<p>The normal way that RPP receivers recover messages is when they re-register within the state lifetime after a failure. However, just as with SPP, there is the possibility that the transport session of the source is unable to successfully deliver all messages to the receiver. In the event of unrecoverable loss at the transport session, the Off Transport Recovery (OTR) method is also available for RPP receivers. OTR does not require the receiver to restart to recover messages from the Store. See the <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/design.tag:../../Design/" href="../../Design/umfeatures.html#offtransportrecoveryotr">Off-Transport Recovery (OTR)</a> for more information.</p>
<p><br />
 </p>
<h3><a class="anchor" id="rppderegistration"></a>
RPP Deregistration&nbsp;&nbsp;<small><a href="#rppderegistration">&lt;-</a></small></h3>
<p>You can deregister either sources or receivers using deregistration APIs, (<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#a3a89366ab4e36dfa362e20397778d04a">lbm_src_ume_deregister()</a>, <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#a861f4a170ec4caf4533669ee53fbf36f">lbm_rcv_ume_deregister()</a>, and <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#adc9f1b15ab516bed8556e7a20666770c">lbm_wrcv_ume_deregister()</a>). UM deletes the state of deregistered objects.</p>
<p>If you deregister an RPP receiver, UM automatically decrements the number of receiver acknowledgements required to maintain RPP behavior. The Store issues Deregistration Successful events for every source or receiver that deregisters. Note that after deregistering a source or receiver, the object will still exist, but is no longer participating in persistence. An attempt to send to a deregistered source will return an error. A deregistered receiver will continue to deliver messages on the topic, but since it is no longer participating in persistence, it will be unable to acknowledge those messages. If the application wants to re-join persistence, it must delete the source or receiver and re-create it, allowing it to re-register. See <a class="el" href="index.html#persistenceevents">Persistence Events</a>.</p>
<p>Users should be cautious using the deregistration APIs, especially for sources. Source deregistration will immediately delete from the Store any messages from that source which might be retained due to lack of receiver acknowledgement. This deletion will render the receivers unable to recover those messages.</p>
<p><br />
 </p>
<h3><a class="anchor" id="implementingrpp"></a>
Implementing RPP&nbsp;&nbsp;<small><a href="#implementingrpp">&lt;-</a></small></h3>
<p>Follow the procedure below to configure Receiver-paced Persistence:</p>
<ol>
<li>
<p class="startli">Set <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umereceiverpacedpersistencesource">ume_receiver_paced_persistence (source)</a> and <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umereceiverpacedpersistencereceiver">ume_receiver_paced_persistence (receiver)</a> in the LBM configurations. If only certain sources or receivers in a context are RPP, use lbm_*setopt() in the source or receiver application or use UM XML configuration files.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">Set <a class="el" href="index.html#umecfgrepositoryallowreceiverpacedpersistence">repository-allow-receiver-paced-persistence</a> = 1 for the repository in the Store configuration file.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">Coordinate <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umeflightsizebytessource">ume_flight_size_bytes (source)</a> between the repository and the source. Set the maximum allowable flight size with the repository option, <a class="el" href="index.html#umecfgsourceflightsizebytesmaximum">source-flight-size-bytes-maximum</a>. Sources can reconfigure its flight size bytes to a value less than or equal to the maximum.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">Optional: coordinate the <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umerepositoryackonreceptionsource">ume_repository_ack_on_reception (source)</a> between the repository and the source. If the repository has <a class="el" href="index.html#umecfgrepositoryallowackonreception">repository-allow-ack-on-reception</a> enabled (1), the source can choose to keep it enabled or turn it off. If the repository has <a class="el" href="index.html#umecfgrepositoryallowackonreception">repository-allow-ack-on-reception</a> disabled (0), the source cannot turn it on.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">Optional: if the repository is a disk repository (<a class="el" href="index.html#umecfgrepositorytype">repository-type</a> <b>"disk"</b>), set the maximum write delay with the repository option, <a class="el" href="index.html#umecfgrepositorydiskwritedelay">repository-disk-write-delay</a>. Sources can set <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umewritedelaysource">ume_write_delay (source)</a> to a value less than or equal to <a class="el" href="index.html#umecfgrepositorydiskwritedelay">repository-disk-write-delay</a>.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">Optional: coordinate repository size options between the source and repository. If you wish to use the repository's values, you do not need to configure source configuration values. The repository sets a maximum for these three options. The source can reconfigure the repository's options with values less than or equal to the maximum configured for the repository using the following LBM configuration options:</p>
<ul>
<li>
<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umerepositorysizethresholdsource">ume_repository_size_threshold (source)</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umerepositorysizelimitsource">ume_repository_size_limit (source)</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umerepositorydiskfilesizelimitsource">ume_repository_disk_file_size_limit (source)</a> </li>
</ul>
</li>
</ol>
<p><br />
 </p>
<h3><a class="anchor" id="examplerppconfigurationfiles"></a>
Example RPP Configuration Files&nbsp;&nbsp;<small><a href="#examplerppconfigurationfiles">&lt;-</a></small></h3>
<p>The sample configuration files shown below show how a Store configuration file establishes certain RPP option values and the source can reconfigure them via an LBM configuration file. Although only two files appear below, this configuration represents two, single-Store quorum/consensus groups and one UM context. A second Store configuration file would be required for the Store "store1rpp" containing options and values identical to "store0rpp".</p>
<p><b>LBM Configuration File for RPP</b></p>
<p>The following example LBM configuration file will work for applications which have sources and/or receivers that must be persisted using RPP. This configuration file is written assuming that the Store is configured as shown in the next section.</p>
<ul>
<li>
<p class="startli">The source configures <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umeflightsizebytessource">ume_flight_size_bytes (source)</a> to 1,000,000 bytes. For this to work, the repository must set <a class="el" href="index.html#umecfgsourceflightsizebytesmaximum">source-flight-size-bytes-maximum</a> to a value greater than or equal to 1,000,000.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">The source uses <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umewritedelaysource">ume_write_delay (source)</a> to override the repository's <a class="el" href="index.html#umecfgrepositorydiskwritedelay">repository-disk-write-delay</a> setting to 1000 ms (1 second). Note that for this to work, the repository must set <a class="el" href="index.html#umecfgrepositorydiskwritedelay">repository-disk-write-delay</a> to a value greater than or equal to 1000 ms.</p>
<p class="endli"></p>
</li>
<li>
To remove clutter from the example, the transport type is allowed to default to TCP. Many persistence users prefer LBT-RM to more quickly and efficiently distribute messages to Stores and receivers. </li>
</ul>
<pre class="fragment">##Sample LBM Configuration File
# Default to TCP transport
# Multicast Resolver Network Options
context resolver_multicast_address 225.8.17.29
context resolver_multicast_interface 10.29.3.0/24

## Persistence Options ###
source ume_store_name store0rpp
source ume_store_name store1rpp
source ume_store_name store2rpp
source ume_session_id 535353
source ume_store_behavior qc
source ume_flight_size 500
# RPP-oriented configs.
#   If this app creates receivers, have them request RPP mode.
receiver ume_receiver_paced_persistence 1
#   If this app creates sources, have them request RPP mode.
source ume_receiver_paced_persistence 1
source ume_flight_size_bytes 1000000
#   The following parameters override Store configurations.
source ume_repository_size_threshold 104857600
source ume_repository_size_limit 209715200
source ume_repository_disk_file_size_limit 1073741824
source ume_repository_ack_on_reception 1
source ume_write_delay 1000
</pre><p><b>Store Configuration File</b></p>
<p>In the following example Store configuration file, RPP options appear in the section for the topic pattern, ABC*. This configuration file is written assuming client applications (sources and receivers) use LBM configuration files similar to that shown in the preceding section.</p>
<p>There are actually three Stores configured in QC. The other two's configurations should differ appropriately. For example, change each instance of "store0" to "store1" and "store2" respectively.</p>
<div class="fragment"><div class="line">&lt;?xml version=<span class="stringliteral">&quot;1.0&quot;</span>?&gt;</div><div class="line">&lt;ume-store version=<span class="stringliteral">&quot;1.3&quot;</span>&gt;</div><div class="line">  &lt;daemon&gt;</div><div class="line">    &lt;log&gt;/configs/stores/umestore0/umestored.log&lt;/log&gt;</div><div class="line">    &lt;pidfile&gt;/configs/stores/umestore0/umestored.pid&lt;/pidfile&gt;</div><div class="line">    &lt;lbm-config&gt;/configs/lbm_store0.cfg&lt;/lbm-config&gt;</div><div class="line">    &lt;web-monitor&gt;*:15404&lt;/web-monitor&gt;</div><div class="line">  &lt;/daemon&gt;</div><div class="line">  &lt;stores&gt;</div><div class="line">    &lt;store name=<span class="stringliteral">&quot;rpp-ump-test-store0&quot;</span> port=<span class="stringliteral">&quot;14667&quot;</span>&gt;</div><div class="line">      &lt;ume-attributes&gt;</div><div class="line">        &lt;option type=<span class="stringliteral">&quot;store&quot;</span> name=<span class="stringliteral">&quot;disk-cache-directory&quot;</span> value=<span class="stringliteral">&quot;/stores/store1/cache&quot;</span>/&gt;</div><div class="line">        &lt;option type=<span class="stringliteral">&quot;store&quot;</span> name=<span class="stringliteral">&quot;disk-state-directory&quot;</span> value=<span class="stringliteral">&quot;/stores/store1/state&quot;</span>/&gt;</div><div class="line">        &lt;option type=<span class="stringliteral">&quot;store&quot;</span> name=<span class="stringliteral">&quot;context-name&quot;</span> value=<span class="stringliteral">&quot;store0rpp&quot;</span>/&gt;</div><div class="line">      &lt;/ume-attributes&gt;</div><div class="line">      &lt;topics&gt;</div><div class="line">        &lt;topic pattern=<span class="stringliteral">&quot;ABC.*&quot;</span> type=<span class="stringliteral">&quot;PCRE&quot;</span>&gt;</div><div class="line">          &lt;ume-attributes&gt;</div><div class="line">             &lt;option type=<span class="stringliteral">&quot;store&quot;</span> name=<span class="stringliteral">&quot;repository-allow-receiver-paced-persistence&quot;</span> value=<span class="stringliteral">&quot;1&quot;</span>/&gt;</div><div class="line">             &lt;option type=<span class="stringliteral">&quot;store&quot;</span> name=<span class="stringliteral">&quot;repository-type&quot;</span> value=<span class="stringliteral">&quot;disk&quot;</span>/&gt;</div><div class="line">             &lt;option type=<span class="stringliteral">&quot;store&quot;</span> name=<span class="stringliteral">&quot;repository-size-threshold&quot;</span> value=<span class="stringliteral">&quot;2048&quot;</span>/&gt;</div><div class="line">             &lt;option type=<span class="stringliteral">&quot;store&quot;</span> name=<span class="stringliteral">&quot;repository-size-limit&quot;</span> value=<span class="stringliteral">&quot;209715200&quot;</span>/&gt;</div><div class="line">             &lt;option type=<span class="stringliteral">&quot;store&quot;</span> name=<span class="stringliteral">&quot;repository-disk-file-size-limit&quot;</span> value=<span class="stringliteral">&quot;1073741824&quot;</span>/&gt;</div><div class="line">             &lt;option type=<span class="stringliteral">&quot;store&quot;</span> name=<span class="stringliteral">&quot;source-flight-size-bytes-maximum&quot;</span> value=<span class="stringliteral">&quot;4194304&quot;</span>/&gt;</div><div class="line">             &lt;option type=<span class="stringliteral">&quot;store&quot;</span> name=<span class="stringliteral">&quot;repository-allow-ack-on-reception&quot;</span> value=<span class="stringliteral">&quot;1&quot;</span>/&gt;</div><div class="line">             &lt;option type=<span class="stringliteral">&quot;store&quot;</span> name=<span class="stringliteral">&quot;repository-disk-write-delay&quot;</span> value=<span class="stringliteral">&quot;1000&quot;</span>/&gt;</div><div class="line">          &lt;/ume-attributes&gt;</div><div class="line">        &lt;/topic&gt;</div><div class="line">      &lt;/topics&gt;</div><div class="line">    &lt;/store&gt;</div><div class="line">  &lt;/stores&gt;</div><div class="line">&lt;/ume-store&gt;</div></div><!-- fragment --><p><br />
 </p>
<h3><a class="anchor" id="rppcrossfeaturefunctionality"></a>
RPP Cross Feature Functionality&nbsp;&nbsp;<small><a href="#rppcrossfeaturefunctionality">&lt;-</a></small></h3>
<table class="doxtable">
<tr>
<th>UM Feature </th><th>Supported </th><th>Notes </th></tr>
<tr>
<td>Store Proxy Sources </td><td>Yes </td></tr>
<tr>
<td>DRO </td><td>Yes </td><td></td></tr>
<tr>
<td>UM Transports </td><td>Yes </td><td></td></tr>
<tr>
<td>Multi-Transport Threads </td><td>No </td><td>The Multi-Transport Threads does not support persistence. </td></tr>
<tr>
<td>Off-Transport Recovery </td><td>Yes </td><td></td></tr>
<tr>
<td>Late Join </td><td>No </td><td>A receiver cannot recover messages sent prior to that receiver's initial registration. </td></tr>
<tr>
<td>HF </td><td>Yes </td><td></td></tr>
<tr>
<td>HFX </td><td>Yes </td><td></td></tr>
<tr>
<td>Wildcard Receivers </td><td>Yes </td><td></td></tr>
<tr>
<td>Message Batching </td><td>Yes </td><td></td></tr>
<tr>
<td>Ordered Delivery </td><td>Yes </td><td></td></tr>
<tr>
<td>Request/Response </td><td>Yes </td><td></td></tr>
<tr>
<td>Multicast Immediate Messaging (MIM) </td><td>No </td><td>MIM messages are not persisted and have no impact on RPP. </td></tr>
<tr>
<td>Source Side Filtering </td><td>Yes </td><td></td></tr>
<tr>
<td>Self-Describing Messaging (SDM) </td><td>Yes </td><td></td></tr>
<tr>
<td>Pre-Defined Messaging (PDM) </td><td>Yes </td><td></td></tr>
<tr>
<td>UM Spectrum </td><td>Yes </td><td></td></tr>
<tr>
<td>Monitoring/Statistics </td><td>Yes </td><td></td></tr>
<tr>
<td>Acceleration - DBL </td><td>Yes </td><td></td></tr>
<tr>
<td>Acceleration - UD </td><td>Yes </td><td></td></tr>
<tr>
<td>Implicit/Explicit Acknowledgements </td><td>Yes </td><td></td></tr>
<tr>
<td>Registration ID/Session Management </td><td>Yes </td><td></td></tr>
<tr>
<td>Fault Tolerance - Quorum Consensus </td><td>Yes </td><td></td></tr>
<tr>
<td>UM SNMP Agent </td><td>Yes </td><td></td></tr>
<tr>
<td>Ultra Messaging Manager </td><td>Yes </td><td></td></tr>
<tr>
<td>Ultra Messaging Cache </td><td>Yes </td><td></td></tr>
<tr>
<td>Ultra Messaging Desktop Services </td><td>No </td><td></td></tr>
</table>
<p><br />
 </p>
<h2><a class="anchor" id="persistenceevents"></a>
Persistence Events&nbsp;&nbsp;<small><a href="#persistenceevents">&lt;-</a></small></h2>
<p>The Ultra Messaging API provides a number of events, callbacks, messages, functions, and settings. The API reference (C API, Java API or .NET API) can be used to see the true extent of the API. In order to design successful applications, though, a high level understanding of the events and callbacks is essential.</p>
<ul>
<li>
Events - Source events occur on a per source basis. </li>
<li>
Callbacks - Source and receiver application callbacks called directly from UM internal operation and usually demands a return value be filled in and/or are informational in nature. Typically, applications do very little processing in callbacks. </li>
<li>
Messages - Messages to receivers can simply contain UM information or have impact on operation. </li>
</ul>
<p>Some specific languages, such as C, Java, or C# may have specific nuances for the various events and callbacks. But, by and large, an application should plan on having access to the items listed in the following sections. For details for a particular language, consult the Ultra Messaging API documentation (C API, Java API or .NET API).</p>
<p><br />
 </p>
<h3><a class="anchor" id="persistencesourceevents"></a>
Persistence Source Events&nbsp;&nbsp;<small><a href="#persistencesourceevents">&lt;-</a></small></h3>
<p>The following events and callbacks are available for source applications:</p>
<table class="doxtable">
<tr>
<th>Event Name </th><th>Type </th><th>Description </th></tr>
<tr>
<td>Store Registration Success </td><td>Source Event </td><td><p class="starttd">Delivered once a source has successfully registered with a single Store. Event contains flags to show if the source is "old" (i.e. a re-registration) as well as the sequence number that the source should use as its initial sequence number when sending, and the Store information. See <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#a99e39b5b7215553654f91f8b74ad98c8">LBM_SRC_EVENT_UME_REGISTRATION_SUCCESS_EX</a>.</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>Store Registration Complete </td><td>Source Event </td><td><p class="starttd">Delivered once a source has completed registration with the required Store(s). This indicates the source may send as it desires. Event contains the consensus sequence number. See <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#a1e46557c499f8e8f97bb7996a1662f26">LBM_SRC_EVENT_UME_REGISTRATION_COMPLETE_EX</a>.</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>Store Registration Error </td><td>Source Event </td><td><p class="starttd">Delivered once a source has received an error from the Store indicating the requested registration was not granted. Event contains an error message to indicate what happened. See <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#ab030d061f44d60babc7d9efba6769cc2">LBM_SRC_EVENT_UME_REGISTRATION_ERROR</a>.</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>Store Message Stable </td><td>Source Event </td><td><p class="starttd">Delivered once a message is stable at a single Store. Event contains the message sequence number and indicates if the message meets Intergroup and/or Intragroup stability requirements. Also includes the Store information. See <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#acf1cedd5755e63083db63f3d45e45df6">LBM_SRC_EVENT_UME_MESSAGE_STABLE_EX</a>.</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>Store Message Not Stable </td><td>Source Event </td><td><p class="starttd">Delivered once a message's <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umemessagestabilitylifetimesource">ume_message_stability_lifetime (source)</a> has expired. The source no longer retransmits the message to the Store. See <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#a0d66ad81998e457acd6f37c2c312469f">LBM_SRC_EVENT_UME_MESSAGE_NOT_STABLE</a>.</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>Delivery Confirmation </td><td>Source Event </td><td><p class="starttd">Delivered once a message has been confirmed as delivered and processed by a receiving application. Event contains the message sequence number as well as indications whether the message has met the unique confirmations requirement. Also contains the receiver's Registration ID or Session ID. See <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#ae7124621f7cab5925ed8354690d736f9">LBM_SRC_EVENT_UME_DELIVERY_CONFIRMATION_EX</a>.</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>Store Unresponsive </td><td>Source Event </td><td><p class="starttd">Delivered once a Store is seen to be unresponsive due to failure or network disconnect. Event contains a message with more details suitable for logging. If a majority of a source's configured Stores are unresponsive, the application will not be allowed to send messages. See <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#a9505bdf346c03c9751b7d1c3755d4843">LBM_SRC_EVENT_UME_STORE_UNRESPONSIVE</a>.</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>Store Message Reclaimed </td><td>Source Event </td><td><p class="starttd">Delivered once a message has passed through retention and is about to be released from memory or disk. Event contains the message sequence number. (Reclaim refers to storage space reclamation.) See <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#a91689d8826be0160f64358ccfcff2877">LBM_SRC_EVENT_UME_MESSAGE_RECLAIMED_EX</a>.</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>Store Forced Reclaim </td><td>Callback </td><td><p class="starttd">Indicates a message is being forcibly released because the memory size limit (<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grplatejoin.html#retransmitretentionsizelimitsource">retransmit_retention_size_limit (source)</a>) has been exceeded or the message's <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umemessagestabilitylifetimesource">ume_message_stability_lifetime (source)</a> has expired. Event contains the message sequence number. See <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umeforcereclaimfunctionsource">ume_force_reclaim_function (source)</a>.</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>Flight Size Notification </td><td>Source Event </td><td><p class="starttd">Indicates that the number of in-flight messages for a source has exceeded or fallen below the configured flight size limit for a source. The event indicates if the flight size has been exceeded (OVER) by a new message send or that a message recently stabilized has reduced the number of in flight messages to less than the flight size limit (UNDER). See <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#a6d75dfecae9635b61c289efa3a8aa017">LBM_SRC_EVENT_FLIGHT_SIZE_NOTIFICATION</a>.</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>Source Deregistration Success </td><td>Source Event </td><td><p class="starttd">Delivered once a source successfully deregisters from an individual Store. The event contains either the RegID or Session ID, the sequence number of the last message stored for the source and Store information. See <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#a161b30d489f39fde9ead22bea7e13c83">LBM_SRC_EVENT_UME_DEREGISTRATION_SUCCESS_EX</a>.</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>Source Deregistration Complete </td><td>Source Event </td><td>Delivered once UM receives a successful deregistration event from all Stores. See <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#acd799cdd68375462a2b6dec522e0250b">LBM_SRC_EVENT_UME_DEREGISTRATION_COMPLETE_EX</a>. </td></tr>
</table>
<p><br />
 </p>
<h3><a class="anchor" id="persistencereceiverevents"></a>
Persistence Receiver Events&nbsp;&nbsp;<small><a href="#persistencereceiverevents">&lt;-</a></small></h3>
<p>The following callbacks and messages are available for receiver applications:</p>
<table class="doxtable">
<tr>
<th>Event Name </th><th>Type </th><th><p class="starttd">Description</p>
<p class="endtd"></p>
</th></tr>
<tr>
<td>Store Registration Success </td><td>Message </td><td><p class="starttd">Delivered once a receiver has successfully registered with a single Store. Message contains flags to show if the receiver is "old" (i.e. Not a new registration) as well as the sequence number that the receiver should use as its low sequence number, and the Store information. In addition, the event contains the source's Registration ID or Session ID and the receiver's Registration ID or Session ID. See <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#acae32fc8bfc50769993fcea62e553bd8">LBM_MSG_UME_REGISTRATION_SUCCESS_EX</a>.</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>Store Registration Complete </td><td>Message </td><td><p class="starttd">Delivered once a receiver has completed registration with the Store(s) required. This indicates the receiver may now receive data. Message contains the consensus sequence number. See <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#ab0571ebaf7704333a5503d1c0668a989">LBM_MSG_UME_REGISTRATION_COMPLETE_EX</a>.</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>Store Registration Failure </td><td>Message </td><td><p class="starttd">Delivered once a receiver has received an error from the Store indicating the requested registration was not granted. Event contains an error message to indicate what happened. See <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#aeb0203ec0c560a60c3b97017afc61ada">LBM_MSG_UME_REGISTRATION_ERROR</a>.</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>Receiver Deregistration Success </td><td>Message </td><td><p class="starttd">Delivered once a receiver successfully deregisters from an individual Store. The message contains either the RegID or Session ID for the receiver and the source, the sequence number of the last message stored for the source and Store information. See <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#ac6a7a25ddf1e95d30d686b967fd7e5c9">LBM_MSG_UME_DEREGISTRATION_SUCCESS_EX</a>.</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>Receiver Deregistration Complete </td><td>Message </td><td><p class="starttd">Delivered once UM receives a successful deregistration event from all Stores. See <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#a86121aa40ecebeaa5c17e711dcd76b96">LBM_MSG_UME_DEREGISTRATION_COMPLETE_EX</a>.</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>Store Registration Change </td><td>Message </td><td><p class="starttd">Delivered once a change in Store information is received from the source. The extent of the change is included in a message suitable for logging. See <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#ac12f55e0cdd14bd4d389bb3ef3afded3">LBM_MSG_UME_REGISTRATION_CHANGE</a>.</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>Store Retransmission </td><td>Message </td><td><p class="starttd">Retransmissions from recovery come in as normal messages with a flag indicating their status as a retransmission. See <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#abae94fa27ea855156f5aac9962d5435c">LBM_MSG_FLAG_UME_RETRANSMIT</a> and <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#a2b086d6bd8088880fe53f8b82d3d6eec">LBM_MSG_FLAG_OTR</a>.</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>Store Registration Function </td><td>Callback </td><td><p class="starttd">Called once a receiver receives Store information from a source and UM desires to know the RegID to use for the receiver. Callback passes the source RegID, the Store information, and the source transport name. The return value is the RegID that UM should request to use from the Store. See <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umeregistrationextendedfunctionreceiver">ume_registration_extended_function (receiver)</a>.</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>Store Recovery Sequence Number Function </td><td>Callback </td><td>Called once registration is about to complete and the low sequence number must be determined. Callback passes the highest sequence number seen from the source and the consensus sequence number from the Stores. See <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umerecoverysequencenumberinfofunctionreceiver">ume_recovery_sequence_number_info_function (receiver)</a>. </td></tr>
</table>
<p><br />
 </p>
<h2><a class="anchor" id="storemonitoring"></a>
Store Monitoring&nbsp;&nbsp;<small><a href="#storemonitoring">&lt;-</a></small></h2>
<p>See <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/operations.tag:../../Operations/" href="../../Operations/monitoring.html">Monitoring</a> for an overview of monitoring an Ultra Messaging network.</p>
<p>It is important to the health and stability of a UM network to monitor the operation of Stores. This monitoring should include real-time automated detection of problems that will produce a timely alert to operations staff.</p>
<p>Three types of data should be monitored: </p><ul>
<li>
Log file. </li>
<li>
UM library statistics (context, source, receiver, wildcard receiver, event queue). </li>
<li>
Daemon statistics (similar data to the <a class="el" href="index.html#storewebmonitor">Store Web Monitor</a>). </li>
</ul>
<p>For UM library stats and daemon stats, the monitoring messages contain an "application ID". For UM applications, this is a user-specified name intended to identify the individual component/instance, and is supplied by the option <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpautomaticmonitoring.html#monitorappidcontext">monitor_appid (context)</a>.</p>
<p>However, in the Store, the "monitor-appid" is typically set in the store's XML configuration file, so that it can be set on a store-basis. I.e. if the Store daemon is configured with multiple Store instances, each one can be given its own "monitor-appid".</p>
<p>For example, a Store configured with: </p><div class="fragment"><div class="line">&lt;stores&gt;</div><div class="line">  &lt;store name=<span class="stringliteral">&quot;store_topic1&quot;</span> interface=<span class="stringliteral">&quot;10.29.4.0/24&quot;</span> port=<span class="stringliteral">&quot;12801&quot;</span>&gt;</div><div class="line">    &lt;ume-attributes&gt;</div><div class="line">      &lt;option type=<span class="stringliteral">&quot;lbm-context&quot;</span> name=<span class="stringliteral">&quot;monitor_appid&quot;</span> value=<span class="stringliteral">&quot;store_appid_topic1&quot;</span>/&gt;</div><div class="line">      ...</div></div><!-- fragment --><p> The UM library stats will have the application ID <code>"store_appid_topic1"</code>.</p>
<p>However, in the case of Store daemon stats, the "name" attribute of the <a class="el" href="index.html#umeelementstore">UMP Element "&lt;store&gt;"</a> is used as the application ID. So in the above example Store configuration, the daemon stats will have the application ID <code>"store_topic1"</code>.</p>
<p><br />
 </p>
<h3><a class="anchor" id="storemonitoringlogs"></a>
Store Monitoring: Logs&nbsp;&nbsp;<small><a href="#storemonitoringlogs">&lt;-</a></small></h3>
<p>Ideally, log file monitoring would support the following: </p><ul>
<li>
Archive all log messages for all Stores for at least a week, preferably a month. </li>
<li>
Provide rapid access to operations staff to view the latest log messages from a Store. </li>
<li>
Periodic scans of the log file to detect errors and raise alerts to operations staff. </li>
</ul>
<p>Regarding log file scanning, messages in the Store's log file contain a severity indicator in square brackets. For example: </p><pre class="fragment">Sun Oct 30 08:32:22 2022 [WARNING]: Store-5688-5445: WARNING: store "store_topic1" cache directory appears to be on an NFS mount. This is not recommended.
</pre><p> Informatica recommends alerting operations staff for messages of severity [WARNING], [ERROR], [CRITICAL], [ALERT], and [EMERGENCY].</p>
<p>It would also be useful to have a set of exceptions for specific messages you wish to ignore. For example, if you have a Store that must locate its state and cache files on an NFS mount, you might want to have your scanner exclude message Store-5688-5445.</p>
<p>There are many third party real-time log file analysis tools available. A discussion of possible tools is beyond the scope of UM documentation.</p>
<p><br />
 </p>
<h3><a class="anchor" id="storemonitoringumlibrarystats"></a>
Store Monitoring: UM Library Stats&nbsp;&nbsp;<small><a href="#storemonitoringumlibrarystats">&lt;-</a></small></h3>
<p>The Store communicates with persistent applications using Ultra Messaging protocols, and therefore makes use of the UM library. It is just as important to monitor the UM library statistics for the Store as it is for applications. Automatic monitoring is enabled using the same configuration options as for applications.</p>
<p>There are two data formats for UM library stats: </p><ul>
<li>
Protobufs - recommended. </li>
<li>
CSV - deprecated. Informatica recommends migrating to protobufs. </li>
</ul>
<p>For example, here is an excerpt from a sample Store configuration file that shows how an XML-based UM library configuration file is specified: </p><div class="fragment"><div class="line">&lt;ume-store version=<span class="stringliteral">&quot;1.3&quot;</span>&gt;</div><div class="line">  &lt;daemon&gt;</div><div class="line">    ...</div><div class="line">    &lt;xml-config&gt;um.xml&lt;/xml-config&gt;</div><div class="line">    ...</div></div><!-- fragment --><p>Here is an excerpt from a sample "um.xml": </p><div class="fragment"><div class="line">&lt;?xml version=<span class="stringliteral">&quot;1.0&quot;</span> encoding=<span class="stringliteral">&quot;UTF-8&quot;</span> ?&gt;</div><div class="line">&lt;um-configuration version=<span class="stringliteral">&quot;1.0&quot;</span>&gt;</div><div class="line">  &lt;templates&gt;</div><div class="line">    ...</div><div class="line">    &lt;<span class="keyword">template</span> name=<span class="stringliteral">&quot;automonitor&quot;</span>&gt;</div><div class="line">      &lt;options type=<span class="stringliteral">&quot;context&quot;</span>&gt;</div><div class="line">        &lt;option name=<span class="stringliteral">&quot;monitor_format&quot;</span> <span class="keywordflow">default</span>-value=<span class="stringliteral">&quot;pb&quot;</span>/&gt;</div><div class="line">        &lt;option name=<span class="stringliteral">&quot;monitor_interval&quot;</span> <span class="keywordflow">default</span>-value=<span class="stringliteral">&quot;600&quot;</span>/&gt;</div><div class="line">        &lt;option name=<span class="stringliteral">&quot;monitor_transport&quot;</span> <span class="keywordflow">default</span>-value=<span class="stringliteral">&quot;lbm&quot;</span>/&gt;</div><div class="line">      &lt;/options&gt;</div><div class="line">    &lt;/<span class="keyword">template</span>&gt;</div><div class="line">    ...</div><div class="line">    &lt;<span class="keyword">template</span> name=<span class="stringliteral">&quot;mon_ctx&quot;</span>&gt;</div><div class="line">      &lt;options type=<span class="stringliteral">&quot;context&quot;</span>&gt;</div><div class="line">        &lt;option name=<span class="stringliteral">&quot;resolver_unicast_daemon&quot;</span> <span class="keywordflow">default</span>-value=<span class="stringliteral">&quot;10.29.3.101:12801&quot;</span>/&gt;</div><div class="line">        &lt;option name=<span class="stringliteral">&quot;default_interface&quot;</span> <span class="keywordflow">default</span>-value=<span class="stringliteral">&quot;10.29.3.0/24&quot;</span>/&gt;</div><div class="line">        &lt;option name=<span class="stringliteral">&quot;mim_incoming_address&quot;</span> <span class="keywordflow">default</span>-value=<span class="stringliteral">&quot;0.0.0.0&quot;</span>/&gt;</div><div class="line">        ...</div><div class="line">      &lt;/options&gt;</div><div class="line">      &lt;options type=<span class="stringliteral">&quot;source&quot;</span>&gt;</div><div class="line">        &lt;option name=<span class="stringliteral">&quot;transport&quot;</span> <span class="keywordflow">default</span>-value=<span class="stringliteral">&quot;tcp&quot;</span>/&gt;</div><div class="line">      &lt;/options&gt;</div><div class="line">    &lt;/<span class="keyword">template</span>&gt;</div><div class="line">    ...</div><div class="line">  &lt;/templates&gt;</div><div class="line"></div><div class="line">  &lt;applications&gt;</div><div class="line">    ...</div><div class="line">    &lt;application name=<span class="stringliteral">&quot;umestored&quot;</span>&gt;</div><div class="line">      &lt;contexts&gt;</div><div class="line">        &lt;context name=<span class="stringliteral">&quot;store_topic1&quot;</span> <span class="keyword">template</span>=<span class="stringliteral">&quot;mytemplate,automonitor&quot;</span>&gt;</div><div class="line">          &lt;sources/&gt;</div><div class="line">        &lt;/context&gt;</div><div class="line">        &lt;context name=<span class="stringliteral">&quot;29west_statistics_context&quot;</span> <span class="keyword">template</span>=<span class="stringliteral">&quot;mon_ctx&quot;</span>&gt;</div><div class="line">          &lt;sources/&gt;</div><div class="line">        &lt;/context&gt;</div><div class="line">      &lt;/contexts&gt;</div><div class="line">    &lt;/application&gt;</div><div class="line">    ...</div></div><!-- fragment --><p><b>Notes:</b></p>
<ol>
<li>
<p class="startli">The <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpautomaticmonitoring.html#monitorformatcontext">monitor_format (context)</a> value "pb" selects the protobuf format and is available for the Store in UM version 6.14 and beyond. Selecting this format implicitly enables the inclusion of the Store's daemon stats (see below).</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">For a list of possible protobuf messages for the Store, see the "ump_mon.proto" file at <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/example.tag:../../example/" href="../../example/index.html#exampleump_mon_proto">Example ump_mon.proto</a>.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">The Store context named "store_topic1" is configured with the <code>"automonitor"</code> template, which sets the automatic monitoring options. The <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpautomaticmonitoring.html#monitorintervalcontext">monitor_interval (context)</a> option enables automatic monitoring and defines the statistics sampling period. In the above example, 600 seconds (10 minutes) is chosen somewhat arbitrarily. Shorter times produce more data, but not much additional benefit. However, UM networks with many thousands of applications may need a longer interval (perhaps 30 or 60 minutes) to maintain a reasonable load on the network and monitoring data storage.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">When automatic monitoring is enabled, it creates a context named "29west_statistics_context". It is configured with the "mon_ctx" template, which sets options for the monitoring data TRD. (Alternatively, you can configure the monitoring context using <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpautomaticmonitoring.html#monitortransportoptscontext">monitor_transport_opts (context)</a>.) When possible, Informatica recommends directing monitoring data to an administrative network, separate from the application data network. This prevents monitoring data from interfering with application data latency or throughput. In this example, the monitoring context is configured to use an interface matching <code>10.29.3.0/24</code>.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">In this example, the monitoring data <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/design.tag:../../Design/" href="../../Design/topicresolutiondescription.html">TRD</a> uses <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/design.tag:../../Design/" href="../../Design/architecture.html#unicasttopicresolution">Unicast UDP Topic Resolution</a>. The <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/design.tag:../../Design/" href="../../Design/manpagesforlbmrd.html#lbmrdmanpage">lbmrd</a> daemon is running on host 10.29.3.101, port 12001.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">The monitoring data is sent out via UM using the TCP transport.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">These settings were chosen to conform to the recommendations in <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/operations.tag:../../Operations/" href="../../Operations/monitoring.html#automaticmonitoring">Automatic Monitoring</a>.</p>
<p class="endli"></p>
</li>
</ol>
<p>For a full demonstration of monitoring, see: <a href="https://github.com/UltraMessaging/mcs_demo">https://github.com/UltraMessaging/mcs_demo</a></p>
<p><br />
 </p>
<h3><a class="anchor" id="storemonitoringdaemonstats"></a>
Store Monitoring: Daemon Stats&nbsp;&nbsp;<small><a href="#storemonitoringdaemonstats">&lt;-</a></small></h3>
<p>The daemon statistics for the Store represent a superset of the information presented on the <a class="el" href="index.html#storewebmonitor">Store Web Monitor</a>.</p>
<p>There are two data formats for the Store to send its daemon stats: </p><ul>
<li>
Protobufs - recommended. </li>
<li>
Binary - deprecated. Informatica recommends migrating to protobufs. </li>
</ul>
<p>For information on the deprecated binary formatted daemon stats, see <a class="el" href="index.html#storedaemonstatistics">Store Binary Daemon Statistics</a>.</p>
<p>The protobufs format is accepted by the <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/operations.tag:../../Operations/" href="../../Operations/monitoring.html#monitoringcollectorservicemcs">Monitoring Collector Service (MCS)</a> and the "lbmmon" example applications: <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/example.tag:../../example/" href="../../example/index.html#examplelbmmon_c">Example lbmmon.c</a> and <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/java_example.tag:../../java_example/" href="../../java_example/index.html#examplelbmmon_java">Example lbmmon.java</a>.</p>
<p>The daemon stats are enabled when the UM library stats are published using <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/operations.tag:../../Operations/" href="../../Operations/monitoring.html#automaticmonitoring">Automatic Monitoring</a> with format="pb". See <a class="el" href="index.html#storemonitoringumlibrarystats">Store Monitoring: UM Library Stats</a>.</p>
<p>For a list of possible protobuf messages for the Store, see the "ump_mon.proto" file at <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/example.tag:../../example/" href="../../example/index.html#exampleump_mon_proto">Example ump_mon.proto</a>.</p>
<p>For a full demonstration of monitoring, see: <a href="https://github.com/UltraMessaging/mcs_demo">https://github.com/UltraMessaging/mcs_demo</a></p>
<p><br />
 </p><hr/>
<h1><a class="anchor" id="storerepositoryprofilingsrp"></a>
Store Repository Profiling (SRP)&nbsp;&nbsp;<small><a href="#storerepositoryprofilingsrp">&lt;-</a></small></h1>
<p>To aid the users in operating and maintaining their Persistent Store deployment, Informatica provides an API that will read Store cache and state files and return useful information about them, including message content. This is the Store Repository Profiling (SRP) API. (The API is not in the normal "lbm" library; see <a class="el" href="index.html#usingthesrpapi">Using the SRP API</a>.)</p>
<p>Also supplied is the "umesnaprepo" example program, which uses the SRP API to read the information and print to standard out. It can be used as-is (see <a class="el" href="index.html#umesnaprepomanpage">umesnaprepo Man Page</a>), or its source code (<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/example.tag:../../example/" href="../../example/index.html#exampleumesnaprepo_c">Example umesnaprepo.c</a>) can be used as a guide for users to develop their own management tools.</p>
<p>This API and example program are supported on the same platforms that support the Persistent Store: 64-bit Linux and 64-bit Windows. The API is C-only (no Java or .NET). Also be aware that the API is read-only. The API does not provide a way to modify the cache or state files.</p>
<p><b>IMPORTANT</b>: due to differences in certain Windows and Linux data sizes, a given set of state and cache files needs to be read on the same platform where it was generated. For example it is <em>NOT</em> valid to copy a Linux Store's files to a Windows machine and use the windows-based SRP API or command-line tool to read them.</p>
<dl class="section note"><dt>Note</dt><dd>The Store instance <b>should NOT be running</b> while the API or example program is used to read the Store files. There currently is no tool that performs the same function on an actively running Store.</dd></dl>
<p><br />
 </p>
<h2><a class="anchor" id="usingthesrpapi"></a>
Using the SRP API&nbsp;&nbsp;<small><a href="#usingthesrpapi">&lt;-</a></small></h2>
<p>Use the <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/example.tag:../../example/" href="../../example/index.html#exampleumesnaprepo_c">Example umesnaprepo.c</a> source code as your guide.</p>
<p>The <a href="../../API/umeprofile_8h.html.html">umeprofile.h</a> header file contains the needed definitions.</p>
<p>The API code is <em>not</em> contained within the normal "lbm" library. On Linux, it is in "libumestorelib.a", a static library. On Windows, it is in "umestore.dll", a dynamic library.</p>
<p>The main API functions are: </p><ul>
<li>
<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/umeprofile_8h.html#a7cbe29f232a6c3123286a97ac2b5a3f7">lbm_srp_create()</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/umeprofile_8h.html#a99a7efb5c423f5a3c9cf10891c89c88b">lbm_srp_delete()</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/umeprofile_8h.html#a8142a85b874de9fc5f01d98dfea0eac8">lbm_srp_get_repo_state()</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/umeprofile_8h.html#aefbd012de930c9c47172ee305e2ae8af">lbm_srp_free_repo_state()</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/umeprofile_8h.html#a0324123a655d0aeaefb4ee81092dc7dd">lbm_srp_get_repo_message()</a> </li>
</ul>
<p><br />
 </p>
<h2><a class="anchor" id="umesnaprepomanpage"></a>
umesnaprepo Man Page&nbsp;&nbsp;<small><a href="#umesnaprepomanpage">&lt;-</a></small></h2>
<p>The "umesnaprepo" command is an example program that uses the <a class="el" href="index.html#storerepositoryprofilingsrp">Store Repository Profiling (SRP)</a> API to read Store state and cache files and print useful information, including message content. It can be used as-is, or its source code (<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/example.tag:../../example/" href="../../example/index.html#exampleumesnaprepo_c">Example umesnaprepo.c</a>) can be used as a guide for users to develop their own management tools.</p>
<dl class="section note"><dt>Note</dt><dd>The Store instance <b>should NOT be running</b> while the API or example program is used to read the Store files. There currently is no tool that performs the same function on an actively running Store.</dd></dl>
<pre class="fragment">Usage: umesnaprepo -s state_dir [options]
Available options:
  -c, --cache-dir=PATH     cache file search PATH
  -h, --help               display this help and exit
  -n, --no-checksum        disable cache checksum checking
  -p, --parse              enable LBM header parsing
  -s, --state-dir=PATH     state file search PATH [required]
  -t, --truncate=NUM       limit cache message displays to NUM bytes
  -T, --terse              summarize cache and skip cache message displays
</pre><p>For example: </p><pre class="fragment">umesnaprepo -s /UM/store5/state -c /UM/store5/cache
</pre><p>This examines the state and cache files and prints information for every Store instance represented there. Here's some example output: </p><pre class="fragment">Examining repository at index: 0
state_filename: /UM/store5/state/2545027182-state
cache_filename: /UM/store5/cache/2545027182-cache
...
Repository cache:
    number of messages: 26
...
Receiver 0
    regid: 2545027183
    sqn: 25
...
Message sqn [0]:
   tsp: 1584022054.898262
   disk_len: 37
   disk_offset: 0
   flags: 0x01
Message body:
00 00 00 25 a4 ab 82 e6 00 00 00 00 6d 65 73 73         ...%........mess
61 67 65 20 30 00 00 00 00 00 00 00 00 00 00 00         age 0...........
00 00 00 00 00                                          .....          
...
</pre><p>In this example output, notice that the actual beginning of the message (the first byte is the "m" of "message 0") is at offset 12 from the beginning of the buffer. The 12 bytes in front of the message is the "LBMC" header. The example application lets you supply the "-T" option, which parses the LBMC header and starts printing the message at the actual start of data.</p>
<p><br />
 </p><hr/>
<h1><a class="anchor" id="enablingpersistence"></a>
Enabling Persistence&nbsp;&nbsp;<small><a href="#enablingpersistence">&lt;-</a></small></h1>
<p>The following table lists all source files used in this section. The files can be found in the /doc/example directory. You can also access these file via the Sample Source Code tab in the left panel, under C Example Source Code.</p>
<table class="doxtable">
<tr>
<th>Filename </th><th>Content </th></tr>
<tr>
<td><a href="../../example/ume-example-src.c">ume-example-src.c</a> </td><td>Source Application </td></tr>
<tr>
<td><a href="../../example/ume-example-rcv.c">ume-example-rcv.c</a> </td><td>Receiver Application </td></tr>
<tr>
<td><a href="../../example/ume-example-src-2.c">ume-example-src-2.c</a> </td><td>Source Application 2 </td></tr>
<tr>
<td><a href="../../example/ume-example-rcv-2.c">ume-example-rcv-2.c</a> </td><td>Receiver Application 2 </td></tr>
<tr>
<td><a href="../../example/ume-example-src-3.c">ume-example-src-3.c</a> </td><td>Source Application 3 </td></tr>
<tr>
<td><a href="../../example/ume-example-rcv-3.c">ume-example-rcv-3.c</a> </td><td>Receiver Application 3 </td></tr>
<tr>
<td><a href="../../example/ume-example-config.xml">ume-example-config.xml</a> </td><td>Persistent Store Configuration File </td></tr>
</table>
<p><br />
 </p>
<h2><a class="anchor" id="startingconfiguration"></a>
Starting Configuration&nbsp;&nbsp;<small><a href="#startingconfiguration">&lt;-</a></small></h2>
<p>We begin with the minimal source and receiver used by the QuickStart Guide. To more easily demonstrate the persistence features we are interested in, we have modified the QuickStart source and receiver in the following ways.</p>
<ul>
<li>
Modified the source to send 20 messages with a one second pause between each message. </li>
<li>
Modified the receiver to anticipate 20 messages instead of just one. </li>
<li>
Assigned the topic, "UME Example", to both the source and receiver. </li>
<li>
Modified the receiver to not exit on unexpected receiver events. </li>
</ul>
<p>The last change allows us to better demonstrate basic operation and evolve our receiver slowly without having to anticipate all the options that UM provides up front.</p>
<p>Example files for our exercise are: </p><table class="doxtable">
<tr>
<th>Filename </th><th>Content </th></tr>
<tr>
<td><a href="../../example/ume-example-src.c">ume-example-src.c</a> </td><td>Source Application </td></tr>
<tr>
<td><a href="../../example/ume-example-rcv.c">ume-example-rcv.c</a> </td><td>Receiver Application </td></tr>
</table>
<p><br />
 </p>
<h2><a class="anchor" id="addingthestoretoasource"></a>
Adding the Store to a Source&nbsp;&nbsp;<small><a href="#addingthestoretoasource">&lt;-</a></small></h2>
<p>The fundamental component of a persistence solution is the Persistent Store. To use a Store, a source needs to be configured to use one by setting <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umestoresource">ume_store (source)</a> for the source. We can do that with the following piece of code.</p>
<div class="fragment"><div class="line">err = <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#a422f330bf7ef3efdd7a9f17caabccb24">lbm_src_topic_attr_str_setopt</a>(&amp;attr, <span class="stringliteral">&quot;ume_store&quot;</span>, <span class="stringliteral">&quot;127.0.0.1:14567&quot;</span>);</div></div><!-- fragment --><p>This sets the Persistent Store for the source to the Store running at 127.0.0.1 on port 14567.</p>
<p>Example files for our exercise are: </p><table class="doxtable">
<tr>
<th>Filename </th><th>Content </th></tr>
<tr>
<td><a href="../../example/ume-example-src-2.c">ume-example-src-2.c</a> </td><td>Source Application 2 </td></tr>
<tr>
<td><a href="../../example/ume-example-rcv-2.c">ume-example-rcv-2.c</a> </td><td>Receiver Application 2 </td></tr>
<tr>
<td><a href="../../example/ume-example-config.xml">ume-example-config.xml</a> </td><td>Persistent Store Configuration File </td></tr>
</table>
<p>After adding the Store specification to the source, perform the following steps (assumes a Unix command prompt):</p>
<ol>
<li>
Create the cache and state directories. <pre class="fragment">$ mkdir umestored-cache ; mkdir umestored-state
</pre> </li>
<li>
Start up the Store. <pre class="fragment">$ umestored ume-example-config.xml
</pre> </li>
<li>
Start the Receiver. <pre class="fragment">$ ume-example-rcv
</pre> </li>
<li>
Start the Source. <pre class="fragment">$ ume-example-src
</pre> </li>
</ol>
<p>You should see a message on the source that says:</p>
<pre class="fragment">INFO: Source "UME Example" Late Join not set, but UME store specified. Setting Late Join.
</pre><p>This is an informational message from UM and merely means Late Join was not set and that UM is going to set it.</p>
<p>Notice that the receiver was not configured with any Store information. That is because setting it on the source is all that is needed. The receiver learns Store settings from the source through the normal UM topic resolution process. Receivers don't need to do anything special to leverage the usage of a Store by a source.</p>
<p><br />
 </p>
<h2><a class="anchor" id="addingfaultrecoverywithregistrationids"></a>
Adding Fault Recovery with Registration IDs&nbsp;&nbsp;<small><a href="#addingfaultrecoverywithregistrationids">&lt;-</a></small></h2>
<p>If the source or receiver crashes, how does the source and receiver tell the Store that they have restarted and wish to resume where they left off? We need to add in some sort of identifiers to the source and receiver so that the Store knows which sources and receivers they are.</p>
<p>In persistence, these identifiers are called Registration IDs or RegIDs. UM allows the application to control the use of RegIDs as it wishes. This allows applications to migrate sources and receivers not just between systems, but between locations with true, unprecedented freedom. However, UM requires an application to be careful of how it uses RegIDs. Specifically, an application must not use the same RegID for multiple sources and/or receivers at the same time.</p>
<p>Now let's look at how we can use RegIDs to provide complete fault recovery of sources and receivers. We'll first handle RegIDs in the simplest manner by using static IDs for our source and receiver. For the source, the RegID of 1000 can be added to the existing Store specification by changing the string to <code>127.0.0.1:14567:1000</code></p>
<p>This yields the source code in <a href="../../example/ume-example-src-2.c">ume-example-src-2.c</a></p>
<p>For the receiver, we accomplish this in two steps.</p>
<ol>
<li>
<p class="startli">Set a callback function to be called when we desire to set the RegID to 1100. This is done by declaring a callback function which will return the RegID value 1100 to UM. The example names the callback <code>app_rcv_regid_callback()</code>.</p>
<p class="endli"></p>
</li>
<li>
Inform the LBM configuration for the receiver to use this callback function. That is accomplished by setting the ume_registration_extended_function() similar to example code below. </li>
</ol>
<div class="fragment"><div class="line"><a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__ume__rcv__regid__ex__func__t__stct.html">lbm_ume_rcv_regid_ex_func_t</a> id;      <span class="comment">/* structure to hold registration function information */</span></div><div class="line"><span class="keywordtype">id</span>.<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__ume__rcv__regid__ex__func__t__stct.html#aa182b9c694a4d71b8a30487dd8eed8ea">func</a> = app_rcv_regid_callback;    <span class="comment">/* the callback function to call */</span></div><div class="line"><span class="keywordtype">id</span>.clientd = NULL;                   <span class="comment">/* the value to pass in the clientd to the function */</span></div><div class="line">err = <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#a1afc75f0fb3601d072b3463e7acf16a6">lbm_rcv_topic_attr_setopt</a>(&amp;attr, <span class="stringliteral">&quot;ume_registration_extended_function&quot;</span>, &amp;<span class="keywordtype">id</span>, <span class="keyword">sizeof</span>(<span class="keywordtype">id</span>));</div></div><!-- fragment --><p>Once this is done, the receiver has the ability to control what RegID it will use. This yields the source code in <a href="../../example/ume-example-rcv-2.c">ume-example-rcv-2.c</a>.</p>
<p>With these in place, you can experiment with killing the receiver and bringing it back (as long as you bring it back before the source is finished), as well as killing the source and bringing it back.</p>
<p>The restriction to this initial approach to RegIDs is that the RegIDs 1000 and 1100 may not be used by any other objects at the same time. If you run additional sources or receivers, they must be assigned new RegIDs, not 1000 or 1100. Let's now take a more sophisticated approach to RegIDs that will allow much more flexibility.</p>
<p><br />
 </p>
<h2><a class="anchor" id="enablingpersistencebetweenthesourceandstore"></a>
Enabling Persistence Between the Source and Store&nbsp;&nbsp;<small><a href="#enablingpersistencebetweenthesourceandstore">&lt;-</a></small></h2>
<p>Let's refine our source to include some desired behavior following a crash. Upon restart, we want our source to resume with the first unsent message. For example, if the source sent 10 messages and crashed, we want our source to resume with the 11th message and continue until it has sent the 20th message.</p>
<p>Accomplishing this graceful resumption requires us to ensure that our source is the only source that uses the RegID assigned to it. The same RegID should be used as long as the source has not sent the 20th message regardless of any crashes that may occur. The sources and receivers are primarily responsible for managing the RegIDs.</p>
<p>The following two sections explain the changes needed for the source and receiver, which become fairly easy due to the events that UM delivers to the application during persistence operation.</p>
<p><br />
 </p>
<h2><a class="anchor" id="enablingpersistenceinthesource"></a>
Enabling Persistence in the Source&nbsp;&nbsp;<small><a href="#enablingpersistenceinthesource">&lt;-</a></small></h2>
<p>With the above mentioned behaviors in mind, let's turn to looking at how they may be implemented with persistence, starting with the source. We can summarize the changes we need by the following list.</p>
<ol>
<li>
At source startup, use any saved RegID information found in the file by setting information in the <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umestoresource">ume_store (source)</a> configuration variable. </li>
<li>
After the Store registration is successful, if a new RegID was assigned to the source, save the RegID to the file. </li>
<li>
Set the message number to begin sending. Refer to the explanation below. </li>
<li>
Send until message number 20 has been sent. </li>
<li>
After message 20 has been sent, delete the saved RegID file. </li>
</ol>
<p>For Step 3, if the source has just been initialized, the application starts with message number 1. If the source has been restarted after a crash, the application looks to UM to establish the beginning message number because UM will use the next sequence number. For this simple example, we can make the assumption that each message is one sequence number for UM and that UM starts with sequence number 0. Thus the application can set the message number it begins resending with the value of the UM sequence number + 1. These changes yield the source code in <a href="../../example/ume-example-src-3.c">ume-example-src-3.c</a></p>
<p><br />
 </p>
<h3><a class="anchor" id="smartsourcesandpersistence"></a>
Smart Sources and Persistence&nbsp;&nbsp;<small><a href="#smartsourcesandpersistence">&lt;-</a></small></h3>
<p>When using the <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/design.tag:../../Design/" href="../../Design/advancedoptimizations.html#smartsources">Smart Sources</a> feature to send persistent messages, there are a few restrictions: </p><ul>
<li>
No support for source-side delivery confirmation. Neither of the forms described in <a class="el" href="index.html#deliveryconfirmationconcept">Delivery Confirmation Concept</a> are allowed. </li>
<li>
No support for <a class="el" href="index.html#receiverlivenessdetection">Receiver Liveness Detection</a>. </li>
<li>
Application stability notification is only supported per-message. See <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umemessagestabilitynotificationsource">ume_message_stability_notification (source)</a>. </li>
<li>
The following configuration options have limited or no support with Smart Sources: <ul>
<li>
<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umeconfirmeddeliverynotificationsource">ume_confirmed_delivery_notification (source)</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umeretentionuniqueconfirmationssource">ume_retention_unique_confirmations (source)</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umesriflushsrirequestresponsesource">ume_sri_flush_sri_request_response (source)</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umesrirequestresponselatencysource">ume_sri_request_response_latency (source)</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umemessagestabilitynotificationsource">ume_message_stability_notification (source)</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grplatejoin.html#retransmitretentionsizethresholdsource">retransmit_retention_size_threshold (source)</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umeretentionsizethresholdsource">ume_retention_size_threshold (source)</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grplatejoin.html#retransmitretentionsizelimitsource">retransmit_retention_size_limit (source)</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umeretentionsizelimitsource">ume_retention_size_limit (source)</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grplatejoin.html#retransmitretentionagethresholdsource">retransmit_retention_age_threshold (source)</a> </li>
</ul>
</li>
</ul>
<p><br />
 </p>
<h2><a class="anchor" id="enablingpersistenceinthereceiver"></a>
Enabling Persistence in the Receiver&nbsp;&nbsp;<small><a href="#enablingpersistenceinthereceiver">&lt;-</a></small></h2>
<p>Let's also refine the receiver to resume where it left off after a crash. Just as with the source, the receiver can have the Store assign it a RegID if the receiver is just beginning. Once the receiver receives the 20th message from the source, it can get rid of the RegID and exit. Because the receiver can receive some messages, crash, and come back, we should only need to look at a message and check if it is the 20th message based on the message contents or sequence number. UM provides all the events to the application that we need to create these behaviors in the receiver.</p>
<p>The receiver changes are summarized below:</p>
<ol>
<li>
<p class="startli">At receiver startup, use any saved RegID information found in the file for callback information when needed.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">When RegID callback is called: Check to see if the source RegID matches the saved source RegID. If it does, return the saved receiver RegID. RegID matches the saved source RegID if so, return the saved receiver RegID.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">After Store registration is successful: If not using a previously saved RegID, then save the RegID assigned by the Store to the source to a file, as well as the Store information and the source RegID.</p>
<p class="endli"></p>
</li>
<li>
After the last message is received (message number 20 or UM sequence number 19), end the application and delete the saved RegID file. </li>
</ol>
<p>RegIDs in UM can be considered to be per source and per topic. Thus the receiver does not want to use the wrong RegID for a different source on the same topic. To avoid this, we save the source RegID and even Store information so that the <code>app_rcv_regid_callback()</code> can make sure to use the correct RegID for the given source RegID. These changes yield the source code in <a href="../../example/ume-example-rcv-3.c">ume-example-rcv-3.c</a></p>
<p>The above sources and receivers are simplified for illustration purposes and do have some limitations. The receiver will only keep the information for one source at a time saved to the file. This is fine for illustration purposes, but would be lacking in completeness for production applications unless it was assured that a single source for any topic would be in use. To extend the receiver to include several sources is simply a matter of saving each to the file, reading them in at startup, and being able to search for the correct one for each callback invoked.</p>
<p><br />
 </p><hr/>
<h1><a class="anchor" id="demonstratingpersistence"></a>
Demonstrating Persistence&nbsp;&nbsp;<small><a href="#demonstratingpersistence">&lt;-</a></small></h1>
<p>The following files are used in this section:</p>
<table class="doxtable">
<tr>
<th>Filename </th><th>Content </th></tr>
<tr>
<td><a href="../../example/ume-example-src-3.c">ume-example-src-3.c</a> </td><td>Source Application 3 </td></tr>
<tr>
<td><a href="../../example/ume-example-rcv-3.c">ume-example-rcv-3.c</a> </td><td>Receiver Application 3 </td></tr>
<tr>
<td><a href="../../example/ume-example-config.xml">ume-example-config.xml</a> </td><td>Persistent Store Configuration File </td></tr>
</table>
<p>Perform the following tasks first:</p>
<ol>
<li>
<p class="startli">Build ume-example-rcv-3.c and ume-example-src-3.c. Instructions for building them are at the beginning of the source files.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">Create default directories, umestored-cache and umestored-state in the /doc/UME directory where the other ume-example files are located. Our sample Store configuration file, ume-example-config.xml, doesn't specify directories for the Store's cache and state files, so those will be placed in the default directories.</p>
<p class="endli"></p>
</li>
<li>
Start the Store. <pre class="fragment">$ umestored ume-example-config.xml
</pre> </li>
</ol>
<p>You should see no output if the Store started successfully. However, you should find a new log file, ume-example-stored.log, in the directory you ran the Store in. The first couple lines should look similar to below.</p>
<pre class="fragment">Fri Feb 01 07:34:28 2009 [INFO]: Latency Busters Persistent Store version 2.0
Fri Feb 01 07:34:28 2009 [INFO]: LBM 3.3 [UME-2.0] Build: Jan 31 2009, 02:10:43
( DEBUG license LBT-RM LBT-RU ) WC[PCRE 6.7 04-Jul-2006, appcb]
</pre><p>You'll also be able to view the Store's web monitor. Open a web browser and go to: <code><a href="http://127.0.0.1:15304/">http://127.0.0.1:15304/</a></code></p>
<p>You should see the Store's web monitor page, which is a diagnostic and monitoring tool for the Store. See <a class="el" href="index.html#storewebmonitor">Store Web Monitor</a>.</p>
<p><br />
 </p>
<h2><a class="anchor" id="runningpersistentexampleapplications"></a>
Running Persistent Example Applications&nbsp;&nbsp;<small><a href="#runningpersistentexampleapplications">&lt;-</a></small></h2>
<p>With the Store running, let's try our example source and receiver applications.</p>
<ol>
<li>
Start the Receiver. <pre class="fragment">$ ume-example-rcv-3.exe
</pre> </li>
<li>
Start the Source. <pre class="fragment">$ ume-example-src-3.exe
</pre> </li>
</ol>
<p>You should see output for the source similar to the following: </p><pre class="fragment">saving RegID info to "UME-example-src-RegID" - 127.0.0.1:14567:2795623327
</pre><p>You should see output for the receiver similar to the following:</p>
<pre class="fragment">UME Store 0: 127.0.0.1:14567 [TCP:169.254.97.160:14371][2795623327] Requesting RegID: 0
saving RegID info to "UME-example-rcv-RegID" - 127.0.0.1:14567:2795623327:2795623328
Received 15 bytes on topic UME Example (sequence number 0) 'UME Message 01'
Received 15 bytes on topic UME Example (sequence number 1) 'UME Message 02'
Received 15 bytes on topic UME Example (sequence number 2) 'UME Message 03'
Received 15 bytes on topic UME Example (sequence number 3) 'UME Message 04'
...
</pre><p>The example source sends 20 messages. After the 20th messages, both the source and receiver exit and print:<code> &lt;br&gt;</code>removing saved RegID file...` <br />
So what just happened? Let's walk through the output line by line.</p>
<p><b>Source</b></p>
<pre class="fragment">saving RegID info to "UME-example-src-RegID" - 127.0.0.1:14567:2795623327
</pre><p>The source successfully registered with the Store using its pre-configured Store address and port of 127.0.0.1:14567. It didn't ask for a specific RegID from the Store, so the Store automatically assigned one to it. In this case, the Store assigned the ID, 2795623327. Your source's ID will likely be different because Stores assign random RegIDs.</p>
<p>If you run the test again, you'll notice the source application has written a file named '<code>UME-example-src-RegID</code>' that contains the same information the source printed on startup, namely the IP address and port of the Store it registered with, along with its RegID assigned by the Store.</p>
<p><b>Receiver</b></p>
<pre class="fragment">UME Store 0: 127.0.0.1:14567 [TCP:169.254.97.160:14371][2795623327] Requesting RegID: 0
saving RegID info to "UME-example-rcv-RegID" - 127.0.0.1:14567:2795623327:2795623328
</pre><p>The receiver has been informed of how to connect to the Store by the source, and it also successfully registered with the Store. The Store's IP address and port are shown, followed by the source's unique identifier string (in this case, it's a TCP source on port 14371), and the source's RegID. The receiver then requests RegID 0 from the Store, which is a special value that means pick an ID for me (Although not displayed, the source requested ID 0 when it started up as well).</p>
<p>In parallel with the source application, the receiver application writes its RegID with this Store to the file, <code>UME-example-rcv-RegID</code>.</p>
<p>After sending 20 messages under normal, stable conditions, the source and receiver applications exit and remove their RegID files.</p>
<p><br />
 </p>
<h2><a class="anchor" id="singlereceiverfailsandrecovers"></a>
Single Receiver Fails and Recovers&nbsp;&nbsp;<small><a href="#singlereceiverfailsandrecovers">&lt;-</a></small></h2>
<p>Perform the following procedure with the Store running to see what happens when a receiver fails and recovers:</p>
<ol>
<li>
<p class="startli">Start the Receiver. </p><pre class="fragment">$ ume-example-rcv-3.exe
</pre><p class="endli"></p>
</li>
<li>
<p class="startli">Start the source. Let it run for a few seconds so the receiver gets a few messages.</p>
<pre class="fragment">$ ume-example-src-3.exe
UME Store 0: 127.0.0.1:14567 [TCP:169.254.97.160:14371][3735579353] Requesting RegID: 0
saving RegID info to "UME-example-rcv-RegID" - 127.0.0.1:14567:3735579353:3735579354
Received 15 bytes on topic UME Example (sequence number 0) 'UME Message 01'
Received 15 bytes on topic UME Example (sequence number 1) 'UME Message 02'
Received 15 bytes on topic UME Example (sequence number 2) 'UME Message 03'
</pre><p class="endli"></p>
</li>
<li>
<p class="startli">Stop the receiver (Ctrl/C) and leave the source running. Wait a few more seconds so that the source sends some messages while the receiver was down.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">Restart the Receiver and let it run to completion.</p>
<pre class="fragment">$ ume-example-rcv-3.exe
read in saved RegID info from "UME-example-rcv-RegID" - 127.0.0.1:14567 RegIDs
source 3735579353, receiver 3735579354
UME Store 0: 127.0.0.1:14567 [TCP:169.254.97.160:14371][3735579353]
Requesting RegID: 3735579354
Received 15 bytes on topic UME Example (sequence number 3) 'UME Message 04'
Received 15 bytes on topic UME Example (sequence number 4) 'UME Message 05'
Received 15 bytes on topic UME Example (sequence number 5) 'UME Message 06'
Received 15 bytes on topic UME Example (sequence number 6) 'UME Message 07'
Received 15 bytes on topic UME Example (sequence number 7) 'UME Message 08'
Received 15 bytes on topic UME Example (sequence number 8) 'UME Message 09'
Received 15 bytes on topic UME Example (sequence number 9) 'UME Message 10'
Received 15 bytes on topic UME Example (sequence number 10) 'UME Message 11'
</pre><p class="endli"></p>
</li>
</ol>
<p>Notice that the receiver picked up the message stream right where it had left off - after message 3. The first few messages (which the source had sent while the receiver was down) appear to come in much faster than the source's normal rate of one per second. That's because they are being served to the receiver from the Store. The remaining messages continue to come in at the normal one-per-second rate because they're being received from the source's live message stream. This is durable subscription at work.</p>
<p><br />
 </p>
<h2><a class="anchor" id="singlesourcefailsandrecovers"></a>
Single Source Fails and Recovers&nbsp;&nbsp;<small><a href="#singlesourcefailsandrecovers">&lt;-</a></small></h2>
<p>Perform the following procedure with the Store running to see what happens when a source fails and recovers.</p>
<ol>
<li>
<p class="startli">Start the Receiver. </p><pre class="fragment">$ ume-example-rcv-3.exe
</pre><p class="endli"></p>
</li>
<li>
<p class="startli">Start the source. </p><pre class="fragment">$ ume-example-src-3.exe
</pre><p> Let it run for a few seconds so the receiver gets a few messages.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">Stop the Source (Ctrl/C).</p>
<p class="endli"></p>
</li>
<li>
Restart the Source and let it run to completion. <pre class="fragment">$ ume-example-rcv-3.exe
</pre> </li>
</ol>
<p><b>Source</b></p>
<p>You should see output similar to the following on the second run of the source:</p>
<pre class="fragment">read in saved RegID info from "UME-example-src-RegID" - 127.0.0.1:14567:2118965523
will start with message number 5
removing saved RegID file "UME-example-src-RegID"
</pre><p><b>Receiver</b></p>
<p>The receiver's output looks like the following:</p>
<pre class="fragment">UME Store 0: 127.0.0.1:14567 [TCP:169.254.97.160:14371][2118965523] Requesting RegID: 0
saving RegID info to "UME-example-rcv-RegID" - 127.0.0.1:14567:2118965523:2118965524
Received 15 bytes on topic UME Example (sequence number 0) 'UME Message 01'
Received 15 bytes on topic UME Example (sequence number 1) 'UME Message 02'
Received 15 bytes on topic UME Example (sequence number 2) 'UME Message 03'
Received 15 bytes on topic UME Example (sequence number 3) 'UME Message 04'
UME Store 0: 127.0.0.1:14567 [TCP:169.254.97.160:14371][2118965523] Requesting RegID: 2118965524
saving RegID info to "UME-example-rcv-RegID" - 127.0.0.1:14567:2118965523:2118965524
Received 15 bytes on topic UME Example (sequence number 4) 'UME Message 05'
Received 15 bytes on topic UME Example (sequence number 5) 'UME Message 06'
Received 15 bytes on topic UME Example (sequence number 6) 'UME Message 07'
Received 15 bytes on topic UME Example (sequence number 7) 'UME Message 08'
...
</pre><p>When the source was restarted, it read in its previously saved RegID and requested the same ID when registering with the Store. The Store informed the source that it had left off at sequence number 3 (UME Message 04), and the next sequence number it should send is 4 (UME Message 05). Bringing the source back up also caused the receiver to re-register with the Store. Receivers can only find out about Stores from sources they are listening to. Once the receiver re-registered with the Store, it continued receiving messages from the source where it had left off.</p>
<p><br />
 </p>
<h2><a class="anchor" id="singlestorefails"></a>
Single Store Fails&nbsp;&nbsp;<small><a href="#singlestorefails">&lt;-</a></small></h2>
<p>Perform the following procedure with the Store running to see what happens when the Store itself fails.</p>
<ol>
<li>
<p class="startli">Start the Receiver. </p><pre class="fragment">$ ume-example-rcv-3.exe
</pre><p class="endli"></p>
</li>
<li>
<p class="startli">Start the source. </p><pre class="fragment">$ ume-example-src-3.exe
</pre><p> Let it run for a few seconds so the receiver gets a few messages.</p>
<p class="endli"></p>
</li>
<li>
Stop the Store (Ctrl/C). </li>
</ol>
<p>Notice that with this simple example program, the source simply prints the following and exits.</p>
<pre class="fragment">saving RegID info to "UME-example-src-RegID" - 127.0.0.1:14567:4095035673
Store unresponsive: store 0 [127.0.0.1:14567] unresponsive
Store unresponsive: store 0 [127.0.0.1:14567] unresponsive - no registration response.
line 318: not currently registered with enough UMP stores
</pre><p>When a source application tries to send a message without being registered with a Store, the send call returns an error. Messages sent while not registered with a Store cannot be persisted. See <a class="el" href="index.html#designingpersistentstores">Designing Persistent Stores</a> for information about using multiple Stores.</p>
<p>Your source application(s) should assume an unresponsive Store is a temporary problem and wait before sending the message again. See <code>umesrc.c</code>, <code>umesrc.java</code>, or <code>umesrc.cs</code> for examples of this behavior.</p>
<p><a class="anchor" id="designingpersistenceapplications"></a><br />
 </p><hr/>
<h1><a class="anchor" id="registrationidentifiers"></a>
Registration Identifiers&nbsp;&nbsp;<small><a href="#registrationidentifiers">&lt;-</a></small></h1>
<p>As mentioned in <a class="el" href="index.html#registrationidentifierconcept">Registration Identifier Concept</a> and <a class="el" href="index.html#addingfaultrecoverywithregistrationids">Adding Fault Recovery with Registration IDs</a>, Stores use RegIDs to identify sources and receivers. UM offers three main methods for managing RegIDs:</p>
<ul>
<li>
<p class="startli"><b>Recommended</b>: use Session IDs to enable the Store to both assign and manage RegIDs. See <a class="el" href="index.html#managingregidswithsessionids">Managing RegIDs with Session IDs</a>. Note: while the use of Session IDs is recommended, an understanding of the underlying registration IDs is often helpful to understanding persistence.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">Your applications assign static RegIDs and ensure that the same RegID is not assigned to multiple sources and/or receivers. See <a class="el" href="index.html#usestaticregids">Use Static RegIDs</a>.</p>
<p class="endli"></p>
</li>
<li>
You can allow Stores to assign RegIDs and then save the assigned RegIDs for subsequent reuse. See <a class="el" href="index.html#saveassignedregids">Save Assigned RegIDs</a>. </li>
</ul>
<p>Your applications can manage RegIDs for the lifetime of a source or receiver as long as multiple applications do not reuse RegIDs simultaneously on the same Store. RegIDs only need to be unique on the same Store and may be reused between Stores as desired. You can use a static mapping of RegIDs to applications or use some simple service to assign them.</p>
<p><br />
 </p>
<h2><a class="anchor" id="usestaticregids"></a>
Use Static RegIDs&nbsp;&nbsp;<small><a href="#usestaticregids">&lt;-</a></small></h2>
<p>For very small deployments, the simplest method uses static RegIDs for individual applications. This method requires every persistent source connecting to a given Store have a unique RegID from every other persistent source attaching to the same Store. This includes publishing applications that have multiple persistent topics; each topic's source object must have a unique RegID. (The use of session IDs greatly simplifies the management of these RegIDs.)</p>
<p>The following source code examples assign a static RegID to a source by adding the RegID, 1000, to the <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umestoresource">ume_store (source)</a> LBM configuration option. See also <a href="../../example/ume-example-src-2.c">ume-example-src-2.c</a></p>
<p><b>C API</b></p>
<div class="fragment"><div class="line"><a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#a30c33f443cf2d228f4772d534ce3ee88">lbm_src_topic_attr_t</a> * sattr;</div><div class="line"></div><div class="line"><span class="keywordflow">if</span> (<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#adc12814cac6280b5bd48bfde41d7c88a">lbm_src_topic_attr_create_from_xml</a>(&amp;sattr, <span class="stringliteral">&quot;MyCtx&quot;</span>, src_topic_name) == LBM_FAILURE) {</div><div class="line">  fprintf(stderr, <span class="stringliteral">&quot;lbm_src_topic_attr_create_from_xml: %s\n&quot;</span>, <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#a22a4650d3a5b649c84a0c05adedcc055">lbm_errmsg</a>());</div><div class="line">  exit(1);</div><div class="line">}</div><div class="line"><span class="keywordflow">if</span> (<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#a422f330bf7ef3efdd7a9f17caabccb24">lbm_src_topic_attr_str_setopt</a>(sattr, <span class="stringliteral">&quot;ume_store&quot;</span>, <span class="stringliteral">&quot;127.0.0.1:14567:1000&quot;</span>)</div><div class="line">== LBM_FAILURE) {</div><div class="line">  fprintf(stderr, <span class="stringliteral">&quot;lbm_src_topic_attr_str_setopt: %s\n&quot;</span>, <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#a22a4650d3a5b649c84a0c05adedcc055">lbm_errmsg</a>());</div><div class="line">  exit(1);</div><div class="line">}</div></div><!-- fragment --><p><b>JAVA API</b></p>
<div class="fragment"><div class="line">LBMSourceAttributes sattr = null;</div><div class="line"><span class="keywordflow">try</span> {</div><div class="line">  sattr = <span class="keyword">new</span> LBMSourceAttributes();</div><div class="line">  sattr.setValue(<span class="stringliteral">&quot;ume_store&quot;</span>, <span class="stringliteral">&quot;127.0.0.1:14567:1000&quot;</span>);</div><div class="line">}</div><div class="line"><span class="keywordflow">catch</span> (LBMException ex) {</div><div class="line">  System.err.println(<span class="stringliteral">&quot;Error creating source attribute: &quot;</span> + ex.toString());</div><div class="line">  System.exit(1);</div><div class="line">}</div></div><!-- fragment --><p><b>.NET API</b></p>
<div class="fragment"><div class="line">LBMSourceAttributes sattr = null;</div><div class="line"><span class="keywordflow">try</span> {</div><div class="line">  sattr = <span class="keyword">new</span> LBMSourceAttributes();</div><div class="line">  sattr.setValue(<span class="stringliteral">&quot;ume_store&quot;</span>, <span class="stringliteral">&quot;127.0.0.1:14567:1000&quot;</span>);</div><div class="line">}</div><div class="line"><span class="keywordflow">catch</span> (LBMException ex) {</div><div class="line">  System.Console.Error.WriteLine (<span class="stringliteral">&quot;Error creating source attribute: &quot;</span> + ex.toString());</div><div class="line">  System.Environment.Exit(1);</div><div class="line">}</div></div><!-- fragment --><p><br />
 </p>
<h2><a class="anchor" id="saveassignedregids"></a>
Save Assigned RegIDs&nbsp;&nbsp;<small><a href="#saveassignedregids">&lt;-</a></small></h2>
<p>When using RegIDs, your application can request that the Store assign it a new and unique RegID when it registers for the first time. That RegID is made available to the application, which can then save it to local storage. Thus, the next time the application starts (or restarts) and wants to use the same registration, it reads the value written to local storage. This method of managing RegIDs is not common. For example, what if the application needs to be restarted on a different server due to hardware failure? If it cannot re-register with its earlier RegID, it will not be able to recover only those messages it had not yet acknowledged. (The use of Session IDs simplifies this greatly by essentially saving the registration IDs for you on the Store itself.)</p>
<p>The following minimal source code example saves the RegID assigned to a source to a file. See also <a href="../../example/ume-example-src-3.c">ume-example-src-3.c</a></p>
<p><b>C API</b></p>
<div class="fragment"><div class="line"><span class="comment">/* Callback invoked by UM for source events. */</span></div><div class="line"><span class="keywordtype">int</span> app_src_callback(<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#a717ff27bb10ae7800330c21d810dffb8">lbm_src_t</a> *src, <span class="keywordtype">int</span> event, <span class="keywordtype">void</span> *eventd, <span class="keywordtype">void</span> *clientd)</div><div class="line">{</div><div class="line">  ...</div><div class="line">  <span class="keywordflow">switch</span> (event) {</div><div class="line">  ...</div><div class="line">  <span class="keywordflow">case</span> <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#a99e39b5b7215553654f91f8b74ad98c8">LBM_SRC_EVENT_UME_REGISTRATION_SUCCESS_EX</a>:</div><div class="line">    <span class="comment">/* Get the registration information. */</span></div><div class="line">    <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__src__event__ume__registration__ex__t__stct.html">lbm_src_event_ume_registration_ex_t</a> *reginfo = (<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__src__event__ume__registration__ex__t__stct.html">lbm_src_event_ume_registration_ex_t</a> *)eventd;</div><div class="line"></div><div class="line">    <span class="comment">/* Might want to do the following conditionally only if we are requesting a new RegID. */</span></div><div class="line">    FILE *fp = fopen(<span class="stringliteral">&quot;UME-example-src-RegID&quot;</span>, <span class="stringliteral">&quot;w&quot;</span>);  <span class="comment">/* Error checking omitted for clarity. */</span></div><div class="line">    fprintf(fp, <span class="stringliteral">&quot;%s:%u&quot;</span>, reginfo-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__src__event__ume__registration__ex__t__stct.html#af5299bff3739162ccf08da2d4b33cc67">store</a>, reginfo-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__src__event__ume__registration__ex__t__stct.html#a2597610653b0c77f9d6fb60e2a04a68e">registration_id</a>);</div><div class="line">    fclose(fp);</div><div class="line">  ...</div><div class="line">  }  <span class="comment">/* switch */</span></div><div class="line">  ...</div><div class="line">}  <span class="comment">/* app_src_callback */</span></div><div class="line"></div><div class="line">...</div><div class="line"></div><div class="line">err = <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#ab8dd76271bf9df7a5f88476d431f523e">lbm_src_create</a>(&amp;src, ctx, topic, app_src_callback, ...);  <span class="comment">/* Error checking omitted. */</span></div></div><!-- fragment --><p><br />
 </p>
<h2><a class="anchor" id="managingregidswithsessionids"></a>
Managing RegIDs with Session IDs&nbsp;&nbsp;<small><a href="#managingregidswithsessionids">&lt;-</a></small></h2>
<p>The RegIDs used by Stores to identify sources and receivers must be unique. Rather than maintaining RegIDs (either statically or dynamically), applications can use a Session ID, which is simply a 64-bit value that uniquely identifies any set of sources with unique topics and receivers with unique topics. A single Session ID allows Stores to correctly identify all the sources and receivers for a particular application.</p>
<p>In practice, a Session ID is often thought of as an application identifier, although it is more accurately thought of as a context identifier. (For applications that only have a single context with persistent sources and/or receivers, the two are effectively the same.) However, be aware that many application systems run multiple instances of a given program, perhaps for horizontal scaling. Each instance needs its own Session ID.</p>
<p>It is also possible for a single context to host multiple Session IDs, although this is rarely done. The LBM configuration options <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umesessionidsource">ume_session_id (source)</a> and <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umesessionidreceiver">ume_session_id (receiver)</a> can be used to arrange individual source and/or receiver objects into registration groupings. However, it is more common to use the option <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umesessionidcontext">ume_session_id (context)</a> to group all sources and receivers created within a context into a single session ID. (If both a context and a source or receiver option is specified, the source or receiver option will override the context option.)</p>
<p><b>How Stores Associate Session IDs and RegIDs</b></p>
<p>Session IDs do not replace the use of RegIDs by UM but rather simplify RegID management. Using Session IDs equates to your application specifying a 0 (zero) RegID for all sources and receivers. However, instead of your application persisting the RegID assigned by the Store, the Store maintains the RegID for you.</p>
<p>When a Store receives a registration request from a source or receiver with a particular Session ID, it checks to see if it already has a source or receiver for that topic/Session ID. If it does, then it responds with that source's or receiver's RegID.</p>
<p>If it does not find a source or receiver for that topic/Session ID pair, the Store:</p>
<ol>
<li>
Assigns a new RegID. </li>
<li>
Associates the topic/Session ID with the new RegID. </li>
<li>
Responds to the source or receiver with the new RegID. </li>
</ol>
<p>The source can then advertise with the RegID supplied by the Store. Receivers include the source's RegID in their registration request.</p>
<p>All of the above steps happen within UM itself without any intervention by the application. However, the application does have access to the underlying registration ID, if it desires it.</p>
<p><br />
 </p><hr/>
<h1><a class="anchor" id="designingpersistentsources"></a>
Designing Persistent Sources&nbsp;&nbsp;<small><a href="#designingpersistentsources">&lt;-</a></small></h1>
<p>The major concerns of sources revolve around RegID management and message retention.</p>
<p><br />
 </p>
<h2><a class="anchor" id="neworreregistration"></a>
New or Re-Registration&nbsp;&nbsp;<small><a href="#neworreregistration">&lt;-</a></small></h2>
<p>Any source needs to know at start-up if it is a new registration or a re-registration. The answer determines how a source registers with the Store. The UM library can not answer this question. Therefore, it is essential that the developer consider what identifies the lifetime of a source and how a source determines the appropriate value to use as the RegID when it is ready to register. RegIDs are per source per topic per Store, thus a single RegID per Store is needed.</p>
<p>The following source code examples look for an existing RegID from a file and uses a new RegID assigned from the Store if it finds no existing RegID. See also <a href="../../example/ume-example-src-3.c">ume-example-src-3.c</a></p>
<p><b>C API</b></p>
<div class="fragment"><div class="line">err = <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#a8058947690bd0995bc2c59d4a61b462f">lbm_context_create</a>(&amp;ctx, NULL, NULL, NULL);</div><div class="line"><span class="keywordflow">if</span> (err) {printf(<span class="stringliteral">&quot;line %d: %s\n&quot;</span>, __LINE__, <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#a22a4650d3a5b649c84a0c05adedcc055">lbm_errmsg</a>()); exit(1);}</div><div class="line"></div><div class="line">srcinfo.message_num = 1;</div><div class="line">srcinfo.existing_regid = 0;</div><div class="line"></div><div class="line">err = read_src_regid_from_file(SRC_REGID_SAVE_FILENAME, store_info, <span class="keyword">sizeof</span>(store_info));</div><div class="line"><span class="keywordflow">if</span> (!err) { srcinfo.existing_regid = 1; }</div><div class="line"></div><div class="line">    err = <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#adc12814cac6280b5bd48bfde41d7c88a">lbm_src_topic_attr_create_from_xml</a>(&amp;attr, <span class="stringliteral">&quot;MyCtx&quot;</span>, src_topic_name);</div><div class="line">    <span class="keywordflow">if</span> (err) {printf(<span class="stringliteral">&quot;line %d: %s\n&quot;</span>, __LINE__, <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#a22a4650d3a5b649c84a0c05adedcc055">lbm_errmsg</a>()); exit(1);}</div><div class="line"></div><div class="line">    err = <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#a422f330bf7ef3efdd7a9f17caabccb24">lbm_src_topic_attr_str_setopt</a>(attr, <span class="stringliteral">&quot;ume_store&quot;</span>, store_info);</div><div class="line">    <span class="keywordflow">if</span> (err) {printf(<span class="stringliteral">&quot;line %d: %s\n&quot;</span>, __LINE__, <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#a22a4650d3a5b649c84a0c05adedcc055">lbm_errmsg</a>()); exit(1);}</div></div><!-- fragment --><p>The use of Session IDs allows UM, as opposed to your application, to accomplish the same RegID management. See <a class="el" href="index.html#managingregidswithsessionids">Managing RegIDs with Session IDs</a> Managing RegIDs with Session IDs.</p>
<p><br />
 </p>
<h2><a class="anchor" id="sourcesmustbeabletoresumesending"></a>
Sources Must Be Able to Resume Sending&nbsp;&nbsp;<small><a href="#sourcesmustbeabletoresumesending">&lt;-</a></small></h2>
<p>A source sends messages unless UM prevents it, in which case, the send function returns an error. A source may lose the ability to send messages temporarily if the Store(s) in use become unresponsive, e.g. the Store(s) die or become disconnected from the source. Once the Store(s) are responsive again, sending can continue. Thus source applications need to take into account that sending may fail temporarily under specific failure cases and be able to resume sending when the failure is removed.</p>
<p>The following source code examples demonstrate how a failed send function can sleep for a second and try again:</p>
<p><b>C API</b></p>
<div class="fragment"><div class="line"><span class="keywordflow">while</span> (<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#a91f4b9cb04fe1323ec56833211cc5cb7">lbm_src_send</a>(src, message, len, 0) == LBM_FAILURE) {</div><div class="line">    If (<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#af3a827eb26d87be5b1a6b9fd3a4b63aa">lbm_errnum</a>() == LBM_EUMENOREG) {</div><div class="line">        printf(<span class="stringliteral">&quot;Send unsuccessful. Waiting...\n&quot;</span>);</div><div class="line">        sleep(1);</div><div class="line">        <span class="keywordflow">continue</span>;</div><div class="line">    }</div><div class="line">    fprintf(stderr, <span class="stringliteral">&quot;lbm_src_send: %s\n&quot;</span>, <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#a22a4650d3a5b649c84a0c05adedcc055">lbm_errmsg</a>());</div><div class="line">    exit(1);</div><div class="line">}</div></div><!-- fragment --><p><b>Java API</b></p>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> (;;) {</div><div class="line">    <span class="keywordflow">try</span> {</div><div class="line">        src.send(message, len, 0);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">catch</span> (UMENoRegException ex) {</div><div class="line">        System.out.println(<span class="stringliteral">&quot;Send unsuccessful. Waiting...&quot;</span>);</div><div class="line">        <span class="keywordflow">try</span> {</div><div class="line">            Thread.sleep(1000);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">catch</span> (InterruptedException e) { }</div><div class="line">        <span class="keywordflow">continue</span>;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">catch</span> (LBMException ex) {</div><div class="line">        System.err.println(<span class="stringliteral">&quot;Error sending message: &quot;</span> + ex.toString());</div><div class="line">        System.exit(1);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">break</span>;</div><div class="line">}</div></div><!-- fragment --><p><b>.NET API</b></p>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> (;;) {</div><div class="line">    <span class="keywordflow">try</span> {</div><div class="line">        src.send(message, len, 0);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">catch</span> (UMENoRegException ex) {</div><div class="line">        System.Console.Out.WriteLine(<span class="stringliteral">&quot;Send unsuccessful. Waiting...&quot;</span>);</div><div class="line">        System.Threading.Thread.Sleep(1000);</div><div class="line">        <span class="keywordflow">continue</span>;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">catch</span> (LBMException ex) {</div><div class="line">        System.Console.Out.WriteLine (<span class="stringliteral">&quot;Error sending message: &quot;</span> + ex.toString());</div><div class="line">        System.exit(1);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">break</span>;</div><div class="line">}</div></div><!-- fragment --><p><br />
 </p>
<h2><a class="anchor" id="sourcemessageretentionandrelease"></a>
Source Message Retention and Release&nbsp;&nbsp;<small><a href="#sourcemessageretentionandrelease">&lt;-</a></small></h2>
<p>UM allows streaming of messages from a source without regard to message stability at a Store, which is one reason for UM's performance advantage over other persistent messaging systems. Sources retain all messages until notified by the active Store(s) that they are stable. This provides a method for Stores to be brought up to date when restarted or started anew.</p>
<p>When messages are considered stable at the Store, the source can release them which frees up source retention memory for new messages. Generally, the source releases older stable messages first. To release the oldest retained message, all the following conditions must be met:</p>
<ul>
<li>
<p class="startli">Message must meet stability requirements of the source, which can range from a single stability notice from the active Store to stability notices from a group of Stores (See <a class="el" href="index.html#sourcesusingquorumconsensusstoreconfiguration">Sources Using Quorum/Consensus Store Configuration</a>).</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">Message must have been confirmed as delivered by a configured number of receivers (<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umeretentionuniqueconfirmationssource">ume_retention_unique_confirmations (source)</a>).</p>
<p class="endli"></p>
</li>
<li>
The aggregate amount of buffered messages exceeds <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grplatejoin.html#retransmitretentionsizethresholdsource">retransmit_retention_size_threshold (source)</a> bytes in payload and headers. </li>
</ul>
<p>Some things to note:</p>
<ul>
<li>
<p class="startli">If <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grplatejoin.html#retransmitretentionsizethresholdsource">retransmit_retention_size_threshold (source)</a> is not met, no messages will be released regardless of stability.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">If the source turns off <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umemessagestabilitynotificationsource">ume_message_stability_notification (source)</a>, <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umeretentionuniqueconfirmationssource">ume_retention_unique_confirmations (source)</a> is the only way to allow the source to release messages before retention size options come into play.</p>
<p class="endli"></p>
</li>
<li>
With a quorum/consensus Store configuration, when a quorum of Stores report stability for a message, remaining Stores may or may not send additional stability acks for that message. </li>
</ul>
<dl class="section note"><dt>Note</dt><dd><a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/design.tag:../../Design/" href="../../Design/advancedoptimizations.html#smartsources">Smart Sources</a> simplify matters somewhat by pre-allocating retention buffers. They are not dynamically allocated or deallocated during operation. See <a class="el" href="index.html#smartsourcesandpersistence">Smart Sources and Persistence</a> for more information.</dd></dl>
<p><br />
 </p>
<h2><a class="anchor" id="forcedreclaims"></a>
Forced Reclaims&nbsp;&nbsp;<small><a href="#forcedreclaims">&lt;-</a></small></h2>
<p>If the aggregate amount of buffered messages exceeds <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grplatejoin.html#retransmitretentionsizelimitsource">retransmit_retention_size_limit (source)</a> bytes in payload and headers, then UM forcibly releases the oldest retained message even if it does not meet one or more of the conditions stated in Source Message Retention and Release. This condition should be avoided and Informatica suggests increasing the <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grplatejoin.html#retransmitretentionsizelimitsource">retransmit_retention_size_limit (source)</a>.</p>
<p>A second condition that produces a forced reclaim is when a message remains unstabilized when the <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umemessagestabilitylifetimesource">ume_message_stability_lifetime (source)</a> expires.</p>
<p>Whenever UM performs a Forced Reclaim, it notifies the application in the following ways:</p>
<ul>
<li>
<p class="startli">The source event callback's RECLAIMED_EX event (see <a class="el" href="index.html#persistencesourceevents">Persistence Source Events</a>) includes a "FORCED" flag on the event. (UM uses the same RECLAIMED_EX event, without the FORCED flag, for normal reclaims.)</p>
<p class="endli"></p>
</li>
<li>
Through the separate forced reclaim callback, if registered. You set this separate forced reclaim callback with the <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umeforcereclaimfunctionsource">ume_force_reclaim_function (source)</a> configuration option. </li>
</ul>
<dl class="section note"><dt>Note</dt><dd>UM retains the separate callback for backwards compatibility purposes and may be deprecated in future releases. The source event FORCED flag is the recommended method of tracking forced reclaims.</dd></dl>
<p>The following sample code, from <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/example.tag:../../example/" href="../../example/index.html#exampleumesrc_c">Example umesrc.c</a>, implements the extended reclaim source event with the 'Forced' flag set if the reclamation is a forced reclaim.</p>
<p><b>C API</b></p>
<div class="fragment"><div class="line"><span class="keywordflow">case</span> <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#a91689d8826be0160f64358ccfcff2877">LBM_SRC_EVENT_UME_MESSAGE_RECLAIMED_EX</a>:</div><div class="line">{</div><div class="line">    <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__src__event__ume__ack__ex__info__t__stct.html">lbm_src_event_ume_ack_ex_info_t</a> *ackinfo = (<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__src__event__ume__ack__ex__info__t__stct.html">lbm_src_event_ume_ack_ex_info_t</a> *)ed;</div><div class="line">    <span class="keywordflow">if</span> (opts-&gt;verbose) {</div><div class="line">        printf(<span class="stringliteral">&quot;UME message reclaimed (ex) - sequence number %x (cd %p). Flags 0x%x &quot;</span>,</div><div class="line">               ackinfo-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__src__event__ume__ack__ex__info__t__stct.html#a8b7e4d03232bb81a0629497ac7b8c2fe">sequence_number</a>, (<span class="keywordtype">char</span>*)(ackinfo-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__src__event__ume__ack__ex__info__t__stct.html#a11394d5ea9ee6a873ecf60170732c186">msg_clientd</a>) - 1, ackinfo-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__src__event__ume__ack__ex__info__t__stct.html#a207c8b76a154b24274700279bba95600">flags</a>);</div><div class="line">        <span class="keywordflow">if</span> (ackinfo-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__src__event__ume__ack__ex__info__t__stct.html#a207c8b76a154b24274700279bba95600">flags</a> &amp; LBM_SRC_EVENT_UME_MESSAGE_RECLAIMED_EX_FLAG_FORCED) {</div><div class="line">            printf(<span class="stringliteral">&quot;FORCED&quot;</span>);</div><div class="line">        }</div><div class="line">        printf(<span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line">    }</div><div class="line">}</div><div class="line"><span class="keywordflow">break</span>;</div></div><!-- fragment --><p><b>Java API</b></p>
<div class="fragment"><div class="line"><span class="keywordflow">case</span> LBM.SRC_EVENT_UME_MESSAGE_RECLAIMED_EX:</div><div class="line">    UMESourceEventAckInfo reclaiminfo = sourceEvent.ackInfo();</div><div class="line">    <span class="keywordflow">if</span> (_verbose &gt; 0) {</div><div class="line">        <span class="keywordflow">if</span> (reclaiminfo.clientObject() != null) {</div><div class="line">            System.out.print(<span class="stringliteral">&quot;UME message reclaimed (ex) - sequence number &quot;</span></div><div class="line">                               + Long.toHexString(reclaiminfo.sequenceNumber())</div><div class="line">                               + <span class="stringliteral">&quot; (cd &quot;</span></div><div class="line">                               + Long.toHexString(((Long)reclaiminfo.clientObject()).longValue())</div><div class="line">                               + <span class="stringliteral">&quot;). Flags 0x&quot;</span></div><div class="line">                               + reclaiminfo.flags());</div><div class="line">        } <span class="keywordflow">else</span> {</div><div class="line">            System.out.print(<span class="stringliteral">&quot;UME message reclaimed (ex) - sequence number &quot;</span></div><div class="line">                               + Long.toHexString(reclaiminfo.sequenceNumber())</div><div class="line">                               + <span class="stringliteral">&quot; Flags 0x&quot;</span></div><div class="line">                               + reclaiminfo.flags());</div><div class="line">        }</div><div class="line">        <span class="keywordflow">if</span> ((reclaiminfo.flags() &amp; LBM.SRC_EVENT_UME_MESSAGE_RECLAIMED_EX_FLAG_FORCED) != 0) {</div><div class="line">            System.out.print(<span class="stringliteral">&quot; FORCED&quot;</span>);</div><div class="line">        }</div><div class="line">        System.out.println();</div><div class="line">    }</div><div class="line">    <span class="keywordflow">break</span>;</div></div><!-- fragment --><p><b>.NET API</b></p>
<div class="fragment"><div class="line"><span class="keywordflow">case</span> LBM.SRC_EVENT_UME_MESSAGE_RECLAIMED_EX:</div><div class="line">    UMESourceEventAckInfo reclaiminfo = sourceEvent.ackInfo();</div><div class="line">    <span class="keywordflow">if</span> (_verbose &gt; 0) {</div><div class="line">        System.Console.Out.Write(<span class="stringliteral">&quot;UME message reclaimed (ex) - sequence number &quot;</span></div><div class="line">                                   + reclaiminfo.sequenceNumber()</div><div class="line">                                   + <span class="stringliteral">&quot; (cd &quot;</span></div><div class="line">                                   + ((uint)reclaiminfo.clientObject()).ToString(<span class="stringliteral">&quot;x&quot;</span>)</div><div class="line">                                   + <span class="stringliteral">&quot;). Flags &quot;</span></div><div class="line">                                   + reclaiminfo.flags());</div><div class="line">        <span class="keywordflow">if</span> ((reclaiminfo.flags() &amp; LBM.SRC_EVENT_UME_MESSAGE_RECLAIMED_EX_FLAG_FORCED) != 0) {</div><div class="line">            System.Console.Out.Write(<span class="stringliteral">&quot; FORCED&quot;</span>);</div><div class="line">        }</div><div class="line">        System.Console.Out.WriteLine();</div><div class="line">    }</div><div class="line">    <span class="keywordflow">break</span>;</div></div><!-- fragment --><p><br />
 </p>
<h2><a class="anchor" id="sourcereleasepolicyoptions"></a>
Source Release Policy Options&nbsp;&nbsp;<small><a href="#sourcereleasepolicyoptions">&lt;-</a></small></h2>
<p>Sources use a set of configuration options to release messages that, in effect, specify the source's release policy. The following configuration options directly impact when the source may release retained messages:</p>
<ul>
<li>
<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umemessagestabilitynotificationsource">ume_message_stability_notification (source)</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umeretentionuniqueconfirmationssource">ume_retention_unique_confirmations (source)</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grplatejoin.html#retransmitretentionsizethresholdsource">retransmit_retention_size_threshold (source)</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grplatejoin.html#retransmitretentionsizelimitsource">retransmit_retention_size_limit (source)</a> </li>
</ul>
<p><br />
 </p>
<h2><a class="anchor" id="confirmeddelivery"></a>
Confirmed Delivery&nbsp;&nbsp;<small><a href="#confirmeddelivery">&lt;-</a></small></h2>
<p>The configuration option <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umeretentionuniqueconfirmationssource">ume_retention_unique_confirmations (source)</a> requires a message to have a minimum number of unique confirmations from different receivers before the message may be released. This retains messages that have not been confirmed as being received and processed and keeps them available to fulfill any retransmission requests. This provides a form of receiver-pacing; the source will not be allowed to exceed <a class="el" href="index.html#persistenceflightsize">Persistence Flight Size</a> beyond receiving applications.</p>
<p>For example, a topic might have 2 receivers which are considered essential to keep up, and which should therefore contribute to flight size calculation. There might be any number of less-essential receivers which can be allowed to lag behind. In this case, <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umeretentionuniqueconfirmationssource">ume_retention_unique_confirmations (source)</a> would be set to 2, and the non-essential receivers would set <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umeallowconfirmeddeliveryreceiver">ume_allow_confirmed_delivery (receiver)</a> to 0.</p>
<dl class="section note"><dt>Note</dt><dd><a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/design.tag:../../Design/" href="../../Design/advancedoptimizations.html#smartsources">Smart Sources</a> do not support delivery confirmation.</dd></dl>
<p>The following code samples show how to require a message to have 10 unique receiver confirmations</p>
<p><b>C API</b></p>
<div class="fragment"><div class="line"><a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#a30c33f443cf2d228f4772d534ce3ee88">lbm_src_topic_attr_t</a> * sattr;</div><div class="line"></div><div class="line"><span class="keywordflow">if</span> (<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#adc12814cac6280b5bd48bfde41d7c88a">lbm_src_topic_attr_create_from_xml</a>(&amp;sattr, <span class="stringliteral">&quot;MyCtx&quot;</span>, src_topic_name) == LBM_FAILURE) {</div><div class="line">    fprintf(stderr, <span class="stringliteral">&quot;lbm_src_topic_attr_create_from_xml: %s\n&quot;</span>, <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#a22a4650d3a5b649c84a0c05adedcc055">lbm_errmsg</a>());</div><div class="line">    exit(1);</div><div class="line">}</div><div class="line"><span class="keywordflow">if</span> (<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#a422f330bf7ef3efdd7a9f17caabccb24">lbm_src_topic_attr_str_setopt</a>(sattr, <span class="stringliteral">&quot;ume_retention_unique_confirmations&quot;</span>,</div><div class="line">                                  <span class="stringliteral">&quot;10&quot;</span>) == LBM_FAILURE) {</div><div class="line">    fprintf(stderr, <span class="stringliteral">&quot;lbm_src_topic_attr_str_setopt: %s\n&quot;</span>, <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#a22a4650d3a5b649c84a0c05adedcc055">lbm_errmsg</a>());</div><div class="line">    exit(1);</div><div class="line">}</div></div><!-- fragment --><p><b>JAVA API</b></p>
<div class="fragment"><div class="line">LBMSourceAttributes sattr = null;</div><div class="line"><span class="keywordflow">try</span> {</div><div class="line">    sattr = <span class="keyword">new</span> LBMSourceAttributes();</div><div class="line">    sattr.setValue(<span class="stringliteral">&quot;ume_retention_unique_confirmations&quot;</span>, <span class="stringliteral">&quot;10&quot;</span>);</div><div class="line">}</div><div class="line"><span class="keywordflow">catch</span> (LBMException ex) {</div><div class="line">    System.err.println(<span class="stringliteral">&quot;Error creating source attribute: &quot;</span> + ex.toString());</div><div class="line">    System.exit(1);</div><div class="line">}</div></div><!-- fragment --><p><b>.NET API</b></p>
<div class="fragment"><div class="line">LBMSourceAttributes sattr = null;</div><div class="line"><span class="keywordflow">try</span> {</div><div class="line">    sattr = <span class="keyword">new</span> LBMSourceAttributes();</div><div class="line">    sattr.setValue(<span class="stringliteral">&quot;ume_retention_unique_confirmations&quot;</span>, <span class="stringliteral">&quot;10&quot;</span>);</div><div class="line">}</div><div class="line"><span class="keywordflow">catch</span> (LBMException ex) {</div><div class="line">    System.Console.Error.WriteLine (<span class="stringliteral">&quot;Error creating source attribute: &quot;</span> + ex.toString());</div><div class="line">    System.Environment.Exit(1);</div><div class="line">}</div></div><!-- fragment --><p><br />
 </p>
<h2><a class="anchor" id="sourceeventhandler"></a>
Source Event Handler&nbsp;&nbsp;<small><a href="#sourceeventhandler">&lt;-</a></small></h2>
<p>The Source Event Handler is a function callback initialized at source creation to provide source events to your application related to the operation of the source. The following source code examples illustrate the use of a source event handler for registration events. To accept other source events, additional case statements would be required, one for each additional source event. See also <a class="el" href="index.html#persistenceevents">Persistence Events</a>.</p>
<p><b>C API</b></p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> handle_src_event(<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#a717ff27bb10ae7800330c21d810dffb8">lbm_src_t</a> *src, <span class="keywordtype">int</span> event, <span class="keywordtype">void</span> *ed, <span class="keywordtype">void</span> *cd)</div><div class="line">{</div><div class="line">    <span class="keywordflow">switch</span> (event) {</div><div class="line">    <span class="keywordflow">case</span> <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#ab030d061f44d60babc7d9efba6769cc2">LBM_SRC_EVENT_UME_REGISTRATION_ERROR</a>:</div><div class="line">    {</div><div class="line">        <span class="keyword">const</span> <span class="keywordtype">char</span> *errstr = (<span class="keyword">const</span> <span class="keywordtype">char</span> *)ed;</div><div class="line">        printf(<span class="stringliteral">&quot;Error registering source with UME store: %s\n&quot;</span>, errstr);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#a99e39b5b7215553654f91f8b74ad98c8">LBM_SRC_EVENT_UME_REGISTRATION_SUCCESS_EX</a>:</div><div class="line">    {</div><div class="line">        <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__src__event__ume__registration__ex__t__stct.html">lbm_src_event_ume_registration_ex_t</a> *reg =</div><div class="line">            (<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__src__event__ume__registration__ex__t__stct.html">lbm_src_event_ume_registration_ex_t</a> *)ed;</div><div class="line"></div><div class="line">        printf(<span class="stringliteral">&quot;UME store %u: %s registration success. RegID %u. Flags %x &quot;</span>,</div><div class="line">               reg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__src__event__ume__registration__ex__t__stct.html#a72569bff32bf79a0e1bd5d99d3ab9e6b">store_index</a>, reg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__src__event__ume__registration__ex__t__stct.html#af5299bff3739162ccf08da2d4b33cc67">store</a>, reg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__src__event__ume__registration__ex__t__stct.html#a2597610653b0c77f9d6fb60e2a04a68e">registration_id</a>, reg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__src__event__ume__registration__ex__t__stct.html#ae9f5da93dba23287f1a3e21fe900ab37">flags</a>);</div><div class="line">        <span class="keywordflow">if</span> (reg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__src__event__ume__registration__ex__t__stct.html#ae9f5da93dba23287f1a3e21fe900ab37">flags</a> &amp; LBM_SRC_EVENT_UME_REGISTRATION_SUCCESS_EX_FLAG_OLD)</div><div class="line">            printf(<span class="stringliteral">&quot;OLD[SQN %x] &quot;</span>, reg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__src__event__ume__registration__ex__t__stct.html#ae435ea742defd8af4894b25c9db10cca">sequence_number</a>);</div><div class="line">        <span class="keywordflow">if</span> (reg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__src__event__ume__registration__ex__t__stct.html#ae9f5da93dba23287f1a3e21fe900ab37">flags</a> &amp; LBM_SRC_EVENT_UME_REGISTRATION_SUCCESS_EX_FLAG_NOACKS)</div><div class="line">            printf(<span class="stringliteral">&quot;NOACKS &quot;</span>);</div><div class="line">        printf(<span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#a1e46557c499f8e8f97bb7996a1662f26">LBM_SRC_EVENT_UME_REGISTRATION_COMPLETE_EX</a>:</div><div class="line">    {</div><div class="line">        <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__src__event__ume__registration__complete__ex__t__stct.html">lbm_src_event_ume_registration_complete_ex_t</a> *reg =</div><div class="line">            (lbm_src_event_ume__complete_ex_t *)ed;</div><div class="line">        printf(<span class="stringliteral">&quot;UME registration complete. SQN %x. Flags %x &quot;</span>,</div><div class="line">               reg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__src__event__ume__registration__complete__ex__t__stct.html#aba830cd0f91f4dbdf5d3cbcef96d397c">sequence_number</a>, reg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__src__event__ume__registration__complete__ex__t__stct.html#aee2b59249259b8ff8d301392e1e9e725">flags</a>);</div><div class="line">        <span class="keywordflow">if</span> (reg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__src__event__ume__registration__complete__ex__t__stct.html#aee2b59249259b8ff8d301392e1e9e725">flags</a> &amp; LBM_SRC_EVENT_UME_REGISTRATION_COMPLETE_EX_FLAG_QUORUM)</div><div class="line">            printf(<span class="stringliteral">&quot;QUORUM &quot;</span>);</div><div class="line">        printf(<span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#a9505bdf346c03c9751b7d1c3755d4843">LBM_SRC_EVENT_UME_STORE_UNRESPONSIVE</a>:</div><div class="line">    {</div><div class="line">        <span class="keyword">const</span> <span class="keywordtype">char</span> *infostr = (<span class="keyword">const</span> <span class="keywordtype">char</span> *)ed;</div><div class="line">        printf(<span class="stringliteral">&quot;UME store: %s\n&quot;</span>, infostr);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">default</span>:</div><div class="line">        printf(<span class="stringliteral">&quot;Unknown source event %d\n&quot;</span>, event);</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><p><b>JAVA API</b></p>
<div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keywordtype">int</span> onSourceEvent(Object arg, LBMSourceEvent sourceEvent)</div><div class="line">{</div><div class="line">    <span class="keywordflow">switch</span> (sourceEvent.type()) {</div><div class="line">    <span class="keywordflow">case</span> LBM.SRC_EVENT_UME_REGISTRATION_ERROR:</div><div class="line">        System.out.println(<span class="stringliteral">&quot;Error registering source with UME store: &quot;</span></div><div class="line">            + sourceEvent.dataString());</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> LBM.SRC_EVENT_UME_REGISTRATION_SUCCESS_EX:</div><div class="line">        UMESourceEventRegistrationSuccessInfo reg =</div><div class="line">            sourceEvent.registrationSuccessInfo();</div><div class="line">        System.out.print(<span class="stringliteral">&quot;UME store &quot;</span> + reg.storeIndex() + <span class="stringliteral">&quot;: &quot;</span> + reg.store()</div><div class="line">            + <span class="stringliteral">&quot; registration success. RegID &quot;</span> + reg.registrationId() + <span class="stringliteral">&quot;. Flags &quot;</span></div><div class="line">            + reg.flags() + <span class="stringliteral">&quot; &quot;</span>);</div><div class="line">        <span class="keywordflow">if</span> (((reg.flags() &amp; LBM.SRC_EVENT_UME_REGISTRATION_SUCCESS_EX_FLAG_OLD)) != 0) {</div><div class="line">            System.out.print(<span class="stringliteral">&quot;OLD[SQN &quot;</span> + reg.sequenceNumber() + <span class="stringliteral">&quot;] &quot;</span>);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">if</span> (((reg.flags() &amp; LBM.SRC_EVENT_UME_REGISTRATION_SUCCESS_EX_FLAG_NOACKS)) != 0) {</div><div class="line">            System.out.print(<span class="stringliteral">&quot;NOACKS &quot;</span>);</div><div class="line">        }</div><div class="line">        System.out.println();</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> LBM.SRC_EVENT_UME_REGISTRATION_COMPLETE_EX:</div><div class="line">        UMESourceEventRegistrationCompleteInfo regcomp =</div><div class="line">            sourceEvent.registrationCompleteInfo();</div><div class="line">        System.out.print(<span class="stringliteral">&quot;UME registration complete. SQN &quot;</span> + regcomp.sequenceNumber()</div><div class="line">            + <span class="stringliteral">&quot;. Flags &quot;</span> + regcomp.flags() + <span class="stringliteral">&quot; &quot;</span>);</div><div class="line">        <span class="keywordflow">if</span> ((regcomp.flags() &amp; LBM.SRC_EVENT_UME_REGISTRATION_COMPLETE_EX_FLAG_QUORUM) != 0) {</div><div class="line">            System.out.print(<span class="stringliteral">&quot;QUORUM &quot;</span>);</div><div class="line">        }</div><div class="line">        System.out.println();</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> LBM.SRC_EVENT_UME_STORE_UNRESPONSIVE:</div><div class="line">        System.out.println(<span class="stringliteral">&quot;UME store: &quot;</span> + sourceEvent.dataString());</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">    ...</div><div class="line">    <span class="keywordflow">default</span>:</div><div class="line">        System.out.println(<span class="stringliteral">&quot;Unknown source event &quot;</span> + sourceEvent.type());</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><p><b>.NET API</b></p>
<div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keywordtype">int</span> onSourceEvent(Object arg, LBMSourceEvent sourceEvent)</div><div class="line">{</div><div class="line">    <span class="keywordflow">switch</span> (sourceEvent.type()) {</div><div class="line">    <span class="keywordflow">case</span> LBM.SRC_EVENT_UME_REGISTRATION_ERROR:</div><div class="line">        System.Console.Out.WriteLine(<span class="stringliteral">&quot;Error registering source with UME store: &quot;</span></div><div class="line">            + sourceEvent.dataString());</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> LBM.SRC_EVENT_UME_REGISTRATION_SUCCESS_EX:</div><div class="line">        UMESourceEventRegistrationSuccessInfo reg = sourceEvent.registrationSuccessInfo();</div><div class="line">        System.Console.Out.Write(<span class="stringliteral">&quot;UME store &quot;</span> + reg.storeIndex() + <span class="stringliteral">&quot;: &quot;</span> + reg.store()</div><div class="line">            + <span class="stringliteral">&quot; registration success. RegID &quot;</span> + reg.registrationId() + <span class="stringliteral">&quot;. Flags &quot;</span></div><div class="line">            + reg.flags() + <span class="stringliteral">&quot; &quot;</span>);</div><div class="line">        <span class="keywordflow">if</span> (((reg.flags() &amp; LBM.SRC_EVENT_UME_REGISTRATION_SUCCESS_EX_FLAG_OLD)) != 0) {</div><div class="line">            System.Console.Out.Write(<span class="stringliteral">&quot;OLD[SQN &quot;</span> + reg.sequenceNumber() + <span class="stringliteral">&quot;] &quot;</span>);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">if</span> (((reg.flags() &amp; LBM.SRC_EVENT_UME_REGISTRATION_SUCCESS_EX_FLAG_NOACKS)) != 0) {</div><div class="line">            System.Console.Out.Write(<span class="stringliteral">&quot;NOACKS &quot;</span>);</div><div class="line">        }</div><div class="line">        System.Console.Out.WriteLine();</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> LBM.SRC_EVENT_UME_REGISTRATION_COMPLETE_EX:</div><div class="line">        UMESourceEventRegistrationCompleteInfo regcomp =</div><div class="line">            sourceEvent.registrationCompleteInfo();</div><div class="line">        System.Console.Out.Write(<span class="stringliteral">&quot;UME registration complete. SQN &quot;</span> +</div><div class="line">            regcomp.sequenceNumber() + <span class="stringliteral">&quot;. Flags &quot;</span> + regcomp.flags() + <span class="stringliteral">&quot; &quot;</span>);</div><div class="line">        <span class="keywordflow">if</span> ((regcomp.flags() &amp; LBM.SRC_EVENT_UME_REGISTRATION_COMPLETE_EX_FLAG_QUORUM) != 0) {</div><div class="line">            System.Console.Out.Write(<span class="stringliteral">&quot;QUORUM &quot;</span>);</div><div class="line">        }</div><div class="line">        System.Console.Out.WriteLine();</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> LBM.SRC_EVENT_UME_STORE_UNRESPONSIVE:</div><div class="line">        System.Console.Out.WriteLine(<span class="stringliteral">&quot;UME store: &quot;</span> + sourceEvent.dataString());</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">    ...</div><div class="line">    <span class="keywordflow">default</span>:</div><div class="line">        System.Console.Out.WriteLine(<span class="stringliteral">&quot;Unknown source event &quot;</span> + sourceEvent.type());</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><p><br />
 </p>
<h2><a class="anchor" id="sourceeventhandlerstabilityconfirmationandrelease"></a>
Source Event Handler - Stability, Confirmation and Release&nbsp;&nbsp;<small><a href="#sourceeventhandlerstabilityconfirmationandrelease">&lt;-</a></small></h2>
<p>As shown in Source Event Handler above, the Source Event Handler can be expanded to handle more source events by adding additional case statements. The following source code examples show case statements to handle message stability events, delivery confirmation events and message release (reclaim) events. See also <a class="el" href="index.html#persistenceevents">Persistence Events</a>.</p>
<p><b>C API</b></p>
<div class="fragment"><div class="line"><span class="keywordflow">case</span> <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#acf1cedd5755e63083db63f3d45e45df6">LBM_SRC_EVENT_UME_MESSAGE_STABLE_EX</a>:</div><div class="line"><span class="comment">/* requires that source ume_message_stability_notification option is enabled */</span></div><div class="line">{</div><div class="line">    <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__src__event__ume__ack__ex__info__t__stct.html">lbm_src_event_ume_ack_ex_info_t</a> *info = (<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__src__event__ume__ack__ex__info__t__stct.html">lbm_src_event_ume_ack_ex_info_t</a> *)ed;</div><div class="line"></div><div class="line">    printf(<span class="stringliteral">&quot;UME store %u: %s message stable. SQN %x (msgno %d). Flags %x &quot;</span>,</div><div class="line">        info-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__src__event__ume__ack__ex__info__t__stct.html#a0fd1ee65ec5045f559538d6d41fbb578">store_index</a>, info-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__src__event__ume__ack__ex__info__t__stct.html#a7b71e8d27bf6476e90a27d871bf77a3f">store</a>, info-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__src__event__ume__ack__ex__info__t__stct.html#a8b7e4d03232bb81a0629497ac7b8c2fe">sequence_number</a>,</div><div class="line">        (<span class="keywordtype">int</span>)info-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__src__event__ume__ack__ex__info__t__stct.html#a11394d5ea9ee6a873ecf60170732c186">msg_clientd</a> - 1, info-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__src__event__ume__ack__ex__info__t__stct.html#a207c8b76a154b24274700279bba95600">flags</a>);</div><div class="line">    <span class="keywordflow">if</span> (info-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__src__event__ume__ack__ex__info__t__stct.html#a207c8b76a154b24274700279bba95600">flags</a> &amp; LBM_SRC_EVENT_UME_MESSAGE_STABLE_EX_FLAG_INTRAGROUP_STABLE)</div><div class="line">        printf(<span class="stringliteral">&quot;IA &quot;</span>); <span class="comment">/* Stable within Store QC group */</span></div><div class="line">    <span class="keywordflow">if</span> (info-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__src__event__ume__ack__ex__info__t__stct.html#a207c8b76a154b24274700279bba95600">flags</a> &amp; LBM_SRC_EVENT_UME_MESSAGE_STABLE_EX_FLAG_INTERGROUP_STABLE)</div><div class="line">        printf(<span class="stringliteral">&quot;IR &quot;</span>); <span class="comment">/* Stable amongst all Stores */</span></div><div class="line">    <span class="keywordflow">if</span> (info-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__src__event__ume__ack__ex__info__t__stct.html#a207c8b76a154b24274700279bba95600">flags</a> &amp; LBM_SRC_EVENT_UME_MESSAGE_STABLE_EX_FLAG_STABLE)</div><div class="line">        printf(<span class="stringliteral">&quot;STABLE &quot;</span>);  <span class="comment">/* Just plain stable */</span></div><div class="line">    <span class="keywordflow">if</span> (info-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__src__event__ume__ack__ex__info__t__stct.html#a207c8b76a154b24274700279bba95600">flags</a> &amp; LBM_SRC_EVENT_UME_MESSAGE_STABLE_EX_FLAG_STORE)</div><div class="line">        printf(<span class="stringliteral">&quot;STORE &quot;</span>);   <span class="comment">/* Stability reported by UME Store */</span></div><div class="line">    printf(<span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line">}</div><div class="line"><span class="keywordflow">break</span>;</div><div class="line"></div><div class="line"><span class="keywordflow">case</span> <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#ae7124621f7cab5925ed8354690d736f9">LBM_SRC_EVENT_UME_DELIVERY_CONFIRMATION_EX</a>:</div><div class="line"><span class="comment">/* requires that source ume_confirmed_delivery_notification option is enabled */</span></div><div class="line">{</div><div class="line">    <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__src__event__ume__ack__ex__info__t__stct.html">lbm_src_event_ume_ack_ex_info_t</a> *info = (<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__src__event__ume__ack__ex__info__t__stct.html">lbm_src_event_ume_ack_ex_info_t</a> *)ed;</div><div class="line"></div><div class="line">    printf(<span class="stringliteral">&quot;UME delivery confirmation. SQN %x, Receiver RegID %u (msgno %d). Flags %x &quot;</span>,</div><div class="line">        info-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__src__event__ume__ack__ex__info__t__stct.html#a8b7e4d03232bb81a0629497ac7b8c2fe">sequence_number</a>, info-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__src__event__ume__ack__ex__info__t__stct.html#ab19378eb60d2b6e20bb5187bbb64fcd3">rcv_registration_id</a>,</div><div class="line">        (<span class="keywordtype">int</span>)info-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__src__event__ume__ack__ex__info__t__stct.html#a11394d5ea9ee6a873ecf60170732c186">msg_clientd</a> - 1, info-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__src__event__ume__ack__ex__info__t__stct.html#a207c8b76a154b24274700279bba95600">flags</a>);</div><div class="line">    <span class="keywordflow">if</span> (info-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__src__event__ume__ack__ex__info__t__stct.html#a207c8b76a154b24274700279bba95600">flags</a> &amp; LBM_SRC_EVENT_UME_DELIVERY_CONFIRMATION_EX_FLAG_UNIQUEACKS)</div><div class="line">        printf(<span class="stringliteral">&quot;UNIQUEACKS &quot;</span>); <span class="comment">/* Satisfied number of unique ACKs requirement */</span></div><div class="line">    <span class="keywordflow">if</span> (info-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__src__event__ume__ack__ex__info__t__stct.html#a207c8b76a154b24274700279bba95600">flags</a> &amp; LBM_SRC_EVENT_UME_DELIVERY_CONFIRMATION_EX_FLAG_UREGID)</div><div class="line">        printf(<span class="stringliteral">&quot;UREGID &quot;</span>); <span class="comment">/* Confirmation contains receiver application registration ID */</span></div><div class="line">    <span class="keywordflow">if</span> (info-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__src__event__ume__ack__ex__info__t__stct.html#a207c8b76a154b24274700279bba95600">flags</a> &amp; LBM_SRC_EVENT_UME_DELIVERY_CONFIRMATION_EX_FLAG_OOD)</div><div class="line">        printf(<span class="stringliteral">&quot;OOD &quot;</span>); <span class="comment">/* Confirmation received from arrival order receiver */</span></div><div class="line">    <span class="keywordflow">if</span> (info-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__src__event__ume__ack__ex__info__t__stct.html#a207c8b76a154b24274700279bba95600">flags</a> &amp; LBM_SRC_EVENT_UME_DELIVERY_CONFIRMATION_EX_FLAG_EXACK)</div><div class="line">        printf(<span class="stringliteral">&quot;EXACK &quot;</span>); <span class="comment">/* Confirmation explicitly sent by receiver */</span></div><div class="line">    printf(<span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line">}</div><div class="line"><span class="keywordflow">break</span>;</div><div class="line"></div><div class="line"><span class="keywordflow">case</span> <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#ad1821a408b0feaf8c28893ee79816dab">LBM_SRC_EVENT_UME_MESSAGE_RECLAIMED</a>:</div><div class="line"><span class="comment">/* requires that source ume_confirmed_delivery_notification or ume_message_stability_notification</span></div><div class="line"><span class="comment">attributes are enabled */</span></div><div class="line">{</div><div class="line">    <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__src__event__ume__ack__info__t__stct.html">lbm_src_event_ume_ack_info_t</a> *ackinfo = (<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__src__event__ume__ack__info__t__stct.html">lbm_src_event_ume_ack_info_t</a> *)ed;</div><div class="line"></div><div class="line">    printf(<span class="stringliteral">&quot;UME message released - sequence number %x (msgno %d)\n&quot;</span>,</div><div class="line">        ackinfo-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__src__event__ume__ack__info__t__stct.html#ac9a622d66a1542222ff6650fdbc075e7">sequence_number</a>, (<span class="keywordtype">int</span>)ackinfo-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__src__event__ume__ack__info__t__stct.html#a6feec78d574fac16931d5a9c26aa59a8">msg_clientd</a> - 1);</div><div class="line">}</div><div class="line"><span class="keywordflow">break</span>;</div></div><!-- fragment --><p><b>JAVA API</b></p>
<div class="fragment"><div class="line"><span class="keywordflow">case</span> LBM.SRC_EVENT_UME_MESSAGE_STABLE_EX:</div><div class="line">    <span class="comment">// requires that source ume_message_stability_notification option is enabled</span></div><div class="line">    UMESourceEventAckInfo staInfo = sourceEvent.ackInfo();</div><div class="line">    System.out.print(<span class="stringliteral">&quot;UME store &quot;</span> + staInfo.storeIndex() + <span class="stringliteral">&quot;: &quot;</span></div><div class="line">                    + staInfo.store() + <span class="stringliteral">&quot; message stable. SQN &quot;</span> + staInfo.sequenceNumber()</div><div class="line">                    + <span class="stringliteral">&quot; (msgno &quot;</span> + staInfo.clientObject() + <span class="stringliteral">&quot;). Flags &quot;</span></div><div class="line">                    + staInfo.flags() + <span class="stringliteral">&quot; &quot;</span>);</div><div class="line">    <span class="keywordflow">if</span> ((staInfo.flags() &amp; LBM.SRC_EVENT_UME_MESSAGE_STABLE_EX_FLAG_INTRAGROUP_STABLE) != 0) {</div><div class="line">        System.out.print(<span class="stringliteral">&quot;IA &quot;</span>); <span class="comment">// Stable within Store QC group</span></div><div class="line">    }</div><div class="line">    <span class="keywordflow">if</span> ((staInfo.flags() &amp; LBM.SRC_EVENT_UME_MESSAGE_STABLE_EX_FLAG_INTERGROUP_STABLE) != 0) {</div><div class="line">        System.out.print(<span class="stringliteral">&quot;IR &quot;</span>);  <span class="comment">// Stable amongst all Stores</span></div><div class="line">    }</div><div class="line">    <span class="keywordflow">if</span> ((staInfo.flags() &amp; LBM.SRC_EVENT_UME_MESSAGE_STABLE_EX_FLAG_STABLE) != 0) {</div><div class="line">        System.out.print(<span class="stringliteral">&quot;STABLE &quot;</span>);  <span class="comment">// Just plain stable</span></div><div class="line">    }</div><div class="line">    <span class="keywordflow">if</span> ((staInfo.flags() &amp; LBM.SRC_EVENT_UME_MESSAGE_STABLE_EX_FLAG_STORE) != 0) {</div><div class="line">        System.out.print(<span class="stringliteral">&quot;STORE &quot;</span>);   <span class="comment">// Stability reported by UME Store</span></div><div class="line">    }</div><div class="line">    System.out.println();</div><div class="line">    <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line"><span class="keywordflow">case</span> LBM.SRC_EVENT_UME_DELIVERY_CONFIRMATION_EX:</div><div class="line">    <span class="comment">// requires that source ume_confirmed_delivery_notification option is enabled</span></div><div class="line">    UMESourceEventAckInfo cdelvinfo = sourceEvent.ackInfo();</div><div class="line">    System.out.print(<span class="stringliteral">&quot;UME delivery confirmation. SQN &quot;</span> + cdelvinfo.sequenceNumber()</div><div class="line">                    + <span class="stringliteral">&quot;, RcvRegID &quot;</span> + cdelvinfo.receiverRegistrationId() + <span class="stringliteral">&quot; (msgno &quot;</span></div><div class="line">                    + cdelvinfo.clientObject() + <span class="stringliteral">&quot;). Flags &quot;</span> + cdelvinfo.flags() + <span class="stringliteral">&quot; &quot;</span>);</div><div class="line">    <span class="keywordflow">if</span> ((cdelvinfo.flags() &amp; LBM.SRC_EVENT_UME_DELIVERY_CONFIRMATION_EX_FLAG_UNIQUEACKS) != 0) {</div><div class="line">        System.out.print(<span class="stringliteral">&quot;UNIQUEACKS &quot;</span>); <span class="comment">// Satisfied number of unique ACKs requirement</span></div><div class="line">    }</div><div class="line">    <span class="keywordflow">if</span> ((cdelvinfo.flags() &amp; LBM.SRC_EVENT_UME_DELIVERY_CONFIRMATION_EX_FLAG_UREGID) != 0) {</div><div class="line">        System.out.print(<span class="stringliteral">&quot;UREGID &quot;</span>);    <span class="comment">// Confirmation contains receiver application reg ID</span></div><div class="line">    }</div><div class="line">    <span class="keywordflow">if</span> ((cdelvinfo.flags() &amp; LBM.SRC_EVENT_UME_DELIVERY_CONFIRMATION_EX_FLAG_OOD) != 0) {</div><div class="line">        System.out.print(<span class="stringliteral">&quot;OOD &quot;</span>);      <span class="comment">// Confirmation received from arrival order receiver</span></div><div class="line">    }</div><div class="line">    <span class="keywordflow">if</span> ((cdelvinfo.flags() &amp; LBM.SRC_EVENT_UME_DELIVERY_CONFIRMATION_EX_FLAG_EXACK) != 0) {</div><div class="line">        System.out.print(<span class="stringliteral">&quot;EXACK &quot;</span>);    <span class="comment">// Confirmation explicitly sent by receiver</span></div><div class="line">    }</div><div class="line">    System.out.println();</div><div class="line">    <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line"><span class="keywordflow">case</span> LBM.SRC_EVENT_UME_MESSAGE_RECLAIMED:</div><div class="line">    <span class="comment">// requires that source ume_confirmed_delivery_notification or</span></div><div class="line">    <span class="comment">// ume_message_stability_notification attributes are enabled</span></div><div class="line">    System.out.println(<span class="stringliteral">&quot;UME message released - sequence number &quot;</span></div><div class="line">                + Long.toHexString(sourceEvent.sequenceNumber())</div><div class="line">                + <span class="stringliteral">&quot; (msgno &quot;</span></div><div class="line">                + Long.toHexString(((Integer)sourceEvent.clientObject()).longValue())</div><div class="line">                + <span class="stringliteral">&quot;)&quot;</span>);</div><div class="line">    <span class="keywordflow">break</span>;</div></div><!-- fragment --><p><b>.NET API</b></p>
<div class="fragment"><div class="line"><span class="keywordflow">case</span> LBM.SRC_EVENT_UME_MESSAGE_STABLE_EX:</div><div class="line">    <span class="comment">// requires that source ume_message_stability_notification option is enabled</span></div><div class="line">    UMESourceEventAckInfo staInfo = sourceEvent.ackInfo();</div><div class="line">    System.Console.Out.Write(<span class="stringliteral">&quot;UME store &quot;</span> + staInfo.storeIndex() + <span class="stringliteral">&quot;: &quot;</span></div><div class="line">                        + staInfo.store() + <span class="stringliteral">&quot; message stable. SQN &quot;</span> + staInfo.sequenceNumber()</div><div class="line">                        + <span class="stringliteral">&quot; (msgno &quot;</span> + ((int)staInfo.clientObject()).ToString(<span class="stringliteral">&quot;x&quot;</span>) + <span class="stringliteral">&quot;).</span></div><div class="line"><span class="stringliteral">                        Flags &quot;</span> + staInfo.flags() + <span class="stringliteral">&quot; &quot;</span>);</div><div class="line">    <span class="keywordflow">if</span> ((staInfo.flags() &amp; LBM.SRC_EVENT_UME_MESSAGE_STABLE_EX_FLAG_INTRAGROUP_STABLE) != 0) {</div><div class="line">        System.Console.Out.Write(<span class="stringliteral">&quot;IA &quot;</span>);  <span class="comment">// Stable within Store QC group</span></div><div class="line">    }</div><div class="line">    <span class="keywordflow">if</span> ((staInfo.flags() &amp; LBM.SRC_EVENT_UME_MESSAGE_STABLE_EX_FLAG_INTERGROUP_STABLE) != 0) {</div><div class="line">        System.Console.Out.Write(<span class="stringliteral">&quot;IR &quot;</span>);  <span class="comment">// Stable amongst all Stores</span></div><div class="line">    }</div><div class="line">    <span class="keywordflow">if</span> ((staInfo.flags() &amp; LBM.SRC_EVENT_UME_MESSAGE_STABLE_EX_FLAG_STABLE) != 0) {</div><div class="line">        System.Console.Out.Write(<span class="stringliteral">&quot;STABLE &quot;</span>);  <span class="comment">// Just plain stable</span></div><div class="line">    }</div><div class="line">    <span class="keywordflow">if</span> ((staInfo.flags() &amp; LBM.SRC_EVENT_UME_MESSAGE_STABLE_EX_FLAG_STORE) != 0) {</div><div class="line">        System.Console.Out.Write(<span class="stringliteral">&quot;STORE &quot;</span>);  <span class="comment">// Stability reported by UME Store</span></div><div class="line">    }</div><div class="line">    System.Console.Out.WriteLine();</div><div class="line">    <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line"><span class="keywordflow">case</span> LBM.SRC_EVENT_UME_DELIVERY_CONFIRMATION_EX:</div><div class="line">    <span class="comment">// requires that source ume_confirmed_delivery_notification option is enabled</span></div><div class="line"></div><div class="line">    UMESourceEventAckInfo cdelvinfo = sourceEvent.ackInfo();</div><div class="line"></div><div class="line">    System.Console.Out.Write(<span class="stringliteral">&quot;UME delivery confirmation. SQN &quot;</span> +</div><div class="line">    cdelvinfo.sequenceNumber()</div><div class="line">                        + <span class="stringliteral">&quot;, RcvRegID &quot;</span> + cdelvinfo.receiverRegistrationId() + <span class="stringliteral">&quot; (msgno &quot;</span></div><div class="line">                        + ((int)cdelvinfo.clientObject()).ToString(<span class="stringliteral">&quot;x&quot;</span>) + <span class="stringliteral">&quot;). Flags &quot;</span> +</div><div class="line">                        cdelvinfo.flags() + <span class="stringliteral">&quot; &quot;</span>);</div><div class="line">    <span class="keywordflow">if</span> ((cdelvinfo.flags() &amp; LBM.SRC_EVENT_UME_DELIVERY_CONFIRMATION_EX_FLAG_UNIQUEACKS) != 0) {</div><div class="line">        System.Console.Out.Write(<span class="stringliteral">&quot;UNIQUEACKS &quot;</span>);  <span class="comment">// Satisfied number of unique ACKs requirement</span></div><div class="line">    }</div><div class="line">    <span class="keywordflow">if</span> ((cdelvinfo.flags() &amp; LBM.SRC_EVENT_UME_DELIVERY_CONFIRMATION_EX_FLAG_UREGID) != 0) {</div><div class="line">        System.Console.Out.Write(<span class="stringliteral">&quot;UREGID &quot;</span>);  <span class="comment">// Confirmation contains receiver application reg ID</span></div><div class="line">    }</div><div class="line">    <span class="keywordflow">if</span> ((cdelvinfo.flags() &amp; LBM.SRC_EVENT_UME_DELIVERY_CONFIRMATION_EX_FLAG_OOD) != 0) {</div><div class="line">        System.Console.Out.Write(<span class="stringliteral">&quot;OOD &quot;</span>);  <span class="comment">// Confirmation received from arrival order receiver</span></div><div class="line">    }</div><div class="line">    <span class="keywordflow">if</span> ((cdelvinfo.flags() &amp; LBM.SRC_EVENT_UME_DELIVERY_CONFIRMATION_EX_FLAG_EXACK) != 0) {</div><div class="line">        System.Console.Out.Write(<span class="stringliteral">&quot;EXACK &quot;</span>);  <span class="comment">// Confirmation explicitly sent by receiver</span></div><div class="line">    }</div><div class="line">    System.Console.Out.WriteLine();</div><div class="line">    <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line"><span class="keywordflow">case</span> LBM.SRC_EVENT_UME_MESSAGE_RECLAIMED:</div><div class="line">    <span class="comment">// requires that source ume_confirmed_delivery_notification or</span></div><div class="line">    <span class="comment">// ume_message_stability_notification attributes are enabled</span></div><div class="line"></div><div class="line">    System.Console.Out.WriteLine(<span class="stringliteral">&quot;UME message released - sequence number &quot;</span></div><div class="line">                               + sourceEvent.sequenceNumber().ToString(<span class="stringliteral">&quot;x&quot;</span>)</div><div class="line">                               + <span class="stringliteral">&quot; (msgno &quot;</span></div><div class="line">                               + ((int)sourceEvent.clientObject()).ToString(<span class="stringliteral">&quot;x&quot;</span>)</div><div class="line">                               + <span class="stringliteral">&quot;)&quot;</span>);</div><div class="line">    <span class="keywordflow">break</span>;</div></div><!-- fragment --><p><br />
 </p>
<h2><a class="anchor" id="mappingyourmessagenumberstosequencenumbers"></a>
Mapping Your Message Numbers to Sequence Numbers&nbsp;&nbsp;<small><a href="#mappingyourmessagenumberstosequencenumbers">&lt;-</a></small></h2>
<p>The C API function <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#a4d883eaaa22baf81abf21d495f471c8b">lbm_src_sendv_ex()</a> allows you to create a pointer to an object or structure. This pointer will be returned to your application along with all source events. You can then update the object or structure with source event information. For example, if your messages exceed 8K - which requires fragmentation your application's message into more than one UM message - receiving sequence number events with this pointer allows you to determine all the UM sequence numbers for the message and, therefore, how many release (reclaim) events to expect. The following two source code examples show how to:</p>
<ul>
<li>
Enable message sequence number information. </li>
<li>
Handle sequence number source events to determine the application message number in the Source Event Handler. </li>
</ul>
<p><b>C API - Enable Message Information</b></p>
<div class="fragment"><div class="line"><a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__src__send__ex__info__t__stct.html">lbm_src_send_ex_info_t</a> exinfo;</div><div class="line"></div><div class="line"><span class="comment">/* Enable message sequence number info to be returned */</span></div><div class="line">exinfo.<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__src__send__ex__info__t__stct.html#aa450a079510ebdc97b19625d10bd18ea">flags</a> = <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#a781e689ed6e1178938dc0b2e2bfabc06">LBM_SRC_SEND_EX_FLAG_UME_CLIENTD</a> | <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#ab99586b3f3b469aa6f2e2da632fa5be0">LBM_SRC_SEND_EX_FLAG_SEQUENCE_NUMBER_INFO</a>;</div><div class="line">exinfo.<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__src__send__ex__info__t__stct.html#afeb9643e8ca421be3c85d2c1c32fe556">ume_msg_clientd</a> = (<span class="keywordtype">void</span> *)(msgno + 1);</div><div class="line"><span class="comment">/* msgno set to application message number (can&#39;t evaluate to NULL) */</span></div><div class="line"><span class="keywordflow">while</span> (<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#a091b5806bf18d10ebd0d9117e0c70229">lbm_src_send_ex</a>(src, message, msglen, 0, &amp;exinfo) == <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#a06fc87d81c62e9abb8790b6e5713c55baf90fd7c1c303f82795102f289988877a">LBM_FAILURE</a>) {</div><div class="line">    <span class="keywordflow">if</span> (<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#af3a827eb26d87be5b1a6b9fd3a4b63aa">lbm_errnum</a>() == <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#a2ef169e3b343481d569a88755f22bd59">LBM_EUMENOREG</a>) {</div><div class="line">        printf(<span class="stringliteral">&quot;Send unsuccessful. Waiting...\n&quot;</span>);</div><div class="line">                SLEEP_MSEC(1000);    <span class="comment">/* Sleep for 1 second */</span></div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span> {</div><div class="line">         fprintf(stderr, <span class="stringliteral">&quot;lbm_src_send: %s\n&quot;</span>, <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#a22a4650d3a5b649c84a0c05adedcc055">lbm_errmsg</a>());</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><p><b>C API - Sequence Number Event Handler</b></p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> handle_src_event(<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#a717ff27bb10ae7800330c21d810dffb8">lbm_src_t</a> *src, <span class="keywordtype">int</span> event, <span class="keywordtype">void</span> *ed, <span class="keywordtype">void</span> *cd)</div><div class="line">{</div><div class="line">    <span class="keywordflow">switch</span> (event) {</div><div class="line">    <span class="keywordflow">case</span> <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#a350c2cab7f6f029276ebc323b7d73795">LBM_SRC_EVENT_SEQUENCE_NUMBER_INFO</a>:</div><div class="line">        {</div><div class="line">            <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__src__event__sequence__number__info__t__stct.html">lbm_src_event_sequence_number_info_t</a> *info =</div><div class="line">                (<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__src__event__sequence__number__info__t__stct.html">lbm_src_event_sequence_number_info_t</a> *)ed;</div><div class="line"></div><div class="line">            <span class="keywordflow">if</span> (info-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__src__event__sequence__number__info__t__stct.html#a99f1af068bde67ecfc7bafcef99d11c9">first_sequence_number</a> != info-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__src__event__sequence__number__info__t__stct.html#a1746ec03d7a7034da58b63bc3d3b6ef2">last_sequence_number</a>) {</div><div class="line">                printf(<span class="stringliteral">&quot;SQN [%x,%x] (msgno %d)\n&quot;</span>, info-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__src__event__sequence__number__info__t__stct.html#a99f1af068bde67ecfc7bafcef99d11c9">first_sequence_number</a>,</div><div class="line">                        info-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__src__event__sequence__number__info__t__stct.html#a1746ec03d7a7034da58b63bc3d3b6ef2">last_sequence_number</a>, (<span class="keywordtype">int</span>)info-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__src__event__sequence__number__info__t__stct.html#a83b9b4f89f90021d3dfdb9f08639076d">msg_clientd</a> - 1);</div><div class="line">            }</div><div class="line">            <span class="keywordflow">else</span> {</div><div class="line">                printf(<span class="stringliteral">&quot;SQN %x (msgno %d)\n&quot;</span>, info-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__src__event__sequence__number__info__t__stct.html#a1746ec03d7a7034da58b63bc3d3b6ef2">last_sequence_number</a>,</div><div class="line">                        (<span class="keywordtype">int</span>)info-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__src__event__sequence__number__info__t__stct.html#a83b9b4f89f90021d3dfdb9f08639076d">msg_clientd</a> - 1);</div><div class="line">            }</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">    ...</div><div class="line">    }</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><p><b>JAVA API - Enable Message Information</b></p>
<div class="fragment"><div class="line">LBMSourceSendExInfo exinfo = <span class="keyword">new</span> LBMSourceSendExInfo();</div><div class="line">exinfo.setClientObject(<span class="keyword">new</span> Integer(msgno));  <span class="comment">// msgno set to application message number</span></div><div class="line">exinfo.setFlags(LBM.SRC_SEND_EX_FLAG_SEQUENCE_NUMBER_INFO);</div><div class="line"><span class="comment">// Enable message sequence number info to be returned</span></div><div class="line"><span class="keywordflow">for</span> (;;)</div><div class="line">{</div><div class="line">    <span class="keywordflow">try</span> {</div><div class="line">        src.send(message, msglen, 0, exinfo);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">catch</span>(UMENoRegException ex) {</div><div class="line">        <span class="keywordflow">try</span> {</div><div class="line">            Thread.sleep(1000);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">catch</span> (InterruptedException e) { }</div><div class="line">        <span class="keywordflow">continue</span>;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">catch</span> (LBMException ex) {</div><div class="line">        System.err.println(<span class="stringliteral">&quot;Error sending message: &quot;</span> + ex.toString());</div><div class="line">    }</div><div class="line">    <span class="keywordflow">break</span>;</div><div class="line">}</div></div><!-- fragment --><p><b>JAVA API - Sequence Number Event Handler</b></p>
<div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keywordtype">int</span> onSourceEvent(Object arg, LBMSourceEvent sourceEvent)</div><div class="line">{</div><div class="line">    <span class="keywordflow">switch</span> (sourceEvent.type())</div><div class="line">    {</div><div class="line">    <span class="keywordflow">case</span> LBM.SRC_EVENT_SEQUENCE_NUMBER_INFO:</div><div class="line">        LBMSourceEventSequenceNumberInfo info = sourceEvent.sequenceNumberInfo();</div><div class="line">        <span class="keywordflow">if</span> (info.firstSequenceNumber() != info.lastSequenceNumber()) {</div><div class="line">            System.out.println(<span class="stringliteral">&quot;SQN [&quot;</span> + info.firstSequenceNumber()</div><div class="line">                            + <span class="stringliteral">&quot;,&quot;</span> + info.lastSequenceNumber() + <span class="stringliteral">&quot;] (msgno &quot;</span></div><div class="line">                            + info.clientObject() + <span class="stringliteral">&quot;)&quot;</span>);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">else</span> {</div><div class="line">            System.out.println(<span class="stringliteral">&quot;SQN &quot;</span> + info.lastSequenceNumber()</div><div class="line">                            + <span class="stringliteral">&quot; (msgno &quot;</span> + info.clientObject() + <span class="stringliteral">&quot;)&quot;</span>);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">    ...</div><div class="line">    }</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><p><b>.NET API - Enable Message Information</b></p>
<div class="fragment"><div class="line">LBMSourceSendExInfo exinfo = <span class="keyword">new</span> LBMSourceSendExInfo();</div><div class="line">exinfo.setClientObject(msgno);  <span class="comment">// msgno set to application message number</span></div><div class="line">exinfo.setFlags(LBM.SRC_SEND_EX_FLAG_SEQUENCE_NUMBER_INFO);</div><div class="line"><span class="comment">// Enable message sequence number info to be returned</span></div><div class="line"><span class="keywordflow">for</span> (;;)</div><div class="line">{</div><div class="line">    <span class="keywordflow">try</span> {</div><div class="line">        src.send(message, msglen, 0, exinfo);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">catch</span>(UMENoRegException ex) {</div><div class="line">        System.Threading.Thread.Sleep(100);</div><div class="line">        <span class="keywordflow">continue</span>;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">catch</span> (LBMException ex) {</div><div class="line">        System.Console.Out.WriteLine(<span class="stringliteral">&quot;Error sending message: &quot;</span> + ex.Message());</div><div class="line">    }</div><div class="line">    <span class="keywordflow">break</span>;</div><div class="line">}</div></div><!-- fragment --><p><b>.NET API - Sequence Number Event Handler</b></p>
<div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keywordtype">void</span> onSourceEvent(Object arg, LBMSourceEvent sourceEvent)</div><div class="line">{</div><div class="line">    <span class="keywordflow">switch</span> (sourceEvent.type())</div><div class="line">    {</div><div class="line">    <span class="keywordflow">case</span> LBM.SRC_EVENT_SEQUENCE_NUMBER_INFO:</div><div class="line">        LBMSourceEventSequenceNumberInfo info = sourceEvent.sequenceNumberInfo();</div><div class="line">        <span class="keywordflow">if</span> (info.firstSequenceNumber() != info.lastSequenceNumber()) {</div><div class="line">            System.Console.Out.WriteLine(<span class="stringliteral">&quot;SQN [&quot;</span> + info.firstSequenceNumber()</div><div class="line">                              + <span class="stringliteral">&quot;,&quot;</span> + info.lastSequenceNumber() + <span class="stringliteral">&quot;] (cd &quot;</span></div><div class="line">                              + ((int)info.clientObject()).ToString(<span class="stringliteral">&quot;x&quot;</span>) + <span class="stringliteral">&quot;)&quot;</span>);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">else</span> {</div><div class="line">            System.Console.Out.WriteLine(<span class="stringliteral">&quot;SQN &quot;</span> + info.lastSequenceNumber()</div><div class="line">                + <span class="stringliteral">&quot; (msgno &quot;</span> + ((int)info.clientObject()).ToString(<span class="stringliteral">&quot;x&quot;</span>) + <span class="stringliteral">&quot;)&quot;</span>);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">    ...</div><div class="line"></div><div class="line">    }</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><p><br />
 </p>
<h2><a class="anchor" id="receiverlivenessdetection"></a>
Receiver Liveness Detection&nbsp;&nbsp;<small><a href="#receiverlivenessdetection">&lt;-</a></small></h2>
<p>As an extension to Confirmed Delivery, you can set receivers to send a keepalive to a source during a measured absence of delivery confirmations (due to traffic lapse). In the event that neither message reaches the source within a designated interval, or if the delivery confirmation TCP connection breaks down, the receiver is assumed to have "died". UM then notifies the publishing application via context event callback. This lets the publisher assign a new subscriber.</p>
<p>To use this feature, set these five configuration options: </p><ul>
<li>
<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umesourcelivenesstimeoutcontext">ume_source_liveness_timeout (context)</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umereceiverlivenessintervalcontext">ume_receiver_liveness_interval (context)</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umeconfirmeddeliverynotificationsource">ume_confirmed_delivery_notification (source)</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umeuserreceiverregistrationidcontext">ume_user_receiver_registration_id (context)</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umesessionidcontext">ume_session_id (context)</a>, <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umesessionidsource">ume_session_id (source)</a>, <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umesessionidreceiver">ume_session_id (receiver)</a> </li>
</ul>
<dl class="section note"><dt>Note</dt><dd><a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/design.tag:../../Design/" href="../../Design/advancedoptimizations.html#smartsources">Smart Sources</a> do not support liveness detection.</dd></dl>
<p>This specialized feature is not recommended for general use. If you are considering it, please note the following caveats: </p><ul>
<li>
Do not use in conjunction with a <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/design.tag:../../Design/" href="../../Design/fundamentalconcepts.html#umrouter">DRO</a>. </li>
<li>
There is a variety of potential network occurrences that can break or reset the TCP connection and falsely indicate the death of a receiver. </li>
<li>
In cases where a receiver object is deleted while its context is not, the publisher may still falsely assume the receiver to be alive. </li>
</ul>
<p>Other false receiver-alive assumptions could be caused by the following: </p><ul>
<li>
TCP connections can enter a half-open or otherwise corrupted state. </li>
<li>
Failed TCP connections sometimes do not fully close, or experience objectionable delays before fully closing. </li>
<li>
A switch or router failure along the path does not affect the TCP connection state. </li>
</ul>
<p><br />
 </p><hr/>
<h1><a class="anchor" id="designingpersistentreceivers"></a>
Designing Persistent Receivers&nbsp;&nbsp;<small><a href="#designingpersistentreceivers">&lt;-</a></small></h1>
<p>Receivers are predominantly interested in RegID management and recovery management.</p>
<p><br />
 </p>
<h2><a class="anchor" id="receiverregidmanagement"></a>
Receiver RegID Management&nbsp;&nbsp;<small><a href="#receiverregidmanagement">&lt;-</a></small></h2>
<p>RegIDs are slightly more involved for receivers than for sources. Since RegIDs are per source per topic per Store and a topic may have several sources, a receiver may have to manage several RegIDs per Store in use. Fortunately, receivers in UM can leverage the RegID of the source with the use of a callback as discussed in Adding Fault Recovery with Registration IDs and shown in ume-example-rcv-2.c. Your application can determine the correct RegID to use and return it to UM. You can also use Session IDs to enable UM to manage receiver RegIDs. See <a class="el" href="index.html#managingregidswithsessionids">Managing RegIDs with Session IDs</a>.</p>
<p>Much like sources, receivers typically have a lifetime based on an amount of work, perhaps an infinite amount. And just like sources, it may be helpful to consider that a RegID is "assigned" at the start of that work and is out of use at the end. In between, the RegID is in use by the instance of the receiver application. However, the nature of RegIDs being per source means that the expected lifetime of a source should play a role in how RegIDs on the receiver are managed. Thus, it may be helpful for the application developer to consider the source application lifetime when deciding how best to handle RegIDs on the receiver.</p>
<p><b>Receiver Message and Event Handler</b></p>
<p>The Receiver Message and Event Handler is an application callback, defined at receiver initialization, to deliver received messages to your application. The following source code examples illustrate the use of a receiver message and event handler for registration messages. To accept other receiver events, additional case statements would be required, one for each additional event. See also <a class="el" href="index.html#persistenceevents">Persistence Events</a></p>
<p><b>C API</b></p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> rcv_handle_msg(<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#a0a4af6b8247cc5a0a24a8578fb6e83bd">lbm_rcv_t</a> *rcv, <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__msg__t__stct.html">lbm_msg_t</a> *msg, <span class="keywordtype">void</span> *clientd)</div><div class="line">{</div><div class="line">    <span class="keywordflow">switch</span> (msg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__msg__t__stct.html#ab25327dc4b4ebf527106f6e708dbc05f">type</a>) {</div><div class="line">    <span class="keywordflow">case</span> <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#aeb0203ec0c560a60c3b97017afc61ada">LBM_MSG_UME_REGISTRATION_ERROR</a>:</div><div class="line">        printf(<span class="stringliteral">&quot;[%s][%s] UME registration error: %s\n&quot;</span>, msg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__msg__t__stct.html#ae7d21878e72939c165a5a3ac565390c3">topic_name</a>,</div><div class="line">                msg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__msg__t__stct.html#a6631c87ac29792705794d46c4e1cda06">source</a>, msg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__msg__t__stct.html#a9c7d600dd9794c09b82732e2c233392b">data</a>);</div><div class="line">        exit(0);</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#a2ffe0658e008764982ad97128fedcaf0">LBM_MSG_UME_REGISTRATION_SUCCESS</a>:</div><div class="line">        {</div><div class="line">            <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__msg__ume__registration__t__stct.html">lbm_msg_ume_registration_t</a> *reg =</div><div class="line">                (<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__msg__ume__registration__t__stct.html">lbm_msg_ume_registration_t</a> *)(msg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__msg__t__stct.html#a9c7d600dd9794c09b82732e2c233392b">data</a>);</div><div class="line"></div><div class="line">            printf(<span class="stringliteral">&quot;[%s][%s] UME registration successful. &quot;</span></div><div class="line">                <span class="stringliteral">&quot;SrcRegID %u RcvRegID %u\n&quot;</span>,</div><div class="line">                msg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__msg__t__stct.html#ae7d21878e72939c165a5a3ac565390c3">topic_name</a>, msg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__msg__t__stct.html#a6631c87ac29792705794d46c4e1cda06">source</a>,</div><div class="line">                reg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__msg__ume__registration__t__stct.html#a54d2370fce56d3e3233dc957a497eaa1">src_registration_id</a>, reg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__msg__ume__registration__t__stct.html#a237395b6b2c007fca581b7080d86ef95">rcv_registration_id</a>);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#acae32fc8bfc50769993fcea62e553bd8">LBM_MSG_UME_REGISTRATION_SUCCESS_EX</a>:</div><div class="line">        {</div><div class="line">            <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__msg__ume__registration__ex__t__stct.html">lbm_msg_ume_registration_ex_t</a> *reg =</div><div class="line">                (<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__msg__ume__registration__ex__t__stct.html">lbm_msg_ume_registration_ex_t</a> *)(msg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__msg__t__stct.html#a9c7d600dd9794c09b82732e2c233392b">data</a>);</div><div class="line"></div><div class="line">            printf(<span class="stringliteral">&quot;[%s][%s] store %u: %s UME registration successful. &quot;</span></div><div class="line">                <span class="stringliteral">&quot;SrcRegID %u RcvRegID %u. Flags %x &quot;</span>,</div><div class="line">                msg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__msg__t__stct.html#ae7d21878e72939c165a5a3ac565390c3">topic_name</a>, msg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__msg__t__stct.html#a6631c87ac29792705794d46c4e1cda06">source</a>, reg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__msg__ume__registration__ex__t__stct.html#a46fc18fb82b632a259917e3c65790568">store_index</a>, reg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__msg__ume__registration__ex__t__stct.html#ad1f15dfb96628720e538804b08f0aae0">store</a>,</div><div class="line">                reg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__msg__ume__registration__ex__t__stct.html#af2d83e279399169fe982c75ba97e3221">src_registration_id</a>, reg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__msg__ume__registration__ex__t__stct.html#a3dbf592d420b0886e88c9e91e105d6e2">rcv_registration_id</a>, reg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__msg__ume__registration__ex__t__stct.html#a2fd3cf7fdfdb852283cd8ba1cc0d1390">flags</a>);</div><div class="line">            <span class="keywordflow">if</span> (reg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__msg__ume__registration__ex__t__stct.html#a2fd3cf7fdfdb852283cd8ba1cc0d1390">flags</a> &amp; LBM_MSG_UME_REGISTRATION_SUCCESS_EX_FLAG_OLD)</div><div class="line">                printf(<span class="stringliteral">&quot;OLD[SQN %x] &quot;</span>, reg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__msg__ume__registration__ex__t__stct.html#ad929f9de34db02929bb4fd36c844c683">sequence_number</a>);</div><div class="line">            printf(<span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#ab0571ebaf7704333a5503d1c0668a989">LBM_MSG_UME_REGISTRATION_COMPLETE_EX</a>:</div><div class="line">        {</div><div class="line">            <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__msg__ume__registration__complete__ex__t__stct.html">lbm_msg_ume_registration_complete_ex_t</a> *reg =</div><div class="line">                (<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__msg__ume__registration__complete__ex__t__stct.html">lbm_msg_ume_registration_complete_ex_t</a> *)(msg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__msg__t__stct.html#a9c7d600dd9794c09b82732e2c233392b">data</a>);</div><div class="line"></div><div class="line">            printf(<span class="stringliteral">&quot;[%s][%s] UME registration complete. SQN %x. Flags %x &quot;</span>,</div><div class="line">                msg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__msg__t__stct.html#ae7d21878e72939c165a5a3ac565390c3">topic_name</a>, msg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__msg__t__stct.html#a6631c87ac29792705794d46c4e1cda06">source</a>, reg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__msg__ume__registration__complete__ex__t__stct.html#aee71c36e8fe1a9d314f294b35a79d4b3">sequence_number</a>, reg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__msg__ume__registration__complete__ex__t__stct.html#a020b90070d750107b5bc006dd4a82fe9">flags</a>);</div><div class="line">            <span class="keywordflow">if</span> (reg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__msg__ume__registration__complete__ex__t__stct.html#a020b90070d750107b5bc006dd4a82fe9">flags</a> &amp; LBM_MSG_UME_REGISTRATION_COMPLETE_EX_FLAG_QUORUM)</div><div class="line">                printf(<span class="stringliteral">&quot;QUORUM &quot;</span>);</div><div class="line">            <span class="keywordflow">if</span> (reg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__msg__ume__registration__complete__ex__t__stct.html#a020b90070d750107b5bc006dd4a82fe9">flags</a> &amp; LBM_MSG_UME_REGISTRATION_COMPLETE_EX_FLAG_RXREQMAX)</div><div class="line">                printf(<span class="stringliteral">&quot;RXREQMAX &quot;</span>);</div><div class="line">            printf(<span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#ac12f55e0cdd14bd4d389bb3ef3afded3">LBM_MSG_UME_REGISTRATION_CHANGE</a>:</div><div class="line">        printf(<span class="stringliteral">&quot;[%s][%s] UME registration change: %s\n&quot;</span>, msg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__msg__t__stct.html#ae7d21878e72939c165a5a3ac565390c3">topic_name</a>,</div><div class="line">            msg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__msg__t__stct.html#a6631c87ac29792705794d46c4e1cda06">source</a>, msg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__msg__t__stct.html#a9c7d600dd9794c09b82732e2c233392b">data</a>);</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">    ...</div><div class="line"></div><div class="line">    <span class="keywordflow">default</span>:</div><div class="line">        printf(<span class="stringliteral">&quot;Unknown lbm_msg_t type %x [%s][%s]\n&quot;</span>, msg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__msg__t__stct.html#ab25327dc4b4ebf527106f6e708dbc05f">type</a>,</div><div class="line">            msg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__msg__t__stct.html#ae7d21878e72939c165a5a3ac565390c3">topic_name</a>, msg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__msg__t__stct.html#a6631c87ac29792705794d46c4e1cda06">source</a>);</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><p><b>JAVA API</b></p>
<div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keywordtype">int</span> onReceive(Object cbArg, LBMMessage msg)</div><div class="line">{</div><div class="line">    <span class="keywordflow">case</span> LBM.MSG_UME_REGISTRATION_ERROR:</div><div class="line">        System.out.println(<span class="stringliteral">&quot;[&quot;</span> + msg.topicName() + <span class="stringliteral">&quot;][&quot;</span> + msg.source()</div><div class="line">                    + <span class="stringliteral">&quot;] UME registration error: &quot;</span> + msg.dataString());</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> LBM.MSG_UME_REGISTRATION_SUCCESS_EX:</div><div class="line">        UMERegistrationSuccessInfo reg = msg.registrationSuccessInfo();</div><div class="line">        System.out.print(<span class="stringliteral">&quot;[&quot;</span> + msg.topicName() + <span class="stringliteral">&quot;][&quot;</span> + msg.source()</div><div class="line">                    + <span class="stringliteral">&quot;] store &quot;</span> + reg.storeIndex() + <span class="stringliteral">&quot;: &quot;</span></div><div class="line">                    + reg.store() + <span class="stringliteral">&quot; UME registration successful. SrcRegID &quot;</span></div><div class="line">                    + reg.sourceRegistrationId() + <span class="stringliteral">&quot; RcvRegID &quot;</span></div><div class="line">                    + reg.receiverRegistrationId()</div><div class="line">                    + <span class="stringliteral">&quot;. Flags &quot;</span> + reg.flags() + <span class="stringliteral">&quot; &quot;</span>);</div><div class="line">        <span class="keywordflow">if</span> ((reg.flags() &amp; LBM.MSG_UME_REGISTRATION_SUCCESS_EX_FLAG_OLD) != 0) {</div><div class="line">            System.out.print(<span class="stringliteral">&quot;OLD[SQN &quot;</span> + reg.sequenceNumber() + <span class="stringliteral">&quot;] &quot;</span>);</div><div class="line">        }</div><div class="line">        System.out.println();</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> LBM.MSG_UME_REGISTRATION_COMPLETE_EX:</div><div class="line">        UMERegistrationCompleteInfo regcomplete = msg.registrationCompleteInfo();</div><div class="line">        System.out.print(<span class="stringliteral">&quot;[&quot;</span> + msg.topicName() + <span class="stringliteral">&quot;][&quot;</span> + msg.source()</div><div class="line">            + <span class="stringliteral">&quot;] UME registration complete. SQN &quot;</span> + regcomplete.sequenceNumber()</div><div class="line">            + <span class="stringliteral">&quot;. Flags &quot;</span> + regcomplete.flags() + <span class="stringliteral">&quot; &quot;</span>);</div><div class="line">        <span class="keywordflow">if</span> ((regcomplete.flags() &amp; LBM.MSG_UME_REGISTRATION_COMPLETE_EX_FLAG_QUORUM) != 0) {</div><div class="line">            System.out.print(<span class="stringliteral">&quot;QUORUM &quot;</span>);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">if</span> ((regcomplete.flags() &amp; LBM.MSG_UME_REGISTRATION_COMPLETE_EX_FLAG_RXREQMAX) != 0) {</div><div class="line">            System.out.print(<span class="stringliteral">&quot;RXREQMAX &quot;</span>);</div><div class="line">        }</div><div class="line">        System.out.println();</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> LBM.MSG_UME_REGISTRATION_CHANGE:</div><div class="line">        System.out.println(<span class="stringliteral">&quot;[&quot;</span> + msg.topicName() + <span class="stringliteral">&quot;][&quot;</span> + msg.source()</div><div class="line">                    + <span class="stringliteral">&quot;] UME registration change: &quot;</span> + msg.dataString());</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">    ...</div><div class="line"></div><div class="line">    <span class="keywordflow">default</span>:</div><div class="line">        System.err.println(<span class="stringliteral">&quot;Unknown lbm_msg_t type &quot;</span> + msg.type() + <span class="stringliteral">&quot; [&quot;</span></div><div class="line">                    + msg.topicName() + <span class="stringliteral">&quot;][&quot;</span> + msg.source() + <span class="stringliteral">&quot;]&quot;</span>);</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><p><b>.NET API</b></p>
<div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keywordtype">int</span> onReceive(Object cbArg, LBMMessage msg)</div><div class="line">{</div><div class="line">    <span class="keywordflow">case</span> LBM.MSG_UME_REGISTRATION_ERROR:</div><div class="line">        System. Console.Out.WriteLine(<span class="stringliteral">&quot;[&quot;</span> + msg.topicName() + <span class="stringliteral">&quot;][&quot;</span></div><div class="line">            + msg.source() + <span class="stringliteral">&quot;] UME registration error: &quot;</span> + msg.dataString());</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> LBM.MSG_UME_REGISTRATION_SUCCESS_EX:</div><div class="line">        UMERegistrationSuccessInfo reg = msg.registrationSuccessInfo();</div><div class="line">        System.Console.Out.Write(<span class="stringliteral">&quot;[&quot;</span> + msg.topicName() + <span class="stringliteral">&quot;][&quot;</span> + msg.source()</div><div class="line">                    + <span class="stringliteral">&quot;] store &quot;</span> + reg.storeIndex() + <span class="stringliteral">&quot;: &quot;</span></div><div class="line">                    + reg.store() + <span class="stringliteral">&quot; UME registration successful. SrcRegID &quot;</span></div><div class="line">                    + reg.sourceRegistrationId() + <span class="stringliteral">&quot; RcvRegID &quot;</span></div><div class="line">                    + reg.receiverRegistrationId()</div><div class="line">                    + <span class="stringliteral">&quot;. Flags &quot;</span> + reg.flags() + <span class="stringliteral">&quot; &quot;</span>);</div><div class="line">        <span class="keywordflow">if</span> ((reg.flags() &amp; LBM.MSG_UME_REGISTRATION_SUCCESS_EX_FLAG_OLD) != 0) {</div><div class="line">            System.Console.Out.Write (<span class="stringliteral">&quot;OLD[SQN &quot;</span> + reg.sequenceNumber() + <span class="stringliteral">&quot;] &quot;</span>);</div><div class="line">        }</div><div class="line">        System.Console.Out.WriteLine();</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> LBM.MSG_UME_REGISTRATION_COMPLETE_EX:</div><div class="line">        UMERegistrationCompleteInfo regcomplete = msg.registrationCompleteInfo();</div><div class="line">        System.Console.Out.Write(<span class="stringliteral">&quot;[&quot;</span> + msg.topicName() + <span class="stringliteral">&quot;][&quot;</span> + msg.source()</div><div class="line">                    + <span class="stringliteral">&quot;] UME registration complete. SQN &quot;</span></div><div class="line">                    + regcomplete.sequenceNumber()</div><div class="line">                    + <span class="stringliteral">&quot;. Flags &quot;</span> + regcomplete.flags() + <span class="stringliteral">&quot; &quot;</span>);</div><div class="line">        <span class="keywordflow">if</span> ((regcomplete.flags() &amp; LBM.MSG_UME_REGISTRATION_COMPLETE_EX_FLAG_QUORUM) != 0) {</div><div class="line">            System.Console.Out.Write(<span class="stringliteral">&quot;QUORUM &quot;</span>);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">if</span> ((regcomplete.flags() &amp; LBM.MSG_UME_REGISTRATION_COMPLETE_EX_FLAG_RXREQMAX) != 0) {</div><div class="line">            System.Console.Out.Write(<span class="stringliteral">&quot;RXREQMAX &quot;</span>);</div><div class="line">        }</div><div class="line">        System.Console.Out.WriteLine();</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> LBM.MSG_UME_REGISTRATION_CHANGE:</div><div class="line">        System.Console.Out.WriteLine(<span class="stringliteral">&quot;[&quot;</span> + msg.topicName() + <span class="stringliteral">&quot;][&quot;</span> + msg.source()</div><div class="line">                    + <span class="stringliteral">&quot;] UME registration change: &quot;</span> + msg.dataString());</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">    ...</div><div class="line"></div><div class="line">    <span class="keywordflow">default</span>:</div><div class="line">        System.Console.Out.WriteLine(<span class="stringliteral">&quot;Unknown lbm_msg_t type &quot;</span> + msg.type()</div><div class="line">                    + <span class="stringliteral">&quot; [&quot;</span> + msg.topicName() + <span class="stringliteral">&quot;][&quot;</span> + msg.source() + <span class="stringliteral">&quot;]&quot;</span>);</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><p><br />
 </p>
<h2><a class="anchor" id="recoverymanagement"></a>
Recovery Management&nbsp;&nbsp;<small><a href="#recoverymanagement">&lt;-</a></small></h2>
<p>Recovery management for failed and restarted receivers is fairly simple. UM requests any missed messages from the Store(s) and delivers them to the restarted receiver. However, your application can override that default behavior either by configuring a <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grplatejoin.html#retransmitrequestmaximumreceiver">retransmit_request_maximum (receiver)</a> value, or by configuring a <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umerecoverysequencenumberinfofunctionreceiver">ume_recovery_sequence_number_info_function (receiver)</a> application callback, or both.</p>
<p>For example, let's say a source sends 7 messages with sequence numbers 0-6 which are stabilized at the Store. A C-based receiver, configured with <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grplatejoin.html#retransmitrequestmaximumreceiver">retransmit_request_maximum (receiver)</a> set to 2, and an application callback <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umerecoverysequencenumberinfofunctionreceiver">ume_recovery_sequence_number_info_function (receiver)</a>, consumes (and acknowledges) message 0, goes down, then restarts right after message 6.</p>
<p>During receiver registration, the <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#ac318ae4d0d80e5595ce572558102c7b5">lbm_ume_rcv_recovery_info_ex_func_t</a> application callback is called with the following values in the passed-in structure <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#a864aeb7e5113d0d496950cf75ae3cda9">lbm_ume_rcv_recovery_info_ex_func_info_t</a>&#160;*info:</p>
<div class="fragment"><div class="line">info-&gt;high_sequence_number == 6</div><div class="line">info-&gt;low_rxreq_max_sequence_number == 4</div><div class="line">info-&gt;low_sequence_number == 1</div></div><!-- fragment --><p>Where: </p><ul>
<li>
<p class="startli"><a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__ume__rcv__recovery__info__ex__func__info__t__stct.html#a6365dff87b32b8f4e6e7e985d01acb75">lbm_ume_rcv_recovery_info_ex_func_info_t::high_sequence_number</a> - the most recent message sent by the source,</p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__ume__rcv__recovery__info__ex__func__info__t__stct.html#ab8e05918a9c715b8edbd1e834815eb10">lbm_ume_rcv_recovery_info_ex_func_info_t::low_rxreq_max_sequence_number</a> - high_sequence_number (above) minus the number configured for <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grplatejoin.html#retransmitrequestmaximumreceiver">retransmit_request_maximum (receiver)</a> (2 in this example), and</p>
<p class="endli"></p>
</li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__ume__rcv__recovery__info__ex__func__info__t__stct.html#a730df0455e0c47ec41434c5f0664e0be">lbm_ume_rcv_recovery_info_ex_func_info_t::low_sequence_number</a> - the first sequence number missed by the receiver after it went down. </li>
</ul>
<p>Normally, UM would start delivering messages at 1, but <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grplatejoin.html#retransmitrequestmaximumreceiver">retransmit_request_maximum (receiver)</a> is set to 2, which overrides UM's normal behavior. So in this example, the first message delivered will be number 4.</p>
<p>Finally, the application can, at run-time, further override the starting sequence number. The callback function can modify the contents of the passed-in structure <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#a864aeb7e5113d0d496950cf75ae3cda9">lbm_ume_rcv_recovery_info_ex_func_info_t</a>&#160;*info; specifically it can update the <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__ume__rcv__recovery__info__ex__func__info__t__stct.html#a730df0455e0c47ec41434c5f0664e0be">lbm_ume_rcv_recovery_info_ex_func_info_t::low_sequence_number</a> field. When the callback returns, UM examines that field to see if it was modified by the callback. If so, UM overrides the effect of <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grplatejoin.html#retransmitrequestmaximumreceiver">retransmit_request_maximum (receiver)</a> and starts at the requested sequence number.</p>
<p>Notice that this design does not allow the callback to override the effect of <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grplatejoin.html#retransmitrequestmaximumreceiver">retransmit_request_maximum (receiver)</a> by setting the <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__ume__rcv__recovery__info__ex__func__info__t__stct.html#a730df0455e0c47ec41434c5f0664e0be">lbm_ume_rcv_recovery_info_ex_func_info_t::low_sequence_number</a> field to its original value, 1 in this example. Upon return, UM will see the value unchanged, and will allow <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grplatejoin.html#retransmitrequestmaximumreceiver">retransmit_request_maximum (receiver)</a> to override the starting sequence number. This is only an issue if <em>both</em> <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grplatejoin.html#retransmitrequestmaximumreceiver">retransmit_request_maximum (receiver)</a> and <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umerecoverysequencenumberinfofunctionreceiver">ume_recovery_sequence_number_info_function (receiver)</a> are used. If the application wants to use the sequence number remembered by the Store, it should not configure <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grplatejoin.html#retransmitrequestmaximumreceiver">retransmit_request_maximum (receiver)</a>.</p>
<p><br />
 </p>
<h2><a class="anchor" id="duplicatmessagedelivery"></a>
Duplicate Message Delivery&nbsp;&nbsp;<small><a href="#duplicatmessagedelivery">&lt;-</a></small></h2>
<p>In a distributed system, it is not possible to <em>guarantee</em> "once-and-only-once" delivery of messages in the face of unpredictable system or component failure. Regardless of the algorithms and handshaking, there is always the possibility of messages sent that are never received, as well as messages received and then received again if the receiving application fails and restarts.</p>
<p>UM's persistence design is based on the principle of being close to once-and-only-once, but when that is not possible, UM prefers to fail on the side of duplicate message delivery. Due to other design goals (low latency and high throughput), the possibility of receiving duplicate messages is significant after an application failure and restart.</p>
<p>It is therefore important for persistent applications to be designed to tolerate duplicate message reception, either by making message processing idempotent, or by including logic in the receiving application to detect duplicates and only process the messages which have not been previously processed.</p>
<p>To assist the application in implementing "de-duplication", all messages retransmitted to a receiver are marked as retransmissions via a flag in the message structure. Thus it is easy for an application to determine if a message is a new "live" message from the source, or a retransmission, which may or may not have been processed before the failure. The presence or absence of the retransmit flag gives the application a hint of how best to handle the message with regard to it being processed previously or not.</p>
<p>Informatica recommends that you always check the data or other message properties of messages with the retransmit flag set to be sure the message has not been already processed. Relying on UM sequence numbers is not a 100% reliable method for detecting duplicate messages.</p>
<p><br />
 </p>
<h2><a class="anchor" id="settingcallbackfunctiontosetrecoverysequencenumber"></a>
Setting Callback Function to Set Recovery Sequence Number&nbsp;&nbsp;<small><a href="#settingcallbackfunctiontosetrecoverysequencenumber">&lt;-</a></small></h2>
<p>Whereas the UM persistence design attempts to choose the correct starting sequence number for a recovering receiver, there are cases where the application wishes to override UM's choice.</p>
<p>The sample code below demonstrates how to use the recovery sequence number info function to determine the stored message with which to restart a receiver. This example retrieves the low sequence number from the recovery sequence number structure and adds an offset to determine the beginning sequence number. The offset is a value completely under the control of your application. For example, if a receiver was down for a "long" period and you only want the receiver to receive the last 10 messages, use an offset to start the receiver with the 10th most recent message. If you wish not to receive any messages, set the <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__ume__rcv__recovery__info__ex__func__info__t__stct.html#a730df0455e0c47ec41434c5f0664e0be">lbm_ume_rcv_recovery_info_ex_func_info_t::low_sequence_number</a> to the <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__ume__rcv__recovery__info__ex__func__info__t__stct.html#a6365dff87b32b8f4e6e7e985d01acb75">lbm_ume_rcv_recovery_info_ex_func_info_t::high_sequence_number</a> plus one.</p>
<p><b>C API</b></p>
<div class="fragment"><div class="line"><a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__ume__rcv__recovery__info__ex__func__t__stct.html">lbm_ume_rcv_recovery_info_ex_func_t</a> cb;</div><div class="line"></div><div class="line">cb.<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__ume__rcv__recovery__info__ex__func__t__stct.html#ad6abe69851bb49323a0d3d98eff773f6">func</a> = ume_rcv_seqnum_ex;  <span class="comment">/* declared below */</span></div><div class="line">cb.<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__ume__rcv__recovery__info__ex__func__t__stct.html#a986ce6809286b4abd6c1f81b80ecd287">clientd</a> = NULL;</div><div class="line"><span class="keywordflow">if</span> (<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#a1afc75f0fb3601d072b3463e7acf16a6">lbm_rcv_topic_attr_setopt</a>(&amp;rcv_attr,</div><div class="line">                              <span class="stringliteral">&quot;ume_recovery_sequence_number_info_function&quot;</span>,</div><div class="line">                              &amp;cb, <span class="keyword">sizeof</span>(cb)) == LBM_FAILURE) {</div><div class="line">    fprintf(stderr,</div><div class="line">        <span class="stringliteral">&quot;lbm_rcv_topic_attr_setopt:ume_recovery_sequence_number_info_function: %s\n&quot;</span>,</div><div class="line">        <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#a22a4650d3a5b649c84a0c05adedcc055">lbm_errmsg</a>());</div><div class="line">    exit(1);</div><div class="line">}</div><div class="line">printf(<span class="stringliteral">&quot;Will use seqnum info with low offset %u.\n&quot;</span>, seqnum_offset);</div><div class="line"></div><div class="line">...</div><div class="line"></div><div class="line">int ume_rcv_seqnum_ex(<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__ume__rcv__recovery__info__ex__func__info__t__stct.html">lbm_ume_rcv_recovery_info_ex_func_info_t</a> *info, <span class="keywordtype">void</span> *clientd)</div><div class="line">{</div><div class="line">    <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#abdb96b55cc467a75e1f9ec0036dbc14b">lbm_uint_t</a> new_lo = info-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__ume__rcv__recovery__info__ex__func__info__t__stct.html#a730df0455e0c47ec41434c5f0664e0be">low_sequence_number</a> + seqnum_offset;</div><div class="line"></div><div class="line">    printf(<span class="stringliteral">&quot;[%s] SQNs Low %x (will set to %x), Low rxreqmax %x, High %x (CD %p)\n&quot;</span>,</div><div class="line">        info-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__ume__rcv__recovery__info__ex__func__info__t__stct.html#a108647bced4b79cf953ef1ad32649bc6">source</a>, info-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__ume__rcv__recovery__info__ex__func__info__t__stct.html#a730df0455e0c47ec41434c5f0664e0be">low_sequence_number</a>,</div><div class="line">        new_lo, info-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__ume__rcv__recovery__info__ex__func__info__t__stct.html#ab8e05918a9c715b8edbd1e834815eb10">low_rxreq_max_sequence_number</a>,</div><div class="line">        info-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__ume__rcv__recovery__info__ex__func__info__t__stct.html#a6365dff87b32b8f4e6e7e985d01acb75">high_sequence_number</a>, info-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__ume__rcv__recovery__info__ex__func__info__t__stct.html#a4a3feac0d75b46b6b18f1cc218432109">source_clientd</a>);</div><div class="line">    info-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__ume__rcv__recovery__info__ex__func__info__t__stct.html#a730df0455e0c47ec41434c5f0664e0be">low_sequence_number</a> = new_lo;</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><p><b>JAVA API</b></p>
<div class="fragment"><div class="line">UMERcvRecInfo umerecinfocb = <span class="keyword">new</span> UMERcvRecInfo(seqnum_offset);</div><div class="line">rcv_attr.setRecoverySequenceNumberCallback(umerecinfocb, null);</div><div class="line">System.out.println(<span class="stringliteral">&quot;Will use seqnum info with low offset &quot;</span> + seqnum_offset);</div><div class="line"></div><div class="line"><span class="keyword">class </span>UMERcvRecInfo <span class="keyword">implements</span> UMERecoverySequenceNumberCallback {</div><div class="line">    <span class="keyword">private</span> <span class="keywordtype">long</span> _seqnum_offset = 0;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> UMERcvRecInfo(<span class="keywordtype">long</span> seqnum_offset) {</div><div class="line">        _seqnum_offset = seqnum_offset;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keywordtype">int</span> setRecoverySequenceNumberInfo(Object cbArg,</div><div class="line">    UMERecoverySequenceNumberCallbackInfo cbInfo)</div><div class="line">    {</div><div class="line">        <span class="keywordtype">long</span> new_low = cbInfo.lowSequenceNumber() + _seqnum_offset;</div><div class="line">        System.out.println(<span class="stringliteral">&quot;SQNs Low &quot;</span> + cbInfo.lowSequenceNumber() + <span class="stringliteral">&quot; (will set to &quot;</span></div><div class="line">            + new_low + <span class="stringliteral">&quot;), Low rxreqmax &quot;</span> + cbInfo.lowRxReqMaxSequenceNumber()</div><div class="line">            + <span class="stringliteral">&quot;, High &quot;</span> + cbInfo.highSequenceNumber());</div><div class="line">        <span class="keywordflow">try</span> {</div><div class="line">            cbInfo.setLowSequenceNumber(new_low);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">catch</span> (LBMEInvalException e) {</div><div class="line">            System.err.println(e.getMessage());</div><div class="line">        }</div><div class="line">        <span class="keywordflow">return</span> 0;</div><div class="line">     }</div><div class="line"> }</div></div><!-- fragment --><p><b>.NET API</b></p>
<div class="fragment"><div class="line">UMERcvRecInfo umerecinfocb = <span class="keyword">new</span> UMERcvRecInfo(seqnum_offset);</div><div class="line">rcv_attr.setRecoverySequenceNumberCallback(umerecinfocb, null);</div><div class="line">System.Console.Out.WriteLine(<span class="stringliteral">&quot;Will use seqnum info with low offset &quot;</span> + seqnum_offset);</div><div class="line"></div><div class="line"><span class="keyword">class </span>UMERcvRecInfo <span class="keyword">implements</span> UMERecoverySequenceNumberCallback {</div><div class="line">    <span class="keyword">private</span> <span class="keywordtype">long</span> _seqnum_offset = 0;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> UMERcvRecInfo(<span class="keywordtype">long</span> seqnum_offset) {</div><div class="line">        _seqnum_offset = seqnum_offset;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keywordtype">int</span> setRecoverySequenceNumberInfo(Object cbArg,</div><div class="line">        UMERecoverySequenceNumberCallbackInfo cbInfo)</div><div class="line">    {</div><div class="line">        <span class="keywordtype">long</span> new_low = cbInfo.lowSequenceNumber() + _seqnum_offset;</div><div class="line">        System.Console.Out.WriteLine (<span class="stringliteral">&quot;SQNs Low &quot;</span> + cbInfo.lowSequenceNumber() + <span class="stringliteral">&quot; (will set to &quot;</span></div><div class="line">            + new_low + <span class="stringliteral">&quot;), Low rxreqmax &quot;</span> + cbInfo.lowRxReqMaxSequenceNumber()</div><div class="line">            + <span class="stringliteral">&quot;, High &quot;</span> + cbInfo.highSequenceNumber());</div><div class="line">        <span class="keywordflow">try</span> {</div><div class="line">            cbInfo.setLowSequenceNumber(new_low);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">catch</span> (LBMEInvalException e) {</div><div class="line">            System.Console.Out.WriteLine (e.getMessage());</div><div class="line">        }</div><div class="line">        <span class="keywordflow">return</span> 0;</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><p><a class="anchor" id="immediatemessageconsumption"></a><a class="anchor" id="delayedmessageprocessing"></a><a class="anchor" id="batchingacknowledgments"></a><br />
 </p>
<h2><a class="anchor" id="persistencemessageconsumption"></a>
Persistence Message Consumption&nbsp;&nbsp;<small><a href="#persistencemessageconsumption">&lt;-</a></small></h2>
<p>When a persistent subscriber application has finished processing a received message, it must signal consumption of the message to UM. This is how UM keeps track of where message recovery should begin if recovery is needed (e.g. if the receiver restarts).</p>
<p>There are three basic methods to signaling message consumption that the application must choose between: </p><ul>
<li>
The subscriber's receiver callback returns to UM, allowing UM to delete the message. The message deletion signals consumption. This is generally the most simple case. </li>
<li>
The subscriber retains the message past the point of the receiver callback returning. Then some other application function (typically running in a separate thread) finishes the processing and deletes the message. The message deletion signals consumption. </li>
<li>
The subscriber calls a separate "explicit ACK" API which signals message consumption. In this case, the act of deleting the message does not signal consumption. </li>
</ul>
<p>When the application uses one of those methods to signal consumption, it is informing the local instance of UM running within the application. As a separate step, UM must send a consumption acknowledgement (ACK) to the Persistent Store(s). However, the two steps are not necessarily directly linked.</p>
<p>There are two configurable acknowledgement methods that UM can follow when the application signals consumption: </p><ul>
<li>
UM batches ACKs based on a configurable time period. I.e. UM will delay sending ACKs to the Store so that multiple messages can be acknowledged at once, when its timer expires. </li>
<li>
UM immediately sends an ACK to the Store. </li>
</ul>
<p>Batching of ACKs greatly improves the throughput of a persistent receiver, and can also improve latency. It is the default configuration.</p>
<p>However, batching has the disadvantage that if message recovery is needed (e.g. if the subscriber restarts), it increases the chances that already processed messages will be re-sent during recovery ("duplicate messages"). Any messages that the application signaled consumed, but which UM has not yet acknowledged to the Store, can be re-sent during recovery.</p>
<p>Note that even with immediate ACK, there is still the possibility of one or more already-consumed messages being recovered; applications need to be able to handle this. See <a class="el" href="index.html#duplicatmessagedelivery">Duplicate Message Delivery</a> for more information.</p>
<p><b>Use Cases</b></p>
<p>There are four common use cases which combine an application consumption method with a UM acknowledgement method: </p><ul>
<li>
<a class="el" href="index.html#deleteonreturnbatchacks">Delete on Return, Batch ACKs</a>, most common. </li>
<li>
<a class="el" href="index.html#retainonreturnbatchacks">Retain on Return, Batch ACKs</a>, also common. </li>
<li>
<a class="el" href="index.html#explicitacknowledgments">Explicit Acknowledgments</a>. </li>
<li>
<a class="el" href="index.html#ackimmediatelyondelete">ACK Immediately on Delete</a>. </li>
</ul>
<p><br />
 </p>
<h3><a class="anchor" id="deleteonreturnbatchacks"></a>
Delete on Return, Batch ACKs&nbsp;&nbsp;<small><a href="#deleteonreturnbatchacks">&lt;-</a></small></h3>
<p>The application receiver callback completes all processing of a message before returning. It allows UM to delete the message on return, which signals consumption.</p>
<p>To maximize efficiency, the application allows UM to batch ACKs to the Store.</p>
<p>Note that in this use case, messages are always signaled consumed in the same order in which they are received.</p>
<p>For this use case, use the configuration: </p><ul>
<li>
<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umeuseackbatchingreceiver">ume_use_ack_batching (receiver)</a> - set to <b>1</b> (the default). </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umeexplicitackonlyreceiver">ume_explicit_ack_only (receiver)</a> - set to <b>0</b> (the default). </li>
</ul>
<p>The subscriber code is written to signal message consumption on return from the receiver callback. This is handled differently between the C API vs. the Java and .NET APIs.</p>
<p><b>C API</b></p>
<p>The default behavior for a C application receiver callback is for the message to be deleted and when the receiver callback returns, which signals consumption the message. No special coding is needed for this use case.</p>
<p>Note: the receiver callback must <em>not</em> call <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#aa5fc1eb324a55b8c800c31460b0f0116">lbm_msg_delete()</a>.</p>
<p><b>Java and .NET</b></p>
<p>With Java and .NET, the application receiver callback must explicitly call <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/javaapi.tag:../../JavaAPI/" href="../../JavaAPI/classcom_1_1latencybusters_1_1lbm_1_1LBMMessage.html#a963d0f07751ed176a97f3eff84740fb9">com::latencybusters::lbm::LBMMessage::dispose()</a> prior to returning.</p>
<p>(Note that this is not strictly true for .NET. A .NET program can skip calling "dispose()" and allow the message to become garbage. This will introduce significant latency outliers when GC runs, and also makes acknowledgements to the Store non-deterministic. Finally, in the future, performance improvements for .NET will probably require the use of "dispose()". Informatica recommends that .NET programs call "dispose()" for every message.)</p>
<p><br />
 </p>
<h3><a class="anchor" id="retainonreturnbatchacks"></a>
Retain on Return, Batch ACKs&nbsp;&nbsp;<small><a href="#retainonreturnbatchacks">&lt;-</a></small></h3>
<p>There are application designs where a received message cannot be fully processed inside the receiver application callback. For example, the message might need to be handed off to a worker thread for longer-term processing. Or the acknowledgement must be delayed until some asynchronous event happens, like a handshake with another application.</p>
<p>To maximize efficiency, applications allow UM to batch ACKs to the Store.</p>
<p>Note that some applications are written to process these handed-off messages in parallel, and messages might be signaled consumed in a different order than they arrived. In this use case, out-of-order consumption is supported. See <a class="el" href="index.html#ackordering">ACK Ordering</a> for more information.</p>
<p>For this use case, use the configuration: </p><ul>
<li>
<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umeuseackbatchingreceiver">ume_use_ack_batching (receiver)</a> - set to <b>1</b> (the default). </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umeexplicitackonlyreceiver">ume_explicit_ack_only (receiver)</a> - set to <b>0</b> (the default). </li>
</ul>
<p>Note that this is the same configuration as <a class="el" href="index.html#deleteonreturnbatchacks">Delete on Return, Batch ACKs</a>.</p>
<p>The subscriber code should be written to hand off the message to another part of the application and suppress deleting the message on return from the receiver callback. This is handled differently between the C API vs. the Java and .NET APIs.</p>
<p><b>C API</b></p>
<p>In C, the application's receiver callback function must call the <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#a2b7788ff58f9e78bc89ea890dad0cccf">lbm_msg_retain()</a> API for the received message prior to handing off the message for processing. This suppresses the automatic deletion of the received message when the receiver callback returns, and allows the message buffer to be passed to some other part of the application for processing and deletion at a later time.</p>
<p>When the application subsequently completes all processing of the message, it signals consumption by calling <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#aa5fc1eb324a55b8c800c31460b0f0116">lbm_msg_delete()</a>.</p>
<p><b>Java and .NET</b></p>
<p>In Java and .NET, the application should call the <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/javaapi.tag:../../JavaAPI/" href="../../JavaAPI/classcom_1_1latencybusters_1_1lbm_1_1LBMMessage.html#a2cda69ee0b33fe294d46761401e451ca">com::latencybusters::lbm::LBMMessage::promote()</a> API prior to handing the message for a separate processing. This allows the message object to be passed to some other part of the application for processing and disposal at a later time.</p>
<p>When the application subsequently completes all processing of the message, it signals consumption by calling <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/javaapi.tag:../../JavaAPI/" href="../../JavaAPI/classcom_1_1latencybusters_1_1lbm_1_1LBMMessage.html#a963d0f07751ed176a97f3eff84740fb9">com::latencybusters::lbm::LBMMessage::dispose()</a>.</p>
<p><br />
 </p>
<h3><a class="anchor" id="explicitacknowledgments"></a>
Explicit Acknowledgments&nbsp;&nbsp;<small><a href="#explicitacknowledgments">&lt;-</a></small></h3>
<p>The <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umeuseackbatchingreceiver">ACK batching feature</a> did not exist in UM in versions prior to 5.0. In those early versions, the application had to use the <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umeexplicitackonlyreceiver">Explicit ACK feature</a> to benefit from the increased throughput allowed by batching of ACKs. Informatica will continue to support Explicit ACKs, even though we generally recommend the ACK batching use cases <a class="el" href="index.html#deleteonreturnbatchacks">Delete on Return, Batch ACKs</a> or <a class="el" href="index.html#retainonreturnbatchacks">Retain on Return, Batch ACKs</a>.</p>
<p>With explicit ACKs, message consumption is separated from message deletion. The application uses a separate API to trigger an acknowledgement to the Store. Batching is achieved under application control by not ACKing every message. With explicit ACKs, the action of acknowledging a message to the Store implicitly acknowledges all previous unacknowledged messages.</p>
<dl class="section warning"><dt>Warning</dt><dd>Because explicit ACKs implicitly acknowledge all previous unacknowledged messages, it is not valid to acknowledge messages out of order. Otherwise the application risks not recovering needed messages. See <a class="el" href="index.html#ackordering">ACK Ordering</a>.</dd></dl>
<p>For this use case, use the configuration: </p><ul>
<li>
<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umeuseackbatchingreceiver">ume_use_ack_batching (receiver)</a> - set to <b>0</b>. </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umeexplicitackonlyreceiver">ume_explicit_ack_only (receiver)</a> - set to <b>1</b>. </li>
</ul>
<p>The subscriber should be written the same as <a class="el" href="index.html#deleteonreturnbatchacks">Delete on Return, Batch ACKs</a> (if processing is completed in the receiver callback) or <a class="el" href="index.html#retainonreturnbatchacks">Retain on Return, Batch ACKs</a> (if the message is retained after the receiver callback returns). The same coding rules apply regarding message retention and disposal.</p>
<p>However, as an additional step, the application must call the explicit ACK API: </p><ul>
<li>
C: <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#ad920e7ab51a45099390091dd36d26a34">lbm_msg_ume_send_explicit_ack()</a> </li>
<li>
Java/.NET: <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/javaapi.tag:../../JavaAPI/" href="../../JavaAPI/classcom_1_1latencybusters_1_1lbm_1_1LBMMessage.html#ac367c5298b0db98072b89d4572069db0">com::latencybusters::lbm::LBMMessage.sendExplicitAck()</a> </li>
</ul>
<p>This is typically done inside of a timer callback, which provides batching behavior.</p>
<p><br />
 </p>
<h3><a class="anchor" id="ackimmediatelyondelete"></a>
ACK Immediately on Delete&nbsp;&nbsp;<small><a href="#ackimmediatelyondelete">&lt;-</a></small></h3>
<p>With this use case, the application directs UM to send an acknowledgement to the Store for each and every processed message immediately after the message is deleted.</p>
<p>The advantage of this use case is that it minimizes the chances that already processed messages will be re-sent during recovery (i.e. "duplicate messages"). However, there is still the possibility of one or more duplicate messages during recovery, so applications need to be able to handle this. See <a class="el" href="index.html#duplicatmessagedelivery">Duplicate Message Delivery</a> for more information.</p>
<p>A disadvantage of this use case is that the maximum sustainable throughput (message rate) is limited by the per-message overhead of sending acknowledgements.</p>
<p>Another disadvantage is that messages must be deleted in the same order as they were received, even if the messages are handed off to another thread for processing. See <a class="el" href="index.html#ackordering">ACK Ordering</a>.</p>
<p>Informatica's general recommendation is that since the application needs to handle duplicate messages even with immediate acknowledgement, the user should implement a use case that includes ACK batching.</p>
<p>For this use case, use the configuration: </p><ul>
<li>
<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umeuseackbatchingreceiver">ume_use_ack_batching (receiver)</a> - set to <b>0</b>. </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umeexplicitackonlyreceiver">ume_explicit_ack_only (receiver)</a> - set to <b>0</b> (the default). </li>
</ul>
<p>The subscriber should be written the same as <a class="el" href="index.html#deleteonreturnbatchacks">Delete on Return, Batch ACKs</a> (if processing is completed in the receiver callback) or <a class="el" href="index.html#retainonreturnbatchacks">Retain on Return, Batch ACKs</a> (if the message is retained after the receiver callback returns). The same coding rules apply regarding message retention and disposal.</p>
<p><br />
 </p>
<h2><a class="anchor" id="ackordering"></a>
ACK Ordering&nbsp;&nbsp;<small><a href="#ackordering">&lt;-</a></small></h2>
<p>When UM is allowed to batch ACKs to the Store using <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umeuseackbatchingreceiver">ume_use_ack_batching (receiver)</a>, the UM client library supports "out of order" signaling that the application is done processing messages. For example, the application might retain received messages 1, 2, and 3 for asynchronous processing, and then delete them in the order 2, 1, 3.</p>
<p>However, be aware that the Persistent Store does not support "out of order" acknowledgement of messages. If the Store receives an acknowledgement of sequence number N, that implicitly acknowledges all sequence numbers less than N.</p>
<p>The UM client library handles this by withholding acknowledgement to the Store all messages for which an earlier message is not signaled complete. For example, if the application retains messages 1, 2, and 3, and subsequently deletes message 2, UM will not send an ACK to the Store for message 2. If the application then deletes message 1, UM is now able to send an ACK for message 2, which will implicitly acknowledge message 1 as well.</p>
<p>However, this ability to process messages out of order is dependent on using ACK batching (i.e. <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umeuseackbatchingreceiver">ume_use_ack_batching (receiver)</a> is <b>1</b>). If ACK batching is disabled, then the application is responsible for ordering acknowledgements to the Store. This is true for both the <a class="el" href="index.html#explicitacknowledgments">Explicit Acknowledgments</a> and <a class="el" href="index.html#ackimmediatelyondelete">ACK Immediately on Delete</a> use cases.</p>
<p>For example, suppose that the <a class="el" href="index.html#ackimmediatelyondelete">ACK Immediately on Delete</a> use case is being used. If the application processes and deletes messages in the order 2, 1, 3, the ACK for message 2 will implicitly ACK message 1 to the Store. If the application crashes after ACKing 2 and restarts, recovery will start with message 3. Thus, message 1 is never fully processed.</p>
<p>If ACK batching is disabled, the messages must be deleted in order: 1, 2, 3.</p>
<p><br />
 </p>
<h2><a class="anchor" id="objectfreeexplicitacknowledgments"></a>
Object-free Explicit Acknowledgments&nbsp;&nbsp;<small><a href="#objectfreeexplicitacknowledgments">&lt;-</a></small></h2>
<p>When using explicit ACKs, you can extract ACK information from messages. This allows the received message buffer to be deleted when the receiver callback is done, while still allowing the application to save the ACK structure for persistent acknowledgement to the Store at a future time. This can improve receiver performance when used with the <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/design.tag:../../Design/" href="../../Design/advancedoptimizations.html#receivebufferrecycling">Receive Buffer Recycling</a> feature to reduce the per-message use of dynamic memory (malloc/free) with a persistent receiver. Extracting ACKs can also additionally improve performance of Java and .NET applications by allowing the use of <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/design.tag:../../Design/" href="../../Design/advancedoptimizations.html#zeroobjectdelivery">Zero Object Delivery</a>.</p>
<p>The following source code examples show how to extract ACK information and send an explicit ACK.</p>
<p><b>C API</b></p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> rcv_handle_msg(<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#a0a4af6b8247cc5a0a24a8578fb6e83bd">lbm_rcv_t</a> *rcv, <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structlbm__msg__t__stct.html">lbm_msg_t</a> *msg, <span class="keywordtype">void</span> *clientd)</div><div class="line">{</div><div class="line">  <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#a40d24279afe3a87f1660fbb0086a4def">lbm_ume_rcv_ack_t</a> *ack = NULL;</div><div class="line">...</div><div class="line"></div><div class="line">  ack = <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#ae1b7ca376c99fcbbe6175ad3441b7aeb">lbm_msg_extract_ume_ack</a>(msg);</div><div class="line">  defer_ack(ack);  <span class="comment">/* Pass the &quot;ack&quot; to another thread or work queue. */</span></div><div class="line">...</div><div class="line">  <span class="keywordflow">return</span> 0;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> worker()</div><div class="line">{</div><div class="line">  <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#a40d24279afe3a87f1660fbb0086a4def">lbm_ume_rcv_ack_t</a> *ack = NULL;</div><div class="line">...</div><div class="line">  ack = get_deferred_ack();  <span class="comment">/* Get &quot;ack&quot; that was saved above. */</span></div><div class="line"></div><div class="line">  <span class="comment">/* Some applications improve throughput by not ACKing every message. */</span></div><div class="line">  <span class="keywordflow">if</span> (ack_this_message) {</div><div class="line">    <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#a2b5aa9394b4911eb8e39768a57d5b49e">lbm_ume_ack_send_explicit_ack</a>(ack, msg-&gt;sequence_number);</div><div class="line">  }</div><div class="line"></div><div class="line">  <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#a5c2b4c56240b15dadd9a251989c3180f">lbm_ume_ack_delete</a>(ack);  <span class="comment">/* Extracted ack *must* be deleted. */</span></div><div class="line">...</div><div class="line"></div><div class="line">}</div></div><!-- fragment --><p><b>JAVA API or .NET API</b></p>
<div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keywordtype">int</span> onReceive(Object cbArg, LBMMessage msg)</div><div class="line">{</div><div class="line">  UMEMessageAck ack;</div><div class="line">...</div><div class="line"></div><div class="line">  ack = msg.extractUMEAck();</div><div class="line">  defer_ack(ack);  <span class="comment">/* Pass the &quot;ack&quot; to another thread or work queue. */</span></div><div class="line">...</div><div class="line">  <span class="keywordflow">return</span> 0;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> worker()</div><div class="line">{</div><div class="line">  UMEMessageAck ack;</div><div class="line"></div><div class="line">  ack = get_deferred_ack();  <span class="comment">/* Get &quot;ack&quot; that was saved above. */</span></div><div class="line"></div><div class="line">  <span class="comment">/* Some applications improve throughput by not ACKing every message. */</span></div><div class="line">  <span class="keywordflow">if</span> (ack_this_message) {</div><div class="line">    ack.sendExplicitAck(msg.sequenceNumber());</div><div class="line">  }</div><div class="line">  ack.dispose();  <span class="comment">/* Extracted ack *must* be deleted. */</span></div><div class="line">}</div></div><!-- fragment --><p><br />
 </p><hr/>
<h1><a class="anchor" id="designingpersistentstores"></a>
Designing Persistent Stores&nbsp;&nbsp;<small><a href="#designingpersistentstores">&lt;-</a></small></h1>
<p>As mentioned in <a class="el" href="index.html#persistentstoreconcept">Persistent Store Concept</a>, the Persistent Stores, also just called Stores, actually persist the source and receiver state and use RegIDs to identify sources and receivers. Each source to which a Store provides persistence may have zero or more receivers. The Store maintains each receiver's state along with the source's state and the messages the source has sent.</p>
<p>The Store can be configured with its own set of options to persist this state information on disk or simply in memory. The term disk Store is used to signify a Store that persists state to disk, and the term memory Store is used to signify a Store that persists state only in memory.</p>
<p>A source does not send data to the Store and then have the Store forward it to the receivers. In UM, the source sends to receivers and the Stores in parallel. See <a class="el" href="index.html#persistencenormaloperation">Persistence Normal Operation</a>. Thus, UM can provide extremely low latency to receiving applications.</p>
<p>The Store(s) that a source uses are part of the source's configuration settings. Sources must be configured to use specific Store(s) in a Quorum/Consensus arrangement.</p>
<p>Receivers, on the other hand, do not need to be configured with Store information a priori. The source provides Store information to receivers via a Source Registration Information (SRI) message after the source registers with a Store. Thus the receivers learn about Stores from the source, without needing to be configured themselves. Because receivers learn about the Store or Stores with which they must register via a SRI record, the source must be available to receivers. However, the source does not have to be actively sending data to do this.</p>
<p><br />
 </p>
<h2><a class="anchor" id="limitinitialrestore"></a>
Limit Initial Restore with Restore-Last&nbsp;&nbsp;<small><a href="#limitinitialrestore">&lt;-</a></small></h2>
<p>The "restore-last" feature limits the initial message restore for a restarting Store.</p>
<p>When a disk-based store is restarted, during its initialization it will open the state and cache files and restore the data. This makes previously saved message data available for recovering subscribers. Note that this message restoration takes some time. For small files of a few megabytes, it might take a few seconds. But for large files of many gigabytes, it could take minutes.</p>
<p>Starting with UM version 6.15, you can configure a restarting Store to only restore a subset of the saved messages. This can greatly speed up the process of initialization.</p>
<p>For example, you might direct the Store to only restore 8 hours' worth of message data when it is restarted. Doing this means that older messages are not available from this Store for recovering subscribers. But if only one Store of a Q/C group is restarted, one or more of the other Stores will continue to have the older messages available.</p>
<p>The <a class="el" href="index.html#umeelementrestorelast">UMP Element "&lt;restore-last&gt;"</a> is used to enable this feature.</p>
<p>When the restore-last feature is enabled, the Store will write an additional, per-source "cache index" file. It is written to the configured cache directory and is named the same as the source's normal message cache file with ".idx" appended. For example, your cache directory might contain: </p><pre class="fragment">3085235048-cache
3085235048-cache.idx
</pre><p>When the Store is restarted, the cache index file is used to quickly determine which messages are within the restore-last range. As a result of this algorithm, if a deployed Store is re-configured to enable the restore-last feature, the first time it is restarted will not be sped up. I.e. since the index file will not yet exist, the first startup after enabling the feature will restore the entire existing cache file.</p>
<p>See <a class="el" href="index.html#umeelementrestorelast">UMP Element "&lt;restore-last&gt;"</a> for implementation details.</p>
<p><br />
 </p>
<h2><a class="anchor" id="storelogfile"></a>
Store Log File&nbsp;&nbsp;<small><a href="#storelogfile">&lt;-</a></small></h2>
<p>The Store Process generates log messages that are used to monitor its health and operation. You can configure these to be directed to "console" (standard output) or a specified log "file", via the <a class="el" href="index.html#umeelementlog">UMP Element "&lt;log&gt;"</a>. Normally "console" is only used during testing, as a persistent log file is preferred for production use. The Store does not over-write log files on startup, but instead appends them.</p>
<p><br />
 </p>
<h2><a class="anchor" id="storerollinglogs"></a>
Store Rolling Logs&nbsp;&nbsp;<small><a href="#storerollinglogs">&lt;-</a></small></h2>
<p>To prevent unbounded disk file growth, the Store supports rolling log files. When the log file rolls, the file is renamed according to the model: <br />
&#160;&#160;<em>CONFIGUREDNAME</em><code>_</code><em>PID</em><code>.</code><em>DATE</em><code>.</code><em>SEQNUM</em> <br />
where: </p><ul>
<li>
<em>CONFIGUREDNAME</em> - Root name of log file, as configured by user. </li>
<li>
<em>PID</em> - Process ID of the Store Process. </li>
<li>
<em>DATE</em> - Date that the log file was rolled, in YYYY-MM-DD format. </li>
<li>
<em>SEQNUM</em> - Sequence number, starting at 1 when the process starts, and incrementing each time the log file rolls. </li>
</ul>
<p>For example: <code>umestorelog_9867.2017-08-20.2</code></p>
<p>The user can configure when the log file is eligible to roll over by either or both of two criteria: size and frequency. The size criterion is in millions of bytes. The frequency criterion can be daily or hourly. Once one or both criteria are met, the next message written to the log will trigger a roll operation. These criteria are supplied as attributes to the <a class="el" href="index.html#umeelementlog">UMP Element "&lt;log&gt;"</a>.</p>
<p>If both criteria are supplied, then the first one to be reached will trigger a roll. For example, consider the setting: </p><div class="fragment"><div class="line">&lt;log type=<span class="stringliteral">&quot;file&quot;</span> size=<span class="stringliteral">&quot;23&quot;</span> frequency=<span class="stringliteral">&quot;daily&quot;</span>&gt;store.log&lt;/log&gt;</div></div><!-- fragment --><p> Let say that the log file grows at 1 million bytes per hour. At 11:00 pm, the log file will reach 23 million bytes, and will roll. Then, at 12:00 midnight, the log file will roll again, even though it is only 1 million bytes in size.</p>
<dl class="section note"><dt>Note</dt><dd>The rolling logs cannot be configured to automatically overwrite old logs. Thus, the amount of disk space consumed by log files will grow without bound. The user must implement a desired process of archiving or deleting older log files according to the user's preference.</dd></dl>
<p><br />
 </p>
<h2><a class="anchor" id="quorumconsensusstoreusage"></a>
Quorum/Consensus Store Usage&nbsp;&nbsp;<small><a href="#quorumconsensusstoreusage">&lt;-</a></small></h2>
<p>To provide the highest degree of resiliency in the face of failures, UM provides the Quorum/Consensus failover strategy which allows a source to provide UM with a number of Stores to be used at the same time. Multiple Stores can fail and messaging can continue operation unhindered as long as a majority of configured Stores are operational.</p>
<p>Quorum/Consensus, also called QC, allows a source and the associated receivers to have their persisted state maintained at several Stores at the same time. Central to QC is the concept of a group of Stores, which is a logical grouping of Stores that are intended to signify a single entity of resilience. Within the group, individual Stores may fail but for the group as a whole to be viable and provide resiliency, a quorum must be available. In UM, a quorum is a simple majority. For example, in a group of five Stores, three Stores are required to maintain a quorum. One or two Stores may fail and the group continues to provide resiliency. UM requires a source to have a quorum of Stores available in the group in order to send messages. A group can consist of a single Store.</p>
<p>QC also provides the ability to use multiple groups. The use of multiple QC groups is a special case and should be discussed with Informatica support before using.</p>
<p><br />
 </p>
<h2><a class="anchor" id="sourcesusingquorumconsensusstoreconfiguration"></a>
Sources Using Quorum/Consensus Store Configuration&nbsp;&nbsp;<small><a href="#sourcesusingquorumconsensusstoreconfiguration">&lt;-</a></small></h2>
<p>In the case of Quorum/Consensus Store behavior, a message is considered stable after it has been successfully stored within a group of Stores or among groups of Stores according to the two settings, intergroup behavior and intragroup behavior, described below.</p>
<ul>
<li>
<p class="startli">The intragroup behavior specifies the requirements needed to stabilize a message among the Stores within a group. A message is stable for the group once it is successfully stored at a quorum (majority) of the group's Stores or successfully stored in all the Stores in the group.</p>
<p class="endli"></p>
</li>
<li>
The intergroup behavior specifies the requirements needed to stabilize a message among groups of Stores. A message is stable among the groups if it is successfully stored at any group, a majority of groups, all groups, or all active groups. </li>
</ul>
<p>Notice that a message needs to meet intragroup stability requirements before it can meet intergroup stability requirements. These options provide a number of possibilities for retention of messages for the source.</p>
<p><br />
 </p><hr/>
<h1><a class="anchor" id="persistentfaultrecovery"></a>
Persistent Fault Recovery&nbsp;&nbsp;<small><a href="#persistentfaultrecovery">&lt;-</a></small></h1>
<p>Recovery from source and receiver failure is the real heart of persistent operation. For a source, this means continuing operation from where it stopped. For a receiver, this means essentially the same thing, but with the retransmission of missed messages. Application developers can easily leverage the information in UM to make their applications recover from failure in graceful ways.</p>
<p><a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/design.tag:../../Design/" href="../../Design/fundamentalconcepts.html#latejoin">Late Join</a> is the mechanism of persistent recovery as well as an UM streaming feature. If Late Join is turned off on a source (<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grplatejoin.html#latejoinsource">late_join (source)</a>) or receiver (<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grplatejoin.html#uselatejoinreceiver">use_late_join (receiver)</a>), it also turns off persistent recovery. In order to control Late Join behavior, UM provides a mechanism for a receiver to control the low sequence number. See <a class="el" href="index.html#recoverymanagement">Recovery Management</a>.</p>
<p>Not all failures are recoverable. For application developers it usually pays in the long run to identify what types of errors are non-recoverable and how best to handle them when possible. Such an exercise establishes the precise boundaries of expected versus abnormal operating conditions.</p>
<p><br />
 </p>
<h2><a class="anchor" id="persistentsourcerecovery"></a>
Persistent Source Recovery&nbsp;&nbsp;<small><a href="#persistentsourcerecovery">&lt;-</a></small></h2>
<p>The following shows the basic steps of source recovery:</p>
<ol>
<li>
Re-register with the Store. </li>
<li>
Determine the highest sequence number that the Store has from the source. </li>
<li>
Resume sending with the next sequence number. </li>
</ol>
<p>Because UM allows you to stream messages and not wait until a message is stable at the Persistent Store before sending the next message, the main task of source recovery is to determine what messages the Persistent Store(s) have and what they don't. Therefore, when a source re-registers with a Store during recovery, the Store tells the source what sequence number it has as the most recent from the source. The registration event informs the application of this sequence number. See <a class="el" href="index.html#sourceeventhandler">Source Event Handler</a>.</p>
<p>In addition, a mechanism exists (LBM_SRC_EVENT_SEQUENCE_NUMBER_INFO) that allows the application to know the sequence number assigned to every piece of data it sends. The combination of registration and sequence number information allows an application to know exactly what a Store does have and what it does not and where it should pick up sending. An application designed to stream data in this way should consider how best to maintain this information.</p>
<p>When QC is in use, UM uses the consensus of the group(s) to determine what sequence number to use in the first message it will send. This is necessary as not all Stores can be expected to be in total agreement about what was sent in a distributed system. The application can configure the source with the <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umeconsensussequencenumberbehaviorsource">ume_consensus_sequence_number_behavior (source)</a> to use the lowest sequence number of the latest group of sequence numbers seen from any Store, the highest, or the majority. In most cases, the majority, which is the default, makes the most sense as the consensus. The lowest is a very conservative setting. And the highest is somewhat optimistic. Your application has the flexibility to handle this in any way needed.</p>
<p>If streaming is not what an application desires due to complexity, then it is very simple to use the <a class="el" href="index.html#persistenceevents">Persistence Events</a> delivered to the application to mimic the behavior of restricting a source to having only one unstable message at a time.</p>
<p><br />
 </p>
<h2><a class="anchor" id="persistentreceiverrecovery"></a>
Persistent Receiver Recovery&nbsp;&nbsp;<small><a href="#persistentreceiverrecovery">&lt;-</a></small></h2>
<p>The following shows the basic steps of receiver recovery:</p>
<ol>
<li>
Re-register with the Store. </li>
<li>
Determine the low sequence number. </li>
<li>
Request retransmission of messages starting with the low sequence number. </li>
</ol>
<p>UM provides extensive options for controlling how receivers handle recovery. By default, receivers want to restart after the last piece of data that was consumed prior to failure or graceful suspension. Since UM persists receiver state at the Store, receivers request this state from the Store as part of re-registration and recovery. Receiving applications experiencing unrecoverable loss can potentially retrieve missed messages from the Stores by deleting and recreating the receiver object.</p>
<p>The actual sequence number that a receiver uses as the first topic level message to resume reception with is called the "low sequence number". UM provides a means of modifying this sequence number if desired. An application can decide to use the sequence number as is, to use an even older sequence number, to use a more recent sequence number, or to simply use the most recent sequence number from the source. See <a class="el" href="index.html#recoverymanagement">Recovery Management</a> and <a class="el" href="index.html#settingcallbackfunctiontosetrecoverysequencenumber">Setting Callback Function to Set Recovery Sequence Number</a>. This allows receivers great flexibility on a per source basis when recovering. New receivers, receivers with no pre-existing registration, also have the same flexibility in determining the sequence number to begin data reception.</p>
<p>Like sources, when QC is in use, UM uses the consensus of the group(s) to determine the low sequence number. And as with sources, this is necessary as not all Stores can be expected to be in total agreement about what was acknowledged. The application can configure the receiver with <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umeconsensussequencenumberbehaviorreceiver">ume_consensus_sequence_number_behavior (receiver)</a> to use the lowest sequence number of the latest group of sequence numbers seen from any Store, the highest, or the majority. In most cases, the majority, which is the default, makes the most sense as the consensus. The lowest is a very conservative setting. And the highest is somewhat optimistic. In addition, this sequence number may be modified by the application after the consensus is determined.</p>
<p>For QC, UM load balances receiver retransmission requests among the available Stores. In addition, if requests are unanswered, retransmissions of the actual requests will use different Stores. This means that as long as a single Store has a message, then it is possible for that message to be retransmitted to a requesting receiver.</p>
<p><br />
 </p><hr/>
<h1><a class="anchor" id="callablestore"></a>
Callable Store&nbsp;&nbsp;<small><a href="#callablestore">&lt;-</a></small></h1>
<p>It is possible for an application to start an instance of the Store to run as an independent set of threads within the application process. However, there are several restrictions:</p>
<ol>
<li>
<p class="startli">The application may not make use of messaging. I.e. an application which intends to start a Store instance must not create contexts, sources, or receivers, or make any use of UM except starting (and optionally stopping) the Store. For applications that need to use messaging, it is suggested that the application create a child process from which to invoke the Store. The parent process can then use messaging freely.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">Only a C API is provided at this time. Two API functions are available: <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/umestored__main_8h.html#ae0f0d211a889aee9ea3f4f57d4c75e3a">umestored_main()</a> to start the Store threads running, and <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/umestored__main_8h.html#a974d80bb5206243675c3e0646cbd88d4">umestored_main_shutdown()</a> to request the Store threads to stop gracefully.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">The <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/umestored__main_8h.html#ae0f0d211a889aee9ea3f4f57d4c75e3a">umestored_main()</a> API will not return until the Store exits, either by processing a signal, or by the application calling <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/umestored__main_8h.html#a974d80bb5206243675c3e0646cbd88d4">umestored_main_shutdown()</a>. When <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/umestored__main_8h.html#ae0f0d211a889aee9ea3f4f57d4c75e3a">umestored_main()</a> does return, the Store is in a safe state for the application to exit.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">Only a single instance of the Store may be started. This means that an application may not have two Stores running concurrently, and it also means that an application may not start a Store, shut it down, and then start it again. The Store API is "single use".</p>
<p class="endli"></p>
</li>
<li>
The application may not set signal handlers for SIGPIPE, SIGUSR1, SIGINT, or SIGTERM. The Store uses those signals. For applications that need to handle those signals, it is suggested that the application create a child process, as mentioned above (#1). </li>
</ol>
<p>See <a href="../../API/umestored__main_8h.html">umestored_main.h File Reference</a> for API details.</p>
<p>The API code is <em>not</em> contained within the normal "lbm" library. On Linux, it is in "libumestorelib.a", a static library. On Windows, it is in "umestore.dll", a dynamic library.</p>
<p>For an example of how to use the <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/umestored__main_8h.html#ae0f0d211a889aee9ea3f4f57d4c75e3a">umestored_main()</a> API, see the example program <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/example.tag:../../example/" href="../../example/index.html#exampleumestored_example_c">Example umestored_example.c</a>. Note that while the callable Store APIs are usable on all supported platforms, this example program is restricted to Linux due to its use of <code>prctl()</code>, a Linux-only function.</p>
<p><br />
 </p><hr/>
<h1><a class="anchor" id="storethreadaffinity"></a>
Store Thread Affinity&nbsp;&nbsp;<small><a href="#storethreadaffinity">&lt;-</a></small></h1>
<p>A significant performance improvement of the Store can be obtained by "pinning" threads to CPU cores. Normally, the operating system will migrate a process's threads to different CPU cores, depending on what else is going on in the host. This can degrade the process's performance in a number of ways, mostly related to memory access (cache, NUMA zones). By setting the CPU affinity for the performance-sensitive threads, you avoid this degradation.</p>
<p>For high-throughput applications, you will gain significant performance improvement by constraining the operating system to run the Store's threads on specific CPU cores. All of a Store's threads should run on cores in the same physical CPU chip.</p>
<p>For maximum benefit, you should "isolate" the cores running the message reception threads. This prevents the operating system from scheduling other processes/threads on those cores.</p>
<p><b>Setting Affinity</b></p>
<p>When the Store Process is executed, the user can optionally use the "-a" option to set CPU affinity to the various threads. See <a class="el" href="index.html#umestoredmanpage">Umestored Man Page</a>.</p>
<p>Note that for the Windows Service, you don't supply the option when the service is run. Instead you save the thread affinity into the Windows registry for subsequent use by the Store Windows Service. See <a class="el" href="index.html#umestoredsmanpage">Umestoreds Man Page</a> and <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/operations.tag:../../Operations/" href="../../Operations/startupshutdownprocedures.html#configurethewindowsservice">Configure the Windows Service</a>.</p>
<p>The "-a" option takes a comma-separate list of CPU (core) numbers. For example, "-a 1,3,1,..." refers to CPU 1, CPU 3, CPU 1 again, etc.</p>
<p>The sequence of numbers are assigned to threads as follows:</p>
<p>The first number is the "process" CPU number, which is used for all miscellaneous threads that aren't otherwise assigned.</p>
<p>The next 4 numbers are assigned to a Store's operational threads in the following sequence: </p><ol>
<li>
Message reception thread. </li>
<li>
Proxy source thread. </li>
<li>
Receiver recovery thread. </li>
<li>
Auxiliary thread. </li>
</ol>
<p>If the Store Process has multiple Stores configured, additional groups of 4 numbers should be supplied.</p>
<p>Of these threads, the most critical is the message reception thread. For best performance, each Store's message reception thread should be given exclusive access to its own CPU core.</p>
<p>The receiver recovery thread is also important, since it can affect the speed at which receivers can recover missed messages. However, since CPU cores are scarce resources on hosts, it may not be practical to give each receiver recovery thread its own core.</p>
<p>The proxy source and auxiliary threads are not critical to general Store throughput, and are therefore generally assigned to the "process" core as miscellaneous.</p>
<p><b>Affinity Example</b></p>
<p>For example, suppose you have a Store Process configured for two Stores. Further, let's say that on your host, even-numbered CPUs belong to one physical CPU chip, and odd-numbered CPUs belong to a different physical CPU chip. The following would optimize both message reception and message recovery, at the expense of consuming 5 cores:</p>
<pre class="fragment">umestored -a 3,5,3,7,3,9,3,11,3 ...
</pre><p>This assigns: </p><ul>
<li>
the process's miscellaneous threads to CPU 3, </li>
<li>
the first Store's message reception thread to CPU 5, </li>
<li>
the first Store's proxy source thread to CPU 3, </li>
<li>
the first Store's receiver recovery thread to CPU 7, </li>
<li>
the first Store's auxiliary thread to CPU 3, </li>
<li>
the second Store's message reception thread to CPU 9, </li>
<li>
the second Store's proxy source thread to CPU 3, </li>
<li>
the second Store's receiver recovery thread to CPU 11, </li>
<li>
the second Store's auxiliary thread to CPU 3. </li>
</ul>
<p>If assigning this many cores to the Store Process is not practical, the following conserves cores at the expense of potentially degrading message recovery speed:</p>
<pre class="fragment">umestored -a 3,5,3,3,3,7,3,3,3 ...
</pre><p>This assigns a CPU core to each of the two message reception threads (5 and 7), and groups all other threads onto the miscellaneous CPU core (3).</p>
<p><br />
 </p><hr/>
<h1><a class="anchor" id="persistencefaulttolerance"></a>
Persistence Fault Tolerance&nbsp;&nbsp;<small><a href="#persistencefaulttolerance">&lt;-</a></small></h1>
<p><br />
 </p>
<h2><a class="anchor" id="messagelossrecovery"></a>
Message Loss Recovery&nbsp;&nbsp;<small><a href="#messagelossrecovery">&lt;-</a></small></h2>
<p>Persistence offers the following message recovery mechanisms:</p>
<table class="doxtable">
<tr>
<th>Method </th><th>Product </th><th>Transports </th><th><p class="starttd">Description</p>
<p class="endtd"></p>
</th></tr>
<tr>
<td>Negative Acknowledgments (NAKs) </td><td>UMS, UMP, UMQ </td><td>LBT-RM, LBT-RU </td><td><p class="starttd">Recovers lost transport datagrams from the source which may contain many small topic messages or fragments of a large message. Receivers send unicast NAKs to the source for missed transport datagrams. Source retransmits datagrams over the configured UM transport.</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>Late Join </td><td>UMS, UMP, UMQ </td><td>All </td><td><p class="starttd">Retransmits messages via unicast to receivers joining the stream after the messages were originally sent. See <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/design.tag:../../Design/" href="../../Design/umfeatures.html#usinglatejoin">Using Late Join</a>.</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>Durable Receiver Recovery </td><td>UMP, UMQ </td><td>All </td><td><p class="starttd">Recovers messages persisted while a durable receiver was off line. UM initiates recovery when a durable receiver joins a persistent stream. The receiver then requests retransmission from the Store starting with the low sequence number, defined as the last message it acknowledged to the Store plus one. The Store unicasts retransmissions. See <a class="el" href="index.html#persistentreceiverrecovery">Persistent Receiver Recovery</a>.</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>Off Transport Recovery </td><td>UMS, UMP, UMQ </td><td>All </td><td><p class="starttd">Recovers lost topic messages. Receiver detects lost sequence number and requests retransmission from the source or Persistent Stores (if applicable). UM unicasts retransmissions. See <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/design.tag:../../Design/" href="../../Design/umfeatures.html#offtransportrecoveryotr">Off-Transport Recovery (OTR)</a>.</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>Proactive Retransmissions </td><td>UMP, UMQ </td><td>All </td><td>Recovers lost messages never received by the Store or never acknowledged by the Store. Operates independently of any receivers. Source unicasts retransmissions. See <a class="el" href="index.html#proactiveretransmissions">Proactive Retransmissions</a>. </td></tr>
</table>
<p><br />
 </p>
<h2><a class="anchor" id="persistenceproxysources"></a>
Persistence Proxy Sources&nbsp;&nbsp;<small><a href="#persistenceproxysources">&lt;-</a></small></h2>
<p>By default, UM expects persistent sources to be running concurrently with persistent receivers. If a source exits, any persistent receivers will disconnect from that source's transport and will wait for the source to come back. More significantly, if a new receiver starts while the source is absent, the receiver will be unable to discover the Stores where the old source's previous messages are Stored. So that late-joining receiver will not recover messages until the source finally restarts.</p>
<p>The Proxy Source feature allows you to configure Stores to automatically continue sending the source's topic advertisements which allow new receivers to join the source's transport session and request Source Registration Information (SRI) to register with the Store and request retransmissions. After the source returns, the Store automatically stops acting as a proxy source. Stores can be located across a <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/design.tag:../../Design/" href="../../Design/fundamentalconcepts.html#umrouter">DRO</a> or within the same LAN as the failed source.</p>
<p>Some other features of Proxy Sources include:</p>
<ul>
<li>
<p class="startli">Requires a Quorum/Consensus Store configuration.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">Normal Store failover operation also initiates a new proxy source.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">A Store can be running more than one proxy source if more than one source has failed.</p>
<p class="endli"></p>
</li>
<li>
A Store can be running multiple proxy sources for the same topic, each one corresponding to a previous instance of a real source. </li>
</ul>
<p>Note that proxy sources do introduce extra network and CPU loading, so proxy sources should only be enabled if their functionality is needed.</p>
<p><br />
 </p>
<h3><a class="anchor" id="howproxysourcesoperate"></a>
How Proxy Sources Operate&nbsp;&nbsp;<small><a href="#howproxysourcesoperate">&lt;-</a></small></h3>
<p>The following sequence illustrates the life of a proxy source:</p>
<ol>
<li>
<p class="startli">A source configured for Proxy Source sends to receivers and a group of Quorum/Consensus Stores.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">The source fails.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">The source's <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umeactivitytimeoutsource">ume_activity_timeout (source)</a> or the Store's <a class="el" href="index.html#umecfgsourceactivitytimeout">source-activity-timeout</a> expires.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">The Quorum/Consensus Stores elect a single Store to run the proxy source.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">The elected Store creates a proxy source and sends topic advertisements.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">The failed source reappears.</p>
<p class="endli"></p>
</li>
<li>
The Store deletes the proxy source and the original source resumes activity. </li>
</ol>
<p>If the Store running the proxy source fails, the other Stores in the Quorum/Consensus group detect a source failure again and elect a new Store to initiate a proxy source.</p>
<p>If a loss of quorum occurs, the proxy source can continue to send advertisements, but cannot send messages until a quorum is re-established.</p>
<p><br />
 </p>
<h3><a class="anchor" id="activitytimeoutandstatelifetimes"></a>
Activity Timeout and State Lifetimes&nbsp;&nbsp;<small><a href="#activitytimeoutandstatelifetimes">&lt;-</a></small></h3>
<p>UM provides activity and state lifetime timers for sources and receivers that operate in conjunction with the proxy source option or independently. This section explains how these timers work together and how they work with proxy sources.</p>
<p>The <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umeactivitytimeoutsource">ume_activity_timeout (source)</a> and <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umeactivitytimeoutreceiver">ume_activity_timeout (receiver)</a> options determine how long a source or receiver must be inactive before a Store allows another source or receiver to register using that RegID. This prevents a second source or receiver from stealing a RegID from an existing source or receiver. An activity timeout can be configured for the source/receiver with the LBM configuration option cited above or with a topic's <a class="el" href="index.html#umeelementumeattributes">UMP Element "&lt;ume-attributes&gt;"</a> in the Store configuration file. The following diagram illustrates the default activity timeout behavior, which uses <a class="el" href="index.html#umecfgsourcestatelifetime">source-state-lifetime</a> in the Store configuration file.</p>
<div class="image">
<img src="source_act_timeout_def.png" alt="source_act_timeout_def.png"/>
</div>
 <p>In addition to the activity timeout, you can also configure sources and receivers with a state lifetime timer using the following options.</p>
<ul>
<li>
<p class="startli"><a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umestatelifetimesource">ume_state_lifetime (source)</a></p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umestatelifetimereceiver">ume_state_lifetime (receiver)</a></p>
<p class="endli"></p>
</li>
<li>
The topic's ume-attributes options, <a class="el" href="index.html#umecfgsourcestatelifetime">source-state-lifetime</a> and <a class="el" href="index.html#umecfgreceiverstatelifetime">receiver-state-lifetime</a>. </li>
</ul>
<p>The <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umestatelifetimesource">ume_state_lifetime (source)</a> and <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umestatelifetimereceiver">ume_state_lifetime (receiver)</a> options, when used in conjunction with the <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umeactivitytimeoutsource">ume_activity_timeout (source)</a> and <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umeactivitytimeoutreceiver">ume_activity_timeout (receiver)</a> options, determines at what point UM removes the source or receiver state files. UM does not check the state lifetime until the activity timeout expires. The following diagram illustrates this behavior:</p>
<div class="image">
<img src="source_state_lifetime.png" alt="source_state_lifetime.png"/>
</div>
 <p>If you have enabled the Proxy Source option, the <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umeactivitytimeoutsource">ume_activity_timeout (source)</a> triggers the creation of the proxy source. The following diagram illustrates this behavior:</p>
<div class="image">
<img src="src_act_and_state_timers.png" alt="src_act_and_state_timers.png"/>
</div>
 <p><br />
 </p>
<h3><a class="anchor" id="enablingtheproxysources"></a>
Enabling the Proxy Sources&nbsp;&nbsp;<small><a href="#enablingtheproxysources">&lt;-</a></small></h3>
<p>You must configure both the source and the Stores to enable the Proxy Source option.</p>
<ul>
<li>
<p class="startli">Configure the source in an LBM Configuration File with the source configuration option, <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umeproxysourcesource">ume_proxy_source (source)</a>.</p>
<p class="endli"></p>
</li>
<li>
Configure the Stores in the Store configuration file with the Store Element Option, <a class="el" href="index.html#umecfgallowproxysource">allow-proxy-source</a>. </li>
</ul>
<p><br />
 </p>
<h3><a class="anchor" id="proxysourceelections"></a>
Proxy Source Elections&nbsp;&nbsp;<small><a href="#proxysourceelections">&lt;-</a></small></h3>
<p>When the Stores configured for proxy source detect the loss of a registered source (expiration of the source's <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umeactivitytimeoutsource">ume_activity_timeout (source)</a>), one of the Stores should create a proxy source. The Stores of a Q/C group perform an election to determine which Store creates the proxy.</p>
<p>Each Store starts by waiting a randomized amount of time based on its <a class="el" href="index.html#umecfgproxyelectioninterval">proxy-election-interval</a> option setting. The Store creates a proxy source if it has not received a persistent registration request (PREG) from a proxy on a different Store. The proxy source then sends a PREG containing a unique random value to the other Stores. This value determines which Store deletes it's proxy source in the case that any two Stores independently determine they should create a proxy source. The nature of the random values ensures that only one Store within the QC group or configuration of groups keeps its proxy source.</p>
<p>Note that <a class="el" href="index.html#umecfgsourceactivitytimeout">Topic Option "source-activity-timeout"</a> value should be set to at least double the <a class="el" href="index.html#umecfgkeepaliveinterval">Topic Option "keepalive-interval"</a> value.</p>
<p>There are two algorithms that the Stores can use when holding a proxy source election: </p><ol>
<li>
Quorum not required (default), </li>
<li>
Quorum required (new as of UM version 6.15; set <a class="el" href="index.html#umecfgproxysourcerepoquorumrequired">Store Option "proxy-source-repo-quorum-required"</a> to 1). </li>
</ol>
<p>Informatica recommends that new projects use algorithm 2 (Quorum required). This is not the default and must be explicitly set. Existing projects that use algorithm 1 and do not have problems related to proxy sources do not need to change.</p>
<p><b>ALGORITHM DETAILS:</b></p>
<p>A proxy source is specific to a topic/reg-ID (or topic/session-ID). When a source exits (publisher deletes it or crashes), the Stores time the source out and hold an election to determine which Store will create a proxy source.</p>
<p>With algorithm 1 (quorum not required), every running Store in the Q/C group participates in the election.</p>
<p>With algorithm 2 (quorum required), only those Stores that have state for the topic/reg-ID will participate. A proxy source will be elected only if a quorum of Stores participate.</p>
<p>Algorithm 2 was introduced in UM version 6.15 to help customers who need to perform an un-recommended Store restart procedure whereby the state and cache files are deleted before restarting. Informatica recommends retaining the state and cache files over a restart, but we also understand that sometimes it is unavoidable and a Store must be started "clean" (for example, if a disk fails).</p>
<p>Creating a proxy source for a particular topic/reg-ID that does not have a quorum of repositories is contrary to the general design of UM persistence. Selecting algorithm 2 conforms with the UM persistence design.</p>
<p><br />
 </p>
<h3><a class="anchor" id="proactiveretransmissions"></a>
Proactive Retransmissions&nbsp;&nbsp;<small><a href="#proactiveretransmissions">&lt;-</a></small></h3>
<p>Proactive Retransmissions, which is enabled by default, address two types of loss:</p>
<ul>
<li>
<p class="startli">loss of message data between the source and a Store</p>
<p class="endli"></p>
</li>
<li>
loss of stability acknowledgments (ACK) between the Store and the source </li>
</ul>
<p>The Store sends message stability acknowledgments to the source after the Store persists the message data.</p>
<p>With Proactive Retransmissions, the source maintains an unstable message queue for those messages sent but not acknowledged by the Store. The source checks this queue at the <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umemessagestabilitytimeoutsource">ume_message_stability_timeout (source)</a>. If a message in this queue exceeds its <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umemessagestabilitytimeoutsource">ume_message_stability_timeout (source)</a>, the source retransmits the message and puts it back on the unstabilized message queue, restarting the message's <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umemessagestabilitytimeoutsource">ume_message_stability_timeout (source)</a>.</p>
<p>The source continues to retransmit and check the message's stability timeout until the <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umemessagestabilitylifetimesource">ume_message_stability_lifetime (source)</a> expires or it receives a stability acknowledgment from the Store. If the source has not received a stability acknowledgment when the <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umemessagestabilitylifetimesource">ume_message_stability_lifetime (source)</a> expires, the source sends a Store Message Not Stable source event notification to the application. When the Store discards the message because it has not met stability requirements, the Store sends a Store Forced Reclaim source event notification to the application.</p>
<p>To disable Proactive Retransmissions, set <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umemessagestabilitytimeoutsource">ume_message_stability_timeout (source)</a> to 0 (zero). As a result, sources do not create an unstable message queue.</p>
<p>The following applies whether you enable or disable Proactive Retransmissions.</p>
<ul>
<li>
<p class="startli">The Store does not discard duplicate messages, but rather always responds to duplicate, retransmitted messages by sending stability acknowledgments even if the message is already stable.</p>
<p class="endli"></p>
</li>
<li>
If the Store has marked the message unrecoverably lost and receives a duplicate message from the source, the Store sends the source a negative stability acknowledgment (NAK), which induces the source to remove the message from its unstabilized message queue. A stability NAK is identical to a stability ACKs except that it has a NAK flag set. </li>
</ul>
<p><br />
 </p><hr/>
<h1><a class="anchor" id="configuringforpersistenceandrecovery"></a>
Configuring for Persistence and Recovery&nbsp;&nbsp;<small><a href="#configuringforpersistenceandrecovery">&lt;-</a></small></h1>
<p>Deployment decisions play a huge role in the success of any persistent system. Configuration in UM has a number of options that aid in performance, fault recovery, and overall system stability. It is not possible, or at least not wise, to totally divorce configuration from application development for high performance systems. This is true not only for persistent systems, but for practically all distributed systems. When designing systems, deployment considerations need to be taken into account for the following:</p>
<ul>
<li>
<p class="startli"><a class="el" href="index.html#sourceconsiderations">Source Considerations</a>.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><a class="el" href="index.html#receiverconsiderations">Receiver Considerations</a>.</p>
<p class="endli"></p>
</li>
<li>
<a class="el" href="index.html#storeconfigurationconsiderations">Store Configuration Considerations</a>. </li>
</ul>
<p><br />
 </p>
<h2><a class="anchor" id="sourceconsiderations"></a>
Source Considerations&nbsp;&nbsp;<small><a href="#sourceconsiderations">&lt;-</a></small></h2>
<p>Performance of sources is heavily impacted by:</p>
<ul>
<li>
<p class="startli">The release policy that the source uses,</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">Streaming methods of the source,</p>
<p class="endli"></p>
</li>
<li>
The throughput and latency requirements of the data. </li>
</ul>
<p>Source release settings have a direct impact on memory usage. As messages are retained, they consume memory. You reclaim memory when you release messages. Message stability, delivery confirmation and retention size all interact to create your release policies. UM provides a hard limit on the memory usage. When exceeded, UM delivers a Forced Reclamation event. Thus applications that anticipate forced reclamations can handle them appropriately. See also <a class="el" href="index.html#sourcemessageretentionandrelease">Source Message Retention and Release</a>.</p>
<p>How the source streams data has a direct impact on latency and throughput. One streaming method sets a maximum, outstanding count of messages. Once reached, the source does not send any more until message stability notifications come in to reduce the number of outstanding messages. The umesrc example program uses this mechanism to limit the speed of a source to something a Store can handle comfortably. This also provides a maximum bound on recovery that can simplify handling of streaming source recovery.</p>
<p>The throughput and latency requirements of the data are normal UM concerns.</p>
<p><br />
 </p>
<h2><a class="anchor" id="receiverconsiderations"></a>
Receiver Considerations&nbsp;&nbsp;<small><a href="#receiverconsiderations">&lt;-</a></small></h2>
<p>In addition to the following, receiver performance shares the same considerations as receivers during normal operation.</p>
<p><br />
 </p>
<h3><a class="anchor" id="receiveracknowledgementgeneration"></a>
Receiver Acknowledgement Generation&nbsp;&nbsp;<small><a href="#receiveracknowledgementgeneration">&lt;-</a></small></h3>
<p>Persistent receivers send a message consumption acknowledgement to Stores and the message source. Some applications may want to control this acknowledgement explicitly themselves. In this case, <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umeexplicitackonlyreceiver">ume_explicit_ack_only (receiver)</a> can be used.</p>
<p><br />
 </p>
<h3><a class="anchor" id="controllingretransmission"></a>
Controlling Retransmission&nbsp;&nbsp;<small><a href="#controllingretransmission">&lt;-</a></small></h3>
<p>Receivers send retransmission requests and receive and process retransmissions. Control over this process is crucial when handling very long recoveries, such as hundreds of thousands or millions of messages. A receiver only sends a certain number of retransmission requests at a time.</p>
<p>This means that a receiver will not, unless configured to with <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grplatejoin.html#retransmitrequestoutstandingmaximumreceiver">retransmit_request_outstanding_maximum (receiver)</a>, request everything at once. The value of the low sequence number (<a class="el" href="index.html#persistentreceiverrecovery">Persistent Receiver Recovery</a>) has a direct impact on how many requests need to be handled. A receiving application can decide to only handle the last X number of messages instead of recovering them all using the option, <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grplatejoin.html#retransmitrequestmaximumreceiver">retransmit_request_maximum (receiver)</a>. The timeout used between requests, if the retransmission does not arrive, is totally controllable with <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grplatejoin.html#retransmitrequestintervalreceiver">retransmit_request_interval (receiver)</a>. And the total time given to recover all messages is also controllable.</p>
<p><br />
 </p>
<h3><a class="anchor" id="receiverrecoveryprocess"></a>
Receiver Recovery Process&nbsp;&nbsp;<small><a href="#receiverrecoveryprocess">&lt;-</a></small></h3>
<p>Theoretically, receivers can handle up to roughly 2 billion messages during recovery. This limit is implied from the sequence number arithmetic and not from any other limitation. For recovery, the crucial limiting factor is how a receiver processes and handles retransmissions which come in as fast as UM can request them and a Store can retransmit them. This is perhaps much faster than an application can handle them. In this case, it is crucial to realize that as recovery progresses, the source may still be transmitting new data. This data will be buffered until recovery is complete and then handed to the application. It is prudent to understand application processing load when planning on how much recovery is going to be needed and how it may need to be configured within UM.</p>
<p><br />
 </p>
<h2><a class="anchor" id="storeconfigurationconsiderations"></a>
Store Configuration Considerations&nbsp;&nbsp;<small><a href="#storeconfigurationconsiderations">&lt;-</a></small></h2>
<p>Stores have numerous configuration options. See <a class="el" href="index.html#configurationreferenceforumestored">Configuration Reference for Umestored</a> for details.</p>
<p><br />
 </p>
<h3><a class="anchor" id="configuringstoreusagepersource"></a>
Configuring Store Usage per Source&nbsp;&nbsp;<small><a href="#configuringstoreusagepersource">&lt;-</a></small></h3>
<p>A Store handles persisted state on a per topic per source basis. Based on the load of topics and sources, it may be prudent to spread the topic space, or just source space, across Stores as a way to handle large loads. As configuration of Store usage is per source, this is extremely easy to do. It is easy to spread CPU load via multi-threading as well as hard disk usage across Stores. A single Store Process can have a set of Store instances within it, each with their own thread.</p>
<p><br />
 </p>
<h3><a class="anchor" id="memoryusebystores"></a>
Memory Use by Stores&nbsp;&nbsp;<small><a href="#memoryusebystores">&lt;-</a></small></h3>
<p>As mentioned previously in <a class="el" href="index.html#persistentstoreconcept">Persistent Store Concept</a>, Stores can be memory based or disk based. Disk Stores also have the ability to spread hard disk usage across multiple physical disks by using multiple Store instances within a single Store Process. This gives great flexibility on a per source basis for spreading data reception and persistent data load.</p>
<p>Stores provide settings for controlling memory usage and for caching messages for retransmission in memory as well as on disk. All messages in a Store, whether in memory or on disk, have some small memory state. This is roughly about 72 bytes per message. For very large caches of messages, this can become non-trivial in size.</p>
<p><br />
 </p>
<h3><a class="anchor" id="activitytimeouts"></a>
Activity Timeouts&nbsp;&nbsp;<small><a href="#activitytimeouts">&lt;-</a></small></h3>
<p>Stores are NOT archives and are not designed for archival. Stores persist source and receiver state with the aim of providing message recovery in the event of a fault. Central to this is the concept that a source or receiver has an activity timeout attached to it. Once a source or receiver suspends operation or has a failure, it has a set time before the Store will forget about it. This activity timeout needs to be long enough to handle the recovery demands of sources and receivers. However, it can not and should not be infinite. Each source takes up memory and disk space, therefore an appropriate timeout should be chosen that meets the requirements of recovery, but is not excessively long so that the limited resources of the Store are exhausted.</p>
<p><br />
 </p>
<h3><a class="anchor" id="recommendationsforstoreconfiguration"></a>
Recommendations for Store Configuration&nbsp;&nbsp;<small><a href="#recommendationsforstoreconfiguration">&lt;-</a></small></h3>
<ul>
<li>
<p class="startli">Number of Stores in the <a class="el" href="index.html#quorumconsensusstorefailover">QC group</a>. Informatica recommends a minimum of 3 Stores. A publisher defines the QC Store QC group using the LBM configuration option <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umestoresource">ume_store (source)</a>. This option is specified multiple times to define the desired number of Stores in the QC group.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">Flight Size - Maximum number of messages sent but not stable in a quorum of Stores. The publishing application should not exceed the flight size. See <a class="el" href="index.html#persistenceflightsize">Persistence Flight Size</a> for configuration details.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/design.tag:../../Design/" href="../../Design/umfeatures.html#offtransportrecoveryotr">Off-Transport Recovery (OTR)</a>. Informatica recommends that Stores be configured to use OTR to recover lost messages from the Source. Note that the default for <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpofftransportrecovery.html#useotrreceiver">use_otr (receiver)</a> is "2", which does NOT enable OTR for the Store. Informatica recommends setting "use_otr" to 1 in the Store's LBM configuration file.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><a class="el" href="index.html#proactiveretransmissions">Proactive Retransmissions</a>. Informatica recommends that persistent sources use proactive retransmission to ensure message stability. See <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umemessagestabilitytimeoutsource">ume_message_stability_timeout (source)</a> (on by default).</p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/design.tag:../../Design/" href="../../Design/fundamentalconcepts.html#burstloss1">Burst Loss</a>. Informatica strongly recommends disabling "burst loss" by setting the LBM configuration option <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpdeliverycontrol.html#deliverycontrolmaximumburstlossreceiver">delivery_control_maximum_burst_loss (receiver)</a> to a very large number, perhaps 10000000. This should be done for both the Store's LBM configuration and for the subscriber's LBM configuration.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><a class="el" href="index.html#persistencebuffersizes">Persistence Buffer Sizes</a>. Informatica recommends performing an analysis of expected publisher data rates and worst-case data repair times to properly size the Store's retention buffer and the source's retention buffer (late join buffer). See <a class="el" href="index.html#persistencebuffersizes">Persistence Buffer Sizes</a>.</p>
<p class="endli"></p>
</li>
</ul>
<p><br />
 </p>
<h3><a class="anchor" id="storeconfigurationpracticestoavoid"></a>
Store Configuration Practices to Avoid&nbsp;&nbsp;<small><a href="#storeconfigurationpracticestoavoid">&lt;-</a></small></h3>
<p>Informatica recommends against the following Store configuration practices:</p>
<ul>
<li>
<p class="startli"><a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/design.tag:../../Design/" href="../../Design/fundamentalconcepts.html#burstloss1">Burst Loss</a> must be disabled in Stores and persistent receivers. Set <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpdeliverycontrol.html#deliverycontrolmaximumburstlossreceiver">delivery_control_maximum_burst_loss (receiver)</a> to a very large number (1000000).</p>
<p class="endli"></p>
</li>
<li>
Multiple Store QC groups require special attention. Please <a href="https://ultramessaging.github.io/UM_Support.html">contact Informatica support</a> before using. </li>
</ul>
<p><br />
 </p><hr/>
<h1><a class="anchor" id="manpagesforstore"></a>
Man Pages for Store&nbsp;&nbsp;<small><a href="#manpagesforstore">&lt;-</a></small></h1>
<p>Persistent Store services are provided by Store Process.</p>
<p>There are two executables for the Store, each with it's own man page: </p><ul>
<li>
<a class="el" href="index.html#umestoredmanpage">Umestored Man Page</a> - Unix and Windows command-line interface. </li>
<li>
<a class="el" href="index.html#umestoredsmanpage">Umestoreds Man Page</a> - Windows Service interface. </li>
</ul>
<p><br />
 </p>
<h2><a class="anchor" id="umestoredmanpage"></a>
Umestored Man Page&nbsp;&nbsp;<small><a href="#umestoredmanpage">&lt;-</a></small></h2>
<p>Unix and Windows command-line interface.</p>
<pre class="fragment">UMP Store daemon
Usage: umestored [options] configfile
Available options:
  -h, --help                     display this help and exit
  -d, --dump-dtd                 dump DTD to stdout
  -f, --detach                   detach from terminal (not supported on Windows)
  -v, --validate                 validate config, but do not run
  -a, --affinitize=PCPU[,RRLIST] assign CPU process affinity to PCPU. If optional RRLIST is given
                                 assigns CPU affinity in a round-robin sequence as key processing
                                 threads are created, example: -a 1,3,5 assigns CPU 1 to the process
                                 and CPUs 3, 5, 3, ... to created threads in a repeating sequence</pre><dl class="section user"><dt>Description</dt><dd>The <code>umestored</code> command runs the Store Process. It can be run interactively from a shell or command prompt, or from a script or batch file. (For use as a Windows Service, see <a class="el" href="index.html#umestoredsmanpage">Umestoreds Man Page</a>.)</dd></dl>
<dl class="section user"><dt></dt><dd>The <b>"configfile"</b> parameter is required and specifies the file path for the Store configuration file. See <a class="el" href="index.html#configurationreferenceforumestored">Configuration Reference for Umestored</a> for configuration details.</dd></dl>
<dl class="section user"><dt></dt><dd>The <b>"-f"</b> option directs a Unix-based <code>umestored</code> to fork a child process which detaches from the controlling terminal. The <code>umestored</code> command normally remains attached to the controlling terminal and runs until interrupted. With <b>"-f"</b>, the <code>umestored</code> command exits back to the shell, and the forked child continues running in the background.</dd></dl>
<dl class="section user"><dt></dt><dd>The <b>"-a"</b> option provides the CPU core affinity for Store threads. This "pins" the threads to one or more desired CPU cores, which can provide a significant improvement in throughput. See <a class="el" href="index.html#storethreadaffinity">Store Thread Affinity</a> for details.</dd></dl>
<dl class="section user"><dt></dt><dd>The <b>"-d"</b> option dumps (prints) the Store's XML DTD to standard output. After dumping the DTD, <code>umestored</code> exits.</dd></dl>
<dl class="section user"><dt></dt><dd>The <b>"-v"</b> option validates the XML structure of the given configuration file against the Store's XML DTD. After validating the configuration file's XML structure, <code>umestored</code> exits with status 0 for no errors, or non-zero if errors were found. For example: <pre class="fragment">umestored -v /um/store1_cfg.xml
</pre></dd></dl>
<dl class="section user"><dt></dt><dd>Note that valid XML structure does not guarantee that the configuration file is completely correct. It must be tested on a running Store.</dd></dl>
<dl class="section user"><dt></dt><dd>The <b>"-h"</b> option prints the man page and exits.</dd></dl>
<dl class="section user"><dt><b>Exit</b> <b>Status</b> </dt><dd>The exit status from <code>umestored</code> is 0 for success and some non-zero value for failure.</dd></dl>
<dl class="section user"><dt><b>Usage</b> <b>Notes</b> </dt><dd>When shutting down a Unix-based UM Persistent Store Process, use a SIGINT to trigger a clean shutdown, which attempts to cleanly finish outstanding IO requests before shutting down. Two successive SIGINTs force an immediate shutdown (not recommended unless absolutely necessary).</dd></dl>
<p><br />
 </p>
<h2><a class="anchor" id="umestoredsmanpage"></a>
Umestoreds Man Page&nbsp;&nbsp;<small><a href="#umestoredsmanpage">&lt;-</a></small></h2>
<p>Windows Service interface. See <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/operations.tag:../../Operations/" href="../../Operations/startupshutdownprocedures.html#umdaemonsaswindowsservices">UM Daemons as Windows Services</a> for general information about UM daemons as Windows Services.</p>
<pre class="fragment">UMP Store service
Usage: umestoreds [options] [configfile]
Available options:
  -E, --env_var_file             update/set environment variable file
  -U, --unset_env_var_file       unset the environment variable file
  -h, --help                     display this help and exit
  -d, --dump-dtd                 dump DTD to stdout
  -s, --service=install          install the service passing configfile
  -s, --service=remove           delete/remove the service
  -s, --service=config           update configfile info to use configfile passed
  -v, --validate                 validate config, but do not run
  -e, --event-log-level          update/set service logging level.  This is the minimum logging
                                 level to send to the Windows event log.  Valid values are:
                                    NONE - Send no events
                                    INFO
                                    WARN - default
                                    ERROR
  -a, --affinitize=PCPU[,RRLIST] assign CPU process affinity to PCPU. If optional RRLIST is given
                                 assigns CPU affinity in a round-robin sequence as key processing
                                 threads are created, example: -a 1,3,5 assigns CPU 1 to the process
                                 and CPUs 3, 5, 3, ... to created threads in a repeating sequence
  configfile                     XML config file (if not present, looks in registry)</pre><dl class="section user"><dt><b>Description</b> </dt><dd>The <code>umestoreds</code> command has two functions: <ul>
<li>
First, it lets the user supply Windows Service operating parameters, which the command saves into the Windows registry. Those operating parameters are subsequently used by the Store Service. See <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/operations.tag:../../Operations/" href="../../Operations/startupshutdownprocedures.html#configurethewindowsservice">Configure the Windows Service</a>. </li>
<li>
Second, it provides Windows with the Store Process executable to run as a Service. </li>
</ul>
</dd></dl>
<dl class="section user"><dt></dt><dd>The <b>"configfile"</b> parameter provides the file path for the Store configuration file. It is supplied in conjunction with the <b>"-v"</b> option or the <b>"-s config"</b> option (see below). See <a class="el" href="index.html#configurationreferenceforumestored">Configuration Reference for Umestored</a> for configuration details.</dd></dl>
<dl class="section user"><dt></dt><dd>For <b>"-s install"</b> see <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/operations.tag:../../Operations/" href="../../Operations/startupshutdownprocedures.html#installthewindowsservice">Install the Windows Service</a>.</dd></dl>
<dl class="section user"><dt></dt><dd>For <b>"-s remove"</b> see <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/operations.tag:../../Operations/" href="../../Operations/startupshutdownprocedures.html#removethewindowsservice">Remove the Windows Service</a>.</dd></dl>
<dl class="section user"><dt></dt><dd>For <b>"-s config"</b>, <b>"-e"</b>, <b>"-E"</b>, and <b>"-U"</b>, see <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/operations.tag:../../Operations/" href="../../Operations/startupshutdownprocedures.html#configurethewindowsservice">Configure the Windows Service</a>.</dd></dl>
<dl class="section user"><dt></dt><dd>The <b>"-a"</b> option specifies the CPU core affinity for Store threads, which is saved in the Windows registry and subsequently by the Windows Service. This "pins" the threads to one or more desired CPU cores, which can provide a significant improvement in throughput. See <a class="el" href="index.html#storethreadaffinity">Store Thread Affinity</a> for details.</dd></dl>
<dl class="section user"><dt></dt><dd>The <b>"-d"</b> option dumps (prints) the Store's XML DTD to standard output. After dumping the DTD, <code>umestoreds</code> exits.</dd></dl>
<dl class="section user"><dt></dt><dd>The <b>"-v"</b> option validates the XML structure of the given configuration file against the Store's XML DTD. After validating the configuration file's XML structure, <code>umestoreds</code> exits with status 0 for no errors, or non-zero if errors were found. For example: <pre class="fragment">umestoreds -v c:\um\store1_cfg.xml
</pre></dd></dl>
<dl class="section user"><dt></dt><dd>Note that valid XML structure does not guarantee that the configuration file is completely correct. It must be tested on a running Store.</dd></dl>
<dl class="section user"><dt></dt><dd>The <b>"-h"</b> option prints the man page and exits.</dd></dl>
<dl class="section user"><dt><b>Exit</b> <b>Status</b> </dt><dd>The exit status from <code>umestored</code> is 0 for success and some non-zero value for failure.</dd></dl>
<dl class="section user"><dt><b>Usage</b> <b>Notes</b> </dt><dd>When installing the UM Persistent Store as a Microsoft Windows service, use only local disk devices and fully qualified path names for all filenames. This is because Windows services run by default under a Local System account, which has reduced privileges and is not allowed access to network devices.</dd></dl>
<dl class="section user"><dt></dt><dd>Stopping the UM Persistent Store service triggers a clean shutdown, which attempts to cleanly finish outstanding IO requests before shutting down.</dd></dl>
<dl class="section attention"><dt>Attention</dt><dd>Do not use the task manager or the "kill" command to stop a UM daemon running as a Windows service. Use the Windows service control panel to stop the service. In particular, if the persistent Store is killed non-gracefully, it can leave its files in an inconsistent state.</dd></dl>
<p><br />
 </p><hr/>
<h1><a class="anchor" id="configurationreferenceforumestored"></a>
Configuration Reference for Umestored&nbsp;&nbsp;<small><a href="#configurationreferenceforumestored">&lt;-</a></small></h1>
<p>The operating parameters for <code>umestored</code> come from a Store configuration file that must be supplied on the command line (see <a class="el" href="index.html#manpagesforstore">Man Pages for Store</a>). A Store Process contains a UM context and receivers that may be configured with default values through an LBM configuration file referenced in the XML configuration file. Default UM options my be overridden for each configured Store using the Store configuration file.</p>
<p>An overview of the file format can be seen in the <a class="el" href="index.html#umestoredconfigurationdtd">umestored Configuration DTD</a>.</p>
<p>You configure <code>umestored</code> to instantiate Stores with the Store configuration file, which Ultra Messaging reads at start up.</p>
<p>The Store configuration file for persistence has the following sections:</p>
<ul>
<li>
<p class="startli">Daemon section - holds administrative parameters for such things as the location of log files, the LBM Configuration File, etc.</p>
<p class="endli"></p>
</li>
<li>
Stores section - holds parameters for any Persistent Stores and also the topics to be persisted. </li>
</ul>
<p><b>High Level Store Configuration File:</b></p>
<div class="fragment"><div class="line">&lt;ume-store version=<span class="stringliteral">&quot;1.3&quot;</span>&gt;</div><div class="line">  &lt;daemon&gt;</div><div class="line">    Daemon configuration options</div><div class="line">  &lt;/daemon&gt;</div><div class="line">  &lt;stores&gt;</div><div class="line">    &lt;store attributes&gt;</div><div class="line">      &lt;topics&gt;</div><div class="line">        &lt;topic attributes&gt;</div><div class="line">          &lt;ume-attributes&gt;</div><div class="line">            &lt;option attributes/&gt;</div><div class="line">          &lt;/ume-attributes&gt;</div><div class="line">        &lt;/topic&gt;</div><div class="line">      &lt;/topics&gt;</div><div class="line">    &lt;/store&gt;</div><div class="line">  &lt;/stores&gt;</div><div class="line">&lt;/ume-store&gt;</div></div><!-- fragment --><p><br />
 </p>
<h2><a class="anchor" id="mergingmultiplestorexmlconfigurationfiles"></a>
Share/Merge Store XML Files with XInclude&nbsp;&nbsp;<small><a href="#mergingmultiplestorexmlconfigurationfiles">&lt;-</a></small></h2>
<p>The XInclude mechanism can be used to merge or share XML files for UM library configuration, Store configuration, and DRO configuration. This is typically done to avoid duplicating groups of configuration options in multiple places.</p>
<p>To include an external file from a Store configuration file, use the following syntax:</p>
<div class="fragment"><div class="line">&lt;xi:include xmlns:xi=<span class="stringliteral">&quot;http://www.w3.org/2003/XInclude&quot;</span> href=<span class="stringliteral">&quot;FILEPATH&quot;</span> /&gt;</div></div><!-- fragment --><p>Where FILEPATH can be a local file name, or a network path starting with "http:" or "ftp:". For example: </p><div class="fragment"><div class="line">&lt;xi:include xmlns:xi=<span class="stringliteral">&quot;http://www.w3.org/2003/XInclude&quot;</span> href=<span class="stringliteral">&quot;/um/conf/TRD1.xml&quot;</span> /&gt;</div><div class="line">&lt;xi:include xmlns:xi=<span class="stringliteral">&quot;http://www.w3.org/2003/XInclude&quot;</span> href=<span class="stringliteral">&quot;http://myweb.mydomain.com/umconf/TRD1.xml&quot;</span> /&gt;</div><div class="line">&lt;xi:include xmlns:xi=<span class="stringliteral">&quot;http://www.w3.org/2003/XInclude&quot;</span> href=<span class="stringliteral">&quot;ftp://myftp.mydomain.com/umconf/TRD1.xml&quot;</span> /&gt;</div></div><!-- fragment --><p>Note that secure forms of network paths ("https:" or "sftp:") are not supported.</p>
<p>Files to be included must be formatted such that all elements are enclosed in a single container element.</p>
<p>Example of an <b>invalid</b> file:</p>
<div class="fragment"><div class="line">  &lt;option type=<span class="stringliteral">&quot;store&quot;</span> name=<span class="stringliteral">&quot;repository-type&quot;</span> value=<span class="stringliteral">&quot;disk&quot;</span>/&gt;</div><div class="line">  &lt;option type=<span class="stringliteral">&quot;store&quot;</span> name=<span class="stringliteral">&quot;repository-size-threshold&quot;</span> value=<span class="stringliteral">&quot;75,000,000&quot;</span>/&gt;</div><div class="line">  &lt;option type=<span class="stringliteral">&quot;store&quot;</span> name=<span class="stringliteral">&quot;repository-size-limit&quot;</span> value=<span class="stringliteral">&quot;100,000,000&quot;</span>/&gt;</div><div class="line">...</div></div><!-- fragment --><p>Example of <b>valid</b> file:</p>
<div class="fragment"><div class="line">&lt;ume-attributes&gt;</div><div class="line">  &lt;option type=<span class="stringliteral">&quot;store&quot;</span> name=<span class="stringliteral">&quot;repository-type&quot;</span> value=<span class="stringliteral">&quot;disk&quot;</span>/&gt;</div><div class="line">  &lt;option type=<span class="stringliteral">&quot;store&quot;</span> name=<span class="stringliteral">&quot;repository-size-threshold&quot;</span> value=<span class="stringliteral">&quot;75,000,000&quot;</span>/&gt;</div><div class="line">  &lt;option type=<span class="stringliteral">&quot;store&quot;</span> name=<span class="stringliteral">&quot;repository-size-limit&quot;</span> value=<span class="stringliteral">&quot;100,000,000&quot;</span>/&gt;</div><div class="line">...</div><div class="line">&lt;/ume-attributes&gt;</div></div><!-- fragment --><p><br />
 </p>
<h3><a class="anchor" id="commonstorexincludeusecase"></a>
Common Store XInclude Use Case&nbsp;&nbsp;<small><a href="#commonstorexincludeusecase">&lt;-</a></small></h3>
<p>Store configuration files do not support templates. It is common that groups of configuration options need to be repeated across many Store configurations.</p>
<p>For example consider the Store configuration file "store_conf.xml":</p>
<div class="fragment"><div class="line">  &lt;stores&gt;</div><div class="line">    &lt;store name=<span class="stringliteral">&quot;store-a1&quot;</span> port=<span class="stringliteral">&quot;14570&quot;</span>&gt;</div><div class="line">...</div><div class="line">      &lt;topics&gt;</div><div class="line">        &lt;topic pattern=<span class="stringliteral">&quot;matching.output\.[0-9]$&quot;</span> type=<span class="stringliteral">&quot;PCRE&quot;</span>&gt;</div><div class="line">          &lt;ume-attributes&gt;</div><div class="line">            &lt;option type=<span class="stringliteral">&quot;store&quot;</span> name=<span class="stringliteral">&quot;repository-type&quot;</span> value=<span class="stringliteral">&quot;disk&quot;</span>/&gt;</div><div class="line">            &lt;option type=<span class="stringliteral">&quot;store&quot;</span> name=<span class="stringliteral">&quot;repository-size-threshold&quot;</span> value=<span class="stringliteral">&quot;75,000,000&quot;</span>/&gt;</div><div class="line">            &lt;option type=<span class="stringliteral">&quot;store&quot;</span> name=<span class="stringliteral">&quot;repository-size-limit&quot;</span> value=<span class="stringliteral">&quot;100,000,000&quot;</span>/&gt;</div><div class="line">...</div><div class="line">          &lt;/ume-attributes&gt;</div><div class="line">        &lt;/topic&gt;</div><div class="line">      &lt;/topics&gt;</div><div class="line">    &lt;/store&gt;</div><div class="line"></div><div class="line">    &lt;store name=<span class="stringliteral">&quot;store-a2&quot;</span> port=<span class="stringliteral">&quot;14571&quot;</span>&gt;</div><div class="line">...</div><div class="line">      &lt;topics&gt;</div><div class="line">        &lt;topic pattern=<span class="stringliteral">&quot;matching.output\.[0-9]$&quot;</span> type=<span class="stringliteral">&quot;PCRE&quot;</span>&gt;</div><div class="line">          &lt;ume-attributes&gt;</div><div class="line">            &lt;option type=<span class="stringliteral">&quot;store&quot;</span> name=<span class="stringliteral">&quot;repository-type&quot;</span> value=<span class="stringliteral">&quot;disk&quot;</span>/&gt;</div><div class="line">            &lt;option type=<span class="stringliteral">&quot;store&quot;</span> name=<span class="stringliteral">&quot;repository-size-threshold&quot;</span> value=<span class="stringliteral">&quot;75,000,000&quot;</span>/&gt;</div><div class="line">            &lt;option type=<span class="stringliteral">&quot;store&quot;</span> name=<span class="stringliteral">&quot;repository-size-limit&quot;</span> value=<span class="stringliteral">&quot;100,000,000&quot;</span>/&gt;</div><div class="line">...</div><div class="line">          &lt;/ume-attributes&gt;</div><div class="line">        &lt;/topic&gt;</div><div class="line">      &lt;/topics&gt;</div><div class="line">    &lt;/store&gt;</div><div class="line">...</div></div><!-- fragment --><p>This can be a lot of repeated content for the stores running in this daemon instance.</p>
<p>The XInclude feature can be used to reduce duplicate content by creating a second file "store_topic_attr.xml":</p>
<div class="fragment"><div class="line">&lt;ume-attributes&gt;</div><div class="line">  &lt;option type=<span class="stringliteral">&quot;store&quot;</span> name=<span class="stringliteral">&quot;repository-type&quot;</span> value=<span class="stringliteral">&quot;disk&quot;</span>/&gt;</div><div class="line">  &lt;option type=<span class="stringliteral">&quot;store&quot;</span> name=<span class="stringliteral">&quot;repository-size-threshold&quot;</span> value=<span class="stringliteral">&quot;75,000,000&quot;</span>/&gt;</div><div class="line">  &lt;option type=<span class="stringliteral">&quot;store&quot;</span> name=<span class="stringliteral">&quot;repository-size-limit&quot;</span> value=<span class="stringliteral">&quot;100,000,000&quot;</span>/&gt;</div><div class="line">...</div><div class="line">&lt;/ume-attributes&gt;</div></div><!-- fragment --><p>Now "store_conf.xml" can be coded as:</p>
<div class="fragment"><div class="line">  &lt;stores&gt;</div><div class="line">    &lt;store name=<span class="stringliteral">&quot;store-a1&quot;</span> port=<span class="stringliteral">&quot;14570&quot;</span>&gt;</div><div class="line">...</div><div class="line">      &lt;topics&gt;</div><div class="line">        &lt;topic pattern=<span class="stringliteral">&quot;matching.output\.[0-9]$&quot;</span> type=<span class="stringliteral">&quot;PCRE&quot;</span>&gt;</div><div class="line">          &lt;xi:include xmlns:xi=<span class="stringliteral">&quot;http://www.w3.org/2001/XInclude&quot;</span> href=<span class="stringliteral">&quot;./store_topic_attr.xml&quot;</span> /&gt;</div><div class="line">        &lt;/topic&gt;</div><div class="line">      &lt;/topics&gt;</div><div class="line">    &lt;/store&gt;</div><div class="line"></div><div class="line">    &lt;store name=<span class="stringliteral">&quot;store-a2&quot;</span> port=<span class="stringliteral">&quot;14571&quot;</span>&gt;</div><div class="line">...</div><div class="line">      &lt;topics&gt;</div><div class="line">        &lt;topic pattern=<span class="stringliteral">&quot;matching.output\.[0-9]$&quot;</span> type=<span class="stringliteral">&quot;PCRE&quot;</span>&gt;</div><div class="line">          &lt;xi:include xmlns:xi=<span class="stringliteral">&quot;http://www.w3.org/2001/XInclude&quot;</span> href=<span class="stringliteral">&quot;./store_topic_attr.xml&quot;</span> /&gt;</div><div class="line">        &lt;/topic&gt;</div><div class="line">      &lt;/topics&gt;</div><div class="line">    &lt;/store&gt;</div><div class="line">...</div></div><!-- fragment --><p><br />
 </p>
<h2><a class="anchor" id="storexmlconfigurationfileelements"></a>
Store XML Configuration File Elements&nbsp;&nbsp;<small><a href="#storexmlconfigurationfileelements">&lt;-</a></small></h2>
<hr/>
<p> <br />
 </p>
<h3><a class="anchor" id="umeelementumestore"></a>
UMP Element "&lt;ume-store&gt;"&nbsp;&nbsp;<small><a href="#umeelementumestore">&lt;-</a></small></h3>
<p>Container element that holds the configuration for the Persistent Store Process. Also defines the version of the configuration format used by the file.</p>
<ul>
<li>
<b>Children:</b> <a class="el" href="index.html#umeelementdaemon">&lt;daemon&gt;</a>, <a class="el" href="index.html#umeelementstores">&lt;stores&gt;</a> </li>
</ul>
<p><b>XML</b> <b>Attributes:</b> </p><table class="doxtable">
<tr>
<th>Attribute </th><th>Description </th><th>Valid Values </th><th>Default Value </th></tr>
<tr>
<td><b>version</b> </td><td>Version number of Store XML DTD that the configuration file corresponds to. See <a class="el" href="index.html#umestoredconfigurationdtd">umestored Configuration DTD</a> for a description of the different versions. Users are encouraged to update their Store configuration files to correspond to the latest version supported by the Store software in use. </td><td>string </td><td>(no default; must be specified) </td></tr>
</table>
<p><b>Example:</b> </p><div class="fragment"><div class="line">&lt;?xml version=<span class="stringliteral">&quot;1.0&quot;</span>?&gt;</div><div class="line">&lt;ume-store version=<span class="stringliteral">&quot;1.3&quot;</span>&gt;</div><div class="line">  ...</div><div class="line">&lt;/ume-store&gt;</div></div><!-- fragment --><hr/>
<p> <br />
 </p>
<h3><a class="anchor" id="umeelementstores"></a>
UMP Element "&lt;stores&gt;"&nbsp;&nbsp;<small><a href="#umeelementstores">&lt;-</a></small></h3>
<p>Container element for one or more <a class="el" href="index.html#umeelementstore">&lt;store&gt;</a> elements. A Store Process can run multiple independent Store instances. Some users prefer to run multiple Store instances in a single process to reduce their process management complexity. Other users prefer to run multiple Store Processes, each with a single Store instance, to reduce the impact of a Store Process failing.</p>
<p>There should be little or no performance difference between multiple Store instances running in the same process vs. multiple Store Processes on the same host. However, for maximum Store performance, it is generally easier to pin Store threads to cores when each process is running a single Store instance.</p>
<p>It is NOT recommended for multiple Stores within a QC group to run in the same process, or even the same host, as this defeats the goal of reliability through redundancy.</p>
<ul>
<li>
<b>Cardinality:</b> 0 .. 1 </li>
<li>
<b>Parent:</b> <a class="el" href="index.html#umeelementumestore">&lt;ume-store&gt;</a> </li>
<li>
<b>Children:</b> <a class="el" href="index.html#umeelementstore">&lt;store&gt;</a> </li>
</ul>
<p><b>Example:</b> </p><div class="fragment"><div class="line">&lt;?xml version=<span class="stringliteral">&quot;1.0&quot;</span>?&gt;</div><div class="line">&lt;ume-store version=<span class="stringliteral">&quot;1.3&quot;</span>&gt;</div><div class="line">  &lt;stores&gt;</div><div class="line">    ...</div><div class="line">  &lt;/stores&gt;</div><div class="line">  ...</div><div class="line">&lt;/ume-store&gt;</div></div><!-- fragment --><hr/>
<p> <br />
 </p>
<h3><a class="anchor" id="umeelementstore"></a>
UMP Element "&lt;store&gt;"&nbsp;&nbsp;<small><a href="#umeelementstore">&lt;-</a></small></h3>
<p>Configuration for a Store instance.</p>
<ul>
<li>
<b>Cardinality:</b> 0 .. unbounded </li>
<li>
<b>Parent:</b> <a class="el" href="index.html#umeelementstores">&lt;stores&gt;</a> </li>
<li>
<b>Children:</b> <a class="el" href="index.html#umeelementrestorelast">&lt;restore-last&gt;</a>, <a class="el" href="index.html#umeelementpublishinginterval">&lt;publishing-interval&gt;</a>, <a class="el" href="index.html#umeelementumeattributes">&lt;ume-attributes&gt;</a>, <a class="el" href="index.html#umeelementtopics">&lt;topics&gt;</a> </li>
</ul>
<p><b>XML</b> <b>Attributes:</b> </p><table class="doxtable">
<tr>
<th>Attribute </th><th>Description </th><th>Valid Values </th><th>Default Value </th></tr>
<tr>
<td><b>name</b> </td><td>Identifies log messages for this Store instance in the Store Process log file, the Store Web Monitor, and Daemon Stats. Note: this is not the name that sources can use instead of a network address (see the <a class="el" href="index.html#umecfgcontextname">context-name</a> option). </td><td>attr_name </td><td>(no default; must be specified) </td></tr>
<tr>
<td><b>interface</b> </td><td>Specifies the IP address over which Store Process accepts connection requests for this Store. You can specify a single IP address, such as 10.29.3.16, or a range of addresses, 10.29.3.16/25. See also <a class="el" href="index.html#identifyingpersistentstores">Identifying Persistent Stores</a>. </td><td>string </td><td><b><code>"0.0.0.0"</code></b> (INADDR_ANY) </td></tr>
<tr>
<td><b>port</b> </td><td>TCP port where Store Process should listen for connection requests to this Store. Starting with UM version 6.8, zero may be supplied. In that case, the Store will choose an available port in the range <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpunicastimmediatemessagingnetwork.html#requesttcpportlowcontext">request_tcp_port_low (context)</a> to <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpunicastimmediatemessagingnetwork.html#requesttcpporthighcontext">request_tcp_port_high (context)</a>. This typically requires the use of <a class="el" href="index.html#namedstores">named stores</a>. </td><td>string </td><td>(no default; must be specified) </td></tr>
</table>
<p><b>Example:</b> </p><div class="fragment"><div class="line">&lt;?xml version=<span class="stringliteral">&quot;1.0&quot;</span>?&gt;</div><div class="line">&lt;ume-store version=<span class="stringliteral">&quot;1.3&quot;</span>&gt;</div><div class="line">  &lt;stores&gt;</div><div class="line">    &lt;store name=<span class="stringliteral">&quot;MyStore1&quot;</span> interface=<span class="stringliteral">&quot;10.1.2.3&quot;</span> port=<span class="stringliteral">&quot;12000&quot;</span>&gt;</div><div class="line">      ...</div><div class="line">    &lt;/store&gt;</div><div class="line">    ...</div><div class="line">  &lt;/stores&gt;</div><div class="line">  ...</div><div class="line">&lt;/ume-store&gt;</div></div><!-- fragment --><hr/>
<p> <br />
 </p>
<h3><a class="anchor" id="umeelementtopics"></a>
UMP Element "&lt;topics&gt;"&nbsp;&nbsp;<small><a href="#umeelementtopics">&lt;-</a></small></h3>
<p>Container for <a class="el" href="index.html#umeelementtopic">&lt;topic&gt;</a> elements. Defines the topics that this Store instance will persist.</p>
<ul>
<li>
<b>Parent:</b> <a class="el" href="index.html#umeelementstore">&lt;store&gt;</a> </li>
<li>
<b>Children:</b> <a class="el" href="index.html#umeelementtopic">&lt;topic&gt;</a> </li>
</ul>
<p><b>Example:</b> </p><div class="fragment"><div class="line">&lt;?xml version=<span class="stringliteral">&quot;1.0&quot;</span>?&gt;</div><div class="line">&lt;ume-store version=<span class="stringliteral">&quot;1.3&quot;</span>&gt;</div><div class="line">  &lt;stores&gt;</div><div class="line">    &lt;store name=<span class="stringliteral">&quot;MyStore1&quot;</span> interface=<span class="stringliteral">&quot;10.1.2.3&quot;</span> port=<span class="stringliteral">&quot;12000&quot;</span>&gt;</div><div class="line">      &lt;topics&gt;</div><div class="line">        ...</div><div class="line">      &lt;/topics&gt;</div><div class="line">      ...</div><div class="line">    &lt;/store&gt;</div><div class="line">    ...</div><div class="line">  &lt;/stores&gt;</div><div class="line">  ...</div><div class="line">&lt;/ume-store&gt;</div></div><!-- fragment --><hr/>
<p> <br />
 </p>
<h3><a class="anchor" id="umeelementtopic"></a>
UMP Element "&lt;topic&gt;"&nbsp;&nbsp;<small><a href="#umeelementtopic">&lt;-</a></small></h3>
<p>Defines a topic pattern which the Store will use to find sources to persist. Also contains configuration information about those topics.</p>
<ul>
<li>
<b>Parent:</b> <a class="el" href="index.html#umeelementtopics">&lt;topics&gt;</a> </li>
<li>
<b>Children:</b> <a class="el" href="index.html#umeelementrestorelast">&lt;restore-last&gt;</a>, <a class="el" href="index.html#umeelementumeattributes">&lt;ume-attributes&gt;</a> </li>
</ul>
<p><b>XML</b> <b>Attributes:</b> </p><table class="doxtable">
<tr>
<th>Attribute </th><th>Description </th><th>Valid Values </th><th>Default Value </th></tr>
<tr>
<td><b>pattern</b> </td><td>A string that is used to discover sources to be persisted. The string can be a simple topic name (<code>type="direct"</code>), or it can be a regular expression (<code>type="pcre"</code>) which can match more than one topic. </td><td>string </td><td>(no default; must be specified) </td></tr>
<tr>
<td><b>type</b> </td><td>How the <code>pattern</code> attribute should be interpreted. </td><td><b><code>"direct"</code></b> - Topic name (exact string match) <br />
<b><code>"PCRE"</code></b> - Perl regular expression. <br />
<b><code>"regexp"</code></b> - Posix regular expression. <b>Deprecated; do not use.</b> </td><td><b>direct</b> </td></tr>
</table>
<p><b>Example:</b> </p>
<p>In this example, the topic "NYSE.xyz" and all topics that start with "alert." are persisted in the "MyStore1" Store instance. </p><div class="fragment"><div class="line">&lt;?xml version=<span class="stringliteral">&quot;1.0&quot;</span>?&gt;</div><div class="line">&lt;ume-store version=<span class="stringliteral">&quot;1.3&quot;</span>&gt;</div><div class="line">  &lt;stores&gt;</div><div class="line">    &lt;store name=<span class="stringliteral">&quot;MyStore1&quot;</span> interface=<span class="stringliteral">&quot;10.1.2.3&quot;</span> port=<span class="stringliteral">&quot;12000&quot;</span>&gt;</div><div class="line">      &lt;topics&gt;</div><div class="line">        &lt;topic pattern=<span class="stringliteral">&quot;NYSE.xyz&quot;</span> type=<span class="stringliteral">&quot;direct&quot;</span>&gt;</div><div class="line">          ...</div><div class="line">        &lt;/topic&gt;</div><div class="line">        &lt;topic pattern=<span class="stringliteral">&quot;^alert\..*&quot;</span> type=<span class="stringliteral">&quot;pcre&quot;</span>&gt;</div><div class="line">          ...</div><div class="line">        &lt;/topic&gt;</div><div class="line">        ...</div><div class="line">      &lt;/topics&gt;</div><div class="line">      ...</div><div class="line">    &lt;/store&gt;</div><div class="line">    ...</div><div class="line">  &lt;/stores&gt;</div><div class="line">  ...</div><div class="line">&lt;/ume-store&gt;</div></div><!-- fragment --><hr/>
<p> <br />
 </p>
<h3><a class="anchor" id="umeelementumeattributes"></a>
UMP Element "&lt;ume-attributes&gt;"&nbsp;&nbsp;<small><a href="#umeelementumeattributes">&lt;-</a></small></h3>
<p>Container for a set of <a class="el" href="index.html#umeelementoption">&lt;option&gt;</a> elements.</p>
<ul>
<li>
<b>Cardinality:</b> 0 .. unbounded </li>
<li>
<b>Parent:</b> <a class="el" href="index.html#umeelementstore">&lt;store&gt;</a>, <a class="el" href="index.html#umeelementtopic">&lt;topic&gt;</a> </li>
<li>
<b>Children:</b> <a class="el" href="index.html#umeelementoption">&lt;option&gt;</a> </li>
</ul>
<p><b>Example:</b> </p>
<p>In this example, some options are at the Store level and apply to all topics. Other options are specific to the topic "NYSE.xyz". </p><div class="fragment"><div class="line">&lt;?xml version=<span class="stringliteral">&quot;1.0&quot;</span>?&gt;</div><div class="line">&lt;ume-store version=<span class="stringliteral">&quot;1.3&quot;</span>&gt;</div><div class="line">  &lt;stores&gt;</div><div class="line">    &lt;store name=<span class="stringliteral">&quot;MyStore1&quot;</span> interface=<span class="stringliteral">&quot;10.1.2.3&quot;</span> port=<span class="stringliteral">&quot;12000&quot;</span>&gt;</div><div class="line">      &lt;ume-attributes&gt;</div><div class="line">        ...</div><div class="line">      &lt;/ume-attributes&gt;</div><div class="line">      &lt;topics&gt;</div><div class="line">        &lt;topic pattern=<span class="stringliteral">&quot;NYSE.xyz&quot;</span> type=<span class="stringliteral">&quot;direct&quot;</span>&gt;</div><div class="line">          &lt;ume-attributes&gt;</div><div class="line">            ...</div><div class="line">          &lt;/ume-attributes&gt;</div><div class="line">          ...</div><div class="line">        &lt;/topic&gt;</div><div class="line">        ...</div><div class="line">      &lt;/topics&gt;</div><div class="line">      ...</div><div class="line">    &lt;/store&gt;</div><div class="line">    ...</div><div class="line">  &lt;/stores&gt;</div><div class="line">  ...</div><div class="line">&lt;/ume-store&gt;</div></div><!-- fragment --><hr/>
<p> <br />
 </p>
<h3><a class="anchor" id="umeelementoption"></a>
UMP Element "&lt;option&gt;"&nbsp;&nbsp;<small><a href="#umeelementoption">&lt;-</a></small></h3>
<p>Set a configuration option of a particular type.</p>
<p>This element is used to set most of the operational parameters of the Store and its repositories.</p>
<p>There are many different options that can be set. See <a class="el" href="index.html#optionsforastoresumeattributeselement">"&lt;option&gt;" Element Details</a> for the full list.</p>
<p>An option element has a type attribute. The valid types depend on whether the option's ancestor element is "&lt;store&gt;" or "&lt;topic&gt;": </p><table class="doxtable">
<tr>
<th>Ancestor </th><th>Valid <code>type</code> Attributes </th></tr>
<tr>
<td><a class="el" href="index.html#umeelementstore">&lt;store&gt;</a> </td><td>type="store"<br />
type="lbm-context" </td></tr>
<tr>
<td><a class="el" href="index.html#umeelementtopic">&lt;topic&gt;</a> </td><td>type="store"<br />
type="lbm-receiver"<br />
type="lbm-source" </td></tr>
</table>
<ul>
<li>
<b>Parent:</b> <a class="el" href="index.html#umeelementumeattributes">&lt;ume-attributes&gt;</a> </li>
</ul>
<p><b>XML</b> <b>Attributes:</b> </p><table class="doxtable">
<tr>
<th>Attribute </th><th>Description </th><th>Valid Values </th><th>Default Value </th></tr>
<tr>
<td><b>type</b> </td><td>Type of configuration option. </td><td><b><code>"lbm-receiver"</code></b> - LBM configuration option of scope "receiver". <br />
<b><code>"lbm-context"</code></b> - LBM configuration option of scope "context". <br />
<b><code>"lbm-source"</code></b> - LBM configuration option of scope "source". <br />
<b><code>"store"</code></b> - Store configuration option. </td><td>(no default; must be specified) </td></tr>
<tr>
<td><b>name</b> </td><td>Name of option. </td><td>attr_name </td><td>(no default; must be specified) </td></tr>
<tr>
<td><b>value</b> </td><td>Value for option. </td><td>string </td><td>(no default; must be specified) </td></tr>
</table>
<p><b>Example:</b> </p>
<div class="fragment"><div class="line">&lt;?xml version=<span class="stringliteral">&quot;1.0&quot;</span>?&gt;</div><div class="line">&lt;ume-store version=<span class="stringliteral">&quot;1.3&quot;</span>&gt;</div><div class="line">  &lt;stores&gt;</div><div class="line">    &lt;store name=<span class="stringliteral">&quot;MyStore1&quot;</span> interface=<span class="stringliteral">&quot;10.1.2.3&quot;</span> port=<span class="stringliteral">&quot;12000&quot;</span>&gt;</div><div class="line">      &lt;ume-attributes&gt;</div><div class="line">        &lt;option type=<span class="stringliteral">&quot;...&quot;</span> name=<span class="stringliteral">&quot;...&quot;</span> value=<span class="stringliteral">&quot;...&quot;</span>/&gt;</div><div class="line">        ...</div><div class="line">      &lt;/ume-attributes&gt;</div><div class="line">      &lt;topics&gt;</div><div class="line">        &lt;topic pattern=<span class="stringliteral">&quot;NYSE.xyz&quot;</span> type=<span class="stringliteral">&quot;direct&quot;</span>&gt;</div><div class="line">          &lt;ume-attributes&gt;</div><div class="line">            &lt;option type=<span class="stringliteral">&quot;...&quot;</span> name=<span class="stringliteral">&quot;...&quot;</span> value=<span class="stringliteral">&quot;...&quot;</span>/&gt;</div><div class="line">            ...</div><div class="line">          &lt;/ume-attributes&gt;</div><div class="line">          ...</div><div class="line">        &lt;/topic&gt;</div><div class="line">        ...</div><div class="line">      &lt;/topics&gt;</div><div class="line">      ...</div><div class="line">    &lt;/store&gt;</div><div class="line">    ...</div><div class="line">  &lt;/stores&gt;</div><div class="line">  ...</div><div class="line">&lt;/ume-store&gt;</div></div><!-- fragment --><hr/>
<p> <br />
 </p>
<h3><a class="anchor" id="umeelementrestorelast"></a>
UMP Element "&lt;restore-last&gt;"&nbsp;&nbsp;<small><a href="#umeelementrestorelast">&lt;-</a></small></h3>
<p>Control how much saved message data is restored when a disk-based Store is restarted.</p>
<p>By default, when a disk-based Store is stopped and restarted, it will restore all messages in the cache file to rebuild its internal index. If the cache file is very large, this can take significant time.</p>
<p>Using this element, you can direct the Store to read only recent data. Note that it can be specific to a Store, or a topic within a Store.</p>
<p>If this element is supplied in both the "&lt;store&gt;" and "&lt;topic&gt;" levels, the "&lt;topic&gt;" setting will override the "&lt;store&gt;" setting.</p>
<p>See <a class="el" href="index.html#limitinitialrestore">Limit Initial Restore with Restore-Last</a> for use case.</p>
<ul>
<li>
<b>Cardinality:</b> 0 .. 1 </li>
<li>
<b>Parent:</b> <a class="el" href="index.html#umeelementstore">&lt;store&gt;</a>, <a class="el" href="index.html#umeelementtopic">&lt;topic&gt;</a> </li>
</ul>
<p><b>XML</b> <b>Attributes:</b> </p><table class="doxtable">
<tr>
<th>Attribute </th><th>Description </th><th>Valid Values </th><th>Default Value </th></tr>
<tr>
<td><b>behavior</b> </td><td>Define how the <em>value</em> attribute is interpreted. </td><td><b><code>"hours"</code></b> - Directs the Store to restore the most recent <em>value</em> number of hours worth of message data. <b>NOTE:</b> the message time is relative to the last (most recent) message in the cache, <em>not</em> the absolute time that the Store is restarted. For example, if the store is restarted on Sunday, but the most-recent message was sent the previous Friday afternoon, then <em>value</em> hours worth of messages sent on Friday will be restored. <br />
<b><code>"none"</code></b> - Directs the Store to ignore <em>value</em>, disabling the feature, resulting in the entire cache file being restored. </td><td><b>hours</b> </td></tr>
<tr>
<td><b>value</b> </td><td><p class="starttd">Number of units worth of message data to restore. The units are defined by the "behavior" attribute.</p>
<p>For units of "hours", the valid range is 0 - 336 (14 days).</p>
<p class="endtd">The special value "0" disables the feature, resulting in the entire cache file being restored. </p>
</td><td>string </td><td><b>0</b> (disable) </td></tr>
</table>
<p><b>Example:</b> on restart, only restore the most recent 8 hours worth of messages. </p><div class="fragment"><div class="line">&lt;?xml version=<span class="stringliteral">&quot;1.0&quot;</span>?&gt;</div><div class="line">&lt;ume-store version=<span class="stringliteral">&quot;1.3&quot;</span>&gt;</div><div class="line">...</div><div class="line">  &lt;stores&gt;</div><div class="line">    &lt;store name=<span class="stringliteral">&quot;test-store&quot;</span> port=<span class="stringliteral">&quot;14567&quot;</span>&gt;</div><div class="line">      &lt;restore-last value=<span class="stringliteral">&quot;8&quot;</span> behavior=<span class="stringliteral">&quot;hours&quot;</span>/&gt;</div><div class="line">      ...</div><div class="line">    &lt;/store&gt;</div><div class="line">  &lt;/stores&gt;</div><div class="line">&lt;/ume-store&gt;</div></div><!-- fragment --><hr/>
<p> <br />
 </p>
<h3><a class="anchor" id="umeelementpublishinginterval"></a>
UMP Element "&lt;publishing-interval&gt;"&nbsp;&nbsp;<small><a href="#umeelementpublishinginterval">&lt;-</a></small></h3>
<p>DEPRECATED: Set how often the Store publishes its Daemon Stats. See <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/design.tag:../../Design/" href="../../Design/umfeatures.html#daemonstatistics">daemonstatistics</a> for general information on Daemon Statistics.</p>
<p>Informatica requests users to migrate to using the UM configuration file to enable automatic monitoring with Protocol Buffer monitoring format for Store and DRO by setting <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpautomaticmonitoring.html#monitorformatcontext">monitor_format (context)</a> to "pb". See <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/operations.tag:../../Operations/" href="../../Operations/monitoring.html#automaticmonitoring">Automatic Monitoring</a>.</p>
<ul>
<li>
<b>Cardinality:</b> 0 .. 1 </li>
<li>
<b>Parent:</b> <a class="el" href="index.html#umeelementstore">&lt;store&gt;</a>, <a class="el" href="index.html#umeelementdaemonmonitor">&lt;daemon-monitor&gt;</a> </li>
<li>
<b>Children:</b> <a class="el" href="index.html#umeelementgroup">&lt;group&gt;</a> </li>
</ul>
<p><b>Example:</b> </p>
<p>Daemon Statistics are configured at both the daemon level and at the Store level. </p><div class="fragment"><div class="line">&lt;?xml version=<span class="stringliteral">&quot;1.0&quot;</span>?&gt;</div><div class="line">&lt;ume-store version=<span class="stringliteral">&quot;1.3&quot;</span>&gt;</div><div class="line">  &lt;daemon&gt;</div><div class="line">    &lt;daemon-monitor topic=<span class="stringliteral">&quot;bozo&quot;</span>&gt;</div><div class="line">      &lt;publishing-interval&gt;</div><div class="line">        ...</div><div class="line">      &lt;/publishing-interval&gt;</div><div class="line">    &lt;/daemon-monitor&gt;</div><div class="line">  &lt;/daemon&gt;</div><div class="line">  &lt;stores&gt;</div><div class="line">    &lt;store name=<span class="stringliteral">&quot;MyStore1&quot;</span> interface=<span class="stringliteral">&quot;10.1.2.3&quot;</span> port=<span class="stringliteral">&quot;12000&quot;</span>&gt;</div><div class="line">      &lt;publishing-interval&gt;</div><div class="line">        ...</div><div class="line">      &lt;/publishing-interval&gt;</div><div class="line">      ...</div><div class="line">    &lt;/store&gt;</div><div class="line">    ...</div><div class="line">  &lt;/stores&gt;</div><div class="line">  ...</div><div class="line">&lt;/ume-store&gt;</div></div><!-- fragment --><hr/>
<p> <br />
 </p>
<h3><a class="anchor" id="umeelementgroup"></a>
UMP Element "&lt;group&gt;"&nbsp;&nbsp;<small><a href="#umeelementgroup">&lt;-</a></small></h3>
<p>Configures the rate at which one particular grouping of Daemon Statistics messages are published. See <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/design.tag:../../Design/" href="../../Design/umfeatures.html#daemonstatistics">daemonstatistics</a> for general information on Daemon Statistics.</p>
<ul>
<li>
<b>Parent:</b> <a class="el" href="index.html#umeelementpublishinginterval">&lt;publishing-interval&gt;</a> </li>
</ul>
<p><b>XML</b> <b>Attributes:</b> </p><table class="doxtable">
<tr>
<th>Attribute </th><th>Description </th><th>Valid Values </th><th>Default Value </th></tr>
<tr>
<td><b>name</b> </td><td>Name of statistics group being configured. </td><td><b><code>"default"</code></b> - Sets a default interval for all message types. <br />
<b><code>"store"</code></b> - Sets the interval for messages of type <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/umedmonmsgs_8h.html#aeeb55ed0b759e6316cdedc3c990dfe26">umestore_store_dmon_stat_msg_t</a>. <br />
<b><code>"source"</code></b> - Sets the interval for messages of type <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/umedmonmsgs_8h.html#a88ce572fd35203194ada676661d2f54b">umestore_repo_dmon_stat_msg_t</a>. <br />
<b><code>"receiver"</code></b> - Sets the interval for messages of type <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/umedmonmsgs_8h.html#a3829efae398d994795fb395097626709">umestore_rcv_dmon_stat_msg_t</a>. <br />
<b><code>"disk"</code></b> - Sets the interval for messages of type <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/umedmonmsgs_8h.html#a3ed32f1017abda98dbac7f228d7c506b">umestore_disk_dmon_stat_msg_t</a>. <br />
<b><code>"config"</code></b> - Sets the interval for messages of types umestore_*_dmon_config_msg_t. <br />
<b><code>"memory"</code></b> - Sets the interval for messages of type umestore_smart_heap_dmon_stat_msg_t. </td><td>(no default; must be specified) </td></tr>
<tr>
<td><b>ivl</b> </td><td>Time, in seconds, between publishing the statistics group being configured. </td><td>string </td><td>(no default; must be specified) </td></tr>
</table>
<p><b>Example:</b> </p>
<p>Daemon Statistics are configured at both the daemon level and at the Store level. </p><div class="fragment"><div class="line">&lt;?xml version=<span class="stringliteral">&quot;1.0&quot;</span>?&gt;</div><div class="line">&lt;ume-store version=<span class="stringliteral">&quot;1.3&quot;</span>&gt;</div><div class="line">  &lt;daemon&gt;</div><div class="line">    &lt;daemon-monitor topic=<span class="stringliteral">&quot;bozo&quot;</span>&gt;</div><div class="line">      &lt;publishing-interval&gt;</div><div class="line">        &lt;group name=<span class="stringliteral">&quot;default&quot;</span> ivl=<span class="stringliteral">&quot;10&quot;</span>/&gt;</div><div class="line">        &lt;group name=<span class="stringliteral">&quot;store&quot;</span> ivl=<span class="stringliteral">&quot;20&quot;</span>/&gt;</div><div class="line">        ...</div><div class="line">      &lt;/publishing-interval&gt;</div><div class="line">    &lt;/daemon-monitor&gt;</div><div class="line">  &lt;/daemon&gt;</div><div class="line">  &lt;stores&gt;</div><div class="line">    &lt;store name=<span class="stringliteral">&quot;MyStore1&quot;</span> interface=<span class="stringliteral">&quot;10.1.2.3&quot;</span> port=<span class="stringliteral">&quot;12000&quot;</span>&gt;</div><div class="line">      &lt;publishing-interval&gt;</div><div class="line">        &lt;group name=<span class="stringliteral">&quot;default&quot;</span> ivl=<span class="stringliteral">&quot;10&quot;</span>/&gt;</div><div class="line">        &lt;group name=<span class="stringliteral">&quot;store&quot;</span> ivl=<span class="stringliteral">&quot;20&quot;</span>/&gt;</div><div class="line">        ...</div><div class="line">      &lt;/publishing-interval&gt;</div><div class="line">      ...</div><div class="line">    &lt;/store&gt;</div><div class="line">    ...</div><div class="line">  &lt;/stores&gt;</div><div class="line">  ...</div><div class="line">&lt;/ume-store&gt;</div></div><!-- fragment --><hr/>
<p> <br />
 </p>
<h3><a class="anchor" id="umeelementdaemon"></a>
UMP Element "&lt;daemon&gt;"&nbsp;&nbsp;<small><a href="#umeelementdaemon">&lt;-</a></small></h3>
<p>Container element for configuration elements that apply to the entire Store Process.</p>
<ul>
<li>
<b>Parent:</b> <a class="el" href="index.html#umeelementumestore">&lt;ume-store&gt;</a> </li>
<li>
<b>Children:</b> <a class="el" href="index.html#umeelementlog">&lt;log&gt;</a>, <a class="el" href="index.html#umeelementuid">&lt;uid&gt;</a>, <a class="el" href="index.html#umeelementpidfile">&lt;pidfile&gt;</a>, <a class="el" href="index.html#umeelementgid">&lt;gid&gt;</a>, <a class="el" href="index.html#umeelementlbmconfig">&lt;lbm-config&gt;</a>, <a class="el" href="index.html#umeelementxmlconfig">&lt;xml-config&gt;</a>, <a class="el" href="index.html#umeelementlbmlicensefile">&lt;lbm-license-file&gt;</a>, <a class="el" href="index.html#umeelementwebmonitor">&lt;web-monitor&gt;</a>, <a class="el" href="index.html#umeelementdaemonmonitor">&lt;daemon-monitor&gt;</a> </li>
</ul>
<p><b>Example:</b> </p><div class="fragment"><div class="line">&lt;?xml version=<span class="stringliteral">&quot;1.0&quot;</span>?&gt;</div><div class="line">&lt;ume-store version=<span class="stringliteral">&quot;1.3&quot;</span>&gt;</div><div class="line">  &lt;daemon&gt;</div><div class="line">    ...</div><div class="line">  &lt;/daemon&gt;</div><div class="line">  ...</div><div class="line">&lt;/ume-store&gt;</div></div><!-- fragment --><hr/>
<p> <br />
 </p>
<h3><a class="anchor" id="umeelementdaemonmonitor"></a>
UMP Element "&lt;daemon-monitor&gt;"&nbsp;&nbsp;<small><a href="#umeelementdaemonmonitor">&lt;-</a></small></h3>
<p>DEPRECATED: The daemon-monitor element configures the Store Process for <a class="el" href="index.html#storedaemonstatistics">Store Binary Daemon Statistics</a>.</p>
<p>Informatica requests users to migrate to using the UM configuration file to enable automatic monitoring with Protocol Buffer monitoring format for Store and DRO by setting <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpautomaticmonitoring.html#monitorformatcontext">monitor_format (context)</a> to "pb". See <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/operations.tag:../../Operations/" href="../../Operations/monitoring.html#automaticmonitoring">Automatic Monitoring</a>.</p>
<ul>
<li>
<b>Parent:</b> <a class="el" href="index.html#umeelementdaemon">&lt;daemon&gt;</a> </li>
<li>
<b>Children:</b> <a class="el" href="index.html#umeelementlbmconfig">&lt;lbm-config&gt;</a>, <a class="el" href="index.html#umeelementpublishinginterval">&lt;publishing-interval&gt;</a>, <a class="el" href="index.html#umeelementremotesnapshotrequest">&lt;remote-snapshot-request&gt;</a>, <a class="el" href="index.html#umeelementremoteconfigchangesrequest">&lt;remote-config-changes-request&gt;</a> </li>
</ul>
<p><b>XML</b> <b>Attributes:</b> </p><table class="doxtable">
<tr>
<th>Attribute </th><th>Description </th><th>Valid Values </th><th>Default Value </th></tr>
<tr>
<td><b>topic</b> </td><td>Topic name for used to publish daemon statistics. </td><td>string </td><td><b><code>"umestore.monitor"</code></b> </td></tr>
</table>
<p><b>Example:</b> </p>
<p>Daemon Statistics are configured at both the daemon level and at the Store level. </p><div class="fragment"><div class="line">&lt;?xml version=<span class="stringliteral">&quot;1.0&quot;</span>?&gt;</div><div class="line">&lt;ume-store version=<span class="stringliteral">&quot;1.3&quot;</span>&gt;</div><div class="line">  &lt;daemon&gt;</div><div class="line">    &lt;daemon-monitor topic=<span class="stringliteral">&quot;bozo&quot;</span>&gt;</div><div class="line">      &lt;publishing-interval&gt;</div><div class="line">        ...</div><div class="line">      &lt;/publishing-interval&gt;</div><div class="line">    &lt;/daemon-monitor&gt;</div><div class="line">  &lt;/daemon&gt;</div><div class="line">  ...</div><div class="line">&lt;/ume-store&gt;</div></div><!-- fragment --><hr/>
<p> <br />
 </p>
<h3><a class="anchor" id="umeelementremoteconfigchangesrequest"></a>
UMP Element "&lt;remote-config-changes-request&gt;"&nbsp;&nbsp;<small><a href="#umeelementremoteconfigchangesrequest">&lt;-</a></small></h3>
<p>Controls if the daemon will respond to requests from monitoring applications. See <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/design.tag:../../Design/" href="../../Design/umfeatures.html#daemoncontrolrequests">Daemon Control Requests</a> for general information, <a class="el" href="index.html#storedaemoncontrolrequests">Store Daemon Control Requests</a> for Store-specific requests.</p>
<dl class="section warning"><dt>Warning</dt><dd>If misused, the Daemon Control Requests feature allows a user to interfere with the messaging infrastructure in potentially disruptive ways. By default, this feature is disabled. However, especially if you have enabled the <a class="el" href="index.html#umeelementremoteconfigchangesrequest">UMP Element "&lt;remote-config-changes-request&gt;"</a>, Informatica recommends <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/design.tag:../../Design/" href="../../Design/umfeatures.html#securingdaemoncontrolrequests">Securing Daemon Control Requests</a>.</dd></dl>
<ul>
<li>
<b>Parent:</b> <a class="el" href="index.html#umeelementdaemonmonitor">&lt;daemon-monitor&gt;</a> </li>
</ul>
<p><b>XML</b> <b>Attributes:</b> </p><table class="doxtable">
<tr>
<th>Attribute </th><th>Description </th><th>Valid Values </th><th>Default Value </th></tr>
<tr>
<td><b>allow</b> </td><td>Enables handling requests. </td><td><b><code>"0"</code></b> - Disable request handling. <br />
<b><code>"1"</code></b> - Enable request handling. </td><td><b><code>"0"</code></b> </td></tr>
</table>
<p><b>Example:</b> </p>
<p>Daemon Statistics are configured at both the daemon level and at the Store level. </p><div class="fragment"><div class="line">&lt;?xml version=<span class="stringliteral">&quot;1.0&quot;</span>?&gt;</div><div class="line">&lt;ume-store version=<span class="stringliteral">&quot;1.3&quot;</span>&gt;</div><div class="line">  &lt;daemon&gt;</div><div class="line">    &lt;daemon-monitor topic=<span class="stringliteral">&quot;bozo&quot;</span>&gt;</div><div class="line">      &lt;remote-config-changes-request allow=<span class="stringliteral">&quot;1&quot;</span>/&gt;</div><div class="line">        ...</div><div class="line">      &lt;/publishing-interval&gt;</div><div class="line">    &lt;/daemon-monitor&gt;</div><div class="line">  &lt;/daemon&gt;</div><div class="line">  ...</div><div class="line">&lt;/ume-store&gt;</div></div><!-- fragment --><hr/>
<p> <br />
 </p>
<h3><a class="anchor" id="umeelementremotesnapshotrequest"></a>
UMP Element "&lt;remote-snapshot-request&gt;"&nbsp;&nbsp;<small><a href="#umeelementremotesnapshotrequest">&lt;-</a></small></h3>
<p>Controls if the daemon will respond to requests from monitoring applications. See <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/design.tag:../../Design/" href="../../Design/umfeatures.html#daemoncontrolrequests">Daemon Control Requests</a>.</p>
<ul>
<li>
<b>Parent:</b> <a class="el" href="index.html#umeelementdaemonmonitor">&lt;daemon-monitor&gt;</a> </li>
</ul>
<p><b>XML</b> <b>Attributes:</b> </p><table class="doxtable">
<tr>
<th>Attribute </th><th>Description </th><th>Valid Values </th><th>Default Value </th></tr>
<tr>
<td><b>allow</b> </td><td>Enables handling requests. </td><td><b><code>"0"</code></b> - Disable request handling. <br />
<b><code>"1"</code></b> - Enable request handling. </td><td><b><code>"0"</code></b> </td></tr>
</table>
<p><b>Example:</b> </p>
<p>Daemon Statistics are configured at both the daemon level and at the Store level. </p><div class="fragment"><div class="line">&lt;?xml version=<span class="stringliteral">&quot;1.0&quot;</span>?&gt;</div><div class="line">&lt;ume-store version=<span class="stringliteral">&quot;1.3&quot;</span>&gt;</div><div class="line">  &lt;daemon&gt;</div><div class="line">    &lt;daemon-monitor topic=<span class="stringliteral">&quot;bozo&quot;</span>&gt;</div><div class="line">      &lt;remote-snapshot-request allow=<span class="stringliteral">&quot;1&quot;</span>/&gt;</div><div class="line">        ...</div><div class="line">      &lt;/publishing-interval&gt;</div><div class="line">    &lt;/daemon-monitor&gt;</div><div class="line">  &lt;/daemon&gt;</div><div class="line">  ...</div><div class="line">&lt;/ume-store&gt;</div></div><!-- fragment --><hr/>
<p> <br />
 </p>
<h3><a class="anchor" id="umeelementlbmconfig"></a>
UMP Element "&lt;lbm-config&gt;"&nbsp;&nbsp;<small><a href="#umeelementlbmconfig">&lt;-</a></small></h3>
<p>Pathname for LBM configuration file to be used when the Store creates UM objects (context, receivers, sources).</p>
<p>When used as a child element of <a class="el" href="index.html#umeelementdaemonmonitor">&lt;daemon-monitor&gt;</a>, configures the UM objects used for publishing <a class="el" href="index.html#storedaemonstatistics">Store Binary Daemon Statistics</a>.</p>
<p>Note that starting with UM version 6.13, if one or more errors are discovered in the LBM configuration file, the errors are written to the log file and the Store continues running. I.e. errors in the LBM configuration file are treated as warnings. See <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/index.html#configurationerrorhandling">Configuration Error Handling</a> for an explanation.</p>
<ul>
<li>
<b>Parent:</b> <a class="el" href="index.html#umeelementdaemon">&lt;daemon&gt;</a>, <a class="el" href="index.html#umeelementdaemonmonitor">&lt;daemon-monitor&gt;</a> </li>
</ul>
<p><b>XML</b> <b>Attributes:</b> </p><table class="doxtable">
<tr>
<th>Attribute </th><th>Description </th><th>Valid Values </th><th>Default Value </th></tr>
<tr>
<td><b>xml:space</b> </td><td>Specifies how whitespace (tabs, spaces, linefeeds) are handled in the element content. See <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/xmlconfigurationfiles.html#xmlspaceattribute">xml:space Attribute</a>. </td><td><b><code>"default"</code></b> - Trim whitespace. <br />
<b><code>"preserve"</code></b> - Retain whitespace exactly as entered. </td><td><b>default</b> </td></tr>
</table>
<p><b>Example:</b> </p><div class="fragment"><div class="line">&lt;?xml version=<span class="stringliteral">&quot;1.0&quot;</span>?&gt;</div><div class="line">&lt;ume-store version=<span class="stringliteral">&quot;1.3&quot;</span>&gt;</div><div class="line">  &lt;daemon&gt;</div><div class="line">    &lt;lbm-config&gt;/etc/ump/store0.cfg&lt;/lbm-config&gt;</div><div class="line">    ...</div><div class="line">    &lt;daemon-monitor topic=<span class="stringliteral">&quot;bozo&quot;</span>&gt;</div><div class="line">      &lt;lbm-config&gt;/etc/ump/store0_dmon.cfg&lt;/lbm-config&gt;</div><div class="line">      ...</div><div class="line">    &lt;/daemon-monitor&gt;</div><div class="line">  &lt;/daemon&gt;</div><div class="line">  ...</div><div class="line">&lt;/ume-store&gt;</div></div><!-- fragment --><hr/>
<p> <br />
 </p>
<h3><a class="anchor" id="umeelementwebmonitor"></a>
UMP Element "&lt;web-monitor&gt;"&nbsp;&nbsp;<small><a href="#umeelementwebmonitor">&lt;-</a></small></h3>
<p>Address and port for the Store web-based monitor. Format is "Address:Port", where "Address" is either an IP address of one of the host's interfaces, or is "*" which allows the use of any interface. See <a class="el" href="index.html#storewebmonitor">Store Web Monitor</a> for more information.</p>
<p>If omitted, the web monitor is disabled.</p>
<ul>
<li>
<b>Parent:</b> <a class="el" href="index.html#umeelementdaemon">&lt;daemon&gt;</a> </li>
</ul>
<p><b>XML</b> <b>Attributes:</b> </p><table class="doxtable">
<tr>
<th>Attribute </th><th>Description </th><th>Valid Values </th><th>Default Value </th></tr>
<tr>
<td><b>xml:space</b> </td><td>Specifies how whitespace (tabs, spaces, linefeeds) are handled in the element content. See <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/xmlconfigurationfiles.html#xmlspaceattribute">xml:space Attribute</a>. </td><td><b><code>"default"</code></b> - Trim whitespace. <br />
<b><code>"preserve"</code></b> - Retain whitespace exactly as entered. </td><td><b>default</b> </td></tr>
</table>
<p><b>Example:</b> </p><div class="fragment"><div class="line">&lt;?xml version=<span class="stringliteral">&quot;1.0&quot;</span>?&gt;</div><div class="line">&lt;ume-store version=<span class="stringliteral">&quot;1.3&quot;</span>&gt;</div><div class="line">  &lt;daemon&gt;</div><div class="line">    &lt;web-monitor&gt;*:8080&lt;/web-monitor&gt;</div><div class="line">    ...</div><div class="line">  &lt;/daemon&gt;</div><div class="line">  ...</div><div class="line">&lt;/ume-store&gt;</div></div><!-- fragment --><hr/>
<p> <br />
 </p>
<h3><a class="anchor" id="umeelementlbmlicensefile"></a>
UMP Element "&lt;lbm-license-file&gt;"&nbsp;&nbsp;<small><a href="#umeelementlbmlicensefile">&lt;-</a></small></h3>
<p>Pathname for UM license file. NOTE: starting with UM version 6.8, a license key is no longer required for Store operation. This element is retained for backwards compatibility.</p>
<ul>
<li>
<b>Parent:</b> <a class="el" href="index.html#umeelementdaemon">&lt;daemon&gt;</a> </li>
</ul>
<p><b>XML</b> <b>Attributes:</b> </p><table class="doxtable">
<tr>
<th>Attribute </th><th>Description </th><th>Valid Values </th><th>Default Value </th></tr>
<tr>
<td><b>xml:space</b> </td><td>Specifies how whitespace (tabs, spaces, linefeeds) are handled in the element content. See <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/xmlconfigurationfiles.html#xmlspaceattribute">xml:space Attribute</a>. </td><td><b><code>"default"</code></b> - Trim whitespace. <br />
<b><code>"preserve"</code></b> - Retain whitespace exactly as entered. </td><td><b>default</b> </td></tr>
</table>
<hr/>
<p> <br />
 </p>
<h3><a class="anchor" id="umeelementxmlconfig"></a>
UMP Element "&lt;xml-config&gt;"&nbsp;&nbsp;<small><a href="#umeelementxmlconfig">&lt;-</a></small></h3>
<p><a class="anchor" id="xmlconfigtag"></a>Pathname for LBM configuration file (in XML format) to be used when the Store creates UM objects (context, receivers, sources). I.e. options that control the UM library.</p>
<p>See <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/xmlconfigurationfiles.html">XML Configuration Files</a> for general information on XML-based LBM configuration files.</p>
<p>See also <a class="el" href="index.html#umeelementlbmconfig">&lt;lbm-config&gt;</a>.</p>
<ul>
<li>
<b>Parent:</b> <a class="el" href="index.html#umeelementdaemon">&lt;daemon&gt;</a> </li>
</ul>
<p><b>XML</b> <b>Attributes:</b> </p><table class="doxtable">
<tr>
<th>Attribute </th><th>Description </th><th>Valid Values </th><th>Default Value </th></tr>
<tr>
<td><b>xml:space</b> </td><td>Specifies how whitespace (tabs, spaces, linefeeds) are handled in the element content. See <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/xmlconfigurationfiles.html#xmlspaceattribute">xml:space Attribute</a>. </td><td><b><code>"default"</code></b> - Trim whitespace. <br />
<b><code>"preserve"</code></b> - Retain whitespace exactly as entered. </td><td><b>default</b> </td></tr>
<tr>
<td><b>application-name</b> </td><td><p class="starttd">Allows the user to select an "application name" for the Store Process, which can then used by the LBM XML configuration file to target a configuration to that Store using <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/xmlconfigurationfiles.html#umelementapplication">UM Element "&lt;application&gt;"</a>.</p>
<p class="endtd">See <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/xmlconfigurationfiles.html#xmlapplicationnames">XML Application Names</a> for more information on application names. </p>
</td><td>string </td><td><b><code>"umestored"</code></b> </td></tr>
</table>
<p><b>Example:</b> </p><div class="fragment"><div class="line">&lt;?xml version=<span class="stringliteral">&quot;1.0&quot;</span>?&gt;</div><div class="line">&lt;ume-store version=<span class="stringliteral">&quot;1.3&quot;</span>&gt;</div><div class="line">  &lt;daemon&gt;</div><div class="line">    &lt;xml-config&gt;/etc/ump/store01_um.xml&lt;/xml-config&gt;</div><div class="line">    ...</div><div class="line">  &lt;/daemon&gt;</div><div class="line">  ...</div><div class="line">&lt;/ume-store&gt;</div></div><!-- fragment --><hr/>
<p> <br />
 </p>
<h3><a class="anchor" id="umeelementgid"></a>
UMP Element "&lt;gid&gt;"&nbsp;&nbsp;<small><a href="#umeelementgid">&lt;-</a></small></h3>
<p>Specifies a Group ID (GID) for daemon process (if run as root).</p>
<ul>
<li>
<b>Parent:</b> <a class="el" href="index.html#umeelementdaemon">&lt;daemon&gt;</a> </li>
</ul>
<p><b>XML</b> <b>Attributes:</b> </p><table class="doxtable">
<tr>
<th>Attribute </th><th>Description </th><th>Valid Values </th><th>Default Value </th></tr>
<tr>
<td><b>xml:space</b> </td><td>Specifies how whitespace (tabs, spaces, linefeeds) are handled in the element content. See <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/xmlconfigurationfiles.html#xmlspaceattribute">xml:space Attribute</a>. </td><td><b><code>"default"</code></b> - Trim whitespace. <br />
<b><code>"preserve"</code></b> - Retain whitespace exactly as entered. </td><td><b>default</b> </td></tr>
</table>
<p><b>Example:</b> </p><div class="fragment"><div class="line">&lt;?xml version=<span class="stringliteral">&quot;1.0&quot;</span>?&gt;</div><div class="line">&lt;ume-store version=<span class="stringliteral">&quot;1.3&quot;</span>&gt;</div><div class="line">  &lt;daemon&gt;</div><div class="line">    &lt;gid&gt;1234&lt;/gid&gt;</div><div class="line">    ...</div><div class="line">  &lt;/daemon&gt;</div><div class="line">  ...</div><div class="line">&lt;/ume-store&gt;</div></div><!-- fragment --><hr/>
<p> <br />
 </p>
<h3><a class="anchor" id="umeelementpidfile"></a>
UMP Element "&lt;pidfile&gt;"&nbsp;&nbsp;<small><a href="#umeelementpidfile">&lt;-</a></small></h3>
<p>Contains the pathname for daemon process ID (PID) file.</p>
<ul>
<li>
<b>Parent:</b> <a class="el" href="index.html#umeelementdaemon">&lt;daemon&gt;</a> </li>
</ul>
<p><b>XML</b> <b>Attributes:</b> </p><table class="doxtable">
<tr>
<th>Attribute </th><th>Description </th><th>Valid Values </th><th>Default Value </th></tr>
<tr>
<td><b>xml:space</b> </td><td>Specifies how whitespace (tabs, spaces, linefeeds) are handled in the element content. See <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/xmlconfigurationfiles.html#xmlspaceattribute">xml:space Attribute</a>. </td><td><b><code>"default"</code></b> - Trim whitespace. <br />
<b><code>"preserve"</code></b> - Retain whitespace exactly as entered. </td><td><b>default</b> </td></tr>
</table>
<p><b>Example:</b> </p><div class="fragment"><div class="line">&lt;?xml version=<span class="stringliteral">&quot;1.0&quot;</span>?&gt;</div><div class="line">&lt;ume-store version=<span class="stringliteral">&quot;1.3&quot;</span>&gt;</div><div class="line">  &lt;daemon&gt;</div><div class="line">    &lt;pidfile&gt;/var/run/store01.pid&lt;/pidfile&gt;</div><div class="line">    ...</div><div class="line">  &lt;/daemon&gt;</div><div class="line">  ...</div><div class="line">&lt;/ume-store&gt;</div></div><!-- fragment --><hr/>
<p> <br />
 </p>
<h3><a class="anchor" id="umeelementuid"></a>
UMP Element "&lt;uid&gt;"&nbsp;&nbsp;<small><a href="#umeelementuid">&lt;-</a></small></h3>
<p>Specifies a User ID (UID) for daemon process (if run as root).</p>
<ul>
<li>
<b>Parent:</b> <a class="el" href="index.html#umeelementdaemon">&lt;daemon&gt;</a> </li>
</ul>
<p><b>XML</b> <b>Attributes:</b> </p><table class="doxtable">
<tr>
<th>Attribute </th><th>Description </th><th>Valid Values </th><th>Default Value </th></tr>
<tr>
<td><b>xml:space</b> </td><td>Specifies how whitespace (tabs, spaces, linefeeds) are handled in the element content. See <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/xmlconfigurationfiles.html#xmlspaceattribute">xml:space Attribute</a>. </td><td><b><code>"default"</code></b> - Trim whitespace. <br />
<b><code>"preserve"</code></b> - Retain whitespace exactly as entered. </td><td><b>default</b> </td></tr>
</table>
<p><b>Example:</b> </p><div class="fragment"><div class="line">&lt;?xml version=<span class="stringliteral">&quot;1.0&quot;</span>?&gt;</div><div class="line">&lt;ume-store version=<span class="stringliteral">&quot;1.3&quot;</span>&gt;</div><div class="line">  &lt;daemon&gt;</div><div class="line">    &lt;uid&gt;1234&lt;/uid&gt;</div><div class="line">    ...</div><div class="line">  &lt;/daemon&gt;</div><div class="line">  ...</div><div class="line">&lt;/ume-store&gt;</div></div><!-- fragment --><hr/>
<p> <br />
 </p>
<h3><a class="anchor" id="umeelementlog"></a>
UMP Element "&lt;log&gt;"&nbsp;&nbsp;<small><a href="#umeelementlog">&lt;-</a></small></h3>
<p>Contains the path name of the Store log file. See <a class="el" href="index.html#storerollinglogs">Store Rolling Logs</a> for more information.</p>
<p>If omitted, log messages are written to standard output.</p>
<ul>
<li>
<b>Parent:</b> <a class="el" href="index.html#umeelementdaemon">&lt;daemon&gt;</a> </li>
</ul>
<p><b>XML</b> <b>Attributes:</b> </p><table class="doxtable">
<tr>
<th>Attribute </th><th>Description </th><th>Valid Values </th><th>Default Value </th></tr>
<tr>
<td><b>type</b> </td><td>Where to write log messages. </td><td><b><code>"file"</code></b> - Write log messages to a file. <br />
<b><code>"console"</code></b> - Write log messages to standard output. </td><td><b><code>"console"</code></b> </td></tr>
<tr>
<td><b>frequency</b> </td><td>Time-frame by which to roll the log file. </td><td><b><code>"disable"</code></b> - Do not roll the log file based on time. <br />
<b><code>"daily"</code></b> - Roll the log file at midnight. <br />
<b><code>"hourly"</code></b> - Roll log file after approximately an hour, but is not exact and can drift significantly over a period of time. <br />
<b><code>"test"</code></b> - For internal Informatica use only. Do not use. </td><td><b><code>"disable"</code></b> </td></tr>
<tr>
<td><b>size</b> </td><td>Size (in MB, i.e. 2**20, or 1,048,576) of current log file at which it is rolled. Specify 0 to disable rolling by log file size. </td><td>string </td><td><b><code>"10"</code></b> </td></tr>
<tr>
<td><b>xml:space</b> </td><td>Specifies how whitespace (tabs, spaces, linefeeds) are handled in the element content. See <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/xmlconfigurationfiles.html#xmlspaceattribute">xml:space Attribute</a>. </td><td><b><code>"default"</code></b> - Trim whitespace. <br />
<b><code>"preserve"</code></b> - Retain whitespace exactly as entered. </td><td><b>default</b> </td></tr>
</table>
<p><b>Example:</b> </p><div class="fragment"><div class="line">&lt;?xml version=<span class="stringliteral">&quot;1.0&quot;</span>?&gt;</div><div class="line">&lt;ume-store version=<span class="stringliteral">&quot;1.3&quot;</span>&gt;</div><div class="line">  &lt;daemon&gt;</div><div class="line">    &lt;log type=<span class="stringliteral">&quot;file&quot;</span> size=<span class="stringliteral">&quot;23&quot;</span> frequency=<span class="stringliteral">&quot;daily&quot;</span>&gt;/var/log/store01.log&lt;/log&gt;</div><div class="line">    ...</div><div class="line">  &lt;/daemon&gt;</div><div class="line">  ...</div><div class="line">&lt;/ume-store&gt;</div></div><!-- fragment --><p><br />
 </p>
<h2><a class="anchor" id="umestoredconfigurationdtd"></a>
umestored Configuration DTD&nbsp;&nbsp;<small><a href="#umestoredconfigurationdtd">&lt;-</a></small></h2>
<p>The DTD for UM Store configuration has evolved over time:</p>
<table class="doxtable">
<tr>
<th>DTD Version </th><th>Release Date </th><th>Product Version </th><th>Supported Features </th></tr>
<tr>
<td>1.0 </td><td>Feb. 2007 </td><td>UME 1.0 </td><td>Persistent Stores </td></tr>
<tr>
<td>1.1 </td><td>April 2010 </td><td>UME 3.0.1 / UMQ 1.0 </td><td>Persistent Stores, Queues and Ultra Load Balancing (ULB) </td></tr>
<tr>
<td>1.2 </td><td>March 2011 </td><td>UME 3.2 / UMQ 2.1 </td><td>Persistent Stores, Queues, Ultra Load Balancing (ULB), Dead Letter Queue, Indexed Queuing and Indexed ULB </td></tr>
<tr>
<td>1.3 </td><td>November 2016 </td><td>UM 6.10 </td><td>Addition of '<code>&lt;xml-config&gt;</code>' element (under '<code>&lt;daemon&gt;</code>'). </td></tr>
</table>
<p>To assist the user with upgrades, a more-recent version of the Store will accept an older version of the Store configuration file. For example, if your Store configuration file starts with this: </p><div class="fragment"><div class="line">&lt;?xml version=<span class="stringliteral">&quot;1.0&quot;</span>?&gt;</div><div class="line">&lt;ume-store version=<span class="stringliteral">&quot;1.0&quot;</span>&gt;</div></div><!-- fragment --><p> the Store will parse the file according to DTD 1.0. If you wish to use Store configuration settings that were not available in 1.0, you will need to upgrade to a later DTD version. <a href="https://ultramessaging.github.io/UM_Support.html">Contact Informatica Support</a> if you have trouble.</p>
<p>Here is the current DTD version:</p>
<div class="fragment"><div class="line">&lt;!ELEMENT ume-store (daemon, stores?)&gt; </div><div class="line">&lt;!ATTLIST ume-store version CDATA #REQUIRED&gt; </div><div class="line">&lt;!ELEMENT daemon (log | uid | pidfile | gid | lbm-config | xml-config | lbm-license-file | web-monitor | daemon-monitor)*&gt; </div><div class="line">&lt;!ELEMENT log ( #PCDATA )&gt; </div><div class="line">&lt;!ATTLIST log type (file | console) <span class="stringliteral">&quot;console&quot;</span>&gt; </div><div class="line">&lt;!ATTLIST log frequency (disable | daily | hourly | test) <span class="stringliteral">&quot;disable&quot;</span>&gt; </div><div class="line">&lt;!ATTLIST log size CDATA #IMPLIED&gt; </div><div class="line">&lt;!ATTLIST log xml:space (<span class="keywordflow">default</span> | preserve) <span class="stringliteral">&quot;default&quot;</span>&gt;</div><div class="line">&lt;!ELEMENT pidfile ( #PCDATA )&gt; </div><div class="line">&lt;!ATTLIST pidfile xml:space (<span class="keywordflow">default</span> | preserve) <span class="stringliteral">&quot;default&quot;</span>&gt;</div><div class="line">&lt;!ELEMENT uid ( #PCDATA )&gt; </div><div class="line">&lt;!ATTLIST uid xml:space (<span class="keywordflow">default</span> | preserve) <span class="stringliteral">&quot;default&quot;</span>&gt;</div><div class="line">&lt;!ELEMENT gid ( #PCDATA )&gt; </div><div class="line">&lt;!ATTLIST gid xml:space (<span class="keywordflow">default</span> | preserve) <span class="stringliteral">&quot;default&quot;</span>&gt;</div><div class="line">&lt;!ELEMENT lbm-config ( #PCDATA )&gt; </div><div class="line">&lt;!ATTLIST lbm-config xml:space (<span class="keywordflow">default</span> | preserve) <span class="stringliteral">&quot;default&quot;</span>&gt;</div><div class="line">&lt;!ELEMENT xml-config ( #PCDATA )&gt; </div><div class="line">&lt;!ATTLIST xml-config xml:space (<span class="keywordflow">default</span> | preserve) <span class="stringliteral">&quot;default&quot;</span>&gt;</div><div class="line">&lt;!ATTLIST xml-config application-name CDATA #IMPLIED&gt; </div><div class="line">&lt;!ELEMENT lbm-license-file ( #PCDATA )&gt; </div><div class="line">&lt;!ATTLIST lbm-license-file xml:space (<span class="keywordflow">default</span> | preserve) <span class="stringliteral">&quot;default&quot;</span>&gt;</div><div class="line">&lt;!ELEMENT web-monitor ( #PCDATA )&gt; </div><div class="line">&lt;!ATTLIST web-monitor xml:space (<span class="keywordflow">default</span> | preserve) <span class="stringliteral">&quot;default&quot;</span>&gt;</div><div class="line">&lt;!ELEMENT stores (store*)&gt; </div><div class="line">&lt;!ELEMENT store (restore-last?, publishing-interval?, ume-attributes+, topics+)&gt; </div><div class="line">&lt;!ATTLIST store name CDATA #REQUIRED&gt; </div><div class="line">&lt;!ATTLIST store <span class="keyword">interface </span>CDATA #IMPLIED&gt; </div><div class="line">&lt;!ATTLIST store port CDATA #REQUIRED&gt; </div><div class="line">&lt;!ELEMENT restore-last EMPTY&gt; </div><div class="line">&lt;!ATTLIST restore-last behavior (hours | none) #IMPLIED&gt; </div><div class="line">&lt;!ATTLIST restore-last value CDATA #REQUIRED&gt; </div><div class="line">&lt;!ELEMENT topics (topic+)&gt; </div><div class="line">&lt;!ELEMENT topic (restore-last?, ume-attributes*)&gt; </div><div class="line">&lt;!ATTLIST topic pattern CDATA #REQUIRED&gt; </div><div class="line">&lt;!ATTLIST topic type (direct | PCRE | regexp) <span class="preprocessor">#IMPLIED&gt; </span></div><div class="line">&lt;!ELEMENT ume-attributes (option+)&gt; </div><div class="line">&lt;!ELEMENT option EMPTY&gt; </div><div class="line">&lt;!ATTLIST option type (lbm-receiver | lbm-context | lbm-source | store) <span class="preprocessor">#IMPLIED&gt; </span></div><div class="line">&lt;!ATTLIST option name CDATA #REQUIRED&gt; </div><div class="line">&lt;!ATTLIST option value CDATA #REQUIRED&gt; </div><div class="line">&lt;!ELEMENT daemon-monitor (lbm-config | publishing-interval | remote-snapshot-request | remote-config-changes-request)*&gt; </div><div class="line">&lt;!ATTLIST daemon-monitor topic CDATA <span class="stringliteral">&quot;umestore.monitor&quot;</span>&gt; </div><div class="line">&lt;!ELEMENT publishing-interval (group+)&gt; </div><div class="line">&lt;!ELEMENT group EMPTY&gt; </div><div class="line">&lt;!ATTLIST group name (<span class="keywordflow">default</span> | store | source | receiver | disk | config | memory) <span class="preprocessor">#REQUIRED&gt; </span></div><div class="line">&lt;!ATTLIST group ivl CDATA #REQUIRED&gt; </div><div class="line">&lt;!ELEMENT remote-snapshot-request EMPTY&gt; </div><div class="line">&lt;!ATTLIST remote-snapshot-request allow (0 | 1) <span class="stringliteral">&quot;0&quot;</span>&gt; </div><div class="line">&lt;!ELEMENT remote-config-changes-request EMPTY&gt; </div><div class="line">&lt;!ATTLIST remote-config-changes-request allow (0 | 1) <span class="stringliteral">&quot;0&quot;</span>&gt; </div></div><!-- fragment --><p><br />
 </p>
<h2><a class="anchor" id="storeconfigurationexample"></a>
Store Configuration Example&nbsp;&nbsp;<small><a href="#storeconfigurationexample">&lt;-</a></small></h2>
<p>Store Process with one Store.</p>
<div class="fragment"><div class="line">&lt;?xml version=<span class="stringliteral">&quot;1.0&quot;</span>?&gt;</div><div class="line">&lt;ume-store version=<span class="stringliteral">&quot;1.3&quot;</span>&gt;</div><div class="line">  &lt;daemon&gt;</div><div class="line">    &lt;log&gt;stored.log&lt;/log&gt;</div><div class="line">    &lt;pidfile&gt;stored.pid&lt;/pidfile&gt;</div><div class="line">    &lt;web-monitor&gt;*:15304&lt;/web-monitor&gt;</div><div class="line">  &lt;/daemon&gt;</div><div class="line"></div><div class="line">  &lt;stores&gt;</div><div class="line">    &lt;store name=<span class="stringliteral">&quot;test-store&quot;</span> port=<span class="stringliteral">&quot;14567&quot;</span>&gt;</div><div class="line">      &lt;ume-attributes&gt;</div><div class="line">        &lt;option type=<span class="stringliteral">&quot;store&quot;</span> name=<span class="stringliteral">&quot;disk-cache-directory&quot;</span> value=<span class="stringliteral">&quot;cache&quot;</span>/&gt;</div><div class="line">        &lt;option type=<span class="stringliteral">&quot;store&quot;</span> name=<span class="stringliteral">&quot;disk-state-directory&quot;</span> value=<span class="stringliteral">&quot;state&quot;</span>/&gt;</div><div class="line">        &lt;option type=<span class="stringliteral">&quot;store&quot;</span> name=<span class="stringliteral">&quot;context-name&quot;</span> value=<span class="stringliteral">&quot;remote-store&quot;</span>/&gt;</div><div class="line">      &lt;/ume-attributes&gt;</div><div class="line">      &lt;topics&gt;</div><div class="line">        &lt;topic pattern=<span class="stringliteral">&quot;test.*&quot;</span> type=<span class="stringliteral">&quot;PCRE&quot;</span>&gt;</div><div class="line">          &lt;ume-attributes&gt;</div><div class="line">            &lt;option type=<span class="stringliteral">&quot;store&quot;</span> name=<span class="stringliteral">&quot;repository-type&quot;</span> value=<span class="stringliteral">&quot;disk&quot;</span>/&gt;</div><div class="line">            &lt;option type=<span class="stringliteral">&quot;store&quot;</span> name=<span class="stringliteral">&quot;repository-size-threshold&quot;</span> value=<span class="stringliteral">&quot;2048&quot;</span>/&gt;</div><div class="line">            &lt;option type=<span class="stringliteral">&quot;store&quot;</span> name=<span class="stringliteral">&quot;repository-size-limit&quot;</span> value=<span class="stringliteral">&quot;209715200&quot;</span>/&gt;</div><div class="line">            &lt;option type=<span class="stringliteral">&quot;store&quot;</span> name=<span class="stringliteral">&quot;repository-disk-file-size-limit&quot;</span> value=<span class="stringliteral">&quot;1073741824&quot;</span>/&gt;</div><div class="line">            &lt;option type=<span class="stringliteral">&quot;store&quot;</span> name=<span class="stringliteral">&quot;source-activity-timeout&quot;</span> value=<span class="stringliteral">&quot;120000&quot;</span>/&gt;</div><div class="line">            &lt;option type=<span class="stringliteral">&quot;store&quot;</span> name=<span class="stringliteral">&quot;receiver-activity-timeout&quot;</span> value=<span class="stringliteral">&quot;120000&quot;</span>/&gt;</div><div class="line">            &lt;option type=<span class="stringliteral">&quot;store&quot;</span> name=<span class="stringliteral">&quot;retransmission-request-forwarding&quot;</span> value=<span class="stringliteral">&quot;0&quot;</span>/&gt;</div><div class="line">          &lt;/ume-attributes&gt;</div><div class="line">        &lt;/topic&gt;</div><div class="line">      &lt;/topics&gt;</div><div class="line">    &lt;/store&gt;</div><div class="line">  &lt;/stores&gt;</div><div class="line">&lt;/ume-store&gt;</div></div><!-- fragment --><p><a class="anchor" id="optiontypesforumeattributeselements"></a><br />
 </p><hr/>
<h1><a class="anchor" id="optionsforastoresumeattributeselement"></a>
"&lt;option&gt;" Element Details&nbsp;&nbsp;<small><a href="#optionsforastoresumeattributeselement">&lt;-</a></small></h1>
<p>The <a class="el" href="index.html#umeelementoption">&lt;option&gt;</a> element is the primary construct for setting Store configuration options. It always appears inside a <a class="el" href="index.html#umeelementumeattributes">&lt;ume-attributes&gt;</a> block, which can appear in two places of your Store configuration file: the <a class="el" href="index.html#umeelementstore">&lt;store&gt;</a> element, or the <a class="el" href="index.html#umeelementtopic">&lt;topic&gt;</a> element.</p>
<p>The <a class="el" href="index.html#umeelementoption">&lt;option&gt;</a> element is used to set three kinds of Store configuration options </p><ul>
<li>
<a class="el" href="index.html#optionsforum">Setting LBM Configuration Options</a>, for the underlying UM library. </li>
<li>
<a class="el" href="index.html#optionsforatopicsume-attributeselement">Store Options in "&lt;store&gt;" Element</a>. </li>
<li>
<a class="el" href="index.html#storeoptionsintopicelement">Store Options in "&lt;topic&gt;" Element</a>. </li>
</ul>
<p><br />
 </p>
<h2><a class="anchor" id="optionsforum"></a>
Setting LBM Configuration Options&nbsp;&nbsp;<small><a href="#optionsforum">&lt;-</a></small></h2>
<p>The <a class="el" href="index.html#umeelementoption">&lt;option&gt;</a> element can be used to set LBM configuration options. I.e. options that control the UM library. Those options come in different scopes. For the purposes of the Store, only the "context", "receiver", and "source" scopes are used, as follows: </p><div class="fragment"><div class="line">&lt;option type=<span class="stringliteral">&quot;lbm-context&quot;</span> name=<span class="stringliteral">&quot;context_option_name&quot;</span> value=<span class="stringliteral">&quot;desired_value&quot;</span>/&gt;</div><div class="line">&lt;option type=<span class="stringliteral">&quot;lbm-receiver&quot;</span> name=<span class="stringliteral">&quot;receiver_option_name&quot;</span> value=<span class="stringliteral">&quot;desired_value&quot;</span>/&gt;</div><div class="line">&lt;option type=<span class="stringliteral">&quot;lbm-source&quot;</span> name=<span class="stringliteral">&quot;source_option_name&quot;</span> value=<span class="stringliteral">&quot;desired_value&quot;</span>/&gt;</div></div><!-- fragment --><p>But the valid LBM scopes depend on the "&lt;option&gt;" element's ancestor: </p><table class="doxtable">
<tr>
<th>Ancestor </th><th>Valid LBM <code>type</code> Attributes </th></tr>
<tr>
<td><a class="el" href="index.html#umeelementstore">&lt;store&gt;</a> </td><td>type="lbm-context" </td></tr>
<tr>
<td><a class="el" href="index.html#umeelementtopic">&lt;topic&gt;</a> </td><td>type="lbm-receiver"<br />
type="lbm-source" </td></tr>
</table>
<p>See the <a href="../../Config/index.html">UM Configuration Guide</a> for the full list of LBM configuration options.</p>
<dl class="section note"><dt>Note</dt><dd>Some UM options specify interfaces, which can be done by supplying the device name of the interface. Special care must be taken when supplying device names in an XML file. See <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/generalconfigurationguidelines.html#interfacedevicenamesandxml">Interface Device Names and XML</a> for details.</dd></dl>
<p>Most Store deployments do not make heavy use of the <a class="el" href="index.html#umeelementoption">&lt;option&gt;</a> element to set LBM configuration parameters. Instead they use an LBM configuration file (via the <a class="el" href="index.html#umeelementlbmconfig">&lt;lbm-config&gt;</a> or the <a class="el" href="index.html#umeelementxmlconfig">UMP Element "&lt;xml-config&gt;"</a> element) for setting most of the desired LBM configuration options. However, it is often desired to override one or more of those settings based on an individual Store, or an individual topic within a Store.</p>
<p><b>Example</b></p>
<p>In this hypothetical example, the Store loads a generic project-specific flat LBM configuration file: </p><div class="fragment"><div class="line">...</div><div class="line">&lt;daemon&gt;</div><div class="line">  &lt;lbm-config&gt;/etc/ump/<span class="keyword">generic</span>.cfg&lt;/lbm-config&gt;</div><div class="line">&lt;/daemon&gt;</div><div class="line">...</div></div><!-- fragment --><p>The file "generic.cfg" sets the <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grptransportlbtrmreliability.html#transportlbtrmreceiversocketbuffercontext">receiver-side LBT-RM socket buffer size</a> to 4 MB using: </p><div class="fragment"><div class="line">context transport_lbtrm_receiver_socket_buffer 4194304</div></div><!-- fragment --><p>Since we want the Stores to avoid loss as much as possible, the receive socket buffers should be made large (32 MB): </p><div class="fragment"><div class="line">...</div><div class="line">&lt;daemon&gt;</div><div class="line">  &lt;lbm-config&gt;/etc/ump/<span class="keyword">generic</span>.cfg&lt;/lbm-config&gt;</div><div class="line">&lt;/daemon&gt;</div><div class="line">&lt;store name=<span class="stringliteral">&quot;MyStore1&quot;</span> interface=<span class="stringliteral">&quot;10.1.2.3&quot;</span> port=<span class="stringliteral">&quot;12000&quot;</span>&gt;</div><div class="line">  &lt;ume-attributes&gt;</div><div class="line">    &lt;option type=<span class="stringliteral">&quot;lbm-context&quot;</span> name=<span class="stringliteral">&quot;transport_lbtrm_receiver_socket_buffer&quot;</span> value=<span class="stringliteral">&quot;33554432&quot;</span>/&gt;</div><div class="line">    ...</div><div class="line">  &lt;/ume-attributes&gt;</div><div class="line">  ...</div><div class="line">&lt;/store&gt;</div></div><!-- fragment --><p>Finally, for the specific topic "EventStream", one might want the initial NAK backoff interval to be longer than for application receivers. </p><div class="fragment"><div class="line">...</div><div class="line">&lt;daemon&gt;</div><div class="line">  &lt;lbm-config&gt;/etc/ump/<span class="keyword">generic</span>.cfg&lt;/lbm-config&gt;</div><div class="line">&lt;/daemon&gt;</div><div class="line">&lt;store name=<span class="stringliteral">&quot;MyStore1&quot;</span> interface=<span class="stringliteral">&quot;10.1.2.3&quot;</span> port=<span class="stringliteral">&quot;12000&quot;</span>&gt;</div><div class="line">  &lt;ume-attributes&gt;</div><div class="line">    &lt;option type=<span class="stringliteral">&quot;lbm-context&quot;</span> name=<span class="stringliteral">&quot;transport_lbtrm_receiver_socket_buffer&quot;</span> value=<span class="stringliteral">&quot;33554432&quot;</span>/&gt;</div><div class="line">    ...</div><div class="line">  &lt;/ume-attributes&gt;</div><div class="line">  &lt;topics&gt;</div><div class="line">    &lt;topic pattern=<span class="stringliteral">&quot;EventStream&quot;</span> type=<span class="stringliteral">&quot;direct&quot;</span>&gt;</div><div class="line">      &lt;ume-attributes&gt;</div><div class="line">        &lt;option type=<span class="stringliteral">&quot;lbm-receiver&quot;</span> name=<span class="stringliteral">&quot;transport_lbtrm_nak_initial_backoff_interval&quot;</span> value=<span class="stringliteral">&quot;500&quot;</span>/&gt;</div><div class="line">        ...</div><div class="line">      &lt;/ume-attributes&gt;</div><div class="line">      ...</div><div class="line">    &lt;/topic&gt;</div><div class="line">  &lt;/topics&gt;</div><div class="line">  ...</div><div class="line">&lt;/store&gt;</div></div><!-- fragment --><p><a class="anchor" id="storeoptions"></a><br />
 </p>
<h2><a class="anchor" id="optionsforatopicsume-attributeselement"></a>
Store Options in "&lt;store&gt;" Element&nbsp;&nbsp;<small><a href="#optionsforatopicsume-attributeselement">&lt;-</a></small></h2>
<p>For Store configuration options, the <a class="el" href="index.html#umeelementoption">&lt;option&gt;</a> element must appear inside the <a class="el" href="index.html#umeelementstore">&lt;store&gt;</a> element, as follows:</p>
<div class="fragment"><div class="line">&lt;store ...&gt;</div><div class="line">  &lt;ume-attributes&gt;</div><div class="line">    &lt;option type=<span class="stringliteral">&quot;store&quot;</span> name=<span class="stringliteral">&quot;store_option_name&quot;</span> value=<span class="stringliteral">&quot;desired_value&quot;</span>/&gt;</div><div class="line">  &lt;/ume-attributes&gt;</div><div class="line">&lt;/store&gt;</div></div><!-- fragment --><p>For example: </p><div class="fragment"><div class="line">&lt;store name=<span class="stringliteral">&quot;MyStore1&quot;</span> interface=<span class="stringliteral">&quot;10.1.2.3&quot;</span> port=<span class="stringliteral">&quot;12000&quot;</span>&gt;</div><div class="line">  &lt;ume-attributes&gt;</div><div class="line">    &lt;option type=<span class="stringliteral">&quot;store&quot;</span> name=<span class="stringliteral">&quot;disk-cache-directory&quot;</span> value=<span class="stringliteral">&quot;/cache&quot;</span>/&gt;</div><div class="line">    ...</div><div class="line">  &lt;/ume-attributes&gt;</div><div class="line">&lt;/store&gt;</div></div><!-- fragment --><p>These options apply to all repositories in this Store instance.</p>
<p><br />
 </p>
<h3><a class="anchor" id="umecfgdiskcachedirectory"></a>
Store Option "disk-cache-directory"&nbsp;&nbsp;<small><a href="#umecfgdiskcachedirectory">&lt;-</a></small></h3>
<p>Pathname for disk Store message cache directory. Must be between 1 and 230 characters long. It is the user's responsibility to create this directory; the Store will not do so.</p>
<p><b>Default:</b> </p><pre class="fragment">umestored-cache
</pre><p> The Store looks for a sub-directory by that name in the current working directory of the stored process.</p>
<p><b>Example:</b> </p><div class="fragment"><div class="line">&lt;store name=<span class="stringliteral">&quot;MyStore1&quot;</span> interface=<span class="stringliteral">&quot;10.1.2.3&quot;</span> port=<span class="stringliteral">&quot;12000&quot;</span>&gt;</div><div class="line">  &lt;ume-attributes&gt;</div><div class="line">    &lt;option type=<span class="stringliteral">&quot;store&quot;</span> name=<span class="stringliteral">&quot;disk-cache-directory&quot;</span> value=<span class="stringliteral">&quot;/var/ump/cache&quot;</span>/&gt;</div><div class="line">    ...</div><div class="line">  &lt;/ume-attributes&gt;</div><div class="line">&lt;/store&gt;</div></div><!-- fragment --><p><br />
 </p>
<h3><a class="anchor" id="umecfgdiskstatedirectory"></a>
Store Option "disk-state-directory"&nbsp;&nbsp;<small><a href="#umecfgdiskstatedirectory">&lt;-</a></small></h3>
<p>Pathname for disk Store state directory. Must be between 1 and 230 characters long. It is the user's responsibility to create this directory; the Store will not do so.</p>
<p><b>Default</b> </p><pre class="fragment">umestored-state
</pre><p> The Store looks for a sub-directory by that name in the current working directory of the Store Process.</p>
<p><b>Example:</b> </p><div class="fragment"><div class="line">&lt;store name=<span class="stringliteral">&quot;MyStore1&quot;</span> interface=<span class="stringliteral">&quot;10.1.2.3&quot;</span> port=<span class="stringliteral">&quot;12000&quot;</span>&gt;</div><div class="line">  &lt;ume-attributes&gt;</div><div class="line">    &lt;option type=<span class="stringliteral">&quot;store&quot;</span> name=<span class="stringliteral">&quot;disk-state-directory&quot;</span> value=<span class="stringliteral">&quot;/var/ump/state&quot;</span>/&gt;</div><div class="line">    ...</div><div class="line">  &lt;/ume-attributes&gt;</div><div class="line">&lt;/store&gt;</div></div><!-- fragment --><p><br />
 </p>
<h3><a class="anchor" id="umecfgallowproxysource"></a>
Store Option "allow-proxy-source"&nbsp;&nbsp;<small><a href="#umecfgallowproxysource">&lt;-</a></small></h3>
<p>Allows the Store to act as a proxy source in case a registered source terminates.</p>
<p><b>Default:</b> </p><pre class="fragment">0 (Disable)
</pre><p><b>Example:</b> </p><div class="fragment"><div class="line">&lt;store name=<span class="stringliteral">&quot;MyStore1&quot;</span> interface=<span class="stringliteral">&quot;10.1.2.3&quot;</span> port=<span class="stringliteral">&quot;12000&quot;</span>&gt;</div><div class="line">  &lt;ume-attributes&gt;</div><div class="line">    &lt;option type=<span class="stringliteral">&quot;store&quot;</span> name=<span class="stringliteral">&quot;allow-proxy-source&quot;</span> value=<span class="stringliteral">&quot;1&quot;</span>/&gt;</div><div class="line">    ...</div><div class="line">  &lt;/ume-attributes&gt;</div><div class="line">&lt;/store&gt;</div></div><!-- fragment --><p><br />
 </p>
<h3><a class="anchor" id="umecfgproxysourcerepoquorumrequired"></a>
Store Option "proxy-source-repo-quorum-required"&nbsp;&nbsp;<small><a href="#umecfgproxysourcerepoquorumrequired">&lt;-</a></small></h3>
<p>Modifies the Store's proxy source election algorithm to better conform to the general UM persistence design.</p>
<p>See <a class="el" href="index.html#proxysourceelections">Proxy Source Elections</a> for details.</p>
<p><b>Default:</b> </p><pre class="fragment">0 (Disable)
</pre><p><b>Example:</b> </p><div class="fragment"><div class="line">&lt;store name=<span class="stringliteral">&quot;MyStore1&quot;</span> interface=<span class="stringliteral">&quot;10.1.2.3&quot;</span> port=<span class="stringliteral">&quot;12000&quot;</span>&gt;</div><div class="line">  &lt;ume-attributes&gt;</div><div class="line">    &lt;option type=<span class="stringliteral">&quot;store&quot;</span> name=<span class="stringliteral">&quot;allow-proxy-source&quot;</span> value=<span class="stringliteral">&quot;1&quot;</span>/&gt;</div><div class="line">    &lt;option type=<span class="stringliteral">&quot;store&quot;</span> name=<span class="stringliteral">&quot;proxy-source-repo-quorum-required&quot;</span> value=<span class="stringliteral">&quot;1&quot;</span>/&gt;</div><div class="line">    ...</div><div class="line">  &lt;/ume-attributes&gt;</div><div class="line">&lt;/store&gt;</div></div><!-- fragment --><p><br />
 </p>
<h3><a class="anchor" id="umecfgcontextname"></a>
Store Option "context-name"&nbsp;&nbsp;<small><a href="#umecfgcontextname">&lt;-</a></small></h3>
<p>Name of the Store that can be used by sources to refer to the Store instead of the address:port. Restricted to 128 characters in length, and may contain only alphanumeric characters, hyphens, and underscores.</p>
<p>A Store runs in its own context, so the Store's context name can be used to identify the Store. UM automatically resolves Store context names, which can facilitate persistent operation across the <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/design.tag:../../Design/" href="../../Design/fundamentalconcepts.html#umrouter">DRO</a>. Store context names must be unique across the entire network.</p>
<p>See also <a class="el" href="index.html#identifyingpersistentstores">Identifying Persistent Stores</a></p>
<p><b>Default:</b></p>
<p>None (Store must be referenced by address:port).</p>
<p><b>Example:</b> </p><div class="fragment"><div class="line">&lt;store name=<span class="stringliteral">&quot;MyStore1&quot;</span> interface=<span class="stringliteral">&quot;10.1.2.3&quot;</span> port=<span class="stringliteral">&quot;12000&quot;</span>&gt;</div><div class="line">  &lt;ume-attributes&gt;</div><div class="line">    &lt;option type=<span class="stringliteral">&quot;store&quot;</span> name=<span class="stringliteral">&quot;context-name&quot;</span> value=<span class="stringliteral">&quot;NEWYORK-1&quot;</span>/&gt;</div><div class="line">    ...</div><div class="line">  &lt;/ume-attributes&gt;</div><div class="line">&lt;/store&gt;</div></div><!-- fragment --><p><br />
 </p>
<h3><a class="anchor" id="umecfgretransmissionrequestprocessingrate"></a>
Store Option "retransmission-request-processing-rate"&nbsp;&nbsp;<small><a href="#umecfgretransmissionrequestprocessingrate">&lt;-</a></small></h3>
<p>Specifies the number of retransmission requests processed by a Store per second across all topics. The Store drops all retransmission requests that exceed this value.</p>
<p><b>Default:</b> </p><pre class="fragment">262144
</pre><p><b>Example:</b> </p><div class="fragment"><div class="line">&lt;store name=<span class="stringliteral">&quot;MyStore1&quot;</span> interface=<span class="stringliteral">&quot;10.1.2.3&quot;</span> port=<span class="stringliteral">&quot;12000&quot;</span>&gt;</div><div class="line">  &lt;ume-attributes&gt;</div><div class="line">    &lt;option type=<span class="stringliteral">&quot;store&quot;</span> name=<span class="stringliteral">&quot;retransmission-request-processing-rate&quot;</span></div><div class="line">                         value=<span class="stringliteral">&quot;524288&quot;</span>/&gt;</div><div class="line">    ...</div><div class="line">  &lt;/ume-attributes&gt;</div><div class="line">&lt;/store&gt;</div></div><!-- fragment --><p><br />
 </p>
<h2><a class="anchor" id="storeoptionsintopicelement"></a>
Store Options in "&lt;topic&gt;" Element&nbsp;&nbsp;<small><a href="#storeoptionsintopicelement">&lt;-</a></small></h2>
<p>For Store repository configuration options, the <a class="el" href="index.html#umeelementoption">&lt;option&gt;</a> element must appear inside the <a class="el" href="index.html#umeelementtopic">&lt;topic&gt;</a> element, as follows:</p>
<div class="fragment"><div class="line">&lt;topic ...&gt;</div><div class="line">  &lt;ume-attributes&gt;</div><div class="line">    &lt;option type=<span class="stringliteral">&quot;store&quot;</span> name=<span class="stringliteral">&quot;store_option_name&quot;</span> value=<span class="stringliteral">&quot;desired_value&quot;</span>/&gt;</div><div class="line">  &lt;/ume-attributes&gt;</div><div class="line">&lt;/topic&gt;</div></div><!-- fragment --><p>For example: </p><div class="fragment"><div class="line">&lt;topic pattern=<span class="stringliteral">&quot;EventStream&quot;</span> type=<span class="stringliteral">&quot;direct&quot;</span>&gt;</div><div class="line">  &lt;ume-attributes&gt;</div><div class="line">    &lt;option type=<span class="stringliteral">&quot;store&quot;</span> name=<span class="stringliteral">&quot;repository-type&quot;</span> value=<span class="stringliteral">&quot;disk&quot;</span>/&gt;</div><div class="line">    ...</div></div><!-- fragment --><p>These options apply all repositories for sources that match the specified topic(s).</p>
<p><br />
 </p>
<h3><a class="anchor" id="umecfgretransmissionrequestforwarding"></a>
Topic Option "retransmission-request-forwarding"&nbsp;&nbsp;<small><a href="#umecfgretransmissionrequestforwarding">&lt;-</a></small></h3>
<p>If enabled (value="1"), the Store forwards retransmission requests to sources if and only if the Store does not have the data. If disabled (value="0"), the Store services retransmission requests for data it has, and does not forward requests to sources for data it does not have. (This option should not be enabled if you anticipate using the <a class="el" href="index.html#requestmarkstoredmessageinvalid">Request: Mark Stored Message Invalid</a> feature.)</p>
<p><b>Default:</b> </p><pre class="fragment">0 (Store services retransmission requests and does not forward requests)
</pre><p><b>Example:</b> </p><div class="fragment"><div class="line">&lt;topic pattern=<span class="stringliteral">&quot;EventStream&quot;</span> type=<span class="stringliteral">&quot;direct&quot;</span>&gt;</div><div class="line">  &lt;ume-attributes&gt;</div><div class="line">    &lt;option type=<span class="stringliteral">&quot;store&quot;</span> name=<span class="stringliteral">&quot;retransmission-request-forwarding&quot;</span> value=<span class="stringliteral">&quot;1&quot;</span>/&gt;</div><div class="line">    ...</div><div class="line">  &lt;/ume-attributes&gt;</div><div class="line">&lt;/topic&gt;</div></div><!-- fragment --><p><br />
 </p>
<h3><a class="anchor" id="umecfgrepositorytype"></a>
Topic Option "repository-type"&nbsp;&nbsp;<small><a href="#umecfgrepositorytype">&lt;-</a></small></h3>
<p>Specifies how messages should be retained by the Store.</p>
<p><b>Possible Values</b> </p><ul>
<li>
<b>"memory"</b> retains messages only in the (presumably volatile) main memory of the Store. </li>
<li>
<b>"disk"</b> retains messages to disk storage. In addition, messages are cached in main memory for a time as well. </li>
<li>
<b>"reduced-fd"</b> DEPRECATED, do not use. Retains messages to disk storage in a lower-performing way (compared to <b>"disk"</b>) that uses fewer OS File Descriptors. This type should not be used, as it will be removed in a future UM version. <a href="https://ultramessaging.github.io/UM_Support.html">Contact Informatica Support</a> to devise a plan to migrate away from its use. </li>
<li>
<b>"no-cache"</b> DEPRECATED, do not use. Does not retain messages, only state information. This type should not be used, as it will be removed in a future UM version. <a href="https://ultramessaging.github.io/UM_Support.html">Contact Informatica Support</a> to devise a plan to migrate away from its use. </li>
</ul>
<p><b>Default:</b> </p><pre class="fragment">memory
</pre><p><b>Example:</b> </p><div class="fragment"><div class="line">&lt;topic pattern=<span class="stringliteral">&quot;EventStream&quot;</span> type=<span class="stringliteral">&quot;direct&quot;</span>&gt;</div><div class="line">  &lt;ume-attributes&gt;</div><div class="line">    &lt;option type=<span class="stringliteral">&quot;store&quot;</span> name=<span class="stringliteral">&quot;repository-type&quot;</span> value=<span class="stringliteral">&quot;disk&quot;</span>/&gt;</div><div class="line">    ...</div><div class="line">  &lt;/ume-attributes&gt;</div><div class="line">&lt;/topic&gt;</div></div><!-- fragment --><p><br />
 </p>
<h3><a class="anchor" id="umecfgrepositorysizethreshold"></a>
Topic Option "repository-size-threshold"&nbsp;&nbsp;<small><a href="#umecfgrepositorysizethreshold">&lt;-</a></small></h3>
<p>Specifies the minimum number of message bytes retained in the Store's memory cache. The purpose of this option is for disk Stores to keep some messages in memory even after they have been written to disk. This allows for rapid recovery of recent messages.</p>
<p>For SPP Stores, includes message payload, headers, and Store structure overhead. For RPP Stores, only includes message payload.</p>
<p>Note that the Store's memory cache size can fall below this threshold. With RPP Stores, if all required receivers have acknowledged consumption of all messages, all messages will be deleted.</p>
<p>Also for RPP, the source LBM configuration may override this option with <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umerepositorysizethresholdsource">ume_repository_size_threshold (source)</a>. In that case, the Store's repository-size-threshold value is used as the maximum allowed value for ume_repository_size_threshold. If the source exceeds this value, its registration is rejected.</p>
<p>For RPP, see <a class="el" href="index.html#rppconfigurationspecifics">RPP Configuration Specifics</a> for interactions between this and other configuration options. See <a class="el" href="index.html#receiverpacedpersistenceoperations">RPP: Receiver-Paced Persistence</a> for general information on RPP.</p>
<p><b>Default:</b> </p><pre class="fragment">1024
</pre><p><b>Example:</b> </p><div class="fragment"><div class="line">&lt;topic pattern=<span class="stringliteral">&quot;EventStream&quot;</span> type=<span class="stringliteral">&quot;direct&quot;</span>&gt;</div><div class="line">  &lt;ume-attributes&gt;</div><div class="line">    &lt;option type=<span class="stringliteral">&quot;store&quot;</span> name=<span class="stringliteral">&quot;repository-size-threshold&quot;</span> value=<span class="stringliteral">&quot;2048&quot;</span>/&gt;</div><div class="line">    ...</div><div class="line">  &lt;/ume-attributes&gt;</div><div class="line">&lt;/topic&gt;</div></div><!-- fragment --><p><br />
 </p>
<h3><a class="anchor" id="umecfgrepositorysizelimit"></a>
Topic Option "repository-size-limit"&nbsp;&nbsp;<small><a href="#umecfgrepositorysizelimit">&lt;-</a></small></h3>
<p>Specifies the maximum number of message bytes retained in the Store's memory cache. For <a class="el" href="index.html#umecfgrepositorytype">repository-type</a> <b>"memory"</b>, this represents the maximum size for the entire repository. For <a class="el" href="index.html#umecfgrepositorytype">repository-type</a> <b>"disk"</b>, the total repository size is limited by <a class="el" href="index.html#umecfgrepositorydiskfilesizelimit">Topic Option "repository-disk-file-size-limit"</a>.</p>
<p>Note that the design of UM's persistence allows a maximum of 2,147,483,647 messages (2**31 - 1) to be persisted. Do not specify a limit that would allow more than 2,147,483,647 messages to be stored.</p>
<p>For SPP Stores, includes message payload, headers, and Store structure overhead. For RPP Stores, only includes message payload.</p>
<p>Also for RPP, the source LBM configuration may override this option with <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umerepositorysizelimitsource">ume_repository_size_limit (source)</a>. In that case, the Store's repository-size-limit value is used the maximum allowed value for ume_repository_size_limit. If the source exceeds this value, its registration is rejected.</p>
<p>For RPP, see <a class="el" href="index.html#rppconfigurationspecifics">RPP Configuration Specifics</a> for interactions between this and other configuration options. See <a class="el" href="index.html#receiverpacedpersistenceoperations">RPP: Receiver-Paced Persistence</a> for general information on RPP.</p>
<p><b>Default:</b> </p><pre class="fragment">50331648 (48 MB)
</pre><p><b>Example:</b> </p><div class="fragment"><div class="line">&lt;topic pattern=<span class="stringliteral">&quot;EventStream&quot;</span> type=<span class="stringliteral">&quot;direct&quot;</span>&gt;</div><div class="line">  &lt;ume-attributes&gt;</div><div class="line">    &lt;option type=<span class="stringliteral">&quot;store&quot;</span> name=<span class="stringliteral">&quot;repository-size-limit&quot;</span> value=<span class="stringliteral">&quot;67108864&quot;</span>/&gt;</div><div class="line">    ...</div><div class="line">  &lt;/ume-attributes&gt;</div><div class="line">&lt;/topic&gt;</div></div><!-- fragment --><p><br />
 </p>
<h3><a class="anchor" id="umecfgrepositoryagethreshold"></a>
Topic Option "repository-age-threshold"&nbsp;&nbsp;<small><a href="#umecfgrepositoryagethreshold">&lt;-</a></small></h3>
<p>Specifies how long in seconds the repository keeps a message available. Pertains to a memory Store or the memory cache of a disk Store. The repository reclaims space used to store messages that exceed this threshold. Note that if these deleted messages have been persisted to disk, they are available to receivers for recovery.</p>
<p>This is a rarely-used option, typically only useful on a memory-only Store.</p>
<p>A value of 0 means message age is not considered in retention decisions.</p>
<p><b>Default:</b> </p><pre class="fragment">0 (disabled)
</pre><p><b>Example:</b> </p><div class="fragment"><div class="line">&lt;topic pattern=<span class="stringliteral">&quot;EventStream&quot;</span> type=<span class="stringliteral">&quot;direct&quot;</span>&gt;</div><div class="line">  &lt;ume-attributes&gt;</div><div class="line">    &lt;option type=<span class="stringliteral">&quot;store&quot;</span> name=<span class="stringliteral">&quot;repository-age-threshold&quot;</span> value=<span class="stringliteral">&quot;120&quot;</span>/&gt;</div><div class="line">    ...</div><div class="line">  &lt;/ume-attributes&gt;</div><div class="line">&lt;/topic&gt;</div></div><!-- fragment --><p><br />
 </p>
<h3><a class="anchor" id="umecfgrepositorydiskmaxasynccbs"></a>
Topic Option "repository-disk-max-async-cbs"&nbsp;&nbsp;<small><a href="#umecfgrepositorydiskmaxasynccbs">&lt;-</a></small></h3>
<p>For topics with a <a class="el" href="index.html#umecfgrepositorytype">repository-type</a> <b>"disk"</b>, specifies the maximum number of outstanding async I/O callbacks for reading messages from disk.</p>
<p><b>Default:</b> </p><pre class="fragment">16 (callbacks)
</pre><p><b>Example:</b> </p><div class="fragment"><div class="line">&lt;topic pattern=<span class="stringliteral">&quot;EventStream&quot;</span> type=<span class="stringliteral">&quot;direct&quot;</span>&gt;</div><div class="line">  &lt;ume-attributes&gt;</div><div class="line">    &lt;option type=<span class="stringliteral">&quot;store&quot;</span> name=<span class="stringliteral">&quot;repository-disk-max-async-cbs&quot;</span> value=<span class="stringliteral">&quot;24&quot;</span>/&gt;</div><div class="line">    ...</div><div class="line">  &lt;/ume-attributes&gt;</div><div class="line">&lt;/topic&gt;</div></div><!-- fragment --><p><br />
 </p>
<h3><a class="anchor" id="umecfgrepositorydiskmaxwriteasynccbs"></a>
Topic Option "repository-disk-max-write-async-cbs"&nbsp;&nbsp;<small><a href="#umecfgrepositorydiskmaxwriteasynccbs">&lt;-</a></small></h3>
<p>For topics with a <a class="el" href="index.html#umecfgrepositorytype">repository-type</a> <b>"disk"</b>, specifies the maximum number of outstanding async I/O callbacks for writing messages to disk. This option is deprecated, and if supplied, must be set equal to 1.</p>
<p><b>Default:</b> </p><pre class="fragment">1 (callback)
</pre><p><b>Example:</b> </p><div class="fragment"><div class="line">&lt;topic pattern=<span class="stringliteral">&quot;EventStream&quot;</span> type=<span class="stringliteral">&quot;direct&quot;</span>&gt;</div><div class="line">  &lt;ume-attributes&gt;</div><div class="line">    &lt;option type=<span class="stringliteral">&quot;store&quot;</span> name=<span class="stringliteral">&quot;repository-disk-max-write-async-cbs&quot;</span> value=<span class="stringliteral">&quot;1&quot;</span>/&gt;</div><div class="line">    ...</div><div class="line">  &lt;/ume-attributes&gt;</div><div class="line">&lt;/topic&gt;</div></div><!-- fragment --><p><br />
 </p>
<h3><a class="anchor" id="umecfgrepositorydiskmaxreadasynccbs"></a>
Topic Option "repository-disk-max-read-async-cbs"&nbsp;&nbsp;<small><a href="#umecfgrepositorydiskmaxreadasynccbs">&lt;-</a></small></h3>
<p>For topics with a <a class="el" href="index.html#umecfgrepositorytype">repository-type</a> <b>"disk"</b>, specifies the maximum number of outstanding async I/O callbacks for reading messages from disk. A low value can lead to severely slower message recovery rates by receivers.</p>
<p><b>Default:</b> </p><pre class="fragment">10,000 (callbacks)
</pre><p><b>Example:</b> </p><div class="fragment"><div class="line">&lt;topic pattern=<span class="stringliteral">&quot;EventStream&quot;</span> type=<span class="stringliteral">&quot;direct&quot;</span>&gt;</div><div class="line">  &lt;ume-attributes&gt;</div><div class="line">    &lt;option type=<span class="stringliteral">&quot;store&quot;</span> name=<span class="stringliteral">&quot;repository-disk-max-read-async-cbs&quot;</span> value=<span class="stringliteral">&quot;15000&quot;</span>/&gt;</div><div class="line">    ...</div><div class="line">  &lt;/ume-attributes&gt;</div><div class="line">&lt;/topic&gt;</div></div><!-- fragment --><p><br />
 </p>
<h3><a class="anchor" id="umecfgrepositorydiskfilesizelimit"></a>
Topic Option "repository-disk-file-size-limit"&nbsp;&nbsp;<small><a href="#umecfgrepositorydiskfilesizelimit">&lt;-</a></small></h3>
<p>Specifies the maximum amount of disk space, in bytes, that will be used to store retained messages. A minimum value of 196992 is enforced.</p>
<p>Note that the design of UM's persistence allows a maximum of 2,147,483,647 messages (2**31 - 1) to be persisted. Do not specify a limit that would allow more than 2,147,483,647 messages to be stored.</p>
<p>This option only applies for <a class="el" href="index.html#umecfgrepositorytype">repository-type</a> <b>"disk"</b>.</p>
<p>Also for RPP, the source LBM configuration may override this option with <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umerepositorydiskfilesizelimitsource">ume_repository_disk_file_size_limit (source)</a>. In that case, the Store's repository-disk-file-size-limit value is used as the maximum allowed value for ume_repository_disk_file_size_limit. If the source exceeds this value, its registration is rejected.</p>
<p>For RPP, see <a class="el" href="index.html#rppconfigurationspecifics">RPP Configuration Specifics</a> for interactions between this and other configuration options. See <a class="el" href="index.html#receiverpacedpersistenceoperations">RPP: Receiver-Paced Persistence</a> for general information on RPP.</p>
<p><b>Default:</b> </p><pre class="fragment">104857600 (100 MB)
</pre><p><b>Example:</b> </p><div class="fragment"><div class="line">&lt;topic pattern=<span class="stringliteral">&quot;EventStream&quot;</span> type=<span class="stringliteral">&quot;direct&quot;</span>&gt;</div><div class="line">  &lt;ume-attributes&gt;</div><div class="line">    &lt;option type=<span class="stringliteral">&quot;store&quot;</span> name=<span class="stringliteral">&quot;repository-disk-file-size-limit&quot;</span> value=<span class="stringliteral">&quot;209715200&quot;</span>/&gt;</div><div class="line">    ...</div><div class="line">  &lt;/ume-attributes&gt;</div><div class="line">&lt;/topic&gt;</div></div><!-- fragment --><p><br />
 </p>
<h3><a class="anchor" id="umecfgrepositorydiskfilepreallocate"></a>
Topic Option "repository-disk-file-preallocate"&nbsp;&nbsp;<small><a href="#umecfgrepositorydiskfilepreallocate">&lt;-</a></small></h3>
<p>For topics with a <a class="el" href="index.html#umecfgrepositorytype">repository-type</a> <b>"disk"</b>, if set to 1, UM pre-allocates a Store's cache files to match their maximum size on disk (as configured by repository-disk-file-size-limit) upon creation, as opposed to growing to that size as the Store receives new messages. For ext3/4 and NTFS file systems, this options creates a sparse file, which does not allocate all of the underlying data blocks. Advantages of pre-allocation include better performance on rotating disks due to less file fragmentation, and knowing that enough disk space exists for any new source that registers. Disadvantage is the time to create the cache files, especially if many sources register at once.</p>
<p><b>Default:</b> </p><pre class="fragment">0 (do not pre-allocate)
</pre><p><b>Example:</b> </p><div class="fragment"><div class="line">&lt;topic pattern=<span class="stringliteral">&quot;EventStream&quot;</span> type=<span class="stringliteral">&quot;direct&quot;</span>&gt;</div><div class="line">  &lt;ume-attributes&gt;</div><div class="line">    &lt;option type=<span class="stringliteral">&quot;store&quot;</span> name=<span class="stringliteral">&quot;repository-disk-file-preallocate&quot;</span> value=<span class="stringliteral">&quot;1&quot;</span>/&gt;</div><div class="line">    ...</div><div class="line">  &lt;/ume-attributes&gt;</div><div class="line">&lt;/topic&gt;</div></div><!-- fragment --><p><br />
 </p>
<h3><a class="anchor" id="umecfgrepositorydiskasyncbufferlength"></a>
Topic Option "repository-disk-async-buffer-length"&nbsp;&nbsp;<small><a href="#umecfgrepositorydiskasyncbufferlength">&lt;-</a></small></h3>
<p>For topics with a <a class="el" href="index.html#umecfgrepositorytype">repository-type</a> <b>"disk"</b>, specifies the size of the buffers that will be used in async I/O operations for reading and writing messages to disk. A minimum value of 65664 is enforced.</p>
<p><b>Default:</b> </p><pre class="fragment">1024000 (bytes)
</pre><p><b>Example:</b> </p><div class="fragment"><div class="line">&lt;topic pattern=<span class="stringliteral">&quot;EventStream&quot;</span> type=<span class="stringliteral">&quot;direct&quot;</span>&gt;</div><div class="line">  &lt;ume-attributes&gt;</div><div class="line">    &lt;option type=<span class="stringliteral">&quot;store&quot;</span> name=<span class="stringliteral">&quot;repository-disk-async-buffer-length&quot;</span> value=<span class="stringliteral">&quot;2097152&quot;</span>/&gt;</div><div class="line">    ...</div><div class="line">  &lt;/ume-attributes&gt;</div><div class="line">&lt;/topic&gt;</div></div><!-- fragment --><p><br />
 </p>
<h3><a class="anchor" id="umecfgrepositorydiskmessagechecksum"></a>
Topic Option "repository-disk-message-checksum"&nbsp;&nbsp;<small><a href="#umecfgrepositorydiskmessagechecksum">&lt;-</a></small></h3>
<p>For topics with a <a class="el" href="index.html#umecfgrepositorytype">repository-type</a> <b>"disk"</b>, specifies whether the messages saved to disk should include a checksum field for validation if the Store is restarted.</p>
<p><b>Default:</b> </p><pre class="fragment">0 (disabled)
</pre><p><b>Example:</b> </p><div class="fragment"><div class="line">&lt;topic pattern=<span class="stringliteral">&quot;EventStream&quot;</span> type=<span class="stringliteral">&quot;direct&quot;</span>&gt;</div><div class="line">  &lt;ume-attributes&gt;</div><div class="line">    &lt;option type=<span class="stringliteral">&quot;store&quot;</span> name=<span class="stringliteral">&quot;repository-disk-message-checksum&quot;</span> value=<span class="stringliteral">&quot;1&quot;</span>/&gt;</div><div class="line">    ...</div><div class="line">  &lt;/ume-attributes&gt;</div><div class="line">&lt;/topic&gt;</div></div><!-- fragment --><p><br />
 </p>
<h3><a class="anchor" id="umecfgsourceactivitytimeout"></a>
Topic Option "source-activity-timeout"&nbsp;&nbsp;<small><a href="#umecfgsourceactivitytimeout">&lt;-</a></small></h3>
<p>Establishes the period of time in milliseconds from a source's last activity to the release of the source's RegID. Stores return an error to any new source requesting the source's RegID during this period. If proxy sources are enabled (<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umeproxysourcesource">ume_proxy_source (source)</a>) the Store does not release the source's RegID and UM elects a proxy source. If neither proxy sources nor <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umestatelifetimesource">ume_state_lifetime (source)</a> are configured, the Store also deletes the source's state and cache. Can be overridden by <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umeactivitytimeoutsource">ume_activity_timeout (source)</a>. See also <a class="el" href="index.html#persistenceproxysources">Persistence Proxy Sources</a>.</p>
<p>Note that <a class="el" href="index.html#umecfgsourceactivitytimeout">Topic Option "source-activity-timeout"</a> value should be set to at least double the <a class="el" href="index.html#umecfgkeepaliveinterval">Topic Option "keepalive-interval"</a> value.</p>
<p><b>Default:</b> </p><pre class="fragment">30000 (30 seconds)
</pre><p><b>Example:</b> </p><div class="fragment"><div class="line">&lt;topic pattern=<span class="stringliteral">&quot;EventStream&quot;</span> type=<span class="stringliteral">&quot;direct&quot;</span>&gt;</div><div class="line">  &lt;ume-attributes&gt;</div><div class="line">    &lt;option type=<span class="stringliteral">&quot;store&quot;</span> name=<span class="stringliteral">&quot;source-activity-timeout&quot;</span> value=<span class="stringliteral">&quot;60000&quot;</span>/&gt;</div><div class="line">    ...</div><div class="line">  &lt;/ume-attributes&gt;</div><div class="line">&lt;/topic&gt;</div></div><!-- fragment --><p><br />
 </p>
<h3><a class="anchor" id="umecfgsourcestatelifetime"></a>
Topic Option "source-state-lifetime"&nbsp;&nbsp;<small><a href="#umecfgsourcestatelifetime">&lt;-</a></small></h3>
<p>Establishes the period of time in milliseconds from a source's last activity to the deletion of the source's state and cache by the Store, regardless of whether a proxy source has been created or not. You can also configure <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umestatelifetimesource">ume_state_lifetime (source)</a> for the source. The Store uses whichever is shorter. See also <a class="el" href="index.html#persistenceproxysources">Persistence Proxy Sources</a>.</p>
<p><b>Default:</b> </p><pre class="fragment">0 (disabled)
</pre><p><b>Example:</b> </p><div class="fragment"><div class="line">&lt;topic pattern=<span class="stringliteral">&quot;EventStream&quot;</span> type=<span class="stringliteral">&quot;direct&quot;</span>&gt;</div><div class="line">  &lt;ume-attributes&gt;</div><div class="line">    &lt;option type=<span class="stringliteral">&quot;store&quot;</span> name=<span class="stringliteral">&quot;source-state-lifetime&quot;</span> value=<span class="stringliteral">&quot;0&quot;</span>/&gt;</div><div class="line">    ...</div><div class="line">  &lt;/ume-attributes&gt;</div><div class="line">&lt;/topic&gt;</div></div><!-- fragment --><p><br />
 </p>
<h3><a class="anchor" id="umecfgreceiveractivitytimeout"></a>
Topic Option "receiver-activity-timeout"&nbsp;&nbsp;<small><a href="#umecfgreceiveractivitytimeout">&lt;-</a></small></h3>
<p>Establishes the period of time in milliseconds from a receiver's last activity to the release of the receiver's RegID. Stores return an error to any new request for the receiver's RegID during this period. Can be overridden by <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umeactivitytimeoutreceiver">ume_activity_timeout (receiver)</a>. See also <a class="el" href="index.html#persistenceproxysources">Persistence Proxy Sources</a>.</p>
<p><b>Default:</b> </p><pre class="fragment">30000 (30 seconds)
</pre><p><b>Example:</b> </p><div class="fragment"><div class="line">&lt;topic pattern=<span class="stringliteral">&quot;EventStream&quot;</span> type=<span class="stringliteral">&quot;direct&quot;</span>&gt;</div><div class="line">  &lt;ume-attributes&gt;</div><div class="line">    &lt;option type=<span class="stringliteral">&quot;store&quot;</span> name=<span class="stringliteral">&quot;receiver-activity-timeout&quot;</span> value=<span class="stringliteral">&quot;45000&quot;</span>/&gt;</div><div class="line">    ...</div><div class="line">  &lt;/ume-attributes&gt;</div><div class="line">&lt;/topic&gt;</div></div><!-- fragment --><p><br />
 </p>
<h3><a class="anchor" id="umecfgreceiverstatelifetime"></a>
Topic Option "receiver-state-lifetime"&nbsp;&nbsp;<small><a href="#umecfgreceiverstatelifetime">&lt;-</a></small></h3>
<p>Establishes the period of time in milliseconds from a receiver's last activity to the deletion of the receiver's state and cache by the Store. You can also configure <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umestatelifetimereceiver">ume_state_lifetime (receiver)</a> for the receiver. The Store uses whichever is shorter. See also <a class="el" href="index.html#persistenceproxysources">Persistence Proxy Sources</a>.</p>
<p><b>Default:</b> </p><pre class="fragment">0 (disabled)
</pre><p><b>Example:</b> </p><div class="fragment"><div class="line">&lt;topic pattern=<span class="stringliteral">&quot;EventStream&quot;</span> type=<span class="stringliteral">&quot;direct&quot;</span>&gt;</div><div class="line">  &lt;ume-attributes&gt;</div><div class="line">    &lt;option type=<span class="stringliteral">&quot;store&quot;</span> name=<span class="stringliteral">&quot;receiver-state-lifetime&quot;</span> value=<span class="stringliteral">&quot;0&quot;</span>/&gt;</div><div class="line">    ...</div><div class="line">  &lt;/ume-attributes&gt;</div><div class="line">&lt;/topic&gt;</div></div><!-- fragment --><p><br />
 </p>
<h3><a class="anchor" id="umecfgsourcecheckinterval"></a>
Topic Option "source-check-interval"&nbsp;&nbsp;<small><a href="#umecfgsourcecheckinterval">&lt;-</a></small></h3>
<p>Specifies the period in milliseconds a Store will check for activity of sources and receivers.</p>
<p><b>Default:</b> </p><pre class="fragment">750 (milliseconds)
</pre><p><b>Example:</b> </p><div class="fragment"><div class="line">&lt;topic pattern=<span class="stringliteral">&quot;EventStream&quot;</span> type=<span class="stringliteral">&quot;direct&quot;</span>&gt;</div><div class="line">  &lt;ume-attributes&gt;</div><div class="line">    &lt;option type=<span class="stringliteral">&quot;store&quot;</span> name=<span class="stringliteral">&quot;source-check-interval&quot;</span> value=<span class="stringliteral">&quot;900&quot;</span>/&gt;</div><div class="line">    ...</div><div class="line">  &lt;/ume-attributes&gt;</div><div class="line">&lt;/topic&gt;</div></div><!-- fragment --><p><br />
 </p>
<h3><a class="anchor" id="umecfgkeepaliveinterval"></a>
Topic Option "keepalive-interval"&nbsp;&nbsp;<small><a href="#umecfgkeepaliveinterval">&lt;-</a></small></h3>
<p>Specifies the period in milliseconds a Store will generate keepalive traffic to sources and receivers if there has been no traffic required in the normal course of operation.</p>
<p>Note that <a class="el" href="index.html#umecfgsourceactivitytimeout">Topic Option "source-activity-timeout"</a> value should be set to at least double the <a class="el" href="index.html#umecfgkeepaliveinterval">Topic Option "keepalive-interval"</a> value.</p>
<p><b>Default:</b> </p><pre class="fragment">3000 (3 seconds)
</pre><p><b>Example:</b> </p><div class="fragment"><div class="line">&lt;topic pattern=<span class="stringliteral">&quot;EventStream&quot;</span> type=<span class="stringliteral">&quot;direct&quot;</span>&gt;</div><div class="line">  &lt;ume-attributes&gt;</div><div class="line">    &lt;option type=<span class="stringliteral">&quot;store&quot;</span> name=<span class="stringliteral">&quot;keepalive-interval&quot;</span> value=<span class="stringliteral">&quot;5000&quot;</span>/&gt;</div><div class="line">    ...</div><div class="line">  &lt;/ume-attributes&gt;</div><div class="line">&lt;/topic&gt;</div></div><!-- fragment --><p><br />
 </p>
<h3><a class="anchor" id="umecfgreceivernewregistrationrollback"></a>
Topic Option "receiver-new-registration-rollback"&nbsp;&nbsp;<small><a href="#umecfgreceivernewregistrationrollback">&lt;-</a></small></h3>
<p>Specifies an upper limit to the number of messages a registering persistent receiver should recover during "late join".</p>
<dl class="section attention"><dt>Attention</dt><dd>For most use cases, this option should be left at its default, which effectively disables a limit.</dd></dl>
<p>The receiver can limit the number of messages that it can request for recovery using the LBM configuration option <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grplatejoin.html#retransmitrequestmaximumreceiver">retransmit_request_maximum (receiver)</a>. If the request exceeds the limit configured in the Store's topic option receiver-new-registration-rollback, the receiver's recovery will be limited to the latter number of messages.</p>
<p>Note that this limit interferes with the persistence guarantee of delivery. If a limit of 1,000 is configured, and a receiver exits and restarts after the source has sent 4,000 more messages, the receiver might not be able to recover all 4,000 messages. It might be limited to the most-recent 1,000 messages.</p>
<p>Also, note that a persistent receiver can set up a initial sequence number callback using the LBM configuration option <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umerecoverysequencenumberinfofunctionreceiver">ume_recovery_sequence_number_info_function (receiver)</a>. This allows the application to specify a desired starting sequence number. If the application is written to use this approach, Store topic option "receiver-new-registration-rollback" and LBM configuration option retransmit_request_maximum should be at their default values.</p>
<p>If used, the value for receiver-new-registration-rollback must be between 1 and 2147483647 (maximum signed 32-bit integer). The default value of 2147483647 effectively disables the limit.</p>
<p><b>Default:</b> </p><pre class="fragment">2147483647
</pre><p><b>Example:</b> </p><div class="fragment"><div class="line">&lt;topic pattern=<span class="stringliteral">&quot;EventStream&quot;</span> type=<span class="stringliteral">&quot;direct&quot;</span>&gt;</div><div class="line">  &lt;ume-attributes&gt;</div><div class="line">    &lt;option type=<span class="stringliteral">&quot;store&quot;</span> name=<span class="stringliteral">&quot;receiver-new-registration-rollback&quot;</span> value=<span class="stringliteral">&quot;2147483647&quot;</span>/&gt;</div><div class="line">    ...</div><div class="line">  &lt;/ume-attributes&gt;</div><div class="line">&lt;/topic&gt;</div></div><!-- fragment --><p><br />
 </p>
<h3><a class="anchor" id="umecfgproxyelectioninterval"></a>
Topic Option "proxy-election-interval"&nbsp;&nbsp;<small><a href="#umecfgproxyelectioninterval">&lt;-</a></small></h3>
<p>Specifies the interval, in milliseconds, used when electing a proxy source. When a source, which requested that a proxy source be provided for it, has been detected as no longer active, each Store eligible to provide a proxy source for it waits for an amount of time which is randomized in the range [0.5*proxy-election-interval .. 1.5*proxy-election-interval]. If no other Store has been elected to serve as the proxy source, the Store declares itself as the proxy source.</p>
<p><b>Default:</b> </p><pre class="fragment">60,000 (60 seconds)
</pre><p><b>Example:</b> </p><div class="fragment"><div class="line">&lt;topic pattern=<span class="stringliteral">&quot;EventStream&quot;</span> type=<span class="stringliteral">&quot;direct&quot;</span>&gt;</div><div class="line">  &lt;ume-attributes&gt;</div><div class="line">    &lt;option type=<span class="stringliteral">&quot;store&quot;</span> name=<span class="stringliteral">&quot;proxy-election-interval&quot;</span> value=<span class="stringliteral">&quot;80000&quot;</span>/&gt;</div><div class="line">    ...</div><div class="line">  &lt;/ume-attributes&gt;</div><div class="line">&lt;/topic&gt;</div></div><!-- fragment --><p><br />
 </p>
<h3><a class="anchor" id="umecfgstabilityackinterval"></a>
Topic Option "stability-ack-interval"&nbsp;&nbsp;<small><a href="#umecfgstabilityackinterval">&lt;-</a></small></h3>
<p>Specifies the maximum amount of time in milliseconds that stability acknowledgments will be batched before being sent to a source. This batching is only enabled if <a class="el" href="index.html#umecfgstabilityackminimumnumber">Topic Option "stability-ack-minimum-number"</a> is set to greater than 1.</p>
<p>Batching stability ACKs can increase throughput of Stores (especially memory Stores) significantly, but introduces a delay between when a message is actually stable in the Store and when the source is notified of message stability.</p>
<p>At high message rates, the stability ACKs will normally be triggered by the received messages exceeding <a class="el" href="index.html#umecfgstabilityackminimumnumber">stability-ack-minimum-number</a>. However, if the source publishing rate drops significantly, the stability-ack-interval ensures an upper bound to the time required for stability ACKs.</p>
<p><b>Default:</b> </p><pre class="fragment">200 (200 milliseconds)
</pre><p><b>Example:</b> </p><div class="fragment"><div class="line">&lt;topic pattern=<span class="stringliteral">&quot;EventStream&quot;</span> type=<span class="stringliteral">&quot;direct&quot;</span>&gt;</div><div class="line">  &lt;ume-attributes&gt;</div><div class="line">    &lt;option type=<span class="stringliteral">&quot;store&quot;</span> name=<span class="stringliteral">&quot;stability-ack-interval&quot;</span> value=<span class="stringliteral">&quot;50&quot;</span>/&gt;</div><div class="line">    ...</div><div class="line">  &lt;/ume-attributes&gt;</div><div class="line">&lt;/topic&gt;</div></div><!-- fragment --><p><br />
 </p>
<h3><a class="anchor" id="umecfgstabilityackminimumnumber"></a>
Topic Option "stability-ack-minimum-number"&nbsp;&nbsp;<small><a href="#umecfgstabilityackminimumnumber">&lt;-</a></small></h3>
<p>Specifies the minimum number of message fragment stability acknowledgments that must accumulate before a stability ACK is sent to a source. With the default value of 1, stability ACKs are sent immediately as soon as messages are stable. Increasing this value causes stability ACKs to be batched, which can increase throughput of Stores (especially memory Stores) significantly, but introduces a delay between when a message is actually stable in the Store and when the source is notified of message stability.</p>
<p>If using a stability ACK-based flight size on a persistent source in combination with this option, it is advisable to make sure stability-ack-minimum-number is set less than the source's flight size. Otherwise, stability ACKs will only be sent upon expiration of the <a class="el" href="index.html#umecfgstabilityackinterval">stability-ack-interval</a> timer, resulting in bursty stop-and-go sending.</p>
<p>For RPP, see <a class="el" href="index.html#rppconfigurationspecifics">RPP Configuration Specifics</a> for interactions between this and other configuration options. See <a class="el" href="index.html#receiverpacedpersistenceoperations">RPP: Receiver-Paced Persistence</a> for general information on RPP.</p>
<p><b>Default:</b> </p><pre class="fragment">1 (fragment; no batching)
</pre><p><b>Example:</b> </p><div class="fragment"><div class="line">&lt;topic pattern=<span class="stringliteral">&quot;EventStream&quot;</span> type=<span class="stringliteral">&quot;direct&quot;</span>&gt;</div><div class="line">  &lt;ume-attributes&gt;</div><div class="line">    &lt;option type=<span class="stringliteral">&quot;store&quot;</span> name=<span class="stringliteral">&quot;stability-ack-minimum-number&quot;</span> value=<span class="stringliteral">&quot;1&quot;</span>/&gt;</div><div class="line">    ...</div><div class="line">  &lt;/ume-attributes&gt;</div><div class="line">&lt;/topic&gt;</div></div><!-- fragment --><p><br />
 </p>
<h3><a class="anchor" id="umecfgrepositoryallowreceiverpacedpersistence"></a>
Topic Option "repository-allow-receiver-paced-persistence"&nbsp;&nbsp;<small><a href="#umecfgrepositoryallowreceiverpacedpersistence">&lt;-</a></small></h3>
<p>Specifies if the repository allows receiver-paced persistence (RPP). If allowed (value 1), the source may request RPP with <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umereceiverpacedpersistencesource">ume_receiver_paced_persistence (source)</a>.</p>
<p>Note that the Store cannot be directly configured to enable RPP; the source <em>must</em> be configured to request it. Otherwise, the repository defaults to SPP. This option only <em>allows</em> the source to request it.</p>
<p>See <a class="el" href="index.html#receiverpacedpersistenceoperations">RPP: Receiver-Paced Persistence</a> for general information on RPP.</p>
<p><b>Default:</b> </p><pre class="fragment">0 (Store does not allow the source to specify RPP)
</pre><p><b>Example:</b> </p><div class="fragment"><div class="line">&lt;topic pattern=<span class="stringliteral">&quot;EventStream&quot;</span> type=<span class="stringliteral">&quot;direct&quot;</span>&gt;</div><div class="line">  &lt;ume-attributes&gt;</div><div class="line">    &lt;option type=<span class="stringliteral">&quot;store&quot;</span> name=<span class="stringliteral">&quot;repository-allow-receiver-paced-persistence&quot;</span> value=<span class="stringliteral">&quot;1&quot;</span>/&gt;</div><div class="line">    ...</div><div class="line">  &lt;/ume-attributes&gt;</div><div class="line">&lt;/topic&gt;</div></div><!-- fragment --><p><br />
 </p>
<h3><a class="anchor" id="umecfgrepositoryallowackonreception"></a>
Topic Option "repository-allow-ack-on-reception"&nbsp;&nbsp;<small><a href="#umecfgrepositoryallowackonreception">&lt;-</a></small></h3>
<p>For RPP, specifies if the repository allows "ack on reception" behavior. If allowed (value 1), the source may request "ack on reception" with <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umerepositoryackonreceptionsource">ume_repository_ack_on_reception (source)</a>. See <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umerepositoryackonreceptionsource">ume_repository_ack_on_reception (source)</a> for more information about "ack on reception" behavior.</p>
<p>Note that the Store cannot be directly configured to enable "ack on reception"; the source <em>must</em> be configured to request it. Otherwise, the repository defaults to acknowledging when messages are written to disk. This option only <em>allows</em> the source to request it.</p>
<p>Also note that for SPP Stores, this option is ignored.</p>
<p>For RPP, see <a class="el" href="index.html#rppconfigurationspecifics">RPP Configuration Specifics</a> for interactions between this and other configuration options. See <a class="el" href="index.html#receiverpacedpersistenceoperations">RPP: Receiver-Paced Persistence</a> for general information on RPP.</p>
<p><b>Default:</b> </p><pre class="fragment">0 (Store does not allow the source to specify ack on reception behavior)
</pre><p><b>Example:</b> </p><div class="fragment"><div class="line">&lt;topic pattern=<span class="stringliteral">&quot;EventStream&quot;</span> type=<span class="stringliteral">&quot;direct&quot;</span>&gt;</div><div class="line">  &lt;ume-attributes&gt;</div><div class="line">    &lt;option type=<span class="stringliteral">&quot;store&quot;</span> name=<span class="stringliteral">&quot;repository-allow-ack-on-reception&quot;</span> value=<span class="stringliteral">&quot;1&quot;</span>/&gt;</div><div class="line">    ...</div><div class="line">  &lt;/ume-attributes&gt;</div><div class="line">&lt;/topic&gt;</div></div><!-- fragment --><p><br />
 </p>
<h3><a class="anchor" id="umecfgrepositorydiskwritedelay"></a>
Topic Option "repository-disk-write-delay"&nbsp;&nbsp;<small><a href="#umecfgrepositorydiskwritedelay">&lt;-</a></small></h3>
<p>Specifies a delay in milliseconds after a message is received before the message is written to disk. This option is for use with RPP, and is intended to allow all required receivers to acknowledge consumption of messages within the write delay time. This deletes the messages from the memory cache before they are written to disk. If all required receivers acknowledge consumption within the delay time, the Store never needs to write messages to disk.</p>
<p>This option only applies for <a class="el" href="index.html#umecfgrepositorytype">repository-type</a> <b>"disk"</b>.</p>
<p>For RPP, the source LBM configuration may override this option with <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umewritedelaysource">ume_write_delay (source)</a>. In that case, the Store's repository-disk-write-delay value is used as the maximum allowed value for ume_write_delay. If the source exceeds this value, its registration is rejected.</p>
<p>For RPP, see <a class="el" href="index.html#rppconfigurationspecifics">RPP Configuration Specifics</a> for interactions between this and other configuration options. See <a class="el" href="index.html#receiverpacedpersistenceoperations">RPP: Receiver-Paced Persistence</a> for general information on RPP.</p>
<p><b>Default:</b> </p><pre class="fragment">0 (milliseconds, no delay)
</pre><p><b>Example:</b> </p><div class="fragment"><div class="line">&lt;topic pattern=<span class="stringliteral">&quot;EventStream&quot;</span> type=<span class="stringliteral">&quot;direct&quot;</span>&gt;</div><div class="line">  &lt;ume-attributes&gt;</div><div class="line">    &lt;option type=<span class="stringliteral">&quot;store&quot;</span> name=<span class="stringliteral">&quot;repository-disk-write-delay&quot;</span> value=<span class="stringliteral">&quot;5000&quot;</span>/&gt;</div><div class="line">    ...</div><div class="line">  &lt;/ume-attributes&gt;</div><div class="line">&lt;/topic&gt;</div></div><!-- fragment --><p><br />
 </p>
<h3><a class="anchor" id="umecfgsourceflightsizebytesmaximum"></a>
Topic Option "source-flight-size-bytes-maximum"&nbsp;&nbsp;<small><a href="#umecfgsourceflightsizebytesmaximum">&lt;-</a></small></h3>
<p>For RPP, specifies the maximum number of in-flight payload bytes that the source is allowed to configure with <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umeflightsizebytessource">ume_flight_size_bytes (source)</a>. If the source exceeds this value, its registration is rejected.</p>
<p>See <a class="el" href="index.html#persistenceflightsize">Persistence Flight Size</a> for more information.</p>
<p><b>Default:</b> </p><pre class="fragment">4194304 (4 MB)
</pre><p><b>Example:</b> </p><div class="fragment"><div class="line">&lt;topic pattern=<span class="stringliteral">&quot;EventStream&quot;</span> type=<span class="stringliteral">&quot;direct&quot;</span>&gt;</div><div class="line">  &lt;ume-attributes&gt;</div><div class="line">    &lt;option type=<span class="stringliteral">&quot;store&quot;</span> name=<span class="stringliteral">&quot;source-flight-size-bytes-maximum&quot;</span> value=<span class="stringliteral">&quot;8388608&quot;</span>/&gt;</div><div class="line">    ...</div><div class="line">  &lt;/ume-attributes&gt;</div><div class="line">&lt;/topic&gt;</div></div><!-- fragment --><p><br />
 </p><hr/>
<h1><a class="anchor" id="specialconfigurationtopics"></a>
Special Configuration Topics&nbsp;&nbsp;<small><a href="#specialconfigurationtopics">&lt;-</a></small></h1>
<p><br />
 </p>
<h2><a class="anchor" id="storelossrepair"></a>
Store Loss Repair&nbsp;&nbsp;<small><a href="#storelossrepair">&lt;-</a></small></h2>
<p>The persistent Store uses a normal UM receiver to get messages from the source. The Store is subject to the same potential <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/design.tag:../../Design/" href="../../Design/packetloss.html">Packet Loss</a> scenarios as an application subscriber, and uses the same loss repair techniques as a subscriber.</p>
<p>Informatica recommends enabling <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/design.tag:../../Design/" href="../../Design/umfeatures.html#offtransportrecoveryotr">Off-Transport Recovery (OTR)</a> on the Store and application subscribers.</p>
<p><br />
 </p>
<h2><a class="anchor" id="persistencebuffersizes"></a>
Persistence Buffer Sizes&nbsp;&nbsp;<small><a href="#persistencebuffersizes">&lt;-</a></small></h2>
<p>There are two memory buffers that need to be properly sized to get the desired level of performance and reliability for persistence: </p><ul>
<li>
Source retention buffer, also known as the late join buffer. </li>
<li>
Store message cache. </li>
</ul>
<p>This analysis assumes that you are using disk-based Stores.</p>
<p>The sizing depends on how sensitive your publishing application is to being slowed down in the event of packet loss. The Stores are designed to write messages to disk in sequence-number order. So in the event of packet loss, newly received messages must be buffered in the Store's message cache while the Store waits for retransmission of the lost messages. If the source's message rate is high and the time required to repair the packet loss is significant, the Store's cache must be configured to be large.</p>
<p>Note that this affects the flight size configuration also. For SPP Stores, message stability is acknowledged to the source after the messages is successfully written to disk. But for messages being kept in the Store's message cache waiting for lost packet retransmission, stability acknowledgement is delayed. All messages sent during this time are said to be "in flight". To avoid the publisher being blocked on flight size, the flight size limit might need to be made large. It is not unusual for our performance-sensitive users to configure the flight size limit to be in the tens of thousands.</p>
<p>Finally, the source's retention buffer (late join buffer) should be sized the same as the flight size limit.</p>
<p><br />
 </p>
<h2><a class="anchor" id="calculatingoptionsforspp"></a>
Calculating Options for SPP&nbsp;&nbsp;<small><a href="#calculatingoptionsforspp">&lt;-</a></small></h2>
<p>Determine the following for your application: </p><ul>
<li>
avg_msg_size - The source's average size of application messages, in bytes. </li>
<li>
avg_msg_rate - The source's average message send rate, in datagrams per second. </li>
</ul>
<p>The following formulas calculate minimum recommended values of some configuration options: </p><pre class="fragment">ume_flight_size = 3 * (ume_ack_batching_interval/1,000) * avg_msg_rate
ume_flight_size_bytes = ume_flight_size * avg_msg_size
ume_repository_size_threshold = ume_flight_size_bytes
ume_repository_size_limit = 1.2 * ume_repository_size_threshold
</pre><p>If <a class="el" href="index.html#umecfgstabilityackminimumnumber">Topic Option "stability-ack-minimum-number"</a> is greater than 1, the value of <a class="el" href="index.html#umecfgstabilityackinterval">Topic Option "stability-ack-interval"</a> needs to be added in as follows: </p><pre class="fragment">ume_flight_size = 3 * ((ume_ack_batching_interval + stability-ack-interval)/1,000)
                  * avg_msg_rate
</pre><p> The other parameters must then be recalculated.</p>
<p>For example: </p><pre class="fragment">avg_msg_size = 1024 bytes            (hypothetical use case)
avg_msg_rate = 10,000 datagrams/sec  (hypothetical use case)

ume_flight_size = 3 * (100/1000) * 10000 = 3000
ume_flight_size_bytes = 3000 * 1024 = 3,072,000
ume_repository_size_threshold = 3,072,000
ume_repository_size_limit = 1.2 * 3072000 = 3,686,400
</pre><p>Note that application deviations (e.g. bursts) from the averages can result in unexpected disk writes and blocking imposed on the source. To reduce the chances of blocking, the values for avg_msg_size and/or avg_msg_rate can be increased (with the subsequent configuration values recalculated).</p>
<p><br />
 </p>
<h2><a class="anchor" id="rppconfigurationspecifics"></a>
RPP Configuration Specifics&nbsp;&nbsp;<small><a href="#rppconfigurationspecifics">&lt;-</a></small></h2>
<p>With RPP, there is a non-obvious interaction between the settings for: </p><ul>
<li>
Store configuration option <a class="el" href="index.html#umecfgrepositorysizelimit">repository-size-limit</a>, </li>
<li>
Store configuration option <a class="el" href="index.html#umecfgrepositorysizethreshold">repository-size-threshold</a> </li>
<li>
Store configuration option <a class="el" href="index.html#umecfgrepositorydiskwritedelay">repository-disk-write-delay</a>, </li>
<li>
Source LBM configuration option <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umerepositoryackonreceptionsource">ume_repository_ack_on_reception (source)</a>, </li>
<li>
Source LBM configuration options <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umeflightsizebytessource">ume_flight_size_bytes (source)</a> and <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umeflightsizesource">ume_flight_size (source)</a>. </li>
<li>
Receiver LBM configuration option <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umeackbatchingintervalcontext">ume_ack_batching_interval (context)</a>. </li>
<li>
Store LBM configuration options <a class="el" href="index.html#umecfgstabilityackinterval">stability-ack-interval</a> and <a class="el" href="index.html#umecfgstabilityackminimumnumber">stability-ack-minimum-number</a>. </li>
</ul>
<p>The source and Store can enter a state where the sending rate is severely limited by flight size, even though the Store is relatively idle.</p>
<p>To avoid this issue, you need to analyze your usage patterns and set your configuration options appropriately. Determine the following for your application: </p><ul>
<li>
avg_msg_size - The source's average size of application messages, in bytes. </li>
<li>
avg_msg_rate - The source's average message send rate, in datagrams per second. </li>
</ul>
<p>Next you need to decide how long you want to set <a class="el" href="index.html#umecfgrepositorydiskwritedelay">repository-disk-write-delay</a>. The idea is that you want to avoid writing to disk during normal operation, so you should set it long enough that all normally-operating receivers have a chance to acknowledge consumption of the messages during the write delay time. Remember that when a receiver gets a message, it might delay sending consumption for <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpultramessagingpersistence.html#umeackbatchingintervalcontext">ume_ack_batching_interval (context)</a> milliseconds (defaults to 100).</p>
<p>You also need to take into account heavy bursts of traffic, where receivers might store significant numbers of messages in their socket buffers, and it can take time for the receivers to work their way through all of them.</p>
<p>But you don't want to make the repository-disk-write-delay larger than necessary because it can lead to very high memory usage in the Store. We generally see repository-disk-write-delay being set to values as low as 1000 (1 sec) and as high as 5000 (5 sec).</p>
<p>The following formulas calculate minimum recommended values of some configuration options: </p><pre class="fragment">ume_flight_size = 3 * (ume_ack_batching_interval/1,000) * avg_msg_rate
ume_flight_size_bytes = ume_flight_size * avg_msg_size
ume_repository_size_threshold =
        (avg_msg_size * avg_msg_rate * (repository-disk-write-delay/1,000))
        + ume_flight_size_bytes
ume_repository_size_limit = 1.2 * ume_repository_size_threshold
</pre><p> If <a class="el" href="index.html#umecfgstabilityackminimumnumber">Topic Option "stability-ack-minimum-number"</a> is greater than 1, the value of <a class="el" href="index.html#umecfgstabilityackinterval">Topic Option "stability-ack-interval"</a> needs to be added in as follows: </p><pre class="fragment">ume_flight_size = 3 * ((ume_ack_batching_interval + stability-ack-interval)/1,000)
                  * avg_msg_rate
</pre><p> The other parameters must then be recalculated.</p>
<p>For example: </p><pre class="fragment">avg_msg_size = 1024 bytes            (hypothetical use case)
avg_msg_rate = 10,000 datagrams/sec  (hypothetical use case)
repository-disk-write-delay = 2500  (2.5 sec, chosen by user)

ume_flight_size = 3 * (100/1000) * 10000 = 3000
ume_flight_size_bytes = 3000 * 1024 = 3,072,000
ume_repository_size_threshold = (1024 * 10000 * (2500/1000)) + 3072000 = 28,672,000
ume_repository_size_limit = 1.2 * 28672000 = 34,406,400
</pre><p>Note that application deviations (e.g. bursts) from the averages can result in unexpected disk writes and blocking imposed on the source. To reduce the chances of blocking, the values for avg_msg_size and/or avg_msg_rate can be increased (with the subsequent configuration values recalculated).</p>
<p><br />
 </p><hr/>
<h1><a class="anchor" id="storedaemonstatistics"></a>
Store Binary Daemon Statistics&nbsp;&nbsp;<small><a href="#storedaemonstatistics">&lt;-</a></small></h1>
<dl class="section note"><dt>Note</dt><dd>The C-style binary structure format of daemon statistics is DEPRECATED and may be removed in a future release. Informatica requests that users migrate to protobuf-based format. See <a class="el" href="index.html#storemonitoring">Store Monitoring</a>.</dd></dl>
<p>See <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/example.tag:../../example/" href="../../example/index.html#exampleprotocolfiles">Example Protocol Files</a> for the protocol buffer definition files.</p>
<p><br />
 </p>
<h2><a class="anchor" id="storedaemonstatisticsstructures"></a>
Store Daemon Statistics Structures&nbsp;&nbsp;<small><a href="#storedaemonstatisticsstructures">&lt;-</a></small></h2>
<dl class="section note"><dt>Note</dt><dd>the C-style binary structure format of daemon statistics is DEPRECATED and may be removed in a future release. Informatica requests that users migrate to protobuf-based format. See <a class="el" href="index.html#storemonitoring">Store Monitoring</a>.</dd></dl>
<p>The different message types are:</p>
<ul>
<li>
<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/umedmonmsgs_8h.html#aa3a3d4c63922003ed750ed38027bcc82">LBM_UMESTORE_DMON_MPG_SMART_HEAP_STATS</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/umedmonmsgs_8h.html#a102df121698e67407d2aeffc0147d91e">LBM_UMESTORE_DMON_MPG_STORE_STATS</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/umedmonmsgs_8h.html#aa4269805d37ad1586f340a0f4486e0e9">LBM_UMESTORE_DMON_MPG_REPO_STATS</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/umedmonmsgs_8h.html#a41acc94a55b5c03bf2580c876d7f8ad4">LBM_UMESTORE_DMON_MPG_DISK_STATS</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/umedmonmsgs_8h.html#aa57c0aadc4536533388200812a51584e">LBM_UMESTORE_DMON_MPG_RCV_STATS</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/umedmonmsgs_8h.html#aed8460b69470931e1d8ee4347110a309">LBM_UMESTORE_DMON_MPG_STORE_CONFIG</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/umedmonmsgs_8h.html#aab14bc84ccbe0986c41e5f3f4b5f2b34">LBM_UMESTORE_DMON_MPG_STORE_PATTERN_CONFIG</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/umedmonmsgs_8h.html#a8e29917df3f47cbb8935cb1ed683e876">LBM_UMESTORE_DMON_MPG_STORE_TOPIC_CONFIG</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/umedmonmsgs_8h.html#a76e34ed0b81c5e1141a36e358f3803a4">LBM_UMESTORE_DMON_MPG_REPO_CONFIG</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/umedmonmsgs_8h.html#a37abe47b7a806332d6dec510f8370386">LBM_UMESTORE_DMON_MPG_RCV_CONFIG</a> </li>
</ul>
<p>Each one has a specific structure associated with it, as detailed in <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/umedmonmsgs_8h.html">umedmonmsgs.h</a>.</p>
<p>Note that message types ending with "_CONFIG" are in the config category, while message types ending with "_STATS" are in the stats category. See <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/design.tag:../../Design/" href="../../Design/umfeatures.html#daemonstatisticsstructures">Daemon Statistics Structures</a> for information on how the two categories are handled differently.</p>
<p><br />
 </p>
<h3><a class="anchor" id="storedaemonstatisticsbyteswapping"></a>
Store Daemon Statistics Byte Swapping&nbsp;&nbsp;<small><a href="#storedaemonstatisticsbyteswapping">&lt;-</a></small></h3>
<dl class="section note"><dt>Note</dt><dd>the C-style binary structure format of daemon statistics is DEPRECATED and may be removed in a future release. Informatica requests that users migrate to protobuf-based format. See <a class="el" href="index.html#storemonitoring">Store Monitoring</a>.</dd></dl>
<p>A monitoring application receiving these messages must detect if there is an endian mismatch (see <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/design.tag:../../Design/" href="../../Design/umfeatures.html#daemonstatisticsbinarydata">Daemon Statistics Binary Data</a>). The header structure <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/umedmonmsgs_8h.html#ac8fa75ab624041897fe74bdde0a98b16">umestore_dmon_msg_hdr_t</a> contains a 16-bit field named <code>magic</code> which is set equal to <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/umedmonmsgs_8h.html#a1803f128fe2a66d57e078956fdcc07ca">LBM_UMESTORE_DMON_MAGIC</a>. The receiving application should compare it to <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/umedmonmsgs_8h.html#a1803f128fe2a66d57e078956fdcc07ca">LBM_UMESTORE_DMON_MAGIC</a> and <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/umedmonmsgs_8h.html#a24d18e9ceeaed40dd3e282418dbdc42c">LBM_UMESTORE_DMON_ANTIMAGIC</a>. Anything else would represent a serious problem.</p>
<p>If the receiving app sees: </p><div class="fragment"><div class="line">magic == <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/umedmonmsgs_8h.html#a1803f128fe2a66d57e078956fdcc07ca">LBM_UMESTORE_DMON_MAGIC</a></div></div><!-- fragment --><p> then it can simply access the binary fields directly. However, if it sees: </p><div class="fragment"><div class="line">magic == <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/umedmonmsgs_8h.html#a24d18e9ceeaed40dd3e282418dbdc42c">LBM_UMESTORE_DMON_ANTIMAGIC</a></div></div><!-- fragment --><p> then <em>most</em> (but not all) binary fields need to be byte-swapped. See <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/example.tag:../../example/" href="../../example/index.html#exampleumedmon_c">Example umedmon.c</a> for an example, paying special attention to the macros <code>COND_SWAPxx</code> (which <em>conditionally</em> swaps based on the magic test) and the functions <code>byte_swapXX()</code> (which performs the byte swapping).</p>
<p>However, there are some binary fields which must never be swapped, regardless of the endian. This is indicated in the documentation. For example, <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structumestore__store__dmon__config__msg__t__stct.html#af0145c44bd69bcaf83b9a4088151960c">umestore_store_dmon_config_msg_t_stct::store_iface</a> says "NOTE: This field should NOT be byte-swapped." Here's how that field might be accessed: </p><div class="fragment"><div class="line">in.s_addr = msg-&gt;store_iface;</div><div class="line">printf(<span class="stringliteral">&quot;Store IP address / port: %s / %d\n&quot;</span>,</div><div class="line">    inet_ntoa(in), COND_SWAP16(msg_swap, msg-&gt;store_port));</div></div><!-- fragment --><p> As you can see, <code>store_iface</code> is not byte swapped, but <code>store_port</code> (conditionally) is swapped.</p>
<p><br />
 </p>
<h3><a class="anchor" id="storedaemonstatisticsstructuresstringbuffers"></a>
Store Daemon Statistics String Buffers&nbsp;&nbsp;<small><a href="#storedaemonstatisticsstructuresstringbuffers">&lt;-</a></small></h3>
<dl class="section note"><dt>Note</dt><dd>the C-style binary structure format of daemon statistics is DEPRECATED and may be removed in a future release. Informatica requests that users migrate to protobuf-based format. See <a class="el" href="index.html#storemonitoring">Store Monitoring</a>.</dd></dl>
<p>There are some messages which contain string buffers at the ends of the messages. Strings in these data structures are always null-terminated. Be aware that these messages are not sent as fixed-length equal to the size of the data structure, but rather are sent with only the bytes required by the string (including the final null). For example, the structure <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/umedmonmsgs_8h.html#a132a874ae972e1f393b1a973905ac923">umestore_store_pattern_dmon_config_msg_t</a> contains the field <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structumestore__store__pattern__dmon__config__msg__t__stct.html#ad90cc4d946617553bbc8e7e7f1741138">umestore_store_pattern_dmon_config_msg_t_stct::pattern_buffer</a> which is <code>char</code> array of size <code>LBM_UMESTORE_DMON_TOPIC_PATTERN_STRLEN</code>. If <code>pattern_buffer</code> is set to ".*", then only 3 bytes (including the null string terminator) are sent for that field.</p>
<p>(Contrast this with <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/gateway.tag:../../Gateway/" href="../../Gateway/umrouterdaemonstatistics.html#umrouterdaemonstatisticsstructuresstringbuffers">DRO Daemon Statistics String Buffers</a>.)</p>
<p>This becomes more complicated when there are multiple strings in one message. For example, consider <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/umedmonmsgs_8h.html#a6791bb4e61ba08a319647d4fd5ed8c5d">umestore_store_dmon_config_msg_t</a>. This message contains three strings: Store name, cache directory name, and state directory name. But a single <code>char</code> array is declared: </p><div class="fragment"><div class="line"><span class="keywordtype">char</span> string_buffer[LBM_UMESTORE_DMON_STORE_NAME_STRLEN + (2 * LBM_UMESTORE_DMON_FILENAME_MAX_STRLEN)</div></div><!-- fragment --><p> The three strings are packed into that buffer, only taking up as much space as is necessary. I.e. if the three strings are "a", "b", and "c", only 6 bytes of the buffer will be consumed (each string has a null).</p>
<p>To make it easier for the code to find the three strings, the structure has three offset variables: <code>store_name_offset</code>, <code>disk_cache_dir_offset</code>, and <code>disk_state_dir_offset</code>. These are byte offsets from the start of the entire structure. So, to access the Store name, the monitoring application might use: </p><div class="fragment"><div class="line"><a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structumestore__store__dmon__config__msg__t__stct.html">umestore_store_dmon_config_msg_t</a> *store_config_msg = ... <span class="comment">/* ptr to incoming msg */</span></div><div class="line"><span class="keywordtype">char</span> *state_dir_name = (<span class="keywordtype">char</span> *)store_config_msg +</div><div class="line">                       store_config_msg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structumestore__store__dmon__config__msg__t__stct.html#af8ac96ecf72010fbbe73845c53d1c09e">store_name_offset</a>;</div></div><!-- fragment --><p> (The practice of using offsets from the start of the structure allows for greater flexibility in ensuring inter-version compatibility.)</p>
<p><br />
 </p>
<h3><a class="anchor" id="storedaemonstatisticsstructuresretxcounts"></a>
Store Daemon Statistics Retx Counts&nbsp;&nbsp;<small><a href="#storedaemonstatisticsstructuresretxcounts">&lt;-</a></small></h3>
<dl class="section note"><dt>Note</dt><dd>the C-style binary structure format of daemon statistics is DEPRECATED and may be removed in a future release. Informatica requests that users migrate to protobuf-based format. See <a class="el" href="index.html#storemonitoring">Store Monitoring</a>.</dd></dl>
<p>There is a set of fields in <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/umedmonmsgs_8h.html#aeeb55ed0b759e6316cdedc3c990dfe26">umestore_store_dmon_stat_msg_t</a> which give statistics on recovery operations initiated by receivers:</p>
<ul>
<li>
<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structumestore__store__dmon__stat__msg__t__stct.html#aa5af5aa74379f3784c59503a52309dfd">umestore_store_dmon_stat_msg_t_stct::ume_retx_req_rcv_count</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structumestore__store__dmon__stat__msg__t__stct.html#a9fb94f3660f9055189b1466fbe26d5b1">umestore_store_dmon_stat_msg_t_stct::ume_retx_req_serviced_count</a> </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structumestore__store__dmon__stat__msg__t__stct.html#a48daa393596d1ede504a5c378220f468">umestore_store_dmon_stat_msg_t_stct::ume_retx_req_drop_count</a> </li>
</ul>
<p>The web monitor's <a class="el" href="index.html#storewebmonitorstorepage">Store Web Monitor Store Page</a> has a manual function labeled <a class="el" href="index.html#resetratestats">Reset Rate Stats</a> which clears those <code>"ume_retx_..._count"</code> fields. This is a useful function for users who use the web monitor as their primary monitoring tool, but for users who depend on the published Daemon Statistics, it can be disruptive for the counts to be cleared on-demand.</p>
<p>The field <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/structumestore__store__dmon__stat__msg__t__stct.html#a8413d51c9aa089626fb135e0a64dc60c">umestore_store_dmon_stat_msg_t_stct::ume_retx_stat_interval</a> contains the seconds since the last <a class="el" href="index.html#resetratestats">Reset Rate Stats</a> operation. If the user has not used <a class="el" href="index.html#resetratestats">Reset Rate Stats</a>, then <code>ume_retx_stat_interval</code> contains the seconds since the Store's startup.</p>
<p><br />
 </p>
<h2><a class="anchor" id="storedaemonstatisticsconfiguration"></a>
Store Daemon Statistics Configuration&nbsp;&nbsp;<small><a href="#storedaemonstatisticsconfiguration">&lt;-</a></small></h2>
<dl class="section note"><dt>Note</dt><dd>the C-style binary structure format of daemon statistics is DEPRECATED and may be removed in a future release. Informatica requests that users migrate to protobuf-based format. See <a class="el" href="index.html#storemonitoring">Store Monitoring</a>.</dd></dl>
<p>There are two places in the Store configuration file that Daemon Statistics are configured: </p><ul>
<li>
The <a class="el" href="index.html#umeelementdaemonmonitor">UMP Element "&lt;daemon-monitor&gt;"</a> inside the <a class="el" href="index.html#umeelementdaemon">UMP Element "&lt;daemon&gt;"</a> configures all aspects of the Store Daemon Statistics feature, including publishing intervals, for all Store instances in a Store Process. </li>
<li>
The <a class="el" href="index.html#umeelementpublishinginterval">UMP Element "&lt;publishing-interval&gt;"</a> inside a <a class="el" href="index.html#umeelementstore">UMP Element "&lt;store&gt;"</a> configures only the publishing intervals of a Store instance. </li>
</ul>
<p>Here is an example of configuring daemon statistics.</p>
<div class="fragment"><div class="line">&lt;ume-store version=<span class="stringliteral">&quot;1.3&quot;</span>&gt;</div><div class="line">&lt;daemon&gt;</div><div class="line">  &lt;daemon-monitor topic=<span class="stringliteral">&quot;bozo&quot;</span>&gt;</div><div class="line">    ...</div><div class="line">    &lt;publishing-interval&gt;</div><div class="line">      &lt;group name=<span class="stringliteral">&quot;default&quot;</span> ivl=<span class="stringliteral">&quot;3&quot;</span>/&gt;</div><div class="line">      &lt;group name=<span class="stringliteral">&quot;config&quot;</span> ivl=<span class="stringliteral">&quot;120&quot;</span>/&gt;</div><div class="line">    &lt;/publishing-interval&gt;</div><div class="line">    &lt;remote-snapshot-request allow=<span class="stringliteral">&quot;1&quot;</span>/&gt;</div><div class="line">    &lt;remote-config-changes-request allow=<span class="stringliteral">&quot;1&quot;</span>/&gt;</div><div class="line">  &lt;/daemon-monitor&gt;</div><div class="line">&lt;daemon&gt;</div><div class="line">&lt;stores&gt;</div><div class="line">  &lt;store name=<span class="stringliteral">&quot;store0&quot;</span> port=<span class="stringliteral">&quot;12000&quot;</span>&gt;</div><div class="line">    &lt;publishing-interval&gt;</div><div class="line">      &lt;group name=<span class="stringliteral">&quot;default&quot;</span> ivl=<span class="stringliteral">&quot;6&quot;</span>/&gt;</div><div class="line">      &lt;group name=<span class="stringliteral">&quot;config&quot;</span> ivl=<span class="stringliteral">&quot;120&quot;</span>/&gt;</div><div class="line">    &lt;/publishing-interval&gt;</div><div class="line">    ...</div><div class="line">  &lt;/store&gt;</div><div class="line">  &lt;store name=<span class="stringliteral">&quot;store1&quot;</span> port=<span class="stringliteral">&quot;12001&quot;</span>&gt;</div><div class="line">    ...</div><div class="line">  &lt;/store&gt;</div><div class="line">&lt;/stores&gt;</div></div><!-- fragment --><p>In this example, all stats-type messages are (conditionally) published on a 3-second interval, except those of store0, which are published (conditionally) on a 6-second interval. All config-type messages are published (unconditionally) on a 120-second interval.</p>
<p><br />
 </p>
<h2><a class="anchor" id="storedaemoncontrolrequests"></a>
Store Daemon Control Requests&nbsp;&nbsp;<small><a href="#storedaemoncontrolrequests">&lt;-</a></small></h2>
<p>The Store Process supports a monitoring application to send a specific set of requests to control the operation of Daemon Statistics, and other operations of the Store. The <a class="el" href="index.html#umeelementremotesnapshotrequest">&lt;remote-snapshot-request&gt;</a> and <a class="el" href="index.html#umeelementremoteconfigchangesrequest">&lt;remote-config-changes-request&gt;</a> elements control whether the Store enables the <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/design.tag:../../Design/" href="../../Design/umfeatures.html#daemoncontroller">Daemon Controller</a> operation (both default to disabled).</p>
<dl class="section warning"><dt>Warning</dt><dd>If misused, the Daemon Control Requests feature allows a user to interfere with the messaging infrastructure in potentially disruptive ways. By default, this feature is disabled. However, especially if you have enabled <a class="el" href="index.html#umeelementremoteconfigchangesrequest">UMP Element "&lt;remote-config-changes-request&gt;"</a>, Informatica recommends <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/design.tag:../../Design/" href="../../Design/umfeatures.html#securingdaemoncontrolrequests">Securing Daemon Control Requests</a>.</dd></dl>
<p>If enabled, the monitoring application can send a request message to the Store in the form of a topicless unicast immediate "request" message (see <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/lbm_8h.html#ae011c7a66e1db1f012d7f9633dbd321d">lbm_unicast_immediate_request()</a> with NULL for topic). The format of the message is a simple ascii string, with or without null termination. Due to the simple format of the message, no data structure is defined for it.</p>
<p>When the Store receives and validates the request, it sends a UM response message back to the requesting application containing a status message (which is <em>not</em> null-terminated). If the status was OK, the Store also performs the requested action.</p>
<p><br />
 </p>
<h3><a class="anchor" id="storedaemoncontrolrequestaddressing"></a>
Store Daemon Control Request Addressing&nbsp;&nbsp;<small><a href="#storedaemoncontrolrequestaddressing">&lt;-</a></small></h3>
<p>Since Daemon Control Requests are sent as UIM messages, you must use a target string to address the request to the desired Store Process. The general form of a UIM target address is described in <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/design.tag:../../Design/" href="../../Design/umfeatures.html#uimaddressing">UIM Addressing</a>, but is illustrated by this example: </p><pre class="fragment">TCP:10.29.3.46:12009
</pre><p> where 10.29.3.46:12009 is the IP and Port of the Daemon Control context UIM port. These are typically configured using the <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpunicastimmediatemessagingnetwork.html#requesttcpinterfacecontext">request_tcp_interface (context)</a> and <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpunicastimmediatemessagingnetwork.html#requesttcpportcontext">request_tcp_port (context)</a> options in the LBM configuration file specified by the <a class="el" href="index.html#umeelementlbmconfig">UMP Element "&lt;lbm-config&gt;"</a> contained within the <a class="el" href="index.html#umeelementdaemonmonitor">UMP Element "&lt;daemon-monitor&gt;"</a>.</p>
<p><br />
 </p>
<h3><a class="anchor" id="storedaemoncontrolrequesttypes"></a>
Store Daemon Control Request Types&nbsp;&nbsp;<small><a href="#storedaemoncontrolrequesttypes">&lt;-</a></small></h3>
<p>The example program <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/example.tag:../../example/" href="../../example/index.html#exampleumedcmd_c">Example umedcmd.c</a> demonstrates the correct way to send the messages and receive the responses. See <a class="el" href="index.html#umedcmdmanpage">umedcmd Man Page</a> for usage details.</p>
<p><b>REQUEST TYPES ENABLED BY <a class="el" href="index.html#umeelementremotesnapshotrequest">&lt;remote-snapshot-request&gt;</a>:</b></p>
<dl class="section user"><dt>version</dt><dd>The Store returns in its response the value of <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/umedmonmsgs_8h.html#af43ca32ea1917897c4ff1310d214c20b">LBM_UMESTORE_DMON_VERSION</a>. No daemon statistics messages are published.</dd></dl>
<dl class="section user"><dt>snap memory</dt><dd>The Store immediately publishes the memory usage message <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/umedmonmsgs_8h.html#aa3a3d4c63922003ed750ed38027bcc82">LBM_UMESTORE_DMON_MPG_SMART_HEAP_STATS</a>.</dd></dl>
<dl class="section user"><dt>snap src</dt><dd>The Store immediately publishes the source repository statistics message(s) <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/umedmonmsgs_8h.html#aa4269805d37ad1586f340a0f4486e0e9">LBM_UMESTORE_DMON_MPG_REPO_STATS</a>.</dd></dl>
<dl class="section user"><dt>snap rcv</dt><dd>The Store immediately publishes the receiver statistics message(s) <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/umedmonmsgs_8h.html#aa57c0aadc4536533388200812a51584e">LBM_UMESTORE_DMON_MPG_RCV_STATS</a>.</dd></dl>
<dl class="section user"><dt>snap disk</dt><dd>The Store immediately publishes the disk statistics message(s) <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/umedmonmsgs_8h.html#a41acc94a55b5c03bf2580c876d7f8ad4">LBM_UMESTORE_DMON_MPG_DISK_STATS</a>.</dd></dl>
<dl class="section user"><dt>snap store</dt><dd>The Store immediately publishes the Store statistics message(s) <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/umedmonmsgs_8h.html#a102df121698e67407d2aeffc0147d91e">LBM_UMESTORE_DMON_MPG_STORE_STATS</a>.</dd></dl>
<dl class="section user"><dt>snap config</dt><dd>The Store immediately publishes the Store config category messages <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/umedmonmsgs_8h.html#aed8460b69470931e1d8ee4347110a309">LBM_UMESTORE_DMON_MPG_STORE_CONFIG</a>, <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/umedmonmsgs_8h.html#aab14bc84ccbe0986c41e5f3f4b5f2b34">LBM_UMESTORE_DMON_MPG_STORE_PATTERN_CONFIG</a>, <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/umedmonmsgs_8h.html#a8e29917df3f47cbb8935cb1ed683e876">LBM_UMESTORE_DMON_MPG_STORE_TOPIC_CONFIG</a>, <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/umedmonmsgs_8h.html#a76e34ed0b81c5e1141a36e358f3803a4">LBM_UMESTORE_DMON_MPG_REPO_CONFIG</a>, and <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/api.tag:../../API/" href="../../API/umedmonmsgs_8h.html#a37abe47b7a806332d6dec510f8370386">LBM_UMESTORE_DMON_MPG_RCV_CONFIG</a></dd></dl>
<p><b>REQUEST TYPES ENABLED BY <a class="el" href="index.html#umeelementremoteconfigchangesrequest">&lt;remote-config-changes-request&gt;</a>:</b></p>
<p>A Store Process can have multiple Store instances. But the UIM message is sent to the Daemon Control context within the Store Process.</p>
<p>Except as noted, the following requests can either be applied to all Store instances in the Store Process, or to just one Store instance. To apply the request to one Store instance, the Store name (as specified in the <a class="el" href="index.html#umeelementstore">UMP Element "&lt;store&gt;"</a> attribute "name") should be specified in double quotes.</p>
<dl class="section user"><dt>memory <em>N</em> </dt><dd>Set the publishing interval for memory usage. This is only available on a Store Process basis. A Store instance may not be supplied. <br />
For example: <code>memory 5</code></dd></dl>
<dl class="section user"><dt>src <em>N</em> </dt><dd>Set the publishing interval for source repository statistics messages. This request can be preceded by a Store instance name in double quote marks to only set the publishing interval for that Store. <br />
For example: <code>"store1" src 5</code></dd></dl>
<dl class="section user"><dt>rcv <em>N</em> </dt><dd>Set the publishing interval for receiver statistics messages. This request can be preceded by a Store instance name in double quote marks to only set the publishing interval for that Store. <br />
For example: <code>"store1" rcv 5</code></dd></dl>
<dl class="section user"><dt>disk <em>N</em> </dt><dd>Set the publishing interval for disk statistics messages. This request can be preceded by a Store instance name in double quote marks to only set the publishing interval for that Store. <br />
For example: <code>"store1" disk 5</code></dd></dl>
<dl class="section user"><dt>store <em>N</em> </dt><dd>Set the publishing interval for Store statistics messages. This request can be preceded by a Store instance name in double quote marks to only set the publishing interval for that Store. <br />
For example: <code>"store1" store 5</code></dd></dl>
<dl class="section user"><dt>config <em>N</em> </dt><dd>Set the publishing interval for config category messages. This request can be preceded by a Store instance name in double quote marks to only set the publishing interval for that Store. <br />
For example: <code>"store1" config 5</code></dd></dl>
<p>For the following requests, a Store instance <em>must</em> be supplied as part of the request. It is supplied as an IP and Port, as specified in the <a class="el" href="index.html#umeelementstore">UMP Element "&lt;store&gt;"</a> attributes "interface" and "port". Note that the following requests are <em>not</em> related to the Daemon Statistics feature, but are nonetheless enabled by <a class="el" href="index.html#umeelementremoteconfigchangesrequest">&lt;remote-config-changes-request&gt;</a>.</p>
<dl class="section user"><dt>mark <em>INTFC</em> <em>PORT</em> <em>SRC_REGID</em> <em>SQN</em> </dt><dd>Mark as invalid the message with sequence number <em>SQN</em> from the source with registration ID <em>SRC_REGID</em> on the Store instance at <em>INTFC</em>:<em>PORT</em>. <br />
For example: <code>mark 10.29.3.16 12000 127025183 500</code> <br />
Note that only one sequence number can be specified. See <a class="el" href="index.html#requestmarkstoredmessageinvalid">Request: Mark Stored Message Invalid</a> for more information.</dd></dl>
<dl class="section user"><dt>deregister <em>INTFC</em> <em>PORT</em> <em>SRC_REGID</em> <em>RCV_REGID</em> </dt><dd>Deregister the receiver with registration ID <em>RCV_REGID</em> associated with the source with registration ID <em>SRC_REGID</em> on the Store instance at <em>INTFC</em>:<em>PORT</em>. <br />
For example: <code>deregister 10.29.3.16 12000 127025183 127025184</code> <br />
Note that only one receiver registration ID can be specified. See <a class="el" href="index.html#requestderegisterreceiver">Request: Deregister Receiver</a> for more information.</dd></dl>
<p><br />
 </p>
<h3><a class="anchor" id="requestmarkstoredmessageinvalid"></a>
Request: Mark Stored Message Invalid&nbsp;&nbsp;<small><a href="#requestmarkstoredmessageinvalid">&lt;-</a></small></h3>
<p>There are occasions when a user might want to mark one or more messages in a Store's repository as invalid, to prevent them from being delivered to a recovering receiver. This can be useful if a misbehaving publisher sends a "poison" message that causes receivers to crash; having that message in the Store's repository means that restarting the failed receiver will just cause it to crash again when the message is recovered.</p>
<p>This message marking feature is provided by the daemon command-and-control feature <a class="el" href="index.html#storedaemoncontrolrequests">Store Daemon Control Requests</a>. Note that if there is more than one Store instance in this QC group, the request needs to be sent multiple times, once for each Store instance IP/Port.</p>
<dl class="section warning"><dt>Warning</dt><dd>If misused, the Daemon Control Requests feature allows a user to interfere with the messaging infrastructure in potentially disruptive ways. By default, this feature is disabled. However, especially if you have enabled <a class="el" href="index.html#umeelementremoteconfigchangesrequest">UMP Element "&lt;remote-config-changes-request&gt;"</a>, Informatica recommends <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/design.tag:../../Design/" href="../../Design/umfeatures.html#securingdaemoncontrolrequests">Securing Daemon Control Requests</a>.</dd>
<dd>
When a message is marked invalid with this feature, that mark is <em>NOT</em> saved onto disk. If the marked message resides on disk and the Store is restarted, it loses its invalid mark and becomes subject to delivery to recovering receivers. Invalid messages may need to be re-marked as invalid after a Store restart.</dd>
<dd>
The message marking feature is incompatible with the <a class="el" href="index.html#umecfgretransmissionrequestforwarding">retransmission-request-forwarding</a> Store option. If you have configured the Store instance to enable the <a class="el" href="index.html#umecfgretransmissionrequestforwarding">retransmission-request-forwarding</a> option, and a recovering receiver requests a message that has been marked as invalid, the Store instance will forward the recovery request to the source. If the source still has the message in its retention buffer, the Store will supply it to the receiver.</dd></dl>
<p>Daemon Control requests can be sent by the example program <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/example.tag:../../example/" href="../../example/index.html#exampleumedcmd_c">Example umedcmd.c</a>. Alternatively, that program's source code can be used as a guide for writing your own Store management program. See <a class="el" href="index.html#umedcmdmarkmode">umedcmd Mark Mode</a> for full details.</p>
<p><br />
 </p>
<h3><a class="anchor" id="requestderegisterreceiver"></a>
Request: Deregister Receiver&nbsp;&nbsp;<small><a href="#requestderegisterreceiver">&lt;-</a></small></h3>
<p>There are occasions when a user might want to deregister a failed receiver from a Store. This will delete the Store's state information for that receiver.</p>
<p>This receiver deregistration feature is provided by the Daemon command-and-control feature <a class="el" href="index.html#storedaemoncontrolrequests">Store Daemon Control Requests</a>.</p>
<dl class="section warning"><dt>Warning</dt><dd>If misused, the Daemon Control Requests feature allows a user to interfere with the messaging infrastructure in potentially disruptive ways. By default, this feature is disabled. However, especially if you have enabled <a class="el" href="index.html#umeelementremoteconfigchangesrequest">UMP Element "&lt;remote-config-changes-request&gt;"</a>, Informatica recommends <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/design.tag:../../Design/" href="../../Design/umfeatures.html#securingdaemoncontrolrequests">Securing Daemon Control Requests</a>.</dd></dl>
<p>A receiver's state information is stored per-source. For example, if an application creates a persistent receiver for topic X, and there are two sources for topic X, the Store will save two sets of state information for that receiver, one for each source for X. To fully clean up a failed receiving application, you need to deregister every pairing of receiver registration ID (RegID) associated with that receiver with every source RegID. And that must be repeated for each Store instance that the receiver was registered with. (Session IDs may not be used.)</p>
<p>Once deregistered, the state and cache files are deleted and cannot be restored.</p>
<p>Note that if there is more than one Store instance in this QC group, the request needs to be sent multiple times, once for each Store instance IP/Port.</p>
<dl class="section note"><dt>Note</dt><dd>If you use this feature to deregister a receiver that is still running, that receiving application is not informed of the deregistration, and it will continue to receive messages from the source and will attempt to acknowledge them to the Store. However, the Store will discard these acknowledgements as invalid and will log warnings to its log file. The receiving application will not be aware of the acknowledgement discards.</dd></dl>
<p>Daemon Control Requests can be sent by the example program <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/example.tag:../../example/" href="../../example/index.html#exampleumedcmd_c">Example umedcmd.c</a>. Alternatively, that program's source code can be used as a guide for writing your own Store management program. See <a class="el" href="index.html#umedcmdderegistermode">umedcmd Deregister Mode</a> for full details.</p>
<p><br />
 </p>
<h2><a class="anchor" id="umedcmdmanpage"></a>
umedcmd Man Page&nbsp;&nbsp;<small><a href="#umedcmdmanpage">&lt;-</a></small></h2>
<p>The <code>umedcmd</code> example program sends <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/design.tag:../../Design/" href="../../Design/umfeatures.html#daemoncontrolrequests">Daemon Control Requests</a> to a Store Process. Source code for <code>umedcmd</code> can be found with the other example programs; see <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/example.tag:../../example/" href="../../example/index.html#exampleumedcmd_c">Example umedcmd.c</a>.</p>
<dl class="section note"><dt>Note</dt><dd>UM version 6.13 has a known issue running <code>umedcmd</code> on Windows. See <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/changelog.tag:../../ChangeLog/" href="../../ChangeLog/knownlimitations.html#bug10897">Known Issue 10897</a>.</dd></dl>
<p>The <code>umedcmd</code> command has 3 modes of operation: </p><ul>
<li>
<a class="el" href="index.html#umedcmdpublishmode">publish</a><ul>
<li>used to control the publishing of Daemon Statistics by the Persistent Store. </li>
</ul>
</li>
<li>
<a class="el" href="index.html#umedcmdmarkmode">mark</a><ul>
<li>used to mark messages in a Store instance as invalid. </li>
</ul>
</li>
<li>
<a class="el" href="index.html#umedcmdderegistermode">deregister</a><ul>
<li>used to deregister and delete state information for a receiver that is currently registered with a Store instance. </li>
</ul>
</li>
</ul>
<p>Each mode has a different usage pattern, which is determined by the value passed to the "-m" command-line option.</p>
<p><br />
 </p>
<h3><a class="anchor" id="umedcmdpublishmode"></a>
umedcmd Publish Mode&nbsp;&nbsp;<small><a href="#umedcmdpublishmode">&lt;-</a></small></h3>
<p>This form of the umedcmd command is used to control the publishing of Daemon Statistics by the Persistent Store.</p>
<pre class="fragment">*******************************************************************************
Usage: umedcmd -m publish -c config_file -T target_string [-L linger]
       [command_string]
Available options:
  -c, --config=FILE       Use LBM configuration file FILE.
                             Multiple config files are allowed.
                             Example: '-c file1.cfg -c file2.cfg'
  -h, --help              display this help and exit
  -L, --linger=NUM        linger for NUM seconds before closing context
  -m, --mode=TYPE         set the command mode to TYPE 'publish' [required]
  -T, --target=TARGET     TARGET string for unicast immediate messages
                          [required]
*******************************************************************************
</pre><p>The "-m mode" command-line option is optional in this usage. If supplied, it must be supplied as "-m publish". Omitting it defaults to publish mode.</p>
<p>The "-T target_string" contains the unicast immediate message destination address of the Daemon Control context UIM port (see <a class="el" href="index.html#storedaemoncontrolrequestaddressing">Store Daemon Control Request Addressing</a>).</p>
<p>The parameter "command_string" is optional. If supplied, it should be enclosed in single quotes. If omitted, the program enters an interactive mode in which the user can enter any number of commands (when used interactively, do not enclose the command string in single quotes). In interactive mode, use "h" for a brief help screen, and "q" to quit.</p>
<p>Valid command strings are:</p>
<pre class="fragment">***********************************************************************************
* Publish Mode                                                                    *
* help (print this message): h                                                    *
*   quit (exit application): q                                                    *
* report store dmon version: version                                              *
*   set publishing interval: memory 0-N                                           *
*                            ["store name"] src 0-N                               *
*                            ["store name"] rcv 0-N                               *
*                            ["store name"] disk 0-N                              *
*                            ["store name"] store 0-N                             *
*                            ["store name"] config 0-N                            *
*       snapshot all groups: ["store name"] snap memory|src|rcv|disk|store|config *
***********************************************************************************
</pre><p>Note that most of the commands can optionally be preceded by a Store instance name in double quotes. Supplying it causes the command to apply only to the named Store instance. Omitting this causes the command to apply to <em>all</em> Store instances in the target Store Program.</p>
<p>For example: </p><pre class="fragment">umedcmd -c dstats.cfg -m publish -T TCP:10.29.3.16:12009 '"store1" src 5'
</pre><p>In this example, the Store Process's Daemon Control context has its UIM port configured as 12009 (see <a class="el" href="index.html#storedaemoncontrolrequestaddressing">Store Daemon Control Request Addressing</a>), and the Store instance is configured for the name "store1". (with the <a class="el" href="index.html#umeelementstore">UMP Element "&lt;store&gt;"</a> attribute "name"). The source repository statistics are set to a publishing interval of 5 seconds.</p>
<p><br />
 </p>
<h3><a class="anchor" id="umedcmdmarkmode"></a>
umedcmd Mark Mode&nbsp;&nbsp;<small><a href="#umedcmdmarkmode">&lt;-</a></small></h3>
<p>This form of the umedcmd command is used to mark persisted messages as invalid. This prevents their delivery to recovering receivers. See <a class="el" href="index.html#requestmarkstoredmessageinvalid">Request: Mark Stored Message Invalid</a>.</p>
<pre class="fragment">*******************************************************************************
Usage: umedcmd -m mark -c config_file -i store_interface -p store_port
       -s src_regid -T target_string [-L linger] [-S sqn_string]
Available options:
  -c, --config=FILE     Use LBM configuration file FILE.
                           Multiple config files are allowed.
                           Example: '-c file1.cfg -c file2.cfg'
  -h, --help            display this help and exit
  -i, --store_interface store interface IPv4 address [required]
  -p, --store_port      store port [required]
  -L, --linger=NUM      linger for NUM seconds before closing context
  -m, --mode=TYPE       set the command mode to TYPE 'mark' [required]
  -s, --src_regid=ID    source registration ID associated with the store
                        repository [required]
  -S, --sqn_string=LIST LIST of one or more message sequence number(s) or
                        ranges to drop], e.g.:
                          '-S 54'       drop a single message
                          '-S 312-315'  drops a range of messages
                          '-S 2,5,7-9' drops two single and a range of messages
  -T, --target=TARGET   TARGET string for unicast immediate messages
                        [required]
*******************************************************************************
</pre><p>The "-m mark" command-line option must be supplied.</p>
<p>The "-T target_string" contains the unicast immediate message destination address of the Daemon Control context UIM port (see <a class="el" href="index.html#storedaemoncontrolrequestaddressing">Store Daemon Control Request Addressing</a>).</p>
<p>The "-i store_interface" and "-p store_port" are required parameters which identify the desired Store instance within the Store Process, as specified in the <a class="el" href="index.html#umeelementstore">UMP Element "&lt;store&gt;"</a> attributes "interface" and "port".</p>
<p>The "-s src_regid" parameter is required to identify the specific source that sent the invalid message.</p>
<p>The command-line option "-S sqn_string" specifies the sequence number(s) of the messages that should be marked invalid. If omitted, the program enters an interactive mode in which the user can enter any number of sequence number strings.</p>
<p>A sequence number string can specify multiple sequence numbers and/or ranges of sequence numbers. A range is two sequence numbers separated by a dash. The string can consist of one or more sequence numbers or ranges, separated by commas. The string should be enclosed in quotes. For example: </p><pre class="fragment">-S "100,110-112,220"
</pre><p> This specifies sequence numbers 100, 110, 111, 112, 220. Note that the <code>umedcmd</code> command parses the sequence number string and issues a separate request to the Store instance for each sequence number.</p>
<p>If "-S sqn_string" is omitted from the command line, the program enters an interactive mode in which the user can enter any number of sequence number strings. In interactive mode, use "h" for a brief help screen, and "q" to quit.</p>
<p>For example: </p><pre class="fragment">umedcmd -c dstats.cfg -m mark -T TCP:10.29.3.16:12009 -i 10.29.3.16 -p 12000 -s 127025183 -S "500"
</pre><p>In this example, the Store Process's Daemon Control context has its UIM port configured as 12009 (see <a class="el" href="index.html#storedaemoncontrolrequestaddressing">Store Daemon Control Request Addressing</a>), and the Store instance is configured for port 12000 (with the "port" attribute of the <a class="el" href="index.html#umeelementstore">UMP Element "&lt;store&gt;"</a>). The source registration ID is 127025183. The message with sequence number 500 is marked invalid.</p>
<dl class="section note"><dt>Note</dt><dd>If there is more than one Store instance in this QC group, the command needs to be executed multiple times, once for each Store instance IP/Port.</dd></dl>
<p><br />
 </p>
<h3><a class="anchor" id="umedcmdderegistermode"></a>
umedcmd Deregister Mode&nbsp;&nbsp;<small><a href="#umedcmdderegistermode">&lt;-</a></small></h3>
<p>This form of the umedcmd command is used to deregister a failed receiver. This deletes the state information for that receiver. See <a class="el" href="index.html#requestderegisterreceiver">Request: Deregister Receiver</a>.</p>
<pre class="fragment">*******************************************************************************
Usage: umedcmd  -m deregister-c config_file -i store_interface -p store_port
       -s src_regid -T target_string [-r rcvr_regid] [-L linger]
Available options:
  -c, --config=FILE       Use LBM configuration file FILE.
                             Multiple config files are allowed.
                             Example: '-c file1.cfg -c file2.cfg'
  -h, --help              display this help and exit
  -i, --store_interface   store interface IPv4 address [required]
  -p, --store_port        store port [required]
  -L, --linger=NUM        linger for NUM seconds before closing context
  -m, --mode=TYPE         set the command mode to TYPE 'deregister' [required]
  -r, --rcvr_regid=LIST   LIST of one or more receiver registration IDs
                          with store repository, e.g.:
                           '-r 127025171'            deregister single receiver
                           '-r 127025171, 127025162' deregister two receivers
  -s, --src_regid=ID      source registration ID associated with the
                          store repository [required]
  -T, --target=TARGET     TARGET string for unicast immediate messages
                          [required]
*******************************************************************************
</pre><p>The "-m deregister" command-line option must be supplied.</p>
<p>The "-T target_string" contains the unicast immediate message destination address of the Daemon Control context UIM port (see <a class="el" href="index.html#storedaemoncontrolrequestaddressing">Store Daemon Control Request Addressing</a>).</p>
<p>The "-i store_interface" and "-p store_port" are required parameters which identify the desired Store instance within the Store Process, as specified in the <a class="el" href="index.html#umeelementstore">UMP Element "&lt;store&gt;"</a> attributes "interface" and "port".</p>
<p>The "-s src_regid" and "-r rcv_regid" parameters combine to identify the specific receiver state that will be deleted. Receiver state is stored according to a <em>pair</em> of registration IDs: source, receiver. (Session IDs may not be used.) For example, lets say there are two persisted sources for the same topic with registration IDs 100 and 200. A receiver with registration ID 300 will have two sets of state: state for the pair 100, 300 and state for the pair 200, 300.</p>
<p>Note that the "-r rcv_regid" parameter can have a comma-separated list of receiver registration IDs. This is handy if you need to de-register all receivers for a particular source. The rcv_regid should be enclosed in quotes. Note that <code>umedcmd</code> command parses the receiver registration IDs and issues separate request to the Store instance for each rcv_regid.</p>
<p>Also note that if "-r rcv_regid" is omitted from the command line, the program enters an interactive mode in which the user can enter any number of receiver registration IDs. In interactive mode, use "h" for a brief help screen, and "q" to quit.</p>
<p>For example: </p><pre class="fragment">umedcmd -c dstats.cfg -m deregister -T TCP:10.29.3.16:12009 -i 10.29.3.16 -p 12000 -s 127025183 -r "127025184"
</pre><p>In this example, the Store Process's Daemon Control context has its request port configured as 12009 (see <a class="el" href="index.html#storedaemoncontrolrequestaddressing">Store Daemon Control Request Addressing</a>), and the Store instance is configured for port 12000 (with the "port" attribute of the <a class="el" href="index.html#umeelementstore">UMP Element "&lt;store&gt;"</a>). The source registration ID is 127025183 and the receiver registration ID is 127025184. This pair of registration IDs is used by the Store instance to delete the receiver state.</p>
<dl class="section note"><dt>Note</dt><dd>If there is more than one Store instance in this QC group, the command needs to be executed multiple times, once for each Store instance IP/Port. Also, if there is more than one source for the same topic that the receiver is registered for, the command needs to be executed multiple times, once for each source registration ID.</dd></dl>
<p><br />
 </p><hr/>
<h1><a class="anchor" id="storewebmonitor"></a>
Store Web Monitor&nbsp;&nbsp;<small><a href="#storewebmonitor">&lt;-</a></small></h1>
<dl class="section note"><dt>Note</dt><dd>The Store web monitor functionality is deprecated in favor of <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/operations.tag:../../Operations/" href="../../Operations/monitoring.html#monitoringcollectorservicemcs">MCS</a>. We do not plan to remove existing web monitor functionality, and will continue to support it in its current state. But we do not plan to enhance the web monitor in the future.</dd></dl>
<p>The built-in web monitor (configured in the Store configuration file) is a rich source of information about the health of a Store. This section contains a page-by-page guide to reading and interpreting the output of a UM web monitor, with just a couple example sources and one receiver using a single Store.</p>
<dl class="section warning"><dt>Warning</dt><dd>The Store's web monitor is not designed to be a highly-secure feature. Anybody with access to the network can access the web monitor pages.</dd></dl>
<p>Users are expected to prevent unauthorized access to the web monitor through normal firewalling methods. Users who are unable to limit access to a level consistent with their overall security needs should disable the Store web monitor (using <a class="el" href="index.html#umeelementwebmonitor">&lt;web-monitor&gt;</a>). See <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/design.tag:../../Design/" href="../../Design/securityconsiderations.html#webmonsecurity">Webmon Security</a> for more information.</p>
<p><br />
 </p>
<h2><a class="anchor" id="storewebmonitorindexpage"></a>
Store Web Monitor Index Page&nbsp;&nbsp;<small><a href="#storewebmonitorindexpage">&lt;-</a></small></h2>
<p>Here is an image of the Web Monitor's <em>Index</em> (main) page:</p>
<center> <div class="image">
<img src="webmon_index.png" alt="webmon_index.png"/>
</div>
  </center><p>The web monitor's index page tells what build of UM is running.</p>
<p>The "Stores" link displays the <a class="el" href="index.html#storewebmonitorstorespage">Store Web Monitor Stores Page</a>.</p>
<p><br />
 </p>
<h2><a class="anchor" id="storewebmonitorstorespage"></a>
Store Web Monitor Stores Page&nbsp;&nbsp;<small><a href="#storewebmonitorstorespage">&lt;-</a></small></h2>
<p>Here is an image of the Web Monitor's <em>Stores</em> page:</p>
<center> <div class="image">
<img src="webmon_stores.png" alt="webmon_stores.png"/>
</div>
  </center><p>This page shows all the Stores configured under the <code>umestored</code> process. If you had 5 Stores configured, they would be numbered Store 0 through Store 4. Our example has only one Store configured, "ume-test-store".</p>
<p>Each Store name is a clickable link, which displays the <a class="el" href="index.html#storewebmonitorstorepage">Store Web Monitor Store Page</a> for that Store.</p>
<p><br />
 </p>
<h2><a class="anchor" id="storewebmonitorstorepage"></a>
Store Web Monitor Store Page&nbsp;&nbsp;<small><a href="#storewebmonitorstorepage">&lt;-</a></small></h2>
<p>Here is an image of the Web Monitor's <em>Store</em> page:</p>
<center> <div class="image">
<img src="webmon_store.png" alt="webmon_store.png"/>
</div>
  </center><p>This page shows the following information about the Store.</p>
<table class="doxtable">
<tr>
<th>Item </th><th><p class="starttd">Description</p>
<p class="endtd"></p>
</th></tr>
<tr>
<td>Interface </td><td><p class="starttd">This Store is listening on all interfaces (0.0.0.0) on port 38401.</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>Cache Dir </td><td><p class="starttd">Pathname for disk Store message cache directory. This would be configured as a Store option in the Store configuration file. For example: <br />
<a class="el" href="index.html#umecfgdiskcachedirectory">&lt;option type="store" name="disk-cache-directory" value="cache/" /&gt;</a></p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>State Dir </td><td><p class="starttd">Pathname for disk Store state directory. This would be configured as a Store option in the Store configuration file. For example: <br />
<a class="el" href="index.html#umecfgdiskstatedirectory">&lt;option type="store" name="disk-state-directory" value="state/" /&gt;</a></p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>Configured Retransmission Request Processing Rate </td><td><p class="starttd">Current value for the Store's <a class="el" href="index.html#umecfgretransmissionrequestprocessingrate">retransmission-request-processing-rate</a> option setting.</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>Total Seconds Used for Rate Calculations </td><td><p class="starttd">Accumulating counter that displays the number of seconds since the last rate reset. The Web Monitor divides the Retransmission Request Received, Retransmission Request Service and Retransmission Request Drop totals by the Total Seconds to calculate the rates displayed. If you click the Reset Rate Stats, the Web Monitor resets this value to zero.</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>Retransmission Request Received Rate </td><td><p class="starttd">Number of retransmission requests received per second.</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>Retransmission Request Service Rate </td><td><p class="starttd">Number of retransmission requests serviced per second.</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>Retransmission Request Drop Rate </td><td><p class="starttd">Number of retransmission requests dropped per second. Requests are dropped if the rate of retransmission requests exceeds the configured retransmission request rate.</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>Retransmission Request Total Dropped </td><td><p class="starttd">The number of retransmission requests since the time the Store was started.</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>Patterns </td><td><p class="starttd">Specifies the wildcard pattern used to select topics for which a Store will provide persistence services. This would be configured as a topic option in the Store configuration file. For example: <a class="el" href="index.html#umeelementtopic">&lt;topic pattern="test.*" type="PCRE"&gt;</a></p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>Topics </td><td><p class="starttd">Displays the topic names and Registration ID (Session ID) for any sources publishing on the topic. The screen examples display one topic, test1 - 2504558780(39307788). Each Registration ID (Session ID) is a clickable link, which displays the <a class="el" href="index.html#storewebmonitorsourcepage">Store Web Monitor Source Page</a> for that source.</p>
<p class="endtd"><a class="anchor" id="resetratestats"></a></p>
</td></tr>
<tr>
<td>Reset Rate Stats </td><td>Click the Reset Rate Stats link to reset the retransmission rates. After clicking the link, The Web Monitor rests Total Seconds Used for Rate Calculations to zero and displays a page with the Store number and the message, '<code>Rate Statistics have been reset</code>'. </td></tr>
</table>
<p><br />
 </p>
<h2><a class="anchor" id="storewebmonitorsourcepage"></a>
Store Web Monitor Source Page&nbsp;&nbsp;<small><a href="#storewebmonitorsourcepage">&lt;-</a></small></h2>
<p>Here is an image of the Web Monitor's <em>Source</em> page:</p>
<center> <div class="image">
<img src="webmon_source.png" alt="webmon_source.png"/>
</div>
  </center><p>The first line in the page contains is interpreted as follows:</p>
<table class="doxtable">
<tr>
<td>2504558780 </td><td><p class="starttd">The source's registration ID.</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>10.29.3.42.14392 </td><td><p class="starttd">The IP address and port of the source's LBM configuration option, <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpunicastimmediatemessagingnetwork.html#requesttcpportcontext">request_tcp_port (context)</a>.</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>3958260924 </td><td><p class="starttd">The source's transport session index.</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>1161732811 </td><td>The source's topic index within the transport session, 3958260924. </td></tr>
</table>
<p>The remaining fields are described in the following table:</p>
<table class="doxtable">
<tr>
<th>Source Page Item </th><th><p class="starttd">Description</p>
<p class="endtd"></p>
</th></tr>
<tr>
<td>Topic </td><td><p class="starttd">test is the source's topic string.</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>Session ID </td><td><p class="starttd">39307788 is the source's Session ID.</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>Last Activity </td><td><p class="starttd">09:19:39.501350 is the timestamp when the Store last heard from the source, including keepalives sent by UM</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>Repository </td><td><p class="starttd">disk is the type of repository. Possible values are <b>"memory"</b> or <b>"disk"</b>.</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>Receiver Paced Persistence </td><td><p class="starttd">Setting for Receiver-paced Persistence (RPP), which is a repository option both the repository and source must enable. A value of 0 means RPP is not enabled and the repository is using the default Source-paced persistence. A value of 1 means RPP is enabled.</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>Message Map: 3120 </td><td><p class="starttd">The total number of message fragments the Store has for this source, both on disk and in memory. These are UM-level fragments, not IP-level fragments. UM messages are fragmented into roughly 8 kilobyte chunks for UDP-based protocols (LBT-RM and LBT-RU) and into roughly 64 kilobyte chunks for LBT-TCP. The majority of application messages tend to be well under the fragment boundaries, so the value after "Message Map" could be used as a rough estimate of the number of messages in the Store from this particular source. It's at least a strict upper bound.</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>Window: [0, 9d5, c2f] </td><td><p class="starttd">Window format is: trail_sqn, mem_trail_sqn, lead_sqn <br />
<br />
</p><ul>
<li>trail_sqn, 0, is the trailing sequence number, which is the oldest sequence number in the Store for this source. In most cases, this starts at 0 and stays there for a while. The trailing sequence number changes if the Store reaches a disk file size limit and then deletes the oldest messages. <br />
<br />
</li>
<li>mem_trail_sqn, 9d5, is the trailing sequence number for messages in memory. It is the oldest sequence number still in memory. Typically, you might have more sequence numbers on disk than you do in memory, or possibly the same number. <br />
<br />
</li>
<li>lead_sqn, c2f, is the leading sequence number, which is the newest sequence number in the Store. <br />
<br />
 Note: For a memory Store, the first and second values would always be the same. The oldest sequence number in memory is the oldest in the Store, so only two values are displayed. The trailing sequence number and the leading sequence number.</li>
</ul>
<p class="endtd"></p>
</td></tr>
<tr>
<td>Memory: 55986 / 65000 / 50331648 </td><td><p class="starttd">Memory format is: repository memory size / repository size threshold / repository size limit <br />
<br />
</p><ul>
<li>repository memory size, 55986, is the number of bytes of messages in memory, which includes headers and Store overhead. <br />
<br />
</li>
<li>repository size threshold, 65000, is the <a class="el" href="index.html#umecfgrepositorysizethreshold">repository-size-threshold</a> topic option found in the Store configuration file. <br />
<br />
</li>
<li>repository size limit, 50331648, is the Store's <a class="el" href="index.html#umecfgrepositorysizelimit">repository-size-limit</a> topic option found in the Store configuration file. <br />
<br />
 You would expect the number of bytes in memory to be under the threshold most of the time, but it could spike above it before going back down if the Store is really busy momentarily. It should never go above the limit.</li>
</ul>
<p class="endtd"></p>
</td></tr>
<tr>
<td>Age Threshold: 0 </td><td><p class="starttd">Age Threshold, 0, is the Store's <a class="el" href="index.html#umecfgrepositoryagethreshold">repository-age-threshold</a> topic option found in the Store configuration file.</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>Sync: [c2f, c2f, c2f] </td><td><p class="starttd">Pertains to disk repositories only. Sync format is: sync_complete_sqn, sync_sqn, contig_sqn <br />
<br />
</p><ul>
<li>sync_complete_sqn, c2f, Most recent sequence number that the Operating System has confirmed persisting to disk. <br />
<br />
</li>
<li>sync_sqn, c2f, Most recent sequence number for which the Store has initiated persisting to disk, but the Operating System has not confirmed completion of persistence. <br />
<br />
</li>
<li>contig_sqn, c2f, Most recent sequence number that along with the trail_sqn, creates a range of sequence numbers with no sequence number gaps. For example, if trail_sqn = 0 and the Store has persisted all eleven messages with sequence numbers 0 through 10, contig_sqn would equal 10. contig_sqn would also be 10 if a receiver declared message sequence number 7 unrecoverably lost. contig_sqn would be 6 if message sequence number 7 was not persisted, but not declared lost.</li>
</ul>
<p class="endtd"></p>
</td></tr>
<tr>
<td>In progress: 0 / 0 </td><td><p class="starttd">Pertains to disk repositories only. In progress format is: num_ios_pending / num_read_ios_pending <br />
<br />
</p><ul>
<li>num_ios_pending, 0, Number of disk writes the Store has submitted to the Operation System. A disk write refers to the Store persisting a message to disk. <br />
<br />
</li>
<li>num_read_ios_pending, 0, Number of disk reads that the Store has submitted to the Operating System. A disk read, for example, results from an application retransmission request.</li>
</ul>
<p class="endtd"></p>
</td></tr>
<tr>
<td>Offsets: 0 / 190320 / 4294967296 </td><td><p class="starttd">Pertains to disk repositories only. Offsets format is: start_offset, offset, max_offset <br />
<br />
</p><ul>
<li>start_offset, 0, The relative location of the first message, trail_sqn, in the disk. <br />
<br />
</li>
<li>offset, 190320, The relative location of where the message, contig_sqn plus one will be written. <br />
<br />
</li>
<li>max_offset, 4294967296, The maximum size of the cache file.</li>
</ul>
<p class="endtd"></p>
</td></tr>
<tr>
<td>Active ULBs: 0 high 0 </td><td><p class="starttd">ULB stands for Unrecoverable Loss Burst. A little extra work is required to keep cache files consistent when the Store gets an unrecoverable loss burst, because unrecoverable loss bursts are delivered all at once for lots of messages, rather than one at a time like normal unrecoverable loss messages. <br />
<br />
 Active ULB is the number of unrecoverable loss burst events the Store is dealing with at the moment. It'll go to zero after the ULB has been resolved. <br />
<br />
 The high number (0) is the highest sequence number reported among any unrecoverable loss burst event, and is not reset after the ULB is handled; it increments throughout the process life of the Store. <br />
<br />
 <b>WARNING</b>: If you see any number other than 0 here, the Store is losing large numbers of messages, and they are likely not being persisted.</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>Loss: 0 ULBs 0 </td><td><p class="starttd">These values are counters for number of unrecoverable loss messages (Loss) and for number of unrecoverable burst loss messages (ULB). These start at 0 when the Store starts up and aren't reset until the Store exits. They don't include any loss events that were persisted to disk from a previous run, only new loss events since the Store started. There are cases with UME 2.0 where one individual Store could legitimately report some unrecoverable loss, or maybe even unrecoverable loss bursts. <br />
<br />
 <b>WARNING</b>: If you see any number other than 0 for either of these counters, you should investigate.</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>Drops: 0 / 0 </td><td><p class="starttd">If the Store is nearing the <a class="el" href="index.html#umecfgrepositorysizelimit">repository-size-limit</a> and gets another message, the Store will intentionally drop a message. A drop requires a bit of work on the Store's part. <br />
<br />
 The first 0 is the number of active drops, which are drops that are currently being worked on. <br />
<br />
 The second 0 is the total number of drops that have happened for this Store since it was started. Some people want a low <a class="el" href="index.html#umecfgrepositorysizelimit">repository-size-limit</a> and therefore lots of intentional drops can occur. Some don't want to drop any message the whole day - so the interpretation of the values is up to you.</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>LBM Stats </td><td><p class="starttd">These represent transport-level statistics for the underlying receivers in the Store for the source. The example shown is for a TCP source, so not too many stats are available (stats for a TCP source are less important from a monitoring perspective). <br />
<br />
 Statistics for an LBT-RM or LBT-RU source, however, show number of NAKs sent, which is important. Ideally, the number of NAKs sent should be 0. A few NAKs from a Store throughout the day is not an emergency. It can be, however, an early warning sign of more severe problems, and should be taken seriously. <br />
<br />
 If you see a non-zero number of NAKs here, take a look at the overall network load the Store's machine is attempting to handle, particularly in very busy periods and spikes; it may be too much.</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>Receivers </td><td>Registration IDs and accompanying Session ID for the receivers listening on the source's topic. Click on the receiver Registration ID (Session ID) to display the <a class="el" href="index.html#storewebmonitorreceiverpage">Store Web Monitor Receiver Page</a> to review information about the receivers for that persisted topic. </td></tr>
</table>
<p><br />
 </p>
<h2><a class="anchor" id="storewebmonitorreceiverpage"></a>
Store Web Monitor Receiver Page&nbsp;&nbsp;<small><a href="#storewebmonitorreceiverpage">&lt;-</a></small></h2>
<p>Here is an image of the Web Monitor's <em>Receiver</em> page:</p>
<center> <div class="image">
<img src="webmon_receiver.png" alt="webmon_receiver.png"/>
</div>
  </center><p>The first line in the page contains is interpreted as follows:</p>
<table class="doxtable">
<tr>
<td>2504558781 </td><td><p class="starttd">The receiver's registration ID.</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>10.29.3.42.14393 </td><td><p class="starttd">The IP address and port of the source's LBM configuration option, <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.areas/builds/UMQ_6.15/doc/UME/config.tag:../../Config/" href="../../Config/grpunicastimmediatemessagingnetwork.html#requesttcpportcontext">request_tcp_port (context)</a>.</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>1510613393 </td><td><p class="starttd">The receiver's transport session index.</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>1161732811 </td><td>The source's topic index within the transport session, 1510613393. </td></tr>
</table>
<p>The remaining fields are described in the following table:</p>
<table class="doxtable">
<tr>
<th>Receiver Page Item </th><th><p class="starttd">Description</p>
<p class="endtd"></p>
</th></tr>
<tr>
<td>Topic </td><td><p class="starttd">The topic that the receiver is listening on.</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>Last Activity </td><td><p class="starttd">09:09:35.981110 is the timestamp of when the Store last heard from the receiver, including keepalives sent by UM.</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>Source RegID </td><td><p class="starttd">Registration ID of the source publishing on the topic. Click on the Registration ID link to display the <a class="el" href="index.html#storewebmonitorsourcepage">Store Web Monitor Source Page</a>.</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>Source Session ID </td><td><p class="starttd">The Session ID of the Source sending messages on the topic.</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>ACK </td><td>c93 is the last message sequence number the receiver acknowledged. </td></tr>
</table>
<p><br />
<br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
</body>
</html>
