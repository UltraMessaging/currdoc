<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Guide for Persistence: Designing Persistent Receivers</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen_manual.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Guide for Persistence
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('designingpersistentreceivers.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Designing Persistent Receivers </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Receivers are predominantly interested in RegID management and recovery management.</p>
<p><br />
 </p>
<h1><a class="anchor" id="receiverregidmanagement"></a>
Receiver RegID Management&nbsp;&nbsp;<small><a href="#receiverregidmanagement">&lt;-</a></small></h1>
<p>RegIDs are slightly more involved for receivers than for sources. Since RegIDs are per source per topic per Store and a topic may have several sources, a receiver may have to manage several RegIDs per Store in use. Fortunately, receivers in UM can leverage the RegID of the source with the use of a callback as discussed in <a class="el" href="enablingpersistence.html#addingfaultrecoverywithregistrationids">Adding Fault Recovery with Registration IDs</a> and shown in <a href="../example/ume-example-rcv-2.c">ume-example-rcv-2.c</a>. Your application can determine the correct RegID to use and return it to UM. You can also use Session IDs to enable UM to manage receiver RegIDs.</p>
<p>Much like sources, receivers typically have a lifetime based on an amount of work, perhaps an infinite amount. And just like sources, it may be helpful to consider that a RegID is "assigned" at the start of that work and is out of use at the end. In between, the RegID is in use by the instance of the receiver application. However, the nature of RegIDs being per source means that the expected lifetime of a source should play a role in how RegIDs on the receiver are managed. Thus, it may be helpful for the application developer to consider the source application lifetime when deciding how best to handle RegIDs on the receiver.</p>
<p><b>Receiver Message and Event Handler</b></p>
<p>The Receiver Message and Event Handler is an application callback, defined at receiver initialization, to deliver received messages to your application. The following source code examples illustrate the use of a receiver message and event handler for registration messages. To accept other receiver events, additional case statements would be required, one for each additional event. See also <a class="el" href="operationalview.html#persistenceevents">Persistence Events</a></p>
<p><b>C API</b></p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> rcv_handle_msg(<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/lbm_8h.html#a0a4af6b8247cc5a0a24a8578fb6e83bd">lbm_rcv_t</a> *rcv, <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/structlbm__msg__t__stct.html">lbm_msg_t</a> *msg, <span class="keywordtype">void</span> *clientd)</div><div class="line">{</div><div class="line">    <span class="keywordflow">switch</span> (msg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/structlbm__msg__t__stct.html#ab25327dc4b4ebf527106f6e708dbc05f">type</a>) {</div><div class="line">    <span class="keywordflow">case</span> <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/lbm_8h.html#aeb0203ec0c560a60c3b97017afc61ada">LBM_MSG_UME_REGISTRATION_ERROR</a>:</div><div class="line">        printf(<span class="stringliteral">&quot;[%s][%s] UME registration error: %s\n&quot;</span>, msg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/structlbm__msg__t__stct.html#ae7d21878e72939c165a5a3ac565390c3">topic_name</a>,</div><div class="line">                msg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/structlbm__msg__t__stct.html#a6631c87ac29792705794d46c4e1cda06">source</a>, msg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/structlbm__msg__t__stct.html#a9c7d600dd9794c09b82732e2c233392b">data</a>);</div><div class="line">        exit(0);</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/lbm_8h.html#a2ffe0658e008764982ad97128fedcaf0">LBM_MSG_UME_REGISTRATION_SUCCESS</a>:</div><div class="line">        {</div><div class="line">            <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/structlbm__msg__ume__registration__t__stct.html">lbm_msg_ume_registration_t</a> *reg =</div><div class="line">                (<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/structlbm__msg__ume__registration__t__stct.html">lbm_msg_ume_registration_t</a> *)(msg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/structlbm__msg__t__stct.html#a9c7d600dd9794c09b82732e2c233392b">data</a>);</div><div class="line"></div><div class="line">            printf(<span class="stringliteral">&quot;[%s][%s] UME registration successful. &quot;</span></div><div class="line">                <span class="stringliteral">&quot;SrcRegID %u RcvRegID %u\n&quot;</span>,</div><div class="line">                msg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/structlbm__msg__t__stct.html#ae7d21878e72939c165a5a3ac565390c3">topic_name</a>, msg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/structlbm__msg__t__stct.html#a6631c87ac29792705794d46c4e1cda06">source</a>,</div><div class="line">                reg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/structlbm__msg__ume__registration__t__stct.html#a54d2370fce56d3e3233dc957a497eaa1">src_registration_id</a>, reg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/structlbm__msg__ume__registration__t__stct.html#a237395b6b2c007fca581b7080d86ef95">rcv_registration_id</a>);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/lbm_8h.html#acae32fc8bfc50769993fcea62e553bd8">LBM_MSG_UME_REGISTRATION_SUCCESS_EX</a>:</div><div class="line">        {</div><div class="line">            <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/structlbm__msg__ume__registration__ex__t__stct.html">lbm_msg_ume_registration_ex_t</a> *reg =</div><div class="line">                (<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/structlbm__msg__ume__registration__ex__t__stct.html">lbm_msg_ume_registration_ex_t</a> *)(msg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/structlbm__msg__t__stct.html#a9c7d600dd9794c09b82732e2c233392b">data</a>);</div><div class="line"></div><div class="line">            printf(<span class="stringliteral">&quot;[%s][%s] store %u: %s UME registration successful. &quot;</span></div><div class="line">                <span class="stringliteral">&quot;SrcRegID %u RcvRegID %u. Flags %x &quot;</span>,</div><div class="line">                msg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/structlbm__msg__t__stct.html#ae7d21878e72939c165a5a3ac565390c3">topic_name</a>, msg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/structlbm__msg__t__stct.html#a6631c87ac29792705794d46c4e1cda06">source</a>, reg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/structlbm__msg__ume__registration__ex__t__stct.html#a46fc18fb82b632a259917e3c65790568">store_index</a>, reg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/structlbm__msg__ume__registration__ex__t__stct.html#ad1f15dfb96628720e538804b08f0aae0">store</a>,</div><div class="line">                reg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/structlbm__msg__ume__registration__ex__t__stct.html#af2d83e279399169fe982c75ba97e3221">src_registration_id</a>, reg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/structlbm__msg__ume__registration__ex__t__stct.html#a3dbf592d420b0886e88c9e91e105d6e2">rcv_registration_id</a>, reg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/structlbm__msg__ume__registration__ex__t__stct.html#a2fd3cf7fdfdb852283cd8ba1cc0d1390">flags</a>);</div><div class="line">            <span class="keywordflow">if</span> (reg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/structlbm__msg__ume__registration__ex__t__stct.html#a2fd3cf7fdfdb852283cd8ba1cc0d1390">flags</a> &amp; LBM_MSG_UME_REGISTRATION_SUCCESS_EX_FLAG_OLD)</div><div class="line">                printf(<span class="stringliteral">&quot;OLD[SQN %x] &quot;</span>, reg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/structlbm__msg__ume__registration__ex__t__stct.html#ad929f9de34db02929bb4fd36c844c683">sequence_number</a>);</div><div class="line">            printf(<span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/lbm_8h.html#ab0571ebaf7704333a5503d1c0668a989">LBM_MSG_UME_REGISTRATION_COMPLETE_EX</a>:</div><div class="line">        {</div><div class="line">            <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/structlbm__msg__ume__registration__complete__ex__t__stct.html">lbm_msg_ume_registration_complete_ex_t</a> *reg =</div><div class="line">                (<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/structlbm__msg__ume__registration__complete__ex__t__stct.html">lbm_msg_ume_registration_complete_ex_t</a> *)(msg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/structlbm__msg__t__stct.html#a9c7d600dd9794c09b82732e2c233392b">data</a>);</div><div class="line"></div><div class="line">            printf(<span class="stringliteral">&quot;[%s][%s] UME registration complete. SQN %x. Flags %x &quot;</span>,</div><div class="line">                msg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/structlbm__msg__t__stct.html#ae7d21878e72939c165a5a3ac565390c3">topic_name</a>, msg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/structlbm__msg__t__stct.html#a6631c87ac29792705794d46c4e1cda06">source</a>, reg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/structlbm__msg__ume__registration__complete__ex__t__stct.html#aee71c36e8fe1a9d314f294b35a79d4b3">sequence_number</a>, reg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/structlbm__msg__ume__registration__complete__ex__t__stct.html#a020b90070d750107b5bc006dd4a82fe9">flags</a>);</div><div class="line">            <span class="keywordflow">if</span> (reg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/structlbm__msg__ume__registration__complete__ex__t__stct.html#a020b90070d750107b5bc006dd4a82fe9">flags</a> &amp; LBM_MSG_UME_REGISTRATION_COMPLETE_EX_FLAG_QUORUM)</div><div class="line">                printf(<span class="stringliteral">&quot;QUORUM &quot;</span>);</div><div class="line">            <span class="keywordflow">if</span> (reg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/structlbm__msg__ume__registration__complete__ex__t__stct.html#a020b90070d750107b5bc006dd4a82fe9">flags</a> &amp; LBM_MSG_UME_REGISTRATION_COMPLETE_EX_FLAG_RXREQMAX)</div><div class="line">                printf(<span class="stringliteral">&quot;RXREQMAX &quot;</span>);</div><div class="line">            printf(<span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/lbm_8h.html#ac12f55e0cdd14bd4d389bb3ef3afded3">LBM_MSG_UME_REGISTRATION_CHANGE</a>:</div><div class="line">        printf(<span class="stringliteral">&quot;[%s][%s] UME registration change: %s\n&quot;</span>, msg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/structlbm__msg__t__stct.html#ae7d21878e72939c165a5a3ac565390c3">topic_name</a>,</div><div class="line">            msg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/structlbm__msg__t__stct.html#a6631c87ac29792705794d46c4e1cda06">source</a>, msg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/structlbm__msg__t__stct.html#a9c7d600dd9794c09b82732e2c233392b">data</a>);</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">    ...</div><div class="line"></div><div class="line">    <span class="keywordflow">default</span>:</div><div class="line">        printf(<span class="stringliteral">&quot;Unknown lbm_msg_t type %x [%s][%s]\n&quot;</span>, msg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/structlbm__msg__t__stct.html#ab25327dc4b4ebf527106f6e708dbc05f">type</a>,</div><div class="line">            msg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/structlbm__msg__t__stct.html#ae7d21878e72939c165a5a3ac565390c3">topic_name</a>, msg-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/structlbm__msg__t__stct.html#a6631c87ac29792705794d46c4e1cda06">source</a>);</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><p><b>JAVA API</b></p>
<div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keywordtype">int</span> onReceive(Object cbArg, LBMMessage msg)</div><div class="line">{</div><div class="line">    <span class="keywordflow">case</span> LBM.MSG_UME_REGISTRATION_ERROR:</div><div class="line">        System.out.println(<span class="stringliteral">&quot;[&quot;</span> + msg.topicName() + <span class="stringliteral">&quot;][&quot;</span> + msg.source()</div><div class="line">                    + <span class="stringliteral">&quot;] UME registration error: &quot;</span> + msg.dataString());</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> LBM.MSG_UME_REGISTRATION_SUCCESS_EX:</div><div class="line">        UMERegistrationSuccessInfo reg = msg.registrationSuccessInfo();</div><div class="line">        System.out.print(<span class="stringliteral">&quot;[&quot;</span> + msg.topicName() + <span class="stringliteral">&quot;][&quot;</span> + msg.source()</div><div class="line">                    + <span class="stringliteral">&quot;] store &quot;</span> + reg.storeIndex() + <span class="stringliteral">&quot;: &quot;</span></div><div class="line">                    + reg.store() + <span class="stringliteral">&quot; UME registration successful. SrcRegID &quot;</span></div><div class="line">                    + reg.sourceRegistrationId() + <span class="stringliteral">&quot; RcvRegID &quot;</span></div><div class="line">                    + reg.receiverRegistrationId()</div><div class="line">                    + <span class="stringliteral">&quot;. Flags &quot;</span> + reg.flags() + <span class="stringliteral">&quot; &quot;</span>);</div><div class="line">        <span class="keywordflow">if</span> ((reg.flags() &amp; LBM.MSG_UME_REGISTRATION_SUCCESS_EX_FLAG_OLD) != 0) {</div><div class="line">            System.out.print(<span class="stringliteral">&quot;OLD[SQN &quot;</span> + reg.sequenceNumber() + <span class="stringliteral">&quot;] &quot;</span>);</div><div class="line">        }</div><div class="line">        System.out.println();</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> LBM.MSG_UME_REGISTRATION_COMPLETE_EX:</div><div class="line">        UMERegistrationCompleteInfo regcomplete = msg.registrationCompleteInfo();</div><div class="line">        System.out.print(<span class="stringliteral">&quot;[&quot;</span> + msg.topicName() + <span class="stringliteral">&quot;][&quot;</span> + msg.source()</div><div class="line">            + <span class="stringliteral">&quot;] UME registration complete. SQN &quot;</span> + regcomplete.sequenceNumber()</div><div class="line">            + <span class="stringliteral">&quot;. Flags &quot;</span> + regcomplete.flags() + <span class="stringliteral">&quot; &quot;</span>);</div><div class="line">        <span class="keywordflow">if</span> ((regcomplete.flags() &amp; LBM.MSG_UME_REGISTRATION_COMPLETE_EX_FLAG_QUORUM) != 0) {</div><div class="line">            System.out.print(<span class="stringliteral">&quot;QUORUM &quot;</span>);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">if</span> ((regcomplete.flags() &amp; LBM.MSG_UME_REGISTRATION_COMPLETE_EX_FLAG_RXREQMAX) != 0) {</div><div class="line">            System.out.print(<span class="stringliteral">&quot;RXREQMAX &quot;</span>);</div><div class="line">        }</div><div class="line">        System.out.println();</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> LBM.MSG_UME_REGISTRATION_CHANGE:</div><div class="line">        System.out.println(<span class="stringliteral">&quot;[&quot;</span> + msg.topicName() + <span class="stringliteral">&quot;][&quot;</span> + msg.source()</div><div class="line">                    + <span class="stringliteral">&quot;] UME registration change: &quot;</span> + msg.dataString());</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">    ...</div><div class="line"></div><div class="line">    <span class="keywordflow">default</span>:</div><div class="line">        System.err.println(<span class="stringliteral">&quot;Unknown lbm_msg_t type &quot;</span> + msg.type() + <span class="stringliteral">&quot; [&quot;</span></div><div class="line">                    + msg.topicName() + <span class="stringliteral">&quot;][&quot;</span> + msg.source() + <span class="stringliteral">&quot;]&quot;</span>);</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><p><b>.NET API</b></p>
<div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keywordtype">int</span> onReceive(Object cbArg, LBMMessage msg)</div><div class="line">{</div><div class="line">    <span class="keywordflow">case</span> LBM.MSG_UME_REGISTRATION_ERROR:</div><div class="line">        System. Console.Out.WriteLine(<span class="stringliteral">&quot;[&quot;</span> + msg.topicName() + <span class="stringliteral">&quot;][&quot;</span></div><div class="line">            + msg.source() + <span class="stringliteral">&quot;] UME registration error: &quot;</span> + msg.dataString());</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> LBM.MSG_UME_REGISTRATION_SUCCESS_EX:</div><div class="line">        UMERegistrationSuccessInfo reg = msg.registrationSuccessInfo();</div><div class="line">        System.Console.Out.Write(<span class="stringliteral">&quot;[&quot;</span> + msg.topicName() + <span class="stringliteral">&quot;][&quot;</span> + msg.source()</div><div class="line">                    + <span class="stringliteral">&quot;] store &quot;</span> + reg.storeIndex() + <span class="stringliteral">&quot;: &quot;</span></div><div class="line">                    + reg.store() + <span class="stringliteral">&quot; UME registration successful. SrcRegID &quot;</span></div><div class="line">                    + reg.sourceRegistrationId() + <span class="stringliteral">&quot; RcvRegID &quot;</span></div><div class="line">                    + reg.receiverRegistrationId()</div><div class="line">                    + <span class="stringliteral">&quot;. Flags &quot;</span> + reg.flags() + <span class="stringliteral">&quot; &quot;</span>);</div><div class="line">        <span class="keywordflow">if</span> ((reg.flags() &amp; LBM.MSG_UME_REGISTRATION_SUCCESS_EX_FLAG_OLD) != 0) {</div><div class="line">            System.Console.Out.Write (<span class="stringliteral">&quot;OLD[SQN &quot;</span> + reg.sequenceNumber() + <span class="stringliteral">&quot;] &quot;</span>);</div><div class="line">        }</div><div class="line">        System.Console.Out.WriteLine();</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> LBM.MSG_UME_REGISTRATION_COMPLETE_EX:</div><div class="line">        UMERegistrationCompleteInfo regcomplete = msg.registrationCompleteInfo();</div><div class="line">        System.Console.Out.Write(<span class="stringliteral">&quot;[&quot;</span> + msg.topicName() + <span class="stringliteral">&quot;][&quot;</span> + msg.source()</div><div class="line">                    + <span class="stringliteral">&quot;] UME registration complete. SQN &quot;</span></div><div class="line">                    + regcomplete.sequenceNumber()</div><div class="line">                    + <span class="stringliteral">&quot;. Flags &quot;</span> + regcomplete.flags() + <span class="stringliteral">&quot; &quot;</span>);</div><div class="line">        <span class="keywordflow">if</span> ((regcomplete.flags() &amp; LBM.MSG_UME_REGISTRATION_COMPLETE_EX_FLAG_QUORUM) != 0) {</div><div class="line">            System.Console.Out.Write(<span class="stringliteral">&quot;QUORUM &quot;</span>);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">if</span> ((regcomplete.flags() &amp; LBM.MSG_UME_REGISTRATION_COMPLETE_EX_FLAG_RXREQMAX) != 0) {</div><div class="line">            System.Console.Out.Write(<span class="stringliteral">&quot;RXREQMAX &quot;</span>);</div><div class="line">        }</div><div class="line">        System.Console.Out.WriteLine();</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> LBM.MSG_UME_REGISTRATION_CHANGE:</div><div class="line">        System.Console.Out.WriteLine(<span class="stringliteral">&quot;[&quot;</span> + msg.topicName() + <span class="stringliteral">&quot;][&quot;</span> + msg.source()</div><div class="line">                    + <span class="stringliteral">&quot;] UME registration change: &quot;</span> + msg.dataString());</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">    ...</div><div class="line"></div><div class="line">    <span class="keywordflow">default</span>:</div><div class="line">        System.Console.Out.WriteLine(<span class="stringliteral">&quot;Unknown lbm_msg_t type &quot;</span> + msg.type()</div><div class="line">                    + <span class="stringliteral">&quot; [&quot;</span> + msg.topicName() + <span class="stringliteral">&quot;][&quot;</span> + msg.source() + <span class="stringliteral">&quot;]&quot;</span>);</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><p><br />
 </p>
<h1><a class="anchor" id="recoverymanagement"></a>
Recovery Management&nbsp;&nbsp;<small><a href="#recoverymanagement">&lt;-</a></small></h1>
<p>Recovery management for failed and restarted receivers is fairly simple. UM requests any missed messages from the Store(s) and delivers them to the restarted receiver. However, your application can override that default behavior either by configuring a <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/config.tag:../Config/" href="../Config/grplatejoin.html#retransmitrequestmaximumreceiver">retransmit_request_maximum (receiver)</a> value, or by configuring a <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/config.tag:../Config/" href="../Config/grpultramessagingpersistence.html#umerecoverysequencenumberinfofunctionreceiver">ume_recovery_sequence_number_info_function (receiver)</a> application callback, or both.</p>
<p>For example, let's say a source sends 7 messages with sequence numbers 0-6 which are stabilized at the Store. A C-based receiver, configured with <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/config.tag:../Config/" href="../Config/grplatejoin.html#retransmitrequestmaximumreceiver">retransmit_request_maximum (receiver)</a> set to 2, and an application callback <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/config.tag:../Config/" href="../Config/grpultramessagingpersistence.html#umerecoverysequencenumberinfofunctionreceiver">ume_recovery_sequence_number_info_function (receiver)</a>, consumes (and acknowledges) message 0, goes down, then restarts right after message 6.</p>
<p>During receiver registration, the <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/lbm_8h.html#ac318ae4d0d80e5595ce572558102c7b5">lbm_ume_rcv_recovery_info_ex_func_t</a> application callback is called with the following values in the passed-in structure <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/lbm_8h.html#a864aeb7e5113d0d496950cf75ae3cda9">lbm_ume_rcv_recovery_info_ex_func_info_t</a>&#160;*info:</p>
<div class="fragment"><div class="line">info-&gt;high_sequence_number == 6</div><div class="line">info-&gt;low_rxreq_max_sequence_number == 4</div><div class="line">info-&gt;low_sequence_number == 1</div></div><!-- fragment --><p>Where: </p><ul>
<li>
<p class="startli"><a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/structlbm__ume__rcv__recovery__info__ex__func__info__t__stct.html#a6365dff87b32b8f4e6e7e985d01acb75">lbm_ume_rcv_recovery_info_ex_func_info_t::high_sequence_number</a> - the most recent message sent by the source,</p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/structlbm__ume__rcv__recovery__info__ex__func__info__t__stct.html#ab8e05918a9c715b8edbd1e834815eb10">lbm_ume_rcv_recovery_info_ex_func_info_t::low_rxreq_max_sequence_number</a> - high_sequence_number (above) minus the number configured for <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/config.tag:../Config/" href="../Config/grplatejoin.html#retransmitrequestmaximumreceiver">retransmit_request_maximum (receiver)</a> (2 in this example), and</p>
<p class="endli"></p>
</li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/structlbm__ume__rcv__recovery__info__ex__func__info__t__stct.html#a730df0455e0c47ec41434c5f0664e0be">lbm_ume_rcv_recovery_info_ex_func_info_t::low_sequence_number</a> - the first sequence number missed by the receiver after it went down. </li>
</ul>
<p>Normally, UM would start delivering messages at 1, but <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/config.tag:../Config/" href="../Config/grplatejoin.html#retransmitrequestmaximumreceiver">retransmit_request_maximum (receiver)</a> is set to 2, which overrides UM's normal behavior. So in this example, the first message delivered will be number 4.</p>
<p>Finally, the application can, at run-time, further override the starting sequence number. The callback function can modify the contents of the passed-in structure <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/lbm_8h.html#a864aeb7e5113d0d496950cf75ae3cda9">lbm_ume_rcv_recovery_info_ex_func_info_t</a>&#160;*info; specifically it can update the <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/structlbm__ume__rcv__recovery__info__ex__func__info__t__stct.html#a730df0455e0c47ec41434c5f0664e0be">lbm_ume_rcv_recovery_info_ex_func_info_t::low_sequence_number</a> field. When the callback returns, UM examines that field to see if it was modified by the callback. If so, UM overrides the effect of <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/config.tag:../Config/" href="../Config/grplatejoin.html#retransmitrequestmaximumreceiver">retransmit_request_maximum (receiver)</a> and starts at the requested sequence number.</p>
<p>Notice that this design does not allow the callback to override the effect of <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/config.tag:../Config/" href="../Config/grplatejoin.html#retransmitrequestmaximumreceiver">retransmit_request_maximum (receiver)</a> by setting the <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/structlbm__ume__rcv__recovery__info__ex__func__info__t__stct.html#a730df0455e0c47ec41434c5f0664e0be">lbm_ume_rcv_recovery_info_ex_func_info_t::low_sequence_number</a> field to its original value, 1 in this example. Upon return, UM will see the value unchanged, and will allow <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/config.tag:../Config/" href="../Config/grplatejoin.html#retransmitrequestmaximumreceiver">retransmit_request_maximum (receiver)</a> to override the starting sequence number. This is only an issue if <em>both</em> <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/config.tag:../Config/" href="../Config/grplatejoin.html#retransmitrequestmaximumreceiver">retransmit_request_maximum (receiver)</a> and <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/config.tag:../Config/" href="../Config/grpultramessagingpersistence.html#umerecoverysequencenumberinfofunctionreceiver">ume_recovery_sequence_number_info_function (receiver)</a> are used. If the application wants to use the sequence number remembered by the Store, it should not configure <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/config.tag:../Config/" href="../Config/grplatejoin.html#retransmitrequestmaximumreceiver">retransmit_request_maximum (receiver)</a>.</p>
<p><br />
 </p>
<h1><a class="anchor" id="duplicatmessagedelivery"></a>
Duplicate Message Delivery&nbsp;&nbsp;<small><a href="#duplicatmessagedelivery">&lt;-</a></small></h1>
<p>In a distributed system, it is not possible to <em>guarantee</em> "once-and-only-once" delivery of messages in the face of unpredictable system or component failure. Regardless of the algorithms and handshaking, there is always the possibility of messages sent that are never received, as well as messages received and then received again if the receiving application fails and restarts.</p>
<p>UM's persistence design is based on the principle of being close to once-and-only-once, but when that is not possible, UM prefers to fail on the side of duplicate message delivery. Due to other design goals (low latency and high throughput), the possibility of receiving duplicate messages is significant after an application failure and restart.</p>
<p>It is therefore important for persistent applications to be designed to tolerate duplicate message reception, either by making message processing idempotent, or by including logic in the receiving application to detect duplicates and only process the messages which have not been previously processed.</p>
<p>To assist the application in implementing "de-duplication", all messages retransmitted to a receiver are marked as retransmissions via a flag in the message structure. Thus it is easy for an application to determine if a message is a new "live" message from the source, or a retransmission, which may or may not have been processed before the failure. The presence or absence of the retransmit flag gives the application a hint of how best to handle the message with regard to it being processed previously or not.</p>
<p>Informatica recommends that you always check the data or other message properties of messages with the retransmit flag set to be sure the message has not been already processed. Relying on UM sequence numbers is not a 100% reliable method for detecting duplicate messages.</p>
<p><br />
 </p>
<h1><a class="anchor" id="settingcallbackfunctiontosetrecoverysequencenumber"></a>
Setting Callback Function to Set Recovery Sequence Number&nbsp;&nbsp;<small><a href="#settingcallbackfunctiontosetrecoverysequencenumber">&lt;-</a></small></h1>
<p>Whereas the UM persistence design attempts to choose the correct starting sequence number for a recovering receiver, there are cases where the application wishes to override UM's choice.</p>
<p>The sample code below demonstrates how to use the recovery sequence number info function to determine the stored message with which to restart a receiver. This example retrieves the low sequence number from the recovery sequence number structure and adds an offset to determine the beginning sequence number. The offset is a value completely under the control of your application. For example, if a receiver was down for a "long" period and you only want the receiver to receive the last 10 messages, use an offset to start the receiver with the 10th most recent message. If you wish not to receive any messages, set the <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/structlbm__ume__rcv__recovery__info__ex__func__info__t__stct.html#a730df0455e0c47ec41434c5f0664e0be">lbm_ume_rcv_recovery_info_ex_func_info_t::low_sequence_number</a> to the <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/structlbm__ume__rcv__recovery__info__ex__func__info__t__stct.html#a6365dff87b32b8f4e6e7e985d01acb75">lbm_ume_rcv_recovery_info_ex_func_info_t::high_sequence_number</a> plus one.</p>
<p><b>C API</b></p>
<div class="fragment"><div class="line"><a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/structlbm__ume__rcv__recovery__info__ex__func__t__stct.html">lbm_ume_rcv_recovery_info_ex_func_t</a> cb;</div><div class="line"></div><div class="line">cb.<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/structlbm__ume__rcv__recovery__info__ex__func__t__stct.html#ad6abe69851bb49323a0d3d98eff773f6">func</a> = ume_rcv_seqnum_ex;  <span class="comment">/* declared below */</span></div><div class="line">cb.<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/structlbm__ume__rcv__recovery__info__ex__func__t__stct.html#a986ce6809286b4abd6c1f81b80ecd287">clientd</a> = NULL;</div><div class="line"><span class="keywordflow">if</span> (<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/lbm_8h.html#a1afc75f0fb3601d072b3463e7acf16a6">lbm_rcv_topic_attr_setopt</a>(&amp;rcv_attr,</div><div class="line">                              <span class="stringliteral">&quot;ume_recovery_sequence_number_info_function&quot;</span>,</div><div class="line">                              &amp;cb, <span class="keyword">sizeof</span>(cb)) == LBM_FAILURE) {</div><div class="line">    fprintf(stderr,</div><div class="line">        <span class="stringliteral">&quot;lbm_rcv_topic_attr_setopt:ume_recovery_sequence_number_info_function: %s\n&quot;</span>,</div><div class="line">        <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/lbm_8h.html#a22a4650d3a5b649c84a0c05adedcc055">lbm_errmsg</a>());</div><div class="line">    exit(1);</div><div class="line">}</div><div class="line">printf(<span class="stringliteral">&quot;Will use seqnum info with low offset %u.\n&quot;</span>, seqnum_offset);</div><div class="line"></div><div class="line">...</div><div class="line"></div><div class="line">int ume_rcv_seqnum_ex(<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/structlbm__ume__rcv__recovery__info__ex__func__info__t__stct.html">lbm_ume_rcv_recovery_info_ex_func_info_t</a> *info, <span class="keywordtype">void</span> *clientd)</div><div class="line">{</div><div class="line">    <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/lbm_8h.html#abdb96b55cc467a75e1f9ec0036dbc14b">lbm_uint_t</a> new_lo = info-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/structlbm__ume__rcv__recovery__info__ex__func__info__t__stct.html#a730df0455e0c47ec41434c5f0664e0be">low_sequence_number</a> + seqnum_offset;</div><div class="line"></div><div class="line">    printf(<span class="stringliteral">&quot;[%s] SQNs Low %x (will set to %x), Low rxreqmax %x, High %x (CD %p)\n&quot;</span>,</div><div class="line">        info-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/structlbm__ume__rcv__recovery__info__ex__func__info__t__stct.html#a108647bced4b79cf953ef1ad32649bc6">source</a>, info-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/structlbm__ume__rcv__recovery__info__ex__func__info__t__stct.html#a730df0455e0c47ec41434c5f0664e0be">low_sequence_number</a>,</div><div class="line">        new_lo, info-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/structlbm__ume__rcv__recovery__info__ex__func__info__t__stct.html#ab8e05918a9c715b8edbd1e834815eb10">low_rxreq_max_sequence_number</a>,</div><div class="line">        info-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/structlbm__ume__rcv__recovery__info__ex__func__info__t__stct.html#a6365dff87b32b8f4e6e7e985d01acb75">high_sequence_number</a>, info-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/structlbm__ume__rcv__recovery__info__ex__func__info__t__stct.html#a4a3feac0d75b46b6b18f1cc218432109">source_clientd</a>);</div><div class="line">    info-&gt;<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/structlbm__ume__rcv__recovery__info__ex__func__info__t__stct.html#a730df0455e0c47ec41434c5f0664e0be">low_sequence_number</a> = new_lo;</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><p><b>JAVA API</b></p>
<div class="fragment"><div class="line">UMERcvRecInfo umerecinfocb = <span class="keyword">new</span> UMERcvRecInfo(seqnum_offset);</div><div class="line">rcv_attr.setRecoverySequenceNumberCallback(umerecinfocb, null);</div><div class="line">System.out.println(<span class="stringliteral">&quot;Will use seqnum info with low offset &quot;</span> + seqnum_offset);</div><div class="line"></div><div class="line"><span class="keyword">class </span>UMERcvRecInfo <span class="keyword">implements</span> UMERecoverySequenceNumberCallback {</div><div class="line">    <span class="keyword">private</span> <span class="keywordtype">long</span> _seqnum_offset = 0;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> UMERcvRecInfo(<span class="keywordtype">long</span> seqnum_offset) {</div><div class="line">        _seqnum_offset = seqnum_offset;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keywordtype">int</span> setRecoverySequenceNumberInfo(Object cbArg,</div><div class="line">    UMERecoverySequenceNumberCallbackInfo cbInfo)</div><div class="line">    {</div><div class="line">        <span class="keywordtype">long</span> new_low = cbInfo.lowSequenceNumber() + _seqnum_offset;</div><div class="line">        System.out.println(<span class="stringliteral">&quot;SQNs Low &quot;</span> + cbInfo.lowSequenceNumber() + <span class="stringliteral">&quot; (will set to &quot;</span></div><div class="line">            + new_low + <span class="stringliteral">&quot;), Low rxreqmax &quot;</span> + cbInfo.lowRxReqMaxSequenceNumber()</div><div class="line">            + <span class="stringliteral">&quot;, High &quot;</span> + cbInfo.highSequenceNumber());</div><div class="line">        <span class="keywordflow">try</span> {</div><div class="line">            cbInfo.setLowSequenceNumber(new_low);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">catch</span> (LBMEInvalException e) {</div><div class="line">            System.err.println(e.getMessage());</div><div class="line">        }</div><div class="line">        <span class="keywordflow">return</span> 0;</div><div class="line">     }</div><div class="line"> }</div></div><!-- fragment --><p><b>.NET API</b></p>
<div class="fragment"><div class="line">UMERcvRecInfo umerecinfocb = <span class="keyword">new</span> UMERcvRecInfo(seqnum_offset);</div><div class="line">rcv_attr.setRecoverySequenceNumberCallback(umerecinfocb, null);</div><div class="line">System.Console.Out.WriteLine(<span class="stringliteral">&quot;Will use seqnum info with low offset &quot;</span> + seqnum_offset);</div><div class="line"></div><div class="line"><span class="keyword">class </span>UMERcvRecInfo <span class="keyword">implements</span> UMERecoverySequenceNumberCallback {</div><div class="line">    <span class="keyword">private</span> <span class="keywordtype">long</span> _seqnum_offset = 0;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> UMERcvRecInfo(<span class="keywordtype">long</span> seqnum_offset) {</div><div class="line">        _seqnum_offset = seqnum_offset;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keywordtype">int</span> setRecoverySequenceNumberInfo(Object cbArg,</div><div class="line">        UMERecoverySequenceNumberCallbackInfo cbInfo)</div><div class="line">    {</div><div class="line">        <span class="keywordtype">long</span> new_low = cbInfo.lowSequenceNumber() + _seqnum_offset;</div><div class="line">        System.Console.Out.WriteLine (<span class="stringliteral">&quot;SQNs Low &quot;</span> + cbInfo.lowSequenceNumber() + <span class="stringliteral">&quot; (will set to &quot;</span></div><div class="line">            + new_low + <span class="stringliteral">&quot;), Low rxreqmax &quot;</span> + cbInfo.lowRxReqMaxSequenceNumber()</div><div class="line">            + <span class="stringliteral">&quot;, High &quot;</span> + cbInfo.highSequenceNumber());</div><div class="line">        <span class="keywordflow">try</span> {</div><div class="line">            cbInfo.setLowSequenceNumber(new_low);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">catch</span> (LBMEInvalException e) {</div><div class="line">            System.Console.Out.WriteLine (e.getMessage());</div><div class="line">        }</div><div class="line">        <span class="keywordflow">return</span> 0;</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><p><a class="anchor" id="immediatemessageconsumption"></a><a class="anchor" id="delayedmessageprocessing"></a><a class="anchor" id="batchingacknowledgments"></a><br />
 </p>
<h1><a class="anchor" id="persistencemessageconsumption"></a>
Persistence Message Consumption&nbsp;&nbsp;<small><a href="#persistencemessageconsumption">&lt;-</a></small></h1>
<p>When a persistent subscriber application has finished processing a received message, it must signal consumption of the message to UM. This is how UM keeps track of where message recovery should begin if recovery is needed (e.g. if the receiver restarts).</p>
<p>There are three basic methods to signaling message consumption that the application must choose between: </p><ul>
<li>
The subscriber's receiver callback returns to UM, allowing UM to delete the message. The message deletion signals consumption. This is generally the most simple case. </li>
<li>
The subscriber retains the message past the point of the receiver callback returning. Then some other application function (typically running in a separate thread) finishes the processing and deletes the message. The message deletion signals consumption. </li>
<li>
The subscriber calls a separate "explicit ACK" API which signals message consumption. In this case, the act of deleting the message does not signal consumption. </li>
</ul>
<p>When the application uses one of those methods to signal consumption, it is informing the local instance of UM running within the application. As a separate step, UM must send a consumption acknowledgement (ACK) to the Persistent Store(s). However, the two steps are not necessarily directly linked.</p>
<p>There are two configurable acknowledgement methods that UM can follow when the application signals consumption: </p><ul>
<li>
UM batches ACKs based on a configurable time period. I.e. UM will delay sending ACKs to the Store so that multiple messages can be acknowledged at once, when its timer expires. </li>
<li>
UM immediately sends an ACK to the Store. </li>
</ul>
<p>Batching of ACKs greatly improves the throughput of a persistent receiver, and can also improve latency. It is the default configuration.</p>
<p>However, batching has the disadvantage that if message recovery is needed (e.g. if the subscriber restarts), it increases the chances that already processed messages will be re-sent during recovery ("duplicate messages"). Any messages that the application signaled consumed, but which UM has not yet acknowledged to the Store, can be re-sent during recovery.</p>
<p>Note that even with immediate ACK, there is still the possibility of one or more already-consumed messages being recovered; applications need to be able to handle this. See <a class="el" href="designingpersistentreceivers.html#duplicatmessagedelivery">Duplicate Message Delivery</a> for more information.</p>
<p><b>Use Cases</b></p>
<p>There are four common use cases which combine an application consumption method with a UM acknowledgement method: </p><ul>
<li>
<a class="el" href="designingpersistentreceivers.html#deleteonreturnbatchacks">Delete on Return, Batch ACKs</a>, most common. </li>
<li>
<a class="el" href="designingpersistentreceivers.html#retainonreturnbatchacks">Retain on Return, Batch ACKs</a>, also common. </li>
<li>
<a class="el" href="designingpersistentreceivers.html#explicitacknowledgments">Explicit Acknowledgments</a>. </li>
<li>
<a class="el" href="designingpersistentreceivers.html#ackimmediatelyondelete">ACK Immediately on Delete</a>. </li>
</ul>
<p><br />
 </p>
<h2><a class="anchor" id="deleteonreturnbatchacks"></a>
Delete on Return, Batch ACKs&nbsp;&nbsp;<small><a href="#deleteonreturnbatchacks">&lt;-</a></small></h2>
<p>The application receiver callback completes all processing of a message before returning. It allows UM to delete the message on return, which signals consumption.</p>
<p>To maximize efficiency, the application allows UM to batch ACKs to the Store.</p>
<p>Note that in this use case, messages are always signaled consumed in the same order in which they are received.</p>
<p>For this use case, use the configuration: </p><ul>
<li>
<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/config.tag:../Config/" href="../Config/grpultramessagingpersistence.html#umeuseackbatchingreceiver">ume_use_ack_batching (receiver)</a> - set to <b>1</b> (the default). </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/config.tag:../Config/" href="../Config/grpultramessagingpersistence.html#umeexplicitackonlyreceiver">ume_explicit_ack_only (receiver)</a> - set to <b>0</b> (the default). </li>
</ul>
<p>The subscriber code is written to signal message consumption on return from the receiver callback. This is handled differently between the C API vs. the Java and .NET APIs.</p>
<p><b>C API</b></p>
<p>The default behavior for a C application receiver callback is for the message to be deleted and when the receiver callback returns, which signals consumption the message. No special coding is needed for this use case.</p>
<p>Note: the receiver callback must <em>not</em> call <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/lbm_8h.html#aa5fc1eb324a55b8c800c31460b0f0116">lbm_msg_delete()</a>.</p>
<p><b>Java and .NET</b></p>
<p>With Java and .NET, the application receiver callback must explicitly call <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/javaapi.tag:../JavaAPI/" href="../JavaAPI/classcom_1_1latencybusters_1_1lbm_1_1LBMMessage.html#a963d0f07751ed176a97f3eff84740fb9">com::latencybusters::lbm::LBMMessage::dispose()</a> prior to returning.</p>
<p>(Note that this is not strictly true for .NET. A .NET program can skip calling "dispose()" and allow the message to become garbage. This will introduce significant latency outliers when GC runs, and also makes acknowledgements to the Store non-deterministic. Finally, in the future, performance improvements for .NET will probably require the use of "dispose()". Informatica recommends that .NET programs call "dispose()" for every message.)</p>
<p><br />
 </p>
<h2><a class="anchor" id="retainonreturnbatchacks"></a>
Retain on Return, Batch ACKs&nbsp;&nbsp;<small><a href="#retainonreturnbatchacks">&lt;-</a></small></h2>
<p>There are application designs where a received message cannot be fully processed inside the receiver application callback. For example, the message might need to be handed off to a worker thread for longer-term processing. Or the acknowledgement must be delayed until some asynchronous event happens, like a handshake with another application.</p>
<p>To maximize efficiency, applications allow UM to batch ACKs to the Store.</p>
<p>Note that some applications are written to process these handed-off messages in parallel, and messages might be signaled consumed in a different order than they arrived. In this use case, out-of-order consumption is supported. See <a class="el" href="designingpersistentreceivers.html#ackordering">ACK Ordering</a> for more information.</p>
<p>For this use case, use the configuration: </p><ul>
<li>
<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/config.tag:../Config/" href="../Config/grpultramessagingpersistence.html#umeuseackbatchingreceiver">ume_use_ack_batching (receiver)</a> - set to <b>1</b> (the default). </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/config.tag:../Config/" href="../Config/grpultramessagingpersistence.html#umeexplicitackonlyreceiver">ume_explicit_ack_only (receiver)</a> - set to <b>0</b> (the default). </li>
</ul>
<p>Note that this is the same configuration as <a class="el" href="designingpersistentreceivers.html#deleteonreturnbatchacks">Delete on Return, Batch ACKs</a>.</p>
<p>The subscriber code should be written to hand off the message to another part of the application and suppress deleting the message on return from the receiver callback. This is handled differently between the C API vs. the Java and .NET APIs.</p>
<p><b>C API</b></p>
<p>In C, the application's receiver callback function must call the <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/lbm_8h.html#a2b7788ff58f9e78bc89ea890dad0cccf">lbm_msg_retain()</a> API for the received message prior to handing off the message for processing. This suppresses the automatic deletion of the received message when the receiver callback returns, and allows the message buffer to be passed to some other part of the application for processing and deletion at a later time.</p>
<p>When the application subsequently completes all processing of the message, it signals consumption by calling <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/lbm_8h.html#aa5fc1eb324a55b8c800c31460b0f0116">lbm_msg_delete()</a>.</p>
<p><b>Java and .NET</b></p>
<p>In Java and .NET, the application should call the <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/javaapi.tag:../JavaAPI/" href="../JavaAPI/classcom_1_1latencybusters_1_1lbm_1_1LBMMessage.html#a2cda69ee0b33fe294d46761401e451ca">com::latencybusters::lbm::LBMMessage::promote()</a> API prior to handing the message for a separate processing. This allows the message object to be passed to some other part of the application for processing and disposal at a later time.</p>
<p>When the application subsequently completes all processing of the message, it signals consumption by calling <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/javaapi.tag:../JavaAPI/" href="../JavaAPI/classcom_1_1latencybusters_1_1lbm_1_1LBMMessage.html#a963d0f07751ed176a97f3eff84740fb9">com::latencybusters::lbm::LBMMessage::dispose()</a>.</p>
<p><br />
 </p>
<h2><a class="anchor" id="explicitacknowledgments"></a>
Explicit Acknowledgments&nbsp;&nbsp;<small><a href="#explicitacknowledgments">&lt;-</a></small></h2>
<p>The <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/config.tag:../Config/" href="../Config/grpultramessagingpersistence.html#umeuseackbatchingreceiver">ACK batching feature</a> did not exist in UM in versions prior to 5.0. In those early versions, the application had to use the <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/config.tag:../Config/" href="../Config/grpultramessagingpersistence.html#umeexplicitackonlyreceiver">Explicit ACK feature</a> to benefit from the increased throughput allowed by batching of ACKs. Informatica will continue to support Explicit ACKs, even though we generally recommend the ACK batching use cases <a class="el" href="designingpersistentreceivers.html#deleteonreturnbatchacks">Delete on Return, Batch ACKs</a> or <a class="el" href="designingpersistentreceivers.html#retainonreturnbatchacks">Retain on Return, Batch ACKs</a>.</p>
<p>With explicit ACKs, message consumption is separated from message deletion. The application uses a separate API to trigger an acknowledgement to the Store. Batching is achieved under application control by not ACKing every message. With explicit ACKs, the action of acknowledging a message to the Store implicitly acknowledges all previous unacknowledged messages.</p>
<dl class="section warning"><dt>Warning</dt><dd>Because explicit ACKs implicitly acknowledge all previous unacknowledged messages, it is not valid to acknowledge messages out of order. Otherwise the application risks not recovering needed messages. See <a class="el" href="designingpersistentreceivers.html#ackordering">ACK Ordering</a>.</dd></dl>
<p>For this use case, use the configuration: </p><ul>
<li>
<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/config.tag:../Config/" href="../Config/grpultramessagingpersistence.html#umeuseackbatchingreceiver">ume_use_ack_batching (receiver)</a> - set to <b>0</b>. </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/config.tag:../Config/" href="../Config/grpultramessagingpersistence.html#umeexplicitackonlyreceiver">ume_explicit_ack_only (receiver)</a> - set to <b>1</b>. </li>
</ul>
<p>The subscriber should be written the same as <a class="el" href="designingpersistentreceivers.html#deleteonreturnbatchacks">Delete on Return, Batch ACKs</a> (if processing is completed in the receiver callback) or <a class="el" href="designingpersistentreceivers.html#retainonreturnbatchacks">Retain on Return, Batch ACKs</a> (if the message is retained after the receiver callback returns). The same coding rules apply regarding message retention and disposal.</p>
<p>However, as an additional step, the application must call the explicit ACK API: </p><ul>
<li>
C: <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/lbm_8h.html#ad920e7ab51a45099390091dd36d26a34">lbm_msg_ume_send_explicit_ack()</a> </li>
<li>
Java/.NET: <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/javaapi.tag:../JavaAPI/" href="../JavaAPI/classcom_1_1latencybusters_1_1lbm_1_1LBMMessage.html#ac367c5298b0db98072b89d4572069db0">com::latencybusters::lbm::LBMMessage.sendExplicitAck()</a> </li>
</ul>
<p>This is typically done inside of a timer callback, which provides batching behavior.</p>
<p><br />
 </p>
<h2><a class="anchor" id="ackimmediatelyondelete"></a>
ACK Immediately on Delete&nbsp;&nbsp;<small><a href="#ackimmediatelyondelete">&lt;-</a></small></h2>
<p>With this use case, the application directs UM to send an acknowledgement to the Store for each and every processed message immediately after the message is deleted.</p>
<p>The advantage of this use case is that it minimizes the chances that already processed messages will be re-sent during recovery (i.e. "duplicate messages"). However, there is still the possibility of one or more duplicate messages during recovery, so applications need to be able to handle this. See <a class="el" href="designingpersistentreceivers.html#duplicatmessagedelivery">Duplicate Message Delivery</a> for more information.</p>
<p>A disadvantage of this use case is that the maximum sustainable throughput (message rate) is limited by the per-message overhead of sending acknowledgements.</p>
<p>Another disadvantage is that messages must be deleted in the same order as they were received, even if the messages are handed off to another thread for processing. See <a class="el" href="designingpersistentreceivers.html#ackordering">ACK Ordering</a>.</p>
<p>Informatica's general recommendation is that since the application needs to handle duplicate messages even with immediate acknowledgement, the user should implement a use case that includes ACK batching.</p>
<p>For this use case, use the configuration: </p><ul>
<li>
<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/config.tag:../Config/" href="../Config/grpultramessagingpersistence.html#umeuseackbatchingreceiver">ume_use_ack_batching (receiver)</a> - set to <b>0</b>. </li>
<li>
<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/config.tag:../Config/" href="../Config/grpultramessagingpersistence.html#umeexplicitackonlyreceiver">ume_explicit_ack_only (receiver)</a> - set to <b>0</b> (the default). </li>
</ul>
<p>The subscriber should be written the same as <a class="el" href="designingpersistentreceivers.html#deleteonreturnbatchacks">Delete on Return, Batch ACKs</a> (if processing is completed in the receiver callback) or <a class="el" href="designingpersistentreceivers.html#retainonreturnbatchacks">Retain on Return, Batch ACKs</a> (if the message is retained after the receiver callback returns). The same coding rules apply regarding message retention and disposal.</p>
<p><br />
 </p>
<h1><a class="anchor" id="ackordering"></a>
ACK Ordering&nbsp;&nbsp;<small><a href="#ackordering">&lt;-</a></small></h1>
<p>When UM is allowed to batch ACKs to the Store using <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/config.tag:../Config/" href="../Config/grpultramessagingpersistence.html#umeuseackbatchingreceiver">ume_use_ack_batching (receiver)</a>, the UM client library supports "out of order" signaling that the application is done processing messages. For example, the application might retain received messages 1, 2, and 3 for asynchronous processing, and then delete them in the order 2, 1, 3.</p>
<p>However, be aware that the Persistent Store does not support "out of order" acknowledgement of messages. If the Store receives an acknowledgement of sequence number N, that implicitly acknowledges all sequence numbers less than N.</p>
<p>The UM client library handles this by withholding acknowledgement to the Store all messages for which an earlier message is not signaled complete. For example, if the application retains messages 1, 2, and 3, and subsequently deletes message 2, UM will not send an ACK to the Store for message 2. If the application then deletes message 1, UM is now able to send an ACK for message 2, which will implicitly acknowledge message 1 as well.</p>
<p>However, this ability to process messages out of order is dependent on using ACK batching (i.e. <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/config.tag:../Config/" href="../Config/grpultramessagingpersistence.html#umeuseackbatchingreceiver">ume_use_ack_batching (receiver)</a> is <b>1</b>). If ACK batching is disabled, then the application is responsible for ordering acknowledgements to the Store. This is true for both the <a class="el" href="designingpersistentreceivers.html#explicitacknowledgments">Explicit Acknowledgments</a> and <a class="el" href="designingpersistentreceivers.html#ackimmediatelyondelete">ACK Immediately on Delete</a> use cases.</p>
<p>For example, suppose that the <a class="el" href="designingpersistentreceivers.html#ackimmediatelyondelete">ACK Immediately on Delete</a> use case is being used. If the application processes and deletes messages in the order 2, 1, 3, the ACK for message 2 will implicitly ACK message 1 to the Store. If the application crashes after ACKing 2 and restarts, recovery will start with message 3. Thus, message 1 is never fully processed.</p>
<p>If ACK batching is disabled, the messages must be deleted in order: 1, 2, 3.</p>
<p><br />
 </p>
<h1><a class="anchor" id="objectfreeexplicitacknowledgments"></a>
Object-free Explicit Acknowledgments&nbsp;&nbsp;<small><a href="#objectfreeexplicitacknowledgments">&lt;-</a></small></h1>
<p>When using explicit ACKs, you can extract ACK information from messages. This allows the received message buffer to be deleted when the receiver callback is done, while still allowing the application to save the ACK structure for persistent acknowledgement to the Store at a future time. This can improve receiver performance when used with the <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/design.tag:../Design/" href="../Design/advancedoptimizations.html#receivebufferrecycling">Receive Buffer Recycling</a> feature to reduce the per-message use of dynamic memory (malloc/free) with a persistent receiver. Extracting ACKs can also additionally improve performance of Java and .NET applications by allowing the use of <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/design.tag:../Design/" href="../Design/advancedoptimizations.html#zeroobjectdelivery">Zero Object Delivery</a>.</p>
<p>The following source code examples show how to extract ACK information and send an explicit ACK.</p>
<p><b>C API</b></p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> rcv_handle_msg(<a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/lbm_8h.html#a0a4af6b8247cc5a0a24a8578fb6e83bd">lbm_rcv_t</a> *rcv, <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/structlbm__msg__t__stct.html">lbm_msg_t</a> *msg, <span class="keywordtype">void</span> *clientd)</div><div class="line">{</div><div class="line">  <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/lbm_8h.html#a40d24279afe3a87f1660fbb0086a4def">lbm_ume_rcv_ack_t</a> *ack = NULL;</div><div class="line">...</div><div class="line"></div><div class="line">  ack = <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/lbm_8h.html#ae1b7ca376c99fcbbe6175ad3441b7aeb">lbm_msg_extract_ume_ack</a>(msg);</div><div class="line">  defer_ack(ack);  <span class="comment">/* Pass the &quot;ack&quot; to another thread or work queue. */</span></div><div class="line">...</div><div class="line">  <span class="keywordflow">return</span> 0;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> worker()</div><div class="line">{</div><div class="line">  <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/lbm_8h.html#a40d24279afe3a87f1660fbb0086a4def">lbm_ume_rcv_ack_t</a> *ack = NULL;</div><div class="line">...</div><div class="line">  ack = get_deferred_ack();  <span class="comment">/* Get &quot;ack&quot; that was saved above. */</span></div><div class="line"></div><div class="line">  <span class="comment">/* Some applications improve throughput by not ACKing every message. */</span></div><div class="line">  <span class="keywordflow">if</span> (ack_this_message) {</div><div class="line">    <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/lbm_8h.html#a2b5aa9394b4911eb8e39768a57d5b49e">lbm_ume_ack_send_explicit_ack</a>(ack, msg-&gt;sequence_number);</div><div class="line">  }</div><div class="line"></div><div class="line">  <a class="codeRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.17_RC3/doc/UME/api.tag:../API/" href="../API/lbm_8h.html#a5c2b4c56240b15dadd9a251989c3180f">lbm_ume_ack_delete</a>(ack);  <span class="comment">/* Extracted ack *must* be deleted. */</span></div><div class="line">...</div><div class="line"></div><div class="line">}</div></div><!-- fragment --><p><b>JAVA API or .NET API</b></p>
<div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keywordtype">int</span> onReceive(Object cbArg, LBMMessage msg)</div><div class="line">{</div><div class="line">  UMEMessageAck ack;</div><div class="line">...</div><div class="line"></div><div class="line">  ack = msg.extractUMEAck();</div><div class="line">  defer_ack(ack);  <span class="comment">/* Pass the &quot;ack&quot; to another thread or work queue. */</span></div><div class="line">...</div><div class="line">  <span class="keywordflow">return</span> 0;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> worker()</div><div class="line">{</div><div class="line">  UMEMessageAck ack;</div><div class="line"></div><div class="line">  ack = get_deferred_ack();  <span class="comment">/* Get &quot;ack&quot; that was saved above. */</span></div><div class="line"></div><div class="line">  <span class="comment">/* Some applications improve throughput by not ACKing every message. */</span></div><div class="line">  <span class="keywordflow">if</span> (ack_this_message) {</div><div class="line">    ack.sendExplicitAck(msg.sequenceNumber());</div><div class="line">  }</div><div class="line">  ack.dispose();  <span class="comment">/* Extracted ack *must* be deleted. */</span></div><div class="line">}</div></div><!-- fragment --><p><br />
<br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
 <br />
</p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
</body>
</html>
