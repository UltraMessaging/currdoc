<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>UM C API: C Structure Usage Patterns</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen_api.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">UM C API
   &#160;<span id="projectnumber">6.13.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('cstructureusagepatterns.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">C Structure Usage Patterns </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>As with most rich C APIs, data structures are used extensively to maintain state information and to pass information into and out of the API.</p>
<p>UM uses two general coding conventions related to data structures: </p><ul>
<li>
<a class="el" href="cstructureusagepatterns.html#umobjecthandlespointers">UM Object Handles (Pointers)</a> </li>
<li>
<a class="el" href="cstructureusagepatterns.html#applicationvisibleumstructures">Application-Visible UM Structures</a> </li>
</ul>
<p><br />
 </p>
<h1><a class="anchor" id="umobjecthandlespointers"></a>
UM Object Handles (Pointers)</h1>
<p>A UM object (<a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/API/design.tag:../Design/" href="../Design/umobjects.html#contextobject">context</a>, <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/API/design.tag:../Design/" href="../Design/umobjects.html#sourceobject">source</a>, <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/API/design.tag:../Design/" href="../Design/umobjects.html#receiverobject">receiver</a>, etc) is represented as a pointer to an internal UM structure. The structure is "opaque"; that is the fields of which are not available to the application.</p>
<div class="fragment"><div class="line"><a class="code" href="lbm_8h.html#a9f6ec97839a8f264eb4059de01174f3c">lbm_context_t</a> *ctx_object; <span class="comment">/* Handle (pointer) to context object. */</span></div></div><!-- fragment --><p>To create an object, you call the appropriate API, passing it a pointer to an object handle (pointer variable). For example:</p>
<div class="fragment"><div class="line">err = <a class="code" href="lbm_8h.html#a8058947690bd0995bc2c59d4a61b462f">lbm_context_create</a>(&amp;ctx_object, ...);</div></div><!-- fragment --><p>The "&amp;ctx_object" indicates that it is an output parameter to the API. The <a class="el" href="lbm_8h.html#a8058947690bd0995bc2c59d4a61b462f" title="Create and initialize an lbm_context_t object. ">lbm_context_create()</a> API will allocate the internal structure for the object and put the address into the "ctx_object" variable.</p>
<p>In other (not-create) APIs that take an object, you don't pass it a pointer to the variable, you just pass the variable itself. For example:</p>
<div class="fragment"><div class="line">err = <a class="code" href="lbm_8h.html#a962bfceb336c65191ba08497ac70602b">lbm_context_delete</a>(ctx_object);</div></div><!-- fragment --><p>Note that at no time does the application allocate space for the object data structures. UM allocates and owns the memory. Typically the application is responsible to call an object deletion function (the <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/API/design.tag:../Design/" href="../Design/umobjects.html#topicobject">Topic Object</a> is an exception to this).</p>
<p><br />
 </p>
<h1><a class="anchor" id="applicationvisibleumstructures"></a>
Application-Visible UM Structures</h1>
<p>There are many data structures defined in the UM header files (<a class="el" href="lbm_8h.html" title="Ultra Messaging (UM) Core API. The &quot;lbm.h&quot; header file defines the main APIs to use Ultra Messaging...">lbm.h</a>, <a class="el" href="lbmaux_8h.html" title="Ultra Messaging (UM) Auxiliary Functions API. ">lbmaux.h</a>, <a class="el" href="lbmmon_8h.html" title="Ultra Messaging (UM) Monitoring API. ">lbmmon.h</a>, ... see <a href="files.html">File List</a> for the full list). These structures are used either to pass data into UM, or to return data back to the application.</p>
<p>There are two general use cases by which application-visible structures are passed between UM and the application: </p><ul>
<li>
<a class="el" href="cstructureusagepatterns.html#applicationcallingumapi">Application Calling UM API</a> </li>
<li>
<a class="el" href="cstructureusagepatterns.html#umcallingapplicationcallback">UM Calling Application Callback</a> </li>
</ul>
<p><br />
 </p>
<h1><a class="anchor" id="applicationcallingumapi"></a>
Application Calling UM API</h1>
<p>In these cases, the application generally declares a structure in its memory, and passes the address to a UM API. UM will access the structure (either reading it or writing to it). When the API returns, UM does not maintain a reference to the passed-in structure, so the application is free to re-use or deallocate the space.</p>
<p>For example, if sending a message with message properties: </p><div class="fragment"><div class="line"><a class="code" href="structlbm__src__send__ex__info__t__stct.html">lbm_src_send_ex_info_t</a> ex_info;</div><div class="line">...</div><div class="line">memset(&amp;ex_info, 0, <span class="keyword">sizeof</span>(ex_info));</div><div class="line">ex_info.<a class="code" href="structlbm__src__send__ex__info__t__stct.html#aa450a079510ebdc97b19625d10bd18ea">flags</a> = <a class="code" href="lbm_8h.html#a169eb19b58d383875b718117b2def6e5">LBM_SRC_SEND_EX_FLAG_PROPERTIES</a>;</div><div class="line">ex_info.<a class="code" href="structlbm__src__send__ex__info__t__stct.html#a69ae228b9501f0466bfec8da2a479cbf">properties</a> = prop_obj;</div><div class="line"></div><div class="line">err = <a class="code" href="lbm_8h.html#a091b5806bf18d10ebd0d9117e0c70229">lbm_src_send_ex</a>(src, my_buffer, my_len, <a class="code" href="lbm_8h.html#aff5c45a7f7b65c5bde5988165b89fbd2">LBM_MSG_FLUSH</a>, &amp;ex_info);</div></div><!-- fragment --><p>When <a class="el" href="lbm_8h.html#a091b5806bf18d10ebd0d9117e0c70229" title="Extended send of a message to the topic associated with a UM source. ">lbm_src_send_ex()</a> returns, UM has copied the contents of ex_info and prop_obj. UM does not maintain a reference to the passed-in structures, so the application is free to re-use or deallocate the space.</p>
<p>There are a few general use cases of data structure passing when calling UM APIs that deserve additional explanation: </p><ul>
<li>
<a class="el" href="cstructureusagepatterns.html#statisticsretrieval">Statistics Retrieval</a> </li>
<li>
<a class="el" href="cstructureusagepatterns.html#configurationoptionstructures">Configuration Option Structures</a> </li>
</ul>
<p><br />
 </p>
<h2><a class="anchor" id="statisticsretrieval"></a>
Statistics Retrieval</h2>
<p>A class of application-visible UM structures are used by the UM statistics reporting APIs. For example, when an application self-monitors, it might periodically call <a class="el" href="lbm_8h.html#aa8f2d2e5b28e2c97911117acb099c48e" title="Retrieve the stats for a context. ">lbm_context_retrieve_stats()</a>:</p>
<div class="fragment"><div class="line"><a class="code" href="structlbm__context__stats__t__stct.html">lbm_context_stats_t</a> ctx_stats;</div><div class="line">...</div><div class="line">err = <a class="code" href="lbm_8h.html#aa8f2d2e5b28e2c97911117acb099c48e">lbm_context_retrieve_stats</a>(my_ctx, &amp;ctx_stats);</div></div><!-- fragment --><p>As usual, your application declares the structure in its memory and passes the address to the UM API. In this case it is an output, and UM will fill in the structure. As usual, UM will not maintain a reference to the passed-in structure. Your application is free to re-use or deallocate the space.</p>
<p>Contrast this with the receive-side <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/API/operations.tag:../Operations/" href="../Operations/monitoringumwiththelbmmonapi.html#receivingmonitoringdata">lbmmon API</a> which is callback based. See <a class="el" href="cstructureusagepatterns.html#lbmmoncallbackexample">lbmmon Callback Example</a></p>
<p><br />
 </p>
<h2><a class="anchor" id="configurationoptionstructures"></a>
Configuration Option Structures</h2>
<p>A class of application-visible UM structures are used by the UM Configuration APIs. For example, the configuration option <a class="elRef" doxygen="/29W/Amun/home/jenkins/backup_exclude.1/rc/UMQ_6.13.1_RC1/doc/API/config.tag:../Config/" href="../Config/grpdeliverycontrol.html#sourcenotificationfunctionreceiver">source_notification_function (receiver)</a> uses the <a class="el" href="structlbm__rcv__src__notification__func__t__stct.html">lbm_rcv_src_notification_func_t_stct</a> structure to pass application create and delete function pointers and an application client data pointer.</p>
<div class="fragment"><div class="line"><a class="code" href="structlbm__rcv__src__notification__func__t__stct.html">lbm_rcv_src_notification_func_t</a> src_notif_functs;  <span class="comment">/* Not a pointer. */</span></div><div class="line">...</div><div class="line">src_notif_functs.create_func = my_src_create_funct;</div><div class="line">src_notif_functs.delete_func = my_src_create_funct;</div><div class="line">src_notif_functs.clientd = my_state_pointer;</div><div class="line"></div><div class="line">err = <a class="code" href="lbm_8h.html#a1afc75f0fb3601d072b3463e7acf16a6">lbm_rcv_topic_attr_setopt</a>(rcv_attr, <span class="stringliteral">&quot;source_notification_function&quot;</span>,</div><div class="line">                                &amp;src_notif_functs, <span class="keyword">sizeof</span>(src_notif_functs));</div></div><!-- fragment --><p>Passing the size of the structure allows the API to perform a partial sanity check on the passed-in structure to make sure it is of the expected size.</p>
<p>When the _setopt() function returns, UM has copied the contents of src_notif_functs. UM does not maintain a reference to the passed-in structures, so the application is free to re-use or deallocate the space.</p>
<p><br />
 </p>
<h1><a class="anchor" id="umcallingapplicationcallback"></a>
UM Calling Application Callback</h1>
<p>UM typically delivers events to the application by callback. Information related to the event is passed to the application's callback function via structure pointers.</p>
<p>The "lbmmon</p>
<p>For example, when you create a receiver object, you pass it the address of your application's receiver callback function.</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> rcv_handle_msg(<a class="code" href="lbm_8h.html#a0a4af6b8247cc5a0a24a8578fb6e83bd">lbm_rcv_t</a> *rcv, <a class="code" href="structlbm__msg__t__stct.html">lbm_msg_t</a> *msg, <span class="keywordtype">void</span> *clientd)</div><div class="line">{</div><div class="line">  <span class="keywordflow">switch</span> (msg-&gt;<a class="code" href="structlbm__msg__t__stct.html#ab25327dc4b4ebf527106f6e708dbc05f">type</a>) {</div><div class="line">    ...</div><div class="line">  }</div><div class="line">  <span class="keywordflow">return</span> 0</div><div class="line">}</div><div class="line">...</div><div class="line">err = <a class="code" href="lbm_8h.html#aa7491c50fefbc2b70f8035fce7ac1477">lbm_rcv_create</a>(&amp;rcv, ctx, topic, rcv_handle_msg, NULL, NULL);</div></div><!-- fragment --><p>When a message is received (or any other receiver event needs to be delivered), UM allocates an <a class="el" href="lbm_8h.html#aaa7a945411e63884f12918417e8d117c">lbm_msg_t</a> structure and passes a pointer to it to the application's callback <a class="el" href="lbm_8h.html#aa7491c50fefbc2b70f8035fce7ac1477" title="Create a UM receiver that will receive messages sent to the given topic. ">lbm_rcv_create()</a>. The application can then de-reference the structure pointer and access the fields. However, the application <em>must not</em> retain a reference to the passed-in structure after the callback returns. UM is free to re-use or deallocate the structure.</p>
<p><a class="anchor" id="lbmmoncallbackexample"></a> As another example of callback, the lbmmon library delivers monitoring data to the monitoring application by callback. For example:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> my_ctx_stats_callback(<span class="keywordtype">void</span> *attr, <a class="code" href="structlbm__context__stats__t__stct.html">lbm_context_stats_t</a> *ctx_stats,</div><div class="line">                             <span class="keywordtype">void</span> *clientd)</div><div class="line">{</div><div class="line">  ...</div><div class="line">}</div></div><!-- fragment --><p>In this case, the lbmmon library declares the structure internally and passes the application a pointer to it. The application <em>must not</em> retain a reference to that structure after the callback returns. UM is free to re-use or deallocate the structure.</p>
<p>Contrast this with an application retrieving its own statistics. See <a class="el" href="cstructureusagepatterns.html#statisticsretrieval">Statistics Retrieval</a>. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
